(self.webpackChunkspeculatron=self.webpackChunkspeculatron||[]).push([[179],{89:(At,Et,Fe)=>{"use strict";var Ue=Fe(95),Ne=Fe(703),h="\n  ",H={};function Me(dt){var le=Array.isArray(dt);return function(Oe){var ve=Ce(H.plainArray,Oe);if(ve)return ve;if(le&&Oe.length!==dt.length)return"an array with "+dt.length+" items";for(var He=0;He<Oe.length;He++)if(ve=Ce(le?dt[He]:dt,Oe[He]))return[He].concat(ve)}}function Ce(dt,le){if(null!=le||dt.hasOwnProperty("__required")){var ze=dt(le);if(ze)return Array.isArray(ze)?ze:[ze]}}function ce(dt,le){var ze=dt.length,Ve=dt[ze-1],Oe=dt.slice(0,ze-1);return 0===Oe.length&&(Oe=["value"]),le=Ne(le,{path:Oe}),"function"==typeof Ve?Ve(le):Xe(le,function rt(dt){return"must be "+function Ft(dt){return/^an? /.test(dt)?dt:/^[aeiou]/i.test(dt)?"an "+dt:/^[a-z]/i.test(dt)?"a "+dt:dt}(dt)+"."}(Ve))}function Te(dt){return dt.length<2?dt[0]:2===dt.length?dt.join(" or "):dt.slice(0,-1).join(", ")+", or "+dt.slice(-1)}function Xe(dt,le){return(yt(dt.path)?"Item at position ":"")+dt.path.join(".")+" "+le}function yt(dt){return"number"==typeof dt[dt.length-1]||"number"==typeof dt[0]}H.assert=function(dt,le){return le=le||{},function(ze){var Ve=Ce(dt,ze);if(Ve){var Oe=ce(Ve,le);throw le.apiName&&(Oe=le.apiName+": "+Oe),new Error(Oe)}}},H.shape=function(le){var ze=function ft(dt){return Object.keys(dt||{}).map(function(le){return{key:le,value:dt[le]}})}(le);return function(Oe){var ve=Ce(H.plainObject,Oe);if(ve)return ve;for(var He,je=[],Pt=0;Pt<ze.length;Pt++)(ve=Ce(ze[Pt].value,Oe[He=ze[Pt].key]))&&je.push([He].concat(ve));return je.length<2?je[0]:function(Xt){je=je.map(function(Mt){return"- "+Mt[0]+": "+ce(Mt,Xt).split("\n").join(h)});var jt=Xt.path.join(".");return"The following properties"+("value"===jt?"":" of "+jt)+" have invalid values:"+h+je.join(h)}}},H.strictShape=function(le){var ze=H.shape(le);return function(Oe){var ve=ze(Oe);if(ve)return ve;var He=Object.keys(Oe).reduce(function(Je,je){return void 0===le[je]&&Je.push(je),Je},[]);return 0!==He.length?function(){return"The following keys are invalid: "+He.join(", ")}:void 0}},H.arrayOf=function(le){return Me(le)},H.tuple=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Me(le)},H.required=function(le){function ze(Ve){return null==Ve?function(Oe){return Xe(Oe,yt(Oe.path)?"cannot be undefined/null.":"is required.")}:le.apply(this,arguments)}return ze.__required=!0,ze},H.oneOfType=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Ve){var Oe=le.map(function(ve){return Ce(ve,Ve)}).filter(Boolean);if(Oe.length===le.length)return Oe.every(function(ve){return 1===ve.length&&"string"==typeof ve[0]})?Te(Oe.map(function(ve){return ve[0]})):Oe.reduce(function(ve,He){return He.length>ve.length?He:ve})}},H.equal=function(le){return function(Ve){if(Ve!==le)return JSON.stringify(le)}},H.oneOf=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),ze=le.map(function(Ve){return H.equal(Ve)});return H.oneOfType.apply(this,ze)},H.range=function(le){var ze=le[0],Ve=le[1];return function(ve){if(Ce(H.number,ve)||ve<ze||ve>Ve)return"number between "+ze+" & "+Ve+" (inclusive)"}},H.any=function(){},H.boolean=function(le){if("boolean"!=typeof le)return"boolean"},H.number=function(le){if("number"!=typeof le)return"number"},H.plainArray=function(le){if(!Array.isArray(le))return"array"},H.plainObject=function(le){if(!Ue(le))return"object"},H.string=function(le){if("string"!=typeof le)return"string"},H.func=function(le){if("function"!=typeof le)return"function"},H.validate=Ce,H.processMessage=ce,At.exports=H},95:At=>{"use strict";var Et=Object.prototype.toString;At.exports=function(Fe){var Ue;return"[object Object]"===Et.call(Fe)&&(null===(Ue=Object.getPrototypeOf(Fe))||Ue===Object.getPrototypeOf({}))}},564:(At,Et,Fe)=>{"use strict";var Ue=Fe(652).x0;function Ne(xe){this.origin=xe.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=xe.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=xe,this.send=this.send.bind(this),this.countries=xe.countries?xe.countries.split(","):null,this.types=xe.types?xe.types.split(","):null,this.bbox=xe.bbox?xe.bbox:null,this.language=xe.language?xe.language.split(","):null,this.limit=xe.limit?+xe.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(xe),this.eventQueue=new Array,this.flushInterval=xe.flushInterval||1e3,this.maxQueueSize=xe.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Ne.prototype={select:function(xe,h){var H=this.getSelectedIndex(xe,h),Me=this.getEventPayload("search.select",h);if(Me.resultIndex=H,Me.resultPlaceName=xe.place_name,Me.resultId=xe.id,(H!==this.lastSentIndex||Me.queryString!==this.lastSentInput)&&-1!=H&&(this.lastSentIndex=H,this.lastSentInput=Me.queryString,Me.queryString))return this.push(Me)},start:function(xe){var h=this.getEventPayload("search.start",xe);if(h.queryString)return this.push(h)},keyevent:function(xe,h){if(xe.key&&!xe.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(xe.keyCode)){var H=this.getEventPayload("search.keystroke",h);if(H.lastAction=xe.key,H.queryString)return this.push(H)}},send:function(xe,h){if(!this.enableEventLogging)return h?h():void 0;var H=this.getRequestOptions(xe);this.request(H,function(Me){return Me?this.handleError(Me,h):h?h():void 0}.bind(this))},getRequestOptions:function(xe){return Array.isArray(xe)||(xe=[xe]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(xe)}},getEventPayload:function(xe,h){var H;H=h.options.proximity?"object"==typeof h.options.proximity?[h.options.proximity.longitude,h.options.proximity.latitude]:"ip"===h.options.proximity?[999,999]:h.options.proximity:null;var Me=h._map?h._map.getZoom():void 0,Ce={event:xe,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:h.options.autocomplete,fuzzyMatch:h.options.fuzzyMatch,proximity:H,limit:h.options.limit,routing:h.options.routing,worldview:h.options.worldview,mapZoom:Me,keyboardLocale:this.locale};return Ce.queryString="search.select"===xe?h.inputString:"search.select"!=xe&&h._inputEl?h._inputEl.value:h.inputString,Ce},request:function(xe,h){var H=new XMLHttpRequest;for(var Me in H.onreadystatechange=function(){if(4==this.readyState)return h(204==this.status?null:this.statusText)},H.open(xe.method,xe.host+"/"+xe.path,!0),xe.headers)H.setRequestHeader(Me,xe.headers[Me]);H.send(xe.body)},handleError:function(xe,h){if(h)return h(xe)},generateSessionID:function(){return Ue()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(xe,h){if(h._typeahead){var Me=xe.id;return h._typeahead.data.map(function(Te){return Te.id}).indexOf(Me)}},shouldEnableLogging:function(xe){return!(!1===xe.enableEventLogging||xe.origin&&"https://api.mapbox.com"!==xe.origin||xe.localGeocoder||xe.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(xe,h){this.eventQueue.push(xe),(this.eventQueue.length>=this.maxQueueSize||h)&&this.flush()},remove:function(){this.flush()}},At.exports=Ne},424:At=>{At.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},569:At=>{function Et(){}Et.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const Fe={enableHighAccuracy:!0};return new Promise(function(Ue,Ne){window.navigator.geolocation.getCurrentPosition(Ue,Ne,Fe)})}},At.exports=Et},545:(At,Et,Fe)=>{"use strict";var Ue=Fe(562),Ne=Fe(82),xe=Fe(703),h=Fe(69).EventEmitter,H=Fe(424),Me=Fe(471),Ce=Fe(75),ce=Fe(564),Te=Fe(234),rt=Fe(775),Ft=Fe(569),Xe=Fe(777);function dt(le){this._eventEmitter=new h,this.options=xe({},this.options,le),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Ft}dt.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(le){return le.place_name},render:function(le){var ze=le.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+ze[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+ze.splice(1,ze.length).join(",")+"</div></div>"}},addTo:function(le){function ze(Ve,Oe){if(!document.body.contains(Oe))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ve=Ve.onAdd();Oe.appendChild(ve)}if(le._controlContainer)le.addControl(this);else if(le instanceof HTMLElement)ze(this,le);else{if("string"!=typeof le)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Ve=document.querySelectorAll(le);if(0===Ve.length)throw new Error("Element ",le,"not found.");if(Ve.length>1)throw new Error("Geocoder can only be added to a single html element");ze(this,Ve[0])}}},onAdd:function(le){if(le&&"string"!=typeof le&&(this._map=le),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Ce(Me({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ce(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var ze=this.container=document.createElement("div");ze.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Ve=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ne(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Xt){this.eventManager.keyevent(Xt,this)}.bind(this));var Oe=document.createElement("div");Oe.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ve=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ve),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Oe.appendChild(this._clearEl),Oe.appendChild(this._loadingEl),ze.appendChild(Ve),ze.appendChild(this._inputEl),ze.appendChild(Oe),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var He=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(He),Oe.appendChild(this._geolocateEl),this._showGeolocateButton()}var Je=this._typeahead=new Ue(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Je.getItemValue=this.options.getItemValue;var je=Je.list.draw,Pt=this._footerNode=function ft(){var le=document.createElement("div");return le.className="mapboxgl-ctrl-geocoder--powered-by",le.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',le}();return Je.list.draw=function(){je.call(this),Pt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Pt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Pt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),ze},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(le){this._hideLoadingIcon();const ze={geometry:{type:"Point",coordinates:[le.coords.longitude,le.coords.latitude]}};this._handleMarker(ze),this._fly(ze),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(ze),this._showClearButton(),this.fresh=!1;const Ve={limit:1,language:[this.options.language],query:ze.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(ze.geometry.coordinates[0]+","+ze.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:ze})):this.geocoderService.reverseGeocode(Ve).send().then(function(Oe){const ve=Oe.body.features[0];if(ve){const He=Xe.transformFeatureToGeolocationText(ve,this.options.addressAccuracy);this._setInputValue(He),ve.user_coordinates=ze.geometry.coordinates,this._eventEmitter.emit("result",{result:ve})}else this._eventEmitter.emit("result",{result:{user_coordinates:ze.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(le){1===le.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(le,ze){var Ve=document.createElementNS("http://www.w3.org/2000/svg","svg");return Ve.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+le),Ve.setAttribute("viewBox","0 0 18 18"),Ve.setAttribute("xml:space","preserve"),Ve.setAttribute("width",18),Ve.setAttribute("height",18),Ve.innerHTML=ze,Ve},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(le){this._inputEl.value=le,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(le){var ze=(le.clipboardData||window.clipboardData).getData("text");ze.length>=this.options.minLength&&this._geocode(ze)},_onKeyDown:function(le){var ze=27,Ve=9;if(le.keyCode===ze&&this.options.clearAndBlurOnEsc)return this._clear(le),this._inputEl.blur();var Oe=le.target&&le.target.shadowRoot?le.target.shadowRoot.activeElement:le.target;if(!Oe||!Oe.value)return this.fresh=!0,le.keyCode!==Ve&&this.clear(le),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!le.metaKey&&-1===[Ve,ze,37,39,13,38,40].indexOf(le.keyCode)&&Oe.value.length>=this.options.minLength&&this._geocode(Oe.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(le){this.options.clearOnBlur&&this._clearOnBlur(le),this.options.collapsed&&this._collapse()},_onChange:function(){var le=this._typeahead.selected;le&&JSON.stringify(le)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(le),this.options.marker&&this._mapboxgl&&this._handleMarker(le),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(le),this._eventEmitter.emit("result",{result:le}),this.eventManager.select(le,this))},_fly:function(le){var ze;if(le.properties&&H[le.properties.short_code])ze=xe({},this.options.flyTo),this._map&&this._map.fitBounds(H[le.properties.short_code].bbox,ze);else if(le.bbox){var Ve=le.bbox;ze=xe({},this.options.flyTo),this._map&&this._map.fitBounds([[Ve[0],Ve[1]],[Ve[2],Ve[3]]],ze)}else ze=xe({},{zoom:this.options.zoom},this.options.flyTo),le.center?ze.center=le.center:le.geometry&&le.geometry.type&&"Point"===le.geometry.type&&le.geometry.coordinates&&(ze.center=le.geometry.coordinates),this._map&&this._map.flyTo(ze)},_requestType:function(le,ze){return le.localGeocoderOnly?1:le.reverseGeocode&&Xe.REVERSE_GEOCODE_COORD_RGX.test(ze)?2:0},_setupConfig:function(le,ze){const Oe=/[\s,]+/;var ve=this,He=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(je,Pt){return null==ve.options[Pt]||(je[Pt]=["countries","types","language"].indexOf(Pt)>-1?ve.options[Pt].split(Oe):ve.options[Pt],"proximity"===Pt&&"number"==typeof ve.options[Pt].longitude&&"number"==typeof ve.options[Pt].latitude&&(je[Pt]=[ve.options[Pt].longitude,ve.options[Pt].latitude])),je},{});switch(le){case 2:var Je=ze.split(Oe).map(function(je){return parseFloat(je,10)});ve.options.flipCoordinates||Je.reverse(),He=xe(He,{query:Je,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(je){je in He&&delete He[je]});break;case 0:{const je=ze.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(je)&&(ze=ze.replace(/,/g," ")),He=xe(He,{query:ze})}}return He},_geocode:function(le){this.inputString=le,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:le});const ze=this._requestType(this.options,le),Ve=this._setupConfig(ze,le);var Oe;switch(ze){case 1:Oe=Promise.resolve();break;case 0:Oe=this.geocoderService.forwardGeocode(Ve).send();break;case 2:Oe=this.geocoderService.reverseGeocode(Ve).send()}var ve=this.options.localGeocoder&&this.options.localGeocoder(le)||[],He=[],Je=null;return Oe.catch(function(je){Je=je}.bind(this)).then(function(je){this._hideLoadingIcon();var Pt={};return je?"200"==je.statusCode&&((Pt=je.body).request=je.request,Pt.headers=je.headers):Pt={type:"FeatureCollection",features:[]},Pt.config=Ve,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Pt.features=Pt.features?ve.concat(Pt.features):ve,this.options.externalGeocoder?(He=this.options.externalGeocoder(le,Pt.features)||Promise.resolve([])).then(function(Xt){return Pt.features=Pt.features?Xt.concat(Pt.features):Xt,Pt},function(){return Pt}):Pt}.bind(this)).then(function(je){if(Je)throw Je;this.options.filter&&je.features.length&&(je.features=je.features.filter(this.options.filter)),je.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",je),this._typeahead.update(je.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",je))}.bind(this)).catch(function(je){this._hideLoadingIcon(),this._hideAttribution(),ve.length&&this.options.localGeocoder||He.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ve)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ve}),this._eventEmitter.emit("error",{error:je})}.bind(this)),Oe},_clear:function(le){le&&le.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(le){this._clear(le),this._inputEl.focus()},_clearOnBlur:function(le){le.relatedTarget&&this._clear(le)},_onQueryResult:function(le){var ze=le.body;if(ze.features.length){var Ve=ze.features[0];this._typeahead.selected=Ve,this._inputEl.value=Ve.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var le=this._map.getCenter().wrap();this.setProximity({longitude:le.lng,latitude:le.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(le){return this._geocode(le).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(le){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(le)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var le=this.options.language.split(",")[0],ze=rt.language(le),Ve=Te.placeholder[ze];if(Ve)return Ve}return"Search"},setInput:function(le){return this._inputEl.value=le,this._typeahead.selected=null,this._typeahead.clear(),le.length>=this.options.minLength&&this._geocode(le),this},setProximity:function(le,ze=!0){return this.options.proximity=le,ze&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(le){return le&&"function"==typeof le&&(this._typeahead.render=le),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(le){var ze=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=le||this.options.language||ze,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(le){return this.options.zoom=le,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(le){return this.options.flyTo=le,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(le){return this.placeholder=le||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(le){return this.options.bbox=le,this},getCountries:function(){return this.options.countries},setCountries:function(le){return this.options.countries=le,this},getTypes:function(){return this.options.types},setTypes:function(le){return this.options.types=le,this},getMinLength:function(){return this.options.minLength},setMinLength:function(le){return this.options.minLength=le,this._typeahead&&(this._typeahead.options.minLength=le),this},getLimit:function(){return this.options.limit},setLimit:function(le){return this.options.limit=le,this._typeahead&&(this._typeahead.options.limit=le),this},getFilter:function(){return this.options.filter},setFilter:function(le){return this.options.filter=le,this},setOrigin:function(le){return this.options.origin=le,this.geocoderService=Ce(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(le){return this.options.accessToken=le,this.geocoderService=Ce(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(le){return this.options.autocomplete=le,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(le){return this.options.fuzzyMatch=le,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(le){return this.options.routing=le,this},getRouting:function(){return this.options.routing},setWorldview:function(le){return this.options.worldview=le,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(le){if(this._map){this._removeMarker();var Ve=xe({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Ve),le.center?this.mapMarker.setLngLat(le.center).addTo(this._map):le.geometry&&le.geometry.type&&"Point"===le.geometry.type&&le.geometry.coordinates&&this.mapMarker.setLngLat(le.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(le,ze){return this._eventEmitter.on(le,ze),this},off:function(le,ze){return this._eventEmitter.removeListener(le,ze),this.eventManager.remove(),this}},At.exports=dt},234:At=>{"use strict";At.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},777:At=>{function Fe(Ne){const xe=Ne.address||"",h=Ne.text||"",H=Ne.place_name||"",Ce={address:H.split(",")[0],houseNumber:xe,street:h,placeName:H};return Ne.context.forEach(function(ce){const Te=ce.id.split(".")[0];Ce[Te]=ce.text}),Ce}At.exports={transformFeatureToGeolocationText:function Et(Ne,xe){const h=Fe(Ne),H=["address","street","place","country"];if("function"==typeof xe)return xe(h);const Ce=H.indexOf(xe);return(-1===Ce?H:H.slice(Ce)).reduce(function(ce,Te){return h[Te]?(""!==ce&&(ce+=", "),ce+h[Te]):ce},"")},getAddressInfo:Fe,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},471:(At,Et,Fe)=>{"use strict";var Ue=Fe(454);At.exports=Ue},454:(At,Et,Fe)=>{"use strict";var Ue=Fe(753),Ne=Fe(176);function xe(H){Ne.call(this,H)}(xe.prototype=Object.create(Ne.prototype)).constructor=xe,xe.prototype.sendRequest=Ue.browserSend,xe.prototype.abortRequest=Ue.browserAbort,At.exports=function h(H){return new xe(H)}},753:(At,Et,Fe)=>{"use strict";var Ue=Fe(332),Ne=Fe(158),xe=Fe(719),h=Fe(829),H={};function ce(Xe){var yt=Xe.total,ft=Xe.loaded;return{total:yt,transferred:ft,percent:100*ft/yt}}function Te(Xe,yt){return new Promise(function(ft,dt){yt.onprogress=function(Ve){Xe.emitter.emit(xe.EVENT_PROGRESS_DOWNLOAD,ce(Ve))};var le=Xe.file;le&&(yt.upload.onprogress=function(Ve){Xe.emitter.emit(xe.EVENT_PROGRESS_UPLOAD,ce(Ve))}),yt.onerror=function(Ve){dt(Ve)},yt.onabort=function(){var Ve=new Ne({request:Xe,type:xe.ERROR_REQUEST_ABORTED});dt(Ve)},yt.onload=function(){if(delete H[Xe.id],yt.status<200||yt.status>=400){var Ve=new Ne({request:Xe,body:yt.response,statusCode:yt.status});dt(Ve)}else ft(yt)};var ze=Xe.body;"string"==typeof ze?yt.send(ze):ze?yt.send(JSON.stringify(ze)):le?yt.send(le):yt.send(),H[Xe.id]=yt}).then(function(ft){return function Ce(Xe,yt){return new Ue(Xe,{body:yt.response,headers:h(yt.getAllResponseHeaders()),statusCode:yt.status})}(Xe,ft)})}function rt(Xe,yt){var ft=Xe.url(yt),dt=new window.XMLHttpRequest;return dt.open(Xe.method,ft),Object.keys(Xe.headers).forEach(function(le){dt.setRequestHeader(le,Xe.headers[le])}),dt}At.exports={browserAbort:function Me(Xe){var yt=H[Xe.id];!yt||(yt.abort(),delete H[Xe.id])},sendRequestXhr:Te,browserSend:function Ft(Xe){return Promise.resolve().then(function(){var yt=rt(Xe,Xe.client.accessToken);return Te(Xe,yt)})},createRequestXhr:rt}},176:(At,Et,Fe)=>{"use strict";var Ue=Fe(129),Ne=Fe(538),xe=Fe(719);function h(H){if(!H||!H.accessToken)throw new Error("Cannot create a client without an access token");Ue(H.accessToken),this.accessToken=H.accessToken,this.origin=H.origin||xe.API_ORIGIN}h.prototype.createRequest=function(Me){return new Ne(this,Me)},At.exports=h},158:(At,Et,Fe)=>{"use strict";var Ue=Fe(719);At.exports=function Ne(xe){var H,h=xe.type||Ue.ERROR_HTTP;if(xe.body)try{H=JSON.parse(xe.body)}catch{H=xe.body}else H=null;var Me=xe.message||null;Me||("string"==typeof H?Me=H:H&&"string"==typeof H.message?Me=H.message:h===Ue.ERROR_REQUEST_ABORTED&&(Me="Request aborted")),this.message=Me,this.type=h,this.statusCode=xe.statusCode||null,this.request=xe.request,this.body=H}},538:(At,Et,Fe)=>{"use strict";var Ue=Fe(129),Ne=Fe(703),xe=Fe(661),h=Fe(449),H=Fe(719),Me=1;function Ce(ce,Te){if(!ce)throw new Error("MapiRequest requires a client");if(!Te||!Te.path||!Te.method)throw new Error("MapiRequest requires an options object with path and method properties");var rt={};Te.body&&(rt["content-type"]="application/json");var Ft=Ne(rt,Te.headers),Xe=Object.keys(Ft).reduce(function(yt,ft){return yt[ft.toLowerCase()]=Ft[ft],yt},{});this.id=Me++,this._options=Te,this.emitter=new xe,this.client=ce,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Te.path,this.method=Te.method,this.origin=Te.origin||ce.origin,this.query=Te.query||{},this.params=Te.params||{},this.body=Te.body||null,this.file=Te.file||null,this.encoding=Te.encoding||"utf8",this.sendFileAs=Te.sendFileAs||null,this.headers=Xe}Ce.prototype.url=function(Te){var rt=h.prependOrigin(this.path,this.origin);rt=h.appendQueryObject(rt,this.query);var Ft=this.params,Xe=Te??this.client.accessToken;if(Xe){rt=h.appendQueryParam(rt,"access_token",Xe);var yt=Ue(Xe).user;Ft=Ne({ownerId:yt},Ft)}return h.interpolateRouteParams(rt,Ft)},Ce.prototype.send=function(){var Te=this;if(Te.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Te.sent=!0,Te.client.sendRequest(Te).then(function(rt){return Te.response=rt,Te.emitter.emit(H.EVENT_RESPONSE,rt),rt},function(rt){throw Te.error=rt,Te.emitter.emit(H.EVENT_ERROR,rt),rt})},Ce.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Ce.prototype.eachPage=function(Te){var rt=this;function Ft(ft){Te(null,ft,function dt(){delete rt._nextPageRequest;var le=ft.nextPage();le&&(rt._nextPageRequest=le,yt(le))})}function Xe(ft){Te(ft,null,function(){})}function yt(ft){ft.send().then(Ft,Xe)}yt(this)},Ce.prototype.clone=function(){return this._extend()},Ce.prototype._extend=function(Te){var rt=Ne(this._options,Te);return new Ce(this.client,rt)},At.exports=Ce},332:(At,Et,Fe)=>{"use strict";var Ue=Fe(699);function Ne(xe,h){this.request=xe,this.headers=h.headers,this.rawBody=h.body,this.statusCode=h.statusCode;try{this.body=JSON.parse(h.body||"{}")}catch{this.body=h.body}this.links=Ue(this.headers.link)}Ne.prototype.hasNextPage=function(){return!!this.links.next},Ne.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},At.exports=Ne},719:At=>{"use strict";At.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},829:At=>{"use strict";At.exports=function Fe(Ue){var Ne={};return Ue&&Ue.trim().split(/[\r|\n]+/).forEach(function(xe){var h=function Et(Ue){var Ne=Ue.indexOf(":");return{name:Ue.substring(0,Ne).trim().toLowerCase(),value:Ue.substring(Ne+1).trim()}}(xe);Ne[h.name]=h.value}),Ne}},699:At=>{"use strict";At.exports=function Ue(Ne){return Ne?Ne.split(/,\s*</).reduce(function(xe,h){var H=function Fe(Ne){var xe=Ne.match(/<?([^>]*)>(.*)/);if(!xe)return null;var h=xe[1],H=xe[2].split(";"),Me=null,Ce=H.reduce(function(ce,Te){var rt=function Et(Ne){var xe=Ne.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return xe?{key:xe[1],value:xe[2]}:null}(Te);return rt?"rel"===rt.key?(Me||(Me=rt.value),ce):(ce[rt.key]=rt.value,ce):ce},{});return Me?{url:h,rel:Me,params:Ce}:null}(h);return H?(H.rel.split(/\s+/).forEach(function(Ce){xe[Ce]||(xe[Ce]={url:H.url,params:H.params})}),xe):xe},{}):{}}},449:At=>{"use strict";function Fe(H){return Array.isArray(H)?function Et(H){return H.map(encodeURIComponent).join(",")}(H):encodeURIComponent(String(H))}function Ue(H,Me,Ce){if(!1===Ce||null===Ce)return H;var ce=/\?/.test(H)?"&":"?",Te=encodeURIComponent(Me);return void 0!==Ce&&""!==Ce&&!0!==Ce&&(Te+="="+Fe(Ce)),""+H+ce+Te}At.exports={appendQueryObject:function Ne(H,Me){if(!Me)return H;var Ce=H;return Object.keys(Me).forEach(function(ce){var Te=Me[ce];void 0!==Te&&(Array.isArray(Te)&&(Te=Te.filter(function(rt){return null!=rt}).join(",")),Ce=Ue(Ce,ce,Te))}),Ce},appendQueryParam:Ue,prependOrigin:function xe(H,Me){if(!Me||"http"===H.slice(0,4))return H;var Ce="/"===H[0]?"":"/";return""+Me.replace(/\/$/,"")+Ce+H},interpolateRouteParams:function h(H,Me){return Me?H.replace(/\/:([a-zA-Z0-9]+)/g,function(Ce,ce){var Te=Me[ce];if(void 0===Te)throw new Error("Unspecified route parameter "+ce);return"/"+Fe(Te)}):H}}},661:At=>{"use strict";var Et=Object.prototype.hasOwnProperty,Fe="~";function Ue(){}function Ne(Me,Ce,ce){this.fn=Me,this.context=Ce,this.once=ce||!1}function xe(Me,Ce,ce,Te,rt){if("function"!=typeof ce)throw new TypeError("The listener must be a function");var Ft=new Ne(ce,Te||Me,rt),Xe=Fe?Fe+Ce:Ce;return Me._events[Xe]?Me._events[Xe].fn?Me._events[Xe]=[Me._events[Xe],Ft]:Me._events[Xe].push(Ft):(Me._events[Xe]=Ft,Me._eventsCount++),Me}function h(Me,Ce){0==--Me._eventsCount?Me._events=new Ue:delete Me._events[Ce]}function H(){this._events=new Ue,this._eventsCount=0}Object.create&&(Ue.prototype=Object.create(null),(new Ue).__proto__||(Fe=!1)),H.prototype.eventNames=function(){var ce,Te,Ce=[];if(0===this._eventsCount)return Ce;for(Te in ce=this._events)Et.call(ce,Te)&&Ce.push(Fe?Te.slice(1):Te);return Object.getOwnPropertySymbols?Ce.concat(Object.getOwnPropertySymbols(ce)):Ce},H.prototype.listeners=function(Ce){var Te=this._events[Fe?Fe+Ce:Ce];if(!Te)return[];if(Te.fn)return[Te.fn];for(var rt=0,Ft=Te.length,Xe=new Array(Ft);rt<Ft;rt++)Xe[rt]=Te[rt].fn;return Xe},H.prototype.listenerCount=function(Ce){var Te=this._events[Fe?Fe+Ce:Ce];return Te?Te.fn?1:Te.length:0},H.prototype.emit=function(Ce,ce,Te,rt,Ft,Xe){var yt=Fe?Fe+Ce:Ce;if(!this._events[yt])return!1;var le,ze,ft=this._events[yt],dt=arguments.length;if(ft.fn){switch(ft.once&&this.removeListener(Ce,ft.fn,void 0,!0),dt){case 1:return ft.fn.call(ft.context),!0;case 2:return ft.fn.call(ft.context,ce),!0;case 3:return ft.fn.call(ft.context,ce,Te),!0;case 4:return ft.fn.call(ft.context,ce,Te,rt),!0;case 5:return ft.fn.call(ft.context,ce,Te,rt,Ft),!0;case 6:return ft.fn.call(ft.context,ce,Te,rt,Ft,Xe),!0}for(ze=1,le=new Array(dt-1);ze<dt;ze++)le[ze-1]=arguments[ze];ft.fn.apply(ft.context,le)}else{var Oe,Ve=ft.length;for(ze=0;ze<Ve;ze++)switch(ft[ze].once&&this.removeListener(Ce,ft[ze].fn,void 0,!0),dt){case 1:ft[ze].fn.call(ft[ze].context);break;case 2:ft[ze].fn.call(ft[ze].context,ce);break;case 3:ft[ze].fn.call(ft[ze].context,ce,Te);break;case 4:ft[ze].fn.call(ft[ze].context,ce,Te,rt);break;default:if(!le)for(Oe=1,le=new Array(dt-1);Oe<dt;Oe++)le[Oe-1]=arguments[Oe];ft[ze].fn.apply(ft[ze].context,le)}}return!0},H.prototype.on=function(Ce,ce,Te){return xe(this,Ce,ce,Te,!1)},H.prototype.once=function(Ce,ce,Te){return xe(this,Ce,ce,Te,!0)},H.prototype.removeListener=function(Ce,ce,Te,rt){var Ft=Fe?Fe+Ce:Ce;if(!this._events[Ft])return this;if(!ce)return h(this,Ft),this;var Xe=this._events[Ft];if(Xe.fn)Xe.fn===ce&&(!rt||Xe.once)&&(!Te||Xe.context===Te)&&h(this,Ft);else{for(var yt=0,ft=[],dt=Xe.length;yt<dt;yt++)(Xe[yt].fn!==ce||rt&&!Xe[yt].once||Te&&Xe[yt].context!==Te)&&ft.push(Xe[yt]);ft.length?this._events[Ft]=1===ft.length?ft[0]:ft:h(this,Ft)}return this},H.prototype.removeAllListeners=function(Ce){var ce;return Ce?this._events[ce=Fe?Fe+Ce:Ce]&&h(this,ce):(this._events=new Ue,this._eventsCount=0),this},H.prototype.off=H.prototype.removeListener,H.prototype.addListener=H.prototype.on,H.prefixed=Fe,H.EventEmitter=H,At.exports=H},75:(At,Et,Fe)=>{"use strict";var Ue=Fe(703),Ne=Fe(801),xe=Fe(313),h=Fe(836),H=Fe(497),Me={},Ce=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Me.forwardGeocode=function(ce){Ne.assertShape({query:Ne.required(Ne.string),mode:Ne.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ne.arrayOf(Ne.string),proximity:Ne.oneOf(Ne.coordinates,"ip"),types:Ne.arrayOf(Ne.oneOf(Ce)),autocomplete:Ne.boolean,bbox:Ne.arrayOf(Ne.number),limit:Ne.number,language:Ne.arrayOf(Ne.string),routing:Ne.boolean,fuzzyMatch:Ne.boolean,worldview:Ne.string})(ce),ce.mode=ce.mode||"mapbox.places";var Te=h(Ue({country:ce.countries},xe(ce,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:xe(ce,["mode","query"]),query:Te})},Me.reverseGeocode=function(ce){Ne.assertShape({query:Ne.required(Ne.coordinates),mode:Ne.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ne.arrayOf(Ne.string),types:Ne.arrayOf(Ne.oneOf(Ce)),bbox:Ne.arrayOf(Ne.number),limit:Ne.number,language:Ne.arrayOf(Ne.string),reverseMode:Ne.oneOf("distance","score"),routing:Ne.boolean,worldview:Ne.string})(ce),ce.mode=ce.mode||"mapbox.places";var Te=h(Ue({country:ce.countries},xe(ce,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:xe(ce,["mode","query"]),query:Te})},At.exports=H(Me)},497:(At,Et,Fe)=>{"use strict";var Ue=Fe(176),Ne=Fe(454);At.exports=function xe(h){return function(H){var Me;Me=Ue.prototype.isPrototypeOf(H)?H:Ne(H);var Ce=Object.create(h);return Ce.client=Me,Ce}}},621:At=>{"use strict";At.exports=function Et(Fe,Ue){return Object.keys(Fe).reduce(function(Ne,xe){return Ne[xe]=Ue(xe,Fe[xe]),Ne},{})}},313:At=>{"use strict";At.exports=function Et(Fe,Ue){var Ne=function(xe,h){return-1!==Ue.indexOf(xe)&&void 0!==h};return"function"==typeof Ue&&(Ne=Ue),Object.keys(Fe).filter(function(xe){return Ne(xe,Fe[xe])}).reduce(function(xe,h){return xe[h]=Fe[h],xe},{})}},836:(At,Et,Fe)=>{"use strict";var Ue=Fe(621);At.exports=function Ne(xe){return Ue(xe,function(h,H){return"boolean"==typeof H?JSON.stringify(H):H})}},801:(At,Et,Fe)=>{"use strict";var Ue=Fe(703),Ne=Fe(89);At.exports=Ue(Ne,{file:function xe(Ce){return typeof window<"u"?Ce instanceof global.Blob||Ce instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Ce&&void 0===Ce.pipe?"Filename or Readable stream":void 0},date:function H(Ce){var ce="date";if("boolean"==typeof Ce)return ce;try{var Te=new Date(Ce);if(Te.getTime&&isNaN(Te.getTime()))return ce}catch{return ce}},coordinates:function Me(Ce){return Ne.tuple(Ne.number,Ne.number)(Ce)},assertShape:function h(Ce,ce){return Ne.assert(Ne.strictShape(Ce),ce)}})},129:(At,Et,Fe)=>{"use strict";var Ue=Fe(49),Ne={};function H(Me,Ce){return Object.prototype.hasOwnProperty.call(Me,Ce)}At.exports=function xe(Me){if(Ne[Me])return Ne[Me];var Ce=Me.split("."),ce=Ce[0],Te=Ce[1];if(!Te)throw new Error("Invalid token");var rt=function h(Me){try{return JSON.parse(Ue.decode(Me))}catch{throw new Error("Invalid token")}}(Te),Ft={usage:ce,user:rt.u};return H(rt,"a")&&(Ft.authorization=rt.a),H(rt,"exp")&&(Ft.expires=1e3*rt.exp),H(rt,"iat")&&(Ft.created=1e3*rt.iat),H(rt,"scopes")&&(Ft.scopes=rt.scopes),H(rt,"client")&&(Ft.client=rt.client),H(rt,"ll")&&(Ft.lastLogin=rt.ll),H(rt,"iu")&&(Ft.impersonator=rt.iu),Ne[Me]=Ft,Ft}},729:(At,Et,Fe)=>{"use strict";function Ue(e){return"function"==typeof e}function Ne(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const xe=Ne(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,l)=>`${l+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function h(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class H{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const p of n)p.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(Ue(i))try{i()}catch(p){t=p instanceof xe?p.errors:[p]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const p of l)try{ce(p)}catch(y){t=t??[],y instanceof xe?t=[...t,...y.errors]:t.push(y)}}if(t)throw new xe(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ce(t);else{if(t instanceof H){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&h(n,t)}remove(t){const{_finalizers:n}=this;n&&h(n,t),t instanceof H&&t._removeParent(this)}}H.EMPTY=(()=>{const e=new H;return e.closed=!0,e})();const Me=H.EMPTY;function Ce(e){return e instanceof H||e&&"closed"in e&&Ue(e.remove)&&Ue(e.add)&&Ue(e.unsubscribe)}function ce(e){Ue(e)?e():e.unsubscribe()}const Te={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rt={setTimeout(e,t,...n){const{delegate:i}=rt;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=rt;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Ft(e){rt.setTimeout(()=>{const{onUnhandledError:t}=Te;if(!t)throw e;t(e)})}function Xe(){}const yt=le("C",void 0,void 0);function le(e,t,n){return{kind:e,value:t,error:n}}let ze=null;function Ve(e){if(Te.useDeprecatedSynchronousErrorHandling){const t=!ze;if(t&&(ze={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=ze;if(ze=null,n)throw i}}else e()}class ve extends H{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Ce(t)&&t.add(this)):this.destination=Mt}static create(t,n,i){return new Pt(t,n,i)}next(t){this.isStopped?wt(function dt(e){return le("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?wt(function ft(e){return le("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?wt(yt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const He=Function.prototype.bind;function Je(e,t){return He.call(e,t)}class je{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){Xt(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){Xt(i)}else Xt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Xt(n)}}}class Pt extends ve{constructor(t,n,i){let l;if(super(),Ue(t)||!t)l={next:t??void 0,error:n??void 0,complete:i??void 0};else{let p;this&&Te.useDeprecatedNextContext?(p=Object.create(t),p.unsubscribe=()=>this.unsubscribe(),l={next:t.next&&Je(t.next,p),error:t.error&&Je(t.error,p),complete:t.complete&&Je(t.complete,p)}):l=t}this.destination=new je(l)}}function Xt(e){Te.useDeprecatedSynchronousErrorHandling?function Oe(e){Te.useDeprecatedSynchronousErrorHandling&&ze&&(ze.errorThrown=!0,ze.error=e)}(e):Ft(e)}function wt(e,t){const{onStoppedNotification:n}=Te;n&&rt.setTimeout(()=>n(e,t))}const Mt={closed:!0,next:Xe,error:function jt(e){throw e},complete:Xe},Yt="function"==typeof Symbol&&Symbol.observable||"@@observable";function St(e){return e}let qt=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,l){const p=function Xn(e){return e&&e instanceof ve||function vn(e){return e&&Ue(e.next)&&Ue(e.error)&&Ue(e.complete)}(e)&&Ce(e)}(n)?n:new Pt(n,i,l);return Ve(()=>{const{operator:y,source:w}=this;p.add(y?y.call(p,w):w?this._subscribe(p):this._trySubscribe(p))}),p}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=xr(i))((l,p)=>{const y=new Pt({next:w=>{try{n(w)}catch(M){p(M),y.unsubscribe()}},error:p,complete:l});this.subscribe(y)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[Yt](){return this}pipe(...n){return function an(e){return 0===e.length?St:1===e.length?e[0]:function(n){return e.reduce((i,l)=>l(i),n)}}(n)(this)}toPromise(n){return new(n=xr(n))((i,l)=>{let p;this.subscribe(y=>p=y,y=>l(y),()=>i(p))})}}return e.create=t=>new e(t),e})();function xr(e){var t;return null!==(t=e??Te.Promise)&&void 0!==t?t:Promise}const Zr=Ne(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $n=(()=>{class e extends qt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new Di(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Zr}next(n){Ve(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){Ve(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Ve(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:l,observers:p}=this;return i||l?Me:(this.currentObservers=null,p.push(n),new H(()=>{this.currentObservers=null,h(p,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:l,isStopped:p}=this;i?n.error(l):p&&n.complete()}asObservable(){const n=new qt;return n.source=this,n}}return e.create=(t,n)=>new Di(t,n),e})();class Di extends $n{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:Me}}function Si(e){return Ue(e?.lift)}function Yn(e){return t=>{if(Si(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function en(e,t,n,i,l){return new Tr(e,t,n,i,l)}class Tr extends ve{constructor(t,n,i,l,p,y){super(t),this.onFinalize=p,this.shouldUnsubscribe=y,this._next=n?function(w){try{n(w)}catch(M){t.error(M)}}:super._next,this._error=l?function(w){try{l(w)}catch(M){t.error(M)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function hn(e,t){return Yn((n,i)=>{let l=0;n.subscribe(en(i,p=>{i.next(e.call(t,p,l++))}))})}function yi(e){return this instanceof yi?(this.v=e,this):new yi(e)}function ys(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,i=n.apply(e,t||[]),p=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(K){i[K]&&(l[K]=function(re){return new Promise(function(Se,Ge){p.push([K,re,Se,Ge])>1||w(K,re)})})}function w(K,re){try{!function M(K){K.value instanceof yi?Promise.resolve(K.value.v).then(A,F):V(p[0][2],K)}(i[K](re))}catch(Se){V(p[0][3],Se)}}function A(K){w("next",K)}function F(K){w("throw",K)}function V(K,re){K(re),p.shift(),p.length&&w(p[0][0],p[0][1])}}function Nu(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function _s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(p){n[p]=e[p]&&function(y){return new Promise(function(w,M){!function l(p,y,w,M){Promise.resolve(M).then(function(A){p({value:A,done:w})},y)}(w,M,(y=e[p](y)).done,y.value)})}}}const Tl=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function yc(e){return Ue(e?.then)}function Gu(e){return Ue(e[Yt])}function Bs(e){return Symbol.asyncIterator&&Ue(e?.[Symbol.asyncIterator])}function vs(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const vc=function Dl(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function eo(e){return Ue(e?.[vc])}function Sl(e){return ys(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:l}=yield yi(n.read());if(l)return yield yi(void 0);yield yield yi(i)}}finally{n.releaseLock()}})}function ee(e){return Ue(e?.getReader)}function z(e){if(e instanceof qt)return e;if(null!=e){if(Gu(e))return function j(e){return new qt(t=>{const n=e[Yt]();if(Ue(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Tl(e))return function Q(e){return new qt(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(yc(e))return function se(e){return new qt(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Ft)})}(e);if(Bs(e))return Ee(e);if(eo(e))return function me(e){return new qt(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(ee(e))return function we(e){return Ee(Sl(e))}(e)}throw vs(e)}function Ee(e){return new qt(t=>{(function _e(e,t){var n,i,l,p;return function El(e,t,n,i){return new(n||(n=Promise))(function(p,y){function w(F){try{A(i.next(F))}catch(V){y(V)}}function M(F){try{A(i.throw(F))}catch(V){y(V)}}function A(F){F.done?p(F.value):function l(p){return p instanceof n?p:new n(function(y){y(p)})}(F.value).then(w,M)}A((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Nu(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(y){l={error:y}}finally{try{i&&!i.done&&(p=n.return)&&(yield p.call(n))}finally{if(l)throw l.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function De(e,t,n,i=0,l=!1){const p=t.schedule(function(){n(),l?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(p),!l)return p}function ht(e,t,n=1/0){return Ue(t)?ht((i,l)=>hn((p,y)=>t(i,p,l,y))(z(e(i,l))),n):("number"==typeof t&&(n=t),Yn((i,l)=>function Ke(e,t,n,i,l,p,y,w){const M=[];let A=0,F=0,V=!1;const K=()=>{V&&!M.length&&!A&&t.complete()},re=Ge=>A<i?Se(Ge):M.push(Ge),Se=Ge=>{p&&t.next(Ge),A++;let ut=!1;z(n(Ge,F++)).subscribe(en(t,Ye=>{l?.(Ye),p?re(Ye):t.next(Ye)},()=>{ut=!0},void 0,()=>{if(ut)try{for(A--;M.length&&A<i;){const Ye=M.shift();y?De(t,y,()=>Se(Ye)):Se(Ye)}K()}catch(Ye){t.error(Ye)}}))};return e.subscribe(en(t,re,()=>{V=!0,K()})),()=>{w?.()}}(i,l,e,n)))}function Qe(e=1/0){return ht(St,e)}const Ut=new qt(e=>e.complete());function rn(e){return e&&Ue(e.schedule)}function bn(e){return e[e.length-1]}function Kn(e){return Ue(bn(e))?e.pop():void 0}function cr(e){return rn(bn(e))?e.pop():void 0}function be(e,t=0){return Yn((n,i)=>{n.subscribe(en(i,l=>De(i,e,()=>i.next(l),t),()=>De(i,e,()=>i.complete(),t),l=>De(i,e,()=>i.error(l),t)))})}function po(e,t=0){return Yn((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function xc(e,t){if(!e)throw new Error("Iterable cannot be null");return new qt(n=>{De(n,t,()=>{const i=e[Symbol.asyncIterator]();De(n,t,()=>{i.next().then(l=>{l.done?n.complete():n.next(l.value)})},0,!0)})})}function ct(e,t){return t?function bc(e,t){if(null!=e){if(Gu(e))return function Lr(e,t){return z(e).pipe(po(t),be(t))}(e,t);if(Tl(e))return function Kf(e,t){return new qt(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(yc(e))return function $o(e,t){return z(e).pipe(po(t),be(t))}(e,t);if(Bs(e))return xc(e,t);if(eo(e))return function To(e,t){return new qt(n=>{let i;return De(n,t,()=>{i=e[vc](),De(n,t,()=>{let l,p;try{({value:l,done:p}=i.next())}catch(y){return void n.error(y)}p?n.complete():n.next(l)},0,!0)}),()=>Ue(i?.return)&&i.return()})}(e,t);if(ee(e))return function bp(e,t){return xc(Sl(e),t)}(e,t)}throw vs(e)}(e,t):z(e)}function cn(e){return e<=0?()=>Ut:Yn((t,n)=>{let i=0;t.subscribe(en(n,l=>{++i<=e&&(n.next(l),e<=i&&n.complete())}))})}function Ns(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(cn(1)).subscribe(()=>e())}function Bt(e){for(let t in e)if(e[t]===Bt)return t;throw Error("Could not find renamed property on target object.")}function is(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function ur(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(ur).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function La(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Go=Bt({__forward_ref__:Bt});function dn(e){return e.__forward_ref__=dn,e.toString=function(){return ur(this())},e}function yn(e){return ha(e)?e():e}function ha(e){return"function"==typeof e&&e.hasOwnProperty(Go)&&e.__forward_ref__===dn}class En extends Error{constructor(t,n){super(function Vs(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function Sn(e){return"string"==typeof e?e:null==e?"":String(e)}function vi(e,t){throw new En(-201,!1)}function Do(e,t){null==e&&function hr(e,t,n,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${n} ${i} ${t} <=Actual]`))}(t,e,null,"!=")}function sn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function xi(e){return{providers:e.providers||[],imports:e.imports||[]}}function xs(e){return qu(e,Il)||qu(e,Al)}function qu(e,t){return e.hasOwnProperty(t)?e[t]:null}function Cp(e){return e&&(e.hasOwnProperty(Wu)||e.hasOwnProperty(em))?e[Wu]:null}const Il=Bt({\u0275prov:Bt}),Wu=Bt({\u0275inj:Bt}),Al=Bt({ngInjectableDef:Bt}),em=Bt({ngInjectorDef:Bt});var fn=(()=>((fn=fn||{})[fn.Default=0]="Default",fn[fn.Host=1]="Host",fn[fn.Self=2]="Self",fn[fn.SkipSelf=4]="SkipSelf",fn[fn.Optional=8]="Optional",fn))();let ud;function ui(e){const t=ud;return ud=e,t}function Xu(e,t,n){const i=xs(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&fn.Optional?null:void 0!==t?t:void vi(ur(e))}function Ho(e){return{toString:e}.toString()}var bi=(()=>((bi=bi||{})[bi.OnPush=0]="OnPush",bi[bi.Default=1]="Default",bi))(),no=(()=>{return(e=no||(no={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",no;var e})();const fr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),ma={},dr=[],Fa=Bt({\u0275cmp:Bt}),Pl=Bt({\u0275dir:Bt}),kl=Bt({\u0275pipe:Bt}),Tc=Bt({\u0275mod:Bt}),In=Bt({\u0275fac:Bt}),Us=Bt({__NG_ELEMENT_ID__:Bt});let za=0;function Yr(e){return Ho(()=>{const n=!0===e.standalone,i={},l={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===bi.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||dr,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||no.Emulated,id:"c"+za++,styles:e.styles||dr,_:null,setInput:null,schemas:e.schemas||null,tView:null},p=e.dependencies,y=e.features;return l.inputs=Ju(e.inputs,i),l.outputs=Ju(e.outputs),y&&y.forEach(w=>w(l)),l.directiveDefs=p?()=>("function"==typeof p?p():p).map(Ol).filter(Yu):null,l.pipeDefs=p?()=>("function"==typeof p?p():p).map(ji).filter(Yu):null,l})}function Ol(e){return br(e)||Ui(e)}function Yu(e){return null!==e}const nm={};function qo(e){return Ho(()=>{const t={type:e.type,bootstrap:e.bootstrap||dr,declarations:e.declarations||dr,imports:e.imports||dr,exports:e.exports||dr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nm[e.id]=e.type),t})}function Ju(e,t){if(null==e)return ma;const n={};for(const i in e)if(e.hasOwnProperty(i)){let l=e[i],p=l;Array.isArray(l)&&(p=l[1],l=l[0]),n[l]=i,t&&(t[l]=p)}return n}const un=Yr;function Li(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function br(e){return e[Fa]||null}function Ui(e){return e[Pl]||null}function ji(e){return e[kl]||null}function Fi(e,t){const n=e[Tc]||null;if(!n&&!0===t)throw new Error(`Type ${ur(e)} does not have '\u0275mod' property.`);return n}function Gi(e){return Array.isArray(e)&&"object"==typeof e[1]}function So(e){return Array.isArray(e)&&!0===e[1]}function zl(e){return 0!=(8&e.flags)}function Bl(e){return 2==(2&e.flags)}function Cs(e){return 1==(1&e.flags)}function io(e){return null!==e.template}function Tp(e){return 0!=(256&e[2])}function Ai(e,t){return e.hasOwnProperty(In)?e[In]:null}class Ac{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function li(){return oh}function oh(e){return e.type.prototype.ngOnChanges&&(e.setInput=sh),Ga}function Ga(){const e=ah(this),t=e?.current;if(t){const n=e.previous;if(n===ma)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function sh(e,t,n,i){const l=ah(e)||function Ha(e,t){return e[$l]=t}(e,{previous:ma,current:null}),p=l.current||(l.current={}),y=l.previous,w=this.declaredInputs[n],M=y[w];p[w]=new Ac(M&&M.currentValue,t,y===ma),e[i]=t}li.ngInherit=!0;const $l="__ngSimpleChanges__";function ah(e){return e[$l]||null}let Wa;function Gl(){return void 0!==Wa?Wa:typeof document<"u"?document:void 0}function Kr(e){return!!e.listen}const Pc={createRenderer:(e,t)=>Gl()};function Jr(e){for(;Array.isArray(e);)e=e[0];return e}function Xa(e,t){return Jr(t[e])}function Io(e,t){return Jr(t[e.index])}function Oc(e,t){return e.data[t]}function Hi(e,t){const n=t[e];return Gi(n)?n:n[0]}function hi(e){return 4==(4&e[2])}function ch(e){return 64==(64&e[2])}function Gs(e,t){return null==t?null:e[t]}function Op(e){e[18]=0}function Ao(e,t){e[5]+=t;let n=e,i=e[3];for(;null!==i&&(1===t&&1===n[5]||-1===t&&0===n[5]);)i[5]+=t,n=i,i=i[3]}const Mn={lFrame:u(null),bindingsEnabled:!0};function wd(){return Mn.bindingsEnabled}function lt(){return Mn.lFrame.lView}function er(){return Mn.lFrame.tView}function qs(e){return Mn.lFrame.contextLView=e,e[8]}function Zo(e){return Mn.lFrame.contextLView=null,e}function di(){let e=Cd();for(;null!==e&&64===e.type;)e=e.parent;return e}function Cd(){return Mn.lFrame.currentTNode}function Po(e,t){const n=Mn.lFrame;n.currentTNode=e,n.isParent=t}function Hl(){return Mn.lFrame.isParent}function ql(){Mn.lFrame.isParent=!1}function ga(){return Mn.lFrame.bindingIndex++}function Es(e){const t=Mn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function zp(e,t){const n=Mn.lFrame;n.bindingIndex=n.bindingRootIndex=e,dh(t)}function dh(e){Mn.lFrame.currentDirectiveIndex=e}function Sd(){return Mn.lFrame.currentQueryIndex}function Fc(e){Mn.lFrame.currentQueryIndex=e}function ph(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Ja(e,t,n){if(n&fn.SkipSelf){let l=t,p=e;for(;!(l=l.parent,null!==l||n&fn.Host||(l=ph(p),null===l||(p=p[15],10&l.type))););if(null===l)return!1;t=l,e=p}const i=Mn.lFrame=o();return i.currentTNode=t,i.lView=e,!0}function f(e){const t=o(),n=e[1];Mn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function o(){const e=Mn.lFrame,t=null===e?null:e.child;return null===t?u(e):t}function u(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function g(){const e=Mn.lFrame;return Mn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const v=g;function b(){const e=g();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function I(){return Mn.lFrame.selectedIndex}function O(e){Mn.lFrame.selectedIndex=e}function R(){const e=Mn.lFrame;return Oc(e.tView,e.selectedIndex)}function B(){Mn.lFrame.currentNamespace="svg"}function W(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const p=e.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:M,ngAfterViewChecked:A,ngOnDestroy:F}=p;y&&(e.contentHooks||(e.contentHooks=[])).push(-n,y),w&&((e.contentHooks||(e.contentHooks=[])).push(n,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,w)),M&&(e.viewHooks||(e.viewHooks=[])).push(-n,M),A&&((e.viewHooks||(e.viewHooks=[])).push(n,A),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,A)),null!=F&&(e.destroyHooks||(e.destroyHooks=[])).push(n,F)}}function J(e,t,n){te(e,t,3,n)}function q(e,t,n,i){(3&e[2])===n&&te(e,t,n,i)}function ue(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function te(e,t,n,i){const p=i??-1,y=t.length-1;let w=0;for(let M=void 0!==i?65535&e[18]:0;M<y;M++)if("number"==typeof t[M+1]){if(w=t[M],null!=i&&w>=i)break}else t[M]<0&&(e[18]+=65536),(w<p||-1==p)&&(oe(e,n,t,M),e[18]=(4294901760&e[18])+M+2),M++}function oe(e,t,n,i){const l=n[i]<0,p=n[i+1],w=e[l?-n[i]:n[i]];if(l){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{p.call(w)}finally{}}}else try{p.call(w)}finally{}}class Pe{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function Rt(e,t,n){const i=Kr(e);let l=0;for(;l<n.length;){const p=n[l];if("number"==typeof p){if(0!==p)break;l++;const y=n[l++],w=n[l++],M=n[l++];i?e.setAttribute(t,w,M,y):t.setAttributeNS(y,w,M)}else{const y=p,w=n[++l];vt(y)?i&&e.setProperty(t,y,w):i?e.setAttribute(t,y,w):t.setAttribute(y,w),l++}}return l}function mt(e){return 3===e||4===e||6===e}function vt(e){return 64===e.charCodeAt(0)}function _t(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const l=t[i];"number"==typeof l?n=l:0===n||gt(e,n,l,null,-1===n||2===n?t[++i]:null)}}return e}function gt(e,t,n,i,l){let p=0,y=e.length;if(-1===t)y=-1;else for(;p<e.length;){const w=e[p++];if("number"==typeof w){if(w===t){y=-1;break}if(w>t){y=p-1;break}}}for(;p<e.length;){const w=e[p];if("number"==typeof w)break;if(w===n){if(null===i)return void(null!==l&&(e[p+1]=l));if(i===e[p+1])return void(e[p+2]=l)}p++,null!==i&&p++,null!==l&&p++}-1!==y&&(e.splice(y,0,t),p=y+1),e.splice(p++,0,n),null!==i&&e.splice(p++,0,i),null!==l&&e.splice(p++,0,l)}function It(e){return-1!==e}function Jt(e){return 32767&e}function Nt(e,t){let n=function mn(e){return e>>16}(e),i=t;for(;n>0;)i=i[15],n--;return i}let ln=!0;function Qn(e){const t=ln;return ln=e,t}let fo=0;const Ci={};function gr(e,t){const n=Zn(e,t);if(-1!==n)return n;const i=t[1];i.firstCreatePass&&(e.injectorIndex=t.length,Ir(i.data,e),Ir(t,null),Ir(i.blueprint,null));const l=$r(e,t),p=e.injectorIndex;if(It(l)){const y=Jt(l),w=Nt(l,t),M=w[1].data;for(let A=0;A<8;A++)t[p+A]=w[y+A]|M[y+A]}return t[p+8]=l,p}function Ir(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Zn(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function $r(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,l=t;for(;null!==l;){if(i=lm(l),null===i)return-1;if(n++,l=l[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function Ei(e,t,n){!function Xs(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Us)&&(i=n[Us]),null==i&&(i=n[Us]=fo++);const l=255&i;t.data[e+(l>>5)]|=1<<l}(e,t,n)}function zr(e,t,n){if(n&fn.Optional)return e;vi()}function _a(e,t,n,i){if(n&fn.Optional&&void 0===i&&(i=null),0==(n&(fn.Self|fn.Host))){const l=e[9],p=ui(void 0);try{return l?l.get(t,i,n&fn.Optional):Xu(t,i,n&fn.Optional)}finally{ui(p)}}return zr(i,0,n)}function as(e,t,n,i=fn.Default,l){if(null!==e){if(1024&t[2]){const y=function u_(e,t,n,i,l){let p=e,y=t;for(;null!==p&&null!==y&&1024&y[2]&&!(256&y[2]);){const w=Qa(p,y,n,i|fn.Self,Ci);if(w!==Ci)return w;let M=p.parent;if(!M){const A=y[21];if(A){const F=A.get(n,Ci,i);if(F!==Ci)return F}M=lm(y),y=y[15]}p=M}return l}(e,t,n,i,Ci);if(y!==Ci)return y}const p=Qa(e,t,n,i,Ci);if(p!==Ci)return p}return _a(t,n,i,l)}function Qa(e,t,n,i,l){const p=function ko(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Us)?e[Us]:void 0;return"number"==typeof t?t>=0?255&t:c_:t}(n);if("function"==typeof p){if(!Ja(t,e,i))return i&fn.Host?zr(l,0,i):_a(t,n,i,l);try{const y=p(i);if(null!=y||i&fn.Optional)return y;vi()}finally{v()}}else if("number"==typeof p){let y=null,w=Zn(e,t),M=-1,A=i&fn.Host?t[16][6]:null;for((-1===w||i&fn.SkipSelf)&&(M=-1===w?$r(e,t):t[w+8],-1!==M&&ya(i,!1)?(y=t[1],w=Jt(M),t=Nt(M,t)):w=-1);-1!==w;){const F=t[1];if(cs(p,w,F.data)){const V=el(w,t,n,y,i,A);if(V!==Ci)return V}M=t[w+8],-1!==M&&ya(i,t[1].data[w+8]===A)&&cs(p,w,t)?(y=F,w=Jt(M),t=Nt(M,t)):w=-1}}return l}function el(e,t,n,i,l,p){const y=t[1],w=y.data[e+8],F=ls(w,y,n,null==i?Bl(w)&&ln:i!=y&&0!=(3&w.type),l&fn.Host&&p===w);return null!==F?pi(t,y,F,w):Ci}function ls(e,t,n,i,l){const p=e.providerIndexes,y=t.data,w=1048575&p,M=e.directiveStart,F=p>>20,K=l?w+F:e.directiveEnd;for(let re=i?w:w+F;re<K;re++){const Se=y[re];if(re<M&&n===Se||re>=M&&Se.type===n)return re}if(l){const re=y[M];if(re&&io(re)&&re.type===n)return M}return null}function pi(e,t,n,i){let l=e[n];const p=t.data;if(function Be(e){return e instanceof Pe}(l)){const y=l;y.resolving&&function Wr(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new En(-200,`Circular dependency in DI detected for ${e}${n}`)}(function pn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Sn(e)}(p[n]));const w=Qn(y.canSeeViewProviders);y.resolving=!0;const M=y.injectImpl?ui(y.injectImpl):null;Ja(e,i,fn.Default);try{l=e[n]=y.factory(void 0,p,e,i),t.firstCreatePass&&n>=i.directiveStart&&function ie(e,t,n){const{ngOnChanges:i,ngOnInit:l,ngDoCheck:p}=t.type.prototype;if(i){const y=oh(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,y)}l&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,l),p&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,p),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,p))}(n,p[n],t)}finally{null!==M&&ui(M),Qn(w),y.resolving=!1,v()}}return l}function cs(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function ya(e,t){return!(e&fn.Self||e&fn.Host&&t)}class zc{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return as(this._tNode,this._lView,t,i,n)}}function c_(){return new zc(di(),lt())}function Id(e){return ha(e)?()=>{const t=Id(yn(e));return t&&t()}:Ai(e)}function lm(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}const Nc="__parameters__";function Uc(e,t,n){return Ho(()=>{const i=function Bp(e){return function(...n){if(e){const i=e(...n);for(const l in i)this[l]=i[l]}}}(t);function l(...p){if(this instanceof l)return i.apply(this,p),this;const y=new l(...p);return w.annotation=y,w;function w(M,A,F){const V=M.hasOwnProperty(Nc)?M[Nc]:Object.defineProperty(M,Nc,{value:[]})[Nc];for(;V.length<=F;)V.push(null);return(V[F]=V[F]||[]).push(y),M}}return n&&(l.prototype=Object.create(n.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}class Tn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=sn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Kv=new Tn("AnalyzeForEntryComponents");function us(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?(t===e&&(t=e.slice(0,n)),us(i,t)):t!==e&&t.push(i)}return t}function tl(e,t){e.forEach(n=>Array.isArray(n)?tl(n,t):t(n))}function Vp(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Wl(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function va(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}function hs(e,t,n){let i=vh(e,t);return i>=0?e[1|i]=n:(i=~i,function Xl(e,t,n,i){let l=e.length;if(l==t)e.push(n,i);else if(1===l)e.push(i,e[0]),e[0]=n;else{for(l--,e.push(e[l-1],e[l]);l>t;)e[l]=e[l-2],l--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function dm(e,t){const n=vh(e,t);if(n>=0)return e[1|n]}function vh(e,t){return function Ad(e,t,n){let i=0,l=e.length>>n;for(;l!==i;){const p=i+(l-i>>1),y=e[p<<n];if(t===y)return p<<n;y>t?l=p:i=p+1}return~(l<<n)}(e,t,1)}const $c={},nl="__NG_DI_FLAG__",ba="ngTempTokenPath",mo=/\n/gm,pm="__source";let Xo;function rl(e){const t=Xo;return Xo=e,t}function fm(e,t=fn.Default){if(void 0===Xo)throw new En(-203,"");return null===Xo?Xu(e,void 0,t):Xo.get(e,t&fn.Optional?null:void 0,t)}function Gt(e,t=fn.Default){return(function hd(){return ud}()||fm)(yn(e),t)}function kd(e){const t=[];for(let n=0;n<e.length;n++){const i=yn(e[n]);if(Array.isArray(i)){if(0===i.length)throw new En(900,"");let l,p=fn.Default;for(let y=0;y<i.length;y++){const w=i[y],M=sx(w);"number"==typeof M?-1===M?l=w.token:p|=M:l=w}t.push(Gt(l,p))}else t.push(Gt(i))}return t}function xh(e,t){return e[nl]=t,e.prototype[nl]=t,e}function sx(e){return e[nl]}const Hc=xh(Uc("Inject",e=>({token:e})),-1),Ts=xh(Uc("Optional"),8),bh=xh(Uc("SkipSelf"),4);let Yc,Jl;function Kc(e){return function Ch(){if(void 0===Yc&&(Yc=null,fr.trustedTypes))try{Yc=fr.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Yc}()?.createHTML(e)||e}function Ql(){if(void 0===Jl&&(Jl=null,fr.trustedTypes))try{Jl=fr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Jl}function sl(e){return Ql()?.createHTML(e)||e}function ym(e){return Ql()?.createScriptURL(e)||e}class wa{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Hp extends wa{getTypeName(){return"HTML"}}class Ca extends wa{getTypeName(){return"Style"}}class qp extends wa{getTypeName(){return"Script"}}class go extends wa{getTypeName(){return"URL"}}class Ds extends wa{getTypeName(){return"ResourceURL"}}function Lo(e){return e instanceof wa?e.changingThisBreaksApplicationSecurity:e}function Nr(e,t){const n=vm(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function vm(e){return e instanceof wa&&e.getTypeName()||null}class x_{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(Kc(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.removeChild(n.firstChild),n)}catch{return null}}}class b_{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);const i=this.inertDocument.createElement("body");n.appendChild(i)}}getInertBodyElement(t){const n=this.inertDocument.createElement("template");if("content"in n)return n.innerHTML=Kc(t),n;const i=this.inertDocument.createElement("body");return i.innerHTML=Kc(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const n=t.attributes;for(let l=n.length-1;0<l;l--){const y=n.item(l).name;("xmlns:ns1"===y||0===y.indexOf("ns1:"))&&t.removeAttribute(y)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const C_=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,xm=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Jc(e){return(e=String(e)).match(C_)||e.match(xm)?e:"unsafe:"+e}function Qs(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Ld(...e){const t={};for(const n of e)for(const i in n)n.hasOwnProperty(i)&&(t[i]=!0);return t}const bm=Qs("area,br,col,hr,img,wbr"),M_=Qs("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),T_=Qs("rp,rt"),Fd=Ld(bm,Ld(M_,Qs("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ld(T_,Qs("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ld(T_,M_)),ea=Qs("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),_o=Qs("srcset"),S_=Ld(ea,_o,Qs("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Qs("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),yx=Qs("script,style,template");class vx{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let n=t.firstChild,i=!0;for(;n;)if(n.nodeType===Node.ELEMENT_NODE?i=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,i&&n.firstChild)n=n.firstChild;else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let l=this.checkClobberedElement(n,n.nextSibling);if(l){n=l;break}n=this.checkClobberedElement(n,n.parentNode)}return this.buf.join("")}startElement(t){const n=t.nodeName.toLowerCase();if(!Fd.hasOwnProperty(n))return this.sanitizedSomething=!0,!yx.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const i=t.attributes;for(let l=0;l<i.length;l++){const p=i.item(l),y=p.name,w=y.toLowerCase();if(!S_.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let M=p.value;ea[w]&&(M=Jc(M)),_o[w]&&(e=M,M=(e=String(e)).split(",").map(t=>Jc(t.trim())).join(", ")),this.buf.push(" ",y,'="',zd(M),'"')}var e;return this.buf.push(">"),!0}endElement(t){const n=t.nodeName.toLowerCase();Fd.hasOwnProperty(n)&&!bm.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(zd(t))}checkClobberedElement(t,n){if(n&&(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return n}}const Zp=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,xx=/([^\#-~ |!])/g;function zd(e){return e.replace(/&/g,"&amp;").replace(Zp,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(xx,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Bd;function al(e,t){let n=null;try{Bd=Bd||function ec(e){const t=new b_(e);return function w_(){try{return!!(new window.DOMParser).parseFromString(Kc(""),"text/html")}catch{return!1}}()?new x_(t):t}(e);let i=t?String(t):"";n=Bd.getInertBodyElement(i);let l=5,p=i;do{if(0===l)throw new Error("Failed to sanitize html because the input is unstable");l--,i=p,p=n.innerHTML,n=Bd.getInertBodyElement(i)}while(i!==p);return Kc((new vx).sanitizeChildren(Qc(n)||n))}finally{if(n){const i=Qc(n)||n;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Qc(e){return"content"in e&&function bx(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Gr=(()=>((Gr=Gr||{})[Gr.NONE=0]="NONE",Gr[Gr.HTML=1]="HTML",Gr[Gr.STYLE=2]="STYLE",Gr[Gr.SCRIPT=3]="SCRIPT",Gr[Gr.URL=4]="URL",Gr[Gr.RESOURCE_URL=5]="RESOURCE_URL",Gr))();function Nd(e){const t=Th();return t?sl(t.sanitize(Gr.HTML,e)||""):Nr(e,"HTML")?sl(Lo(e)):al(Gl(),Sn(e))}function Eh(e){const t=Th();return t?t.sanitize(Gr.URL,e)||"":Nr(e,"URL")?Lo(e):Jc(Sn(e))}function wm(e){const t=Th();if(t)return ym(t.sanitize(Gr.RESOURCE_URL,e)||"");if(Nr(e,"ResourceURL"))return ym(Lo(e));throw new En(904,"")}function Th(){const e=lt();return e&&e[12]}function eu(e){return e.ngOriginalError}class tu{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&eu(t);for(;n&&eu(n);)n=eu(n);return n||null}}const jd=new Map;let Sx=0;const Im="__ngContext__";function ao(e,t){Gi(t)?(e[Im]=t[20],function Dm(e){jd.set(e[20],e)}(t)):e[Im]=t}function Ea(e){const t=e[Im];return"number"==typeof t?function $d(e){return jd.get(e)||null}(t):t||null}function Am(e){const t=Ea(e);return t?Gi(t)?t:t.lView:null}const Hd=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(fr))();function Ma(e){return e instanceof Function?e():e}var kr=(()=>((kr=kr||{})[kr.Important=1]="Important",kr[kr.DashCase=2]="DashCase",kr))();function iu(e,t){return undefined(e,t)}function Ih(e){const t=e[3];return So(t)?t[3]:t}function km(e){return N_(e[13])}function Om(e){return N_(e[4])}function N_(e){for(;null!==e&&!So(e);)e=e[4];return e}function ll(e,t,n,i,l){if(null!=i){let p,y=!1;So(i)?p=i:Gi(i)&&(y=!0,i=i[0]);const w=Jr(i);0===e&&null!==n?null==l?H_(t,n,w):na(t,n,w,l||null,!0):1===e&&null!==n?na(t,n,w,l||null,!0):2===e?function X_(e,t,n){const i=tc(e,t);i&&function Z_(e,t,n,i){Kr(e)?e.removeChild(t,n,i):t.removeChild(n)}(e,i,t,n)}(t,w,y):3===e&&t.destroyNode(w),null!=p&&function $x(e,t,n,i,l){const p=n[7];p!==Jr(n)&&ll(t,e,i,p,l);for(let w=10;w<n.length;w++){const M=n[w];Jd(M[1],M,e,t,i,p)}}(t,e,p,n,l)}}function Yp(e,t,n){if(Kr(e))return e.createElement(t,n);{const i=null!==n?function oo(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(n):null;return null===i?e.createElement(t):e.createElementNS(i,t)}}function j_(e,t){const n=e[9],i=n.indexOf(t),l=t[3];512&t[2]&&(t[2]&=-513,Ao(l,-1)),n.splice(i,1)}function ki(e,t){if(e.length<=10)return;const n=10+t,i=e[n];if(i){const l=i[17];null!==l&&l!==e&&j_(l,i),t>0&&(e[n-1][4]=i[4]);const p=Wl(e,10+t);!function zx(e,t){Jd(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const y=p[19];null!==y&&y.detachView(p[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function ta(e,t){if(!(128&t[2])){const n=t[11];Kr(n)&&n.destroyNode&&Jd(e,t,n,3,null,null),function Vx(e){let t=e[13];if(!t)return Yd(e[1],e);for(;t;){let n=null;if(Gi(t))n=t[13];else{const i=t[10];i&&(n=i)}if(!n){for(;t&&!t[4]&&t!==e;)Gi(t)&&Yd(t[1],t),t=t[3];null===t&&(t=e),Gi(t)&&Yd(t[1],t),n=t&&t[4]}t=n}}(t)}}function Yd(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Ah(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const l=t[n[i]];if(!(l instanceof Pe)){const p=n[i+1];if(Array.isArray(p))for(let y=0;y<p.length;y+=2){const w=l[p[y]],M=p[y+1];try{M.call(w)}finally{}}else try{p.call(l)}finally{}}}}(e,t),function Kp(e,t){const n=e.cleanup,i=t[7];let l=-1;if(null!==n)for(let p=0;p<n.length-1;p+=2)if("string"==typeof n[p]){const y=n[p+1],w="function"==typeof y?y(t):Jr(t[y]),M=i[l=n[p+2]],A=n[p+3];"boolean"==typeof A?w.removeEventListener(n[p],M,A):A>=0?i[l=A]():i[l=-A].unsubscribe(),p+=2}else{const y=i[l=n[p+1]];n[p].call(y)}if(null!==i){for(let p=l+1;p<i.length;p++)i[p]();t[7]=null}}(e,t),1===t[1].type&&Kr(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&So(t[3])){n!==t[3]&&j_(n,t);const i=t[19];null!==i&&i.detachView(e)}!function Ix(e){jd.delete(e[20])}(t)}}function $_(e,t,n){return function G_(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[0];if(2&i.flags){const l=e.data[i.directiveStart].encapsulation;if(l===no.None||l===no.Emulated)return null}return Io(i,n)}(e,t.parent,n)}function na(e,t,n,i,l){Kr(e)?e.insertBefore(t,n,i,l):(Fm(t)?t.content:t).insertBefore(n,i,l)}function H_(e,t,n){Kr(e)?e.appendChild(t,n):(Fm(t)?t.content:t).appendChild(n)}function q_(e,t,n,i,l){null!==i?na(e,t,n,i,l):H_(e,t,n)}function Fm(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}function tc(e,t){return Kr(e)?e.parentNode(t):t.parentNode}function Jp(e,t,n){return Bm(e,t,n)}let Bm=function zm(e,t,n){return 40&e.type?Io(e,n):null};function Kd(e,t,n,i){const l=$_(e,i,t),p=t[11],w=Jp(i.parent||t[6],i,t);if(null!=l)if(Array.isArray(n))for(let M=0;M<n.length;M++)q_(p,l,n[M],w,!1);else q_(p,l,n,w,!1)}function Qp(e,t){if(null!==t){const n=t.type;if(3&n)return Io(t,e);if(4&n)return Nm(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return Qp(e,i);{const l=e[t.index];return So(l)?Nm(-1,l):Jr(l)}}if(32&n)return iu(t,e)()||Jr(e[t.index]);{const i=W_(e,t);return null!==i?Array.isArray(i)?i[0]:Qp(Ih(e[16]),i):Qp(e,t.next)}}return null}function W_(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Nm(e,t){const n=10+e+1;if(n<t.length){const i=t[n],l=i[1].firstChild;if(null!==l)return Qp(i,l)}return t[7]}function Vm(e,t,n,i,l,p,y){for(;null!=n;){const w=i[n.index],M=n.type;if(y&&0===t&&(w&&ao(Jr(w),i),n.flags|=4),64!=(64&n.flags))if(8&M)Vm(e,t,n.child,i,l,p,!1),ll(t,e,l,w,p);else if(32&M){const A=iu(n,i);let F;for(;F=A();)ll(t,e,l,F,p);ll(t,e,l,w,p)}else 16&M?Y_(e,t,i,n,l,p):ll(t,e,l,w,p);n=y?n.projectionNext:n.next}}function Jd(e,t,n,i,l,p){Vm(n,i,e.firstChild,t,l,p,!1)}function Y_(e,t,n,i,l,p){const y=n[16],M=y[6].projection[i.projection];if(Array.isArray(M))for(let A=0;A<M.length;A++)ll(t,e,l,M[A],p);else Vm(e,t,M,y[3],l,p,!0)}function su(e,t,n){Kr(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function tf(e,t,n){Kr(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function K_(e,t,n){let i=e.length;for(;;){const l=e.indexOf(t,n);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const p=t.length;if(l+p===i||e.charCodeAt(l+p)<=32)return l}n=l+1}}const J_="ng-template";function Um(e,t,n){let i=0;for(;i<e.length;){let l=e[i++];if(n&&"class"===l){if(l=e[i],-1!==K_(l.toLowerCase(),t,0))return!0}else if(1===l){for(;i<e.length&&"string"==typeof(l=e[i++]);)if(l.toLowerCase()===t)return!0;return!1}}return!1}function nf(e){return 4===e.type&&e.value!==J_}function Q_(e,t,n){return t===(4!==e.type||n?e.value:J_)}function ds(e,t,n){let i=4;const l=e.attrs||[],p=function Gx(e){for(let t=0;t<e.length;t++)if(mt(e[t]))return t;return e.length}(l);let y=!1;for(let w=0;w<t.length;w++){const M=t[w];if("number"!=typeof M){if(!y)if(4&i){if(i=2|1&i,""!==M&&!Q_(e,M,n)||""===M&&1===t.length){if(zo(i))return!1;y=!0}}else{const A=8&i?M:t[++w];if(8&i&&null!==e.attrs){if(!Um(e.attrs,A,n)){if(zo(i))return!1;y=!0}continue}const V=Ph(8&i?"class":M,l,nf(e),n);if(-1===V){if(zo(i))return!1;y=!0;continue}if(""!==A){let K;K=V>p?"":l[V+1].toLowerCase();const re=8&i?K:null;if(re&&-1!==K_(re,A,0)||2&i&&A!==K){if(zo(i))return!1;y=!0}}}}else{if(!y&&!zo(i)&&!zo(M))return!1;if(y&&zo(M))continue;y=!1,i=M|1&i}}return zo(i)||y}function zo(e){return 0==(1&e)}function Ph(e,t,n,i){if(null===t)return-1;let l=0;if(i||!n){let p=!1;for(;l<t.length;){const y=t[l];if(y===e)return l;if(3===y||6===y)p=!0;else{if(1===y||2===y){let w=t[++l];for(;"string"==typeof w;)w=t[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=p?1:2}return-1}return function ey(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function rf(e,t,n=!1){for(let i=0;i<t.length;i++)if(ds(e,t[i],n))return!0;return!1}function ty(e,t){e:for(let n=0;n<t.length;n++){const i=t[n];if(e.length===i.length){for(let l=0;l<e.length;l++)if(e[l]!==i[l])continue e;return!0}}return!1}function ny(e,t){return e?":not("+t.trim()+")":t}function ry(e){let t=e[0],n=1,i=2,l="",p=!1;for(;n<e.length;){let y=e[n];if("string"==typeof y)if(2&i){const w=e[++n];l+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&i?l+="."+y:4&i&&(l+=" "+y);else""!==l&&!zo(y)&&(t+=ny(p,l),l=""),i=y,p=p||!zo(i);n++}return""!==l&&(t+=ny(p,l)),t}const On={};function Vt(e){oy(er(),lt(),I()+e,!1)}function oy(e,t,n,i){if(!i)if(3==(3&t[2])){const p=e.preOrderCheckHooks;null!==p&&J(t,p,n)}else{const p=e.preOrderHooks;null!==p&&q(t,p,0,n)}O(n)}const qm=new Tn("ENVIRONMENT_INITIALIZER"),kh=new Tn("INJECTOR_DEF_TYPES");function ly(...e){return{\u0275providers:Zm(0,e)}}function Zm(e,...t){const n=[],i=new Set;let l;return tl(t,p=>{const y=p;nc(y,n,[],i)&&(l||(l=[]),l.push(y))}),void 0!==l&&sf(l,n),n}function sf(e,t){for(let n=0;n<e.length;n++){const{providers:l}=e[n];tl(l,p=>{t.push(p)})}}function nc(e,t,n,i){if(!(e=yn(e)))return!1;let l=null,p=Cp(e);const y=!p&&br(e);if(p||y){if(y&&!y.standalone)return!1;l=e}else{const M=e.ngModule;if(p=Cp(M),!p)return!1;l=M}const w=i.has(l);if(y){if(w)return!1;if(i.add(l),y.dependencies){const M="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const A of M)nc(A,t,n,i)}}else{if(!p)return!1;{if(null!=p.imports&&!w){let A;i.add(l);try{tl(p.imports,F=>{nc(F,t,n,i)&&(A||(A=[]),A.push(F))})}finally{}void 0!==A&&sf(A,t)}if(!w){const A=Ai(l)||(()=>new l);t.push({provide:l,useFactory:A,deps:dr},{provide:kh,useValue:l,multi:!0},{provide:qm,useValue:()=>Gt(l),multi:!0})}const M=p.providers;null==M||w||tl(M,F=>{t.push(F)})}}return l!==e&&void 0!==e.providers}const af=Bt({provide:String,useValue:Bt});function lf(e){return null!==e&&"object"==typeof e&&af in e}function au(e){return"function"==typeof e}const Wm=new Tn("INJECTOR",-1);class cy{get(t,n=$c){if(n===$c){const i=new Error(`NullInjectorError: No provider for ${ur(t)}!`);throw i.name="NullInjectorError",i}return n}}const Xm=new Tn("Set Injector scope."),ul={},Ym={};let Km;function cf(){return void 0===Km&&(Km=new cy),Km}class lu{}class uf extends lu{constructor(t,n,i,l){super(),this.parent=n,this.source=i,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hf(t,y=>this.processProvider(y)),this.records.set(Wm,hl(void 0,this)),l.has("environment")&&this.records.set(lu,hl(void 0,this));const p=this.records.get(Xm);null!=p&&"string"==typeof p.value&&this.scopes.add(p.value),this.injectorDefTypes=new Set(this.get(kh.multi,dr,fn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,n=$c,i=fn.Default){this.assertNotDestroyed();const l=rl(this),p=ui(void 0);try{if(!(i&fn.SkipSelf)){let w=this.records.get(t);if(void 0===w){const M=function Kx(e){return"function"==typeof e||"object"==typeof e&&e instanceof Tn}(t)&&xs(t);w=M&&this.injectableDefInScope(M)?hl(Jm(t),ul):null,this.records.set(t,w)}if(null!=w)return this.hydrate(t,w)}return(i&fn.Self?cf():this.parent).get(t,n=i&fn.Optional&&n===$c?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[ba]=y[ba]||[]).unshift(ur(t)),l)throw y;return function il(e,t,n,i){const l=e[ba];throw t[pm]&&l.unshift(t[pm]),e.message=function Gc(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let l=ur(t);if(Array.isArray(t))l=t.map(ur).join(" -> ");else if("object"==typeof t){let p=[];for(let y in t)if(t.hasOwnProperty(y)){let w=t[y];p.push(y+":"+("string"==typeof w?JSON.stringify(w):ur(w)))}l=`{${p.join(", ")}}`}return`${n}${i?"("+i+")":""}[${l}]: ${e.replace(mo,"\n  ")}`}("\n"+e.message,l,n,i),e.ngTokenPath=l,e[ba]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{ui(p),rl(l)}}resolveInjectorInitializers(){const t=rl(this),n=ui(void 0);try{const i=this.get(qm.multi,dr,fn.Self);for(const l of i)l()}finally{rl(t),ui(n)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(ur(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new En(205,!1)}processProvider(t){let n=au(t=yn(t))?t:yn(t&&t.provide);const i=function uy(e){return lf(e)?hl(void 0,e.useValue):hl(Qm(e),ul)}(t);if(au(t)||!0!==t.multi)this.records.get(n);else{let l=this.records.get(n);l||(l=hl(void 0,ul,!0),l.factory=()=>kd(l.multi),this.records.set(n,l)),n=t,l.multi.push(t)}this.records.set(n,i)}hydrate(t,n){return n.value===ul&&(n.value=Ym,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Yx(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=yn(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function Jm(e){const t=xs(e),n=null!==t?t.factory:Ai(e);if(null!==n)return n;if(e instanceof Tn)throw new En(204,!1);if(e instanceof Function)return function rc(e){const t=e.length;if(t>0)throw va(t,"?"),new En(204,!1);const n=function Zu(e){const t=e&&(e[Il]||e[Al]);if(t){const n=function Qf(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new En(204,!1)}function Qm(e,t,n){let i;if(au(e)){const l=yn(e);return Ai(l)||Jm(l)}if(lf(e))i=()=>yn(e.useValue);else if(function ep(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...kd(e.deps||[]));else if(function Qd(e){return!(!e||!e.useExisting)}(e))i=()=>Gt(yn(e.useExisting));else{const l=yn(e&&(e.useClass||e.provide));if(!function eg(e){return!!e.deps}(e))return Ai(l)||Jm(l);i=()=>new l(...kd(e.deps))}return i}function hl(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function hy(e){return!!e.\u0275providers}function hf(e,t){for(const n of e)Array.isArray(n)?hf(n,t):hy(n)?hf(n.\u0275providers,t):t(n)}function Oh(e,t=null,n=null,i){const l=ic(e,t,n,i);return l.resolveInjectorInitializers(),l}function ic(e,t=null,n=null,i,l=new Set){const p=[n||dr,ly(e)];return i=i||("object"==typeof e?void 0:ur(e)),new uf(p,t||cf(),i||null,l)}let qi=(()=>{class e{static create(n,i){if(Array.isArray(n))return Oh({name:""},i,n,"");{const l=n.name??"";return Oh({name:l},n.parent,n.providers,l)}}}return e.THROW_IF_NOT_FOUND=$c,e.NULL=new cy,e.\u0275prov=sn({token:e,providedIn:"any",factory:()=>Gt(Wm)}),e.__NG_ELEMENT_ID__=-1,e})();function tt(e,t=fn.Default){const n=lt();return null===n?Gt(e,t):as(di(),n,yn(e),t)}function og(){throw new Error("invalid")}function gf(e,t){return e<<17|t<<2}function ps(e){return e>>17&32767}function lg(e){return 2|e}function ia(e){return(131068&e)>>2}function yf(e,t){return-131069&e|t<<2}function cg(e){return 1|e}function Nh(e,t){const n=e.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const l=n[i],p=n[i+1];if(-1!==p){const y=e.data[p];Fc(l),y.contentQueries(2,t[p],p)}}}function Vh(e,t,n,i,l,p,y,w,M,A,F){const V=t.blueprint.slice();return V[0]=l,V[2]=76|i,(null!==F||e&&1024&e[2])&&(V[2]|=1024),Op(V),V[3]=V[15]=e,V[8]=n,V[10]=y||e&&e[10],V[11]=w||e&&e[11],V[12]=M||e&&e[12]||null,V[9]=A||e&&e[9]||null,V[6]=p,V[20]=function Tm(){return Sx++}(),V[21]=F,V[16]=2==t.type?e[16]:V,V}function Uh(e,t,n,i,l){let p=e.data[t];if(null===p)p=function Ef(e,t,n,i,l){const p=Cd(),y=Hl(),M=e.data[t]=function P(e,t,n,i,l,p){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:p,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?p:p&&p.parent,n,t,i,l);return null===e.firstChild&&(e.firstChild=M),null!==p&&(y?null==p.child&&null!==M.parent&&(p.child=M):null===p.next&&(p.next=M)),M}(e,t,n,i,l),function hh(){return Mn.lFrame.inI18n}()&&(p.flags|=64);else if(64&p.type){p.type=n,p.value=i,p.attrs=l;const y=function Zs(){const e=Mn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();p.injectorIndex=null===y?-1:y.injectorIndex}return Po(p,!0),p}function jh(e,t,n,i){if(0===n)return-1;const l=t.length;for(let p=0;p<n;p++)t.push(i),e.blueprint.push(i),e.data.push(null);return l}function _u(e,t,n){f(t);try{const i=e.viewQuery;null!==i&&Vn(1,i,n);const l=e.template;null!==l&&s(e,t,l,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Nh(e,t),e.staticViewQueries&&Vn(2,e.viewQuery,n);const p=e.components;null!==p&&function Sy(e,t){for(let n=0;n<t.length;n++)Qr(e,t[n])}(t,p)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[2]&=-5,b()}}function yu(e,t,n,i){const l=t[2];if(128!=(128&l)){f(t);try{Op(t),function Md(e){return Mn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&s(e,t,n,2,i);const y=3==(3&l);if(y){const A=e.preOrderCheckHooks;null!==A&&J(t,A,null)}else{const A=e.preOrderHooks;null!==A&&q(t,A,0,null),ue(t,0)}if(function $t(e){for(let t=km(e);null!==t;t=Om(t)){if(!t[2])continue;const n=t[9];for(let i=0;i<n.length;i++){const l=n[i],p=l[3];0==(512&l[2])&&Ao(p,1),l[2]|=512}}}(t),function Dn(e){for(let t=km(e);null!==t;t=Om(t))for(let n=10;n<t.length;n++){const i=t[n],l=i[1];ch(i)&&yu(l,i,l.template,i[8])}}(t),null!==e.contentQueries&&Nh(e,t),y){const A=e.contentCheckHooks;null!==A&&J(t,A)}else{const A=e.contentHooks;null!==A&&q(t,A,1),ue(t,1)}!function Dy(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const l=n[i];if(l<0)O(~l);else{const p=l,y=n[++i],w=n[++i];zp(y,p),w(2,t[p])}}}finally{O(-1)}}(e,t);const w=e.components;null!==w&&function Cf(e,t){for(let n=0;n<t.length;n++)gi(e,t[n])}(t,w);const M=e.viewQuery;if(null!==M&&Vn(2,M,i),y){const A=e.viewCheckHooks;null!==A&&J(t,A)}else{const A=e.viewHooks;null!==A&&q(t,A,2),ue(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Ao(t[3],-1))}finally{b()}}}function Iy(e,t,n,i){const l=t[10],y=hi(t);try{!y&&l.begin&&l.begin(),y&&_u(e,t,i),yu(e,t,n,i)}finally{!y&&l.end&&l.end()}}function s(e,t,n,i,l){const p=I(),y=2&i;try{O(-1),y&&t.length>22&&oy(e,t,22,!1),n(i,l)}finally{O(p)}}function r(e,t,n){if(zl(t)){const l=t.directiveEnd;for(let p=t.directiveStart;p<l;p++){const y=e.data[p];y.contentQueries&&y.contentQueries(1,n[p],p)}}}function a(e,t,n){!wd()||(function Re(e,t,n,i){const l=n.directiveStart,p=n.directiveEnd;e.firstCreatePass||gr(n,t),ao(i,t);const y=n.initialInputs;for(let w=l;w<p;w++){const M=e.data[w],A=io(M);A&&et(t,n,M);const F=pi(t,e,w,n);ao(F,t),null!==y&&Pn(0,w-l,F,M,0,y),A&&(Hi(n.index,t)[8]=F)}}(e,t,n,Io(n,t)),128==(128&n.flags)&&function Le(e,t,n){const i=n.directiveStart,l=n.directiveEnd,p=n.index,y=function Dd(){return Mn.lFrame.currentDirectiveIndex}();try{O(p);for(let w=i;w<l;w++){const M=e.data[w],A=t[w];dh(w),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&We(M,A)}}finally{O(-1),dh(y)}}(e,t,n))}function c(e,t,n=Io){const i=t.localNames;if(null!==i){let l=t.index+1;for(let p=0;p<i.length;p+=2){const y=i[p+1],w=-1===y?n(t,e):e[y];e[l++]=w}}}function d(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=m(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function m(e,t,n,i,l,p,y,w,M,A){const F=22+i,V=F+l,K=function _(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:On);return n}(F,V),re="function"==typeof A?A():A;return K[1]={type:e,blueprint:K,template:n,queries:null,viewQuery:w,declTNode:t,data:K.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof p?p():p,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:M,consts:re,incompleteFirstPass:!1}}function S(e,t,n,i){const l=tr(t);null===n?l.push(i):(l.push(n),e.firstCreatePass&&Rr(e).push(i,l.length-1))}function k(e,t,n){for(let i in e)if(e.hasOwnProperty(i)){const l=e[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(t,l):n[i]=[t,l]}return n}function fe(e,t,n,i){let l=!1;if(wd()){const p=function it(e,t,n){const i=e.directiveRegistry;let l=null;if(i)for(let p=0;p<i.length;p++){const y=i[p];rf(n,y.selectors,!1)&&(l||(l=[]),Ei(gr(n,t),e,y.type),io(y)?(Ae(e,n),l.unshift(y)):l.push(y))}return l}(e,t,n),y=null===i?null:{"":-1};if(null!==p){l=!0,st(n,e.data.length,p.length);for(let F=0;F<p.length;F++){const V=p[F];V.providersResolver&&V.providersResolver(V)}let w=!1,M=!1,A=jh(e,t,p.length,null);for(let F=0;F<p.length;F++){const V=p[F];n.mergedAttrs=_t(n.mergedAttrs,V.hostAttrs),Tt(e,n,t,A,V),ot(A,V,y),null!==V.contentQueries&&(n.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(n.flags|=128);const K=V.type.prototype;!w&&(K.ngOnChanges||K.ngOnInit||K.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),w=!0),!M&&(K.ngOnChanges||K.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),M=!0),A++}!function L(e,t){const i=t.directiveEnd,l=e.data,p=t.attrs,y=[];let w=null,M=null;for(let A=t.directiveStart;A<i;A++){const F=l[A],V=F.inputs,K=null===p||nf(t)?null:Wt(V,p);y.push(K),w=k(V,A,w),M=k(F.outputs,A,M)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=16),w.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=y,t.inputs=w,t.outputs=M}(e,n)}y&&function $e(e,t,n){if(t){const i=e.localNames=[];for(let l=0;l<t.length;l+=2){const p=n[t[l+1]];if(null==p)throw new En(-301,!1);i.push(t[l],p)}}}(n,i,y)}return n.mergedAttrs=_t(n.mergedAttrs,n.attrs),l}function ge(e,t,n,i,l,p){const y=p.hostBindings;if(y){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const M=~t.index;(function ye(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=M&&w.push(M),w.push(i,l,y)}}function We(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Ae(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function ot(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;io(t)&&(n[""]=e)}}function st(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function Tt(e,t,n,i,l){e.data[i]=l;const p=l.factory||(l.factory=Ai(l.type)),y=new Pe(p,io(l),tt);e.blueprint[i]=y,n[i]=y,ge(e,t,0,i,jh(e,n,l.hostVars,On),l)}function et(e,t,n){const i=Io(t,e),l=d(n),p=e[10],y=Un(e,Vh(e,l,null,n.onPush?32:16,i,t,p,p.createRenderer(i,n),null,null,null));e[t.index]=y}function pt(e,t,n,i,l,p){const y=Io(e,t);!function gn(e,t,n,i,l,p,y){if(null==p)Kr(e)?e.removeAttribute(t,l,n):t.removeAttribute(l);else{const w=null==y?Sn(p):y(p,i||"",l);Kr(e)?e.setAttribute(t,l,w,n):n?t.setAttributeNS(n,l,w):t.setAttribute(l,w)}}(t[11],y,p,e.value,n,i,l)}function Pn(e,t,n,i,l,p){const y=p[t];if(null!==y){const w=i.setInput;for(let M=0;M<y.length;){const A=y[M++],F=y[M++],V=y[M++];null!==w?i.setInput(n,V,A,F):n[F]=V}}}function Wt(e,t){let n=null,i=0;for(;i<t.length;){const l=t[i];if(0!==l)if(5!==l){if("number"==typeof l)break;e.hasOwnProperty(l)&&(null===n&&(n=[]),n.push(l,e[l],t[i+1])),i+=2}else i+=2;else i+=4}return n}function zn(e,t,n,i){return new Array(e,!0,!1,t,null,0,i,n,null,null)}function gi(e,t){const n=Hi(t,e);if(ch(n)){const i=n[1];48&n[2]?yu(i,n,i.template,n[8]):n[5]>0&&Hr(n)}}function Hr(e){for(let i=km(e);null!==i;i=Om(i))for(let l=10;l<i.length;l++){const p=i[l];if(512&p[2]){const y=p[1];yu(y,p,y.template,p[8])}else p[5]>0&&Hr(p)}const n=e[1].components;if(null!==n)for(let i=0;i<n.length;i++){const l=Hi(n[i],e);ch(l)&&l[5]>0&&Hr(l)}}function Qr(e,t){const n=Hi(t,e),i=n[1];(function Nn(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(i,n),_u(i,n,n[8])}function Un(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function _r(e){for(;e;){e[2]|=32;const t=Ih(e);if(Tp(e)&&!t)return e;e=t}return null}function Or(e){!function ar(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],i=Am(n);if(null!==i){const l=i[1];Iy(l,i,l.template,n)}}}(e[8])}function Vn(e,t,n){Fc(0),t(e,n)}const lo=(()=>Promise.resolve(null))();function tr(e){return e[7]||(e[7]=[])}function Rr(e){return e.cleanup||(e.cleanup=[])}function Ar(e,t){const n=e[9],i=n?n.get(tu,null):null;i&&i.handleError(t)}function ei(e,t,n,i,l){for(let p=0;p<n.length;){const y=n[p++],w=n[p++],M=t[y],A=e.data[y];null!==A.setInput?A.setInput(M,l,i,w):M[w]=l}}function Vr(e,t,n){const i=Xa(t,e);!function Lm(e,t,n){Kr(e)?e.setValue(t,n):t.textContent=n}(e[11],i,n)}function ci(e,t,n){let i=n?e.styles:null,l=n?e.classes:null,p=0;if(null!==t)for(let y=0;y<t.length;y++){const w=t[y];"number"==typeof w?p=w:1==p?l=La(l,w):2==p&&(i=La(i,w+": "+t[++y]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=l:e.classesWithoutHost=l}function jS(){const e=di();W(lt()[1],e)}function Ur(e){let t=function fw(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let l;if(io(e))l=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new En(903,"");l=t.\u0275dir}if(l){if(n){i.push(l);const y=e;y.inputs=y0(e.inputs),y.declaredInputs=y0(e.declaredInputs),y.outputs=y0(e.outputs);const w=l.hostBindings;w&&qS(e,w);const M=l.viewQuery,A=l.contentQueries;if(M&&GS(e,M),A&&HS(e,A),is(e.inputs,l.inputs),is(e.declaredInputs,l.declaredInputs),is(e.outputs,l.outputs),io(l)&&l.data.animation){const F=e.data;F.animation=(F.animation||[]).concat(l.data.animation)}}const p=l.features;if(p)for(let y=0;y<p.length;y++){const w=p[y];w&&w.ngInherit&&w(e),w===Ur&&(n=!1)}}t=Object.getPrototypeOf(t)}!function $S(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const l=e[i];l.hostVars=t+=l.hostVars,l.hostAttrs=_t(l.hostAttrs,n=_t(n,l.hostAttrs))}}(i)}function y0(e){return e===ma?{}:e===dr?[]:e}function GS(e,t){const n=e.viewQuery;e.viewQuery=n?(i,l)=>{t(i,l),n(i,l)}:t}function HS(e,t){const n=e.contentQueries;e.contentQueries=n?(i,l,p)=>{t(i,l,p),n(i,l,p)}:t}function qS(e,t){const n=e.hostBindings;e.hostBindings=n?(i,l)=>{t(i,l),n(i,l)}:t}let Ry=null;function cp(){if(!Ry){const e=fr.Symbol;if(e&&e.iterator)Ry=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const i=t[n];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Ry=i)}}}return Ry}function yg(e){return!!function v0(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&cp()in e)}function Qo(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Os(e,t,n,i){const l=lt();return Qo(l,ga(),t)&&(er(),pt(R(),l,e,t,n,i)),Os}function si(e,t,n,i,l,p,y,w){const M=lt(),A=er(),F=e+22,V=A.firstCreatePass?function QS(e,t,n,i,l,p,y,w,M){const A=t.consts,F=Uh(t,e,4,y||null,Gs(A,w));fe(t,n,F,Gs(A,M)),W(t,F);const V=F.tViews=m(2,F,i,l,p,t.directiveRegistry,t.pipeRegistry,null,t.schemas,A);return null!==t.queries&&(t.queries.template(t,F),V.queries=t.queries.embeddedTView(F)),F}(F,A,M,t,n,i,l,p,y):A.data[F];Po(V,!1);const K=M[11].createComment("");Kd(A,M,K,V),ao(K,M),Un(M,M[F]=zn(K,M,K,V)),Cs(V)&&a(A,M,V),null!=y&&c(M,V,w)}function Rn(e,t,n){const i=lt();return Qo(i,ga(),t)&&function U(e,t,n,i,l,p,y,w){const M=Io(t,n);let F,A=t.inputs;!w&&null!=A&&(F=A[i])?(ei(e,n,F,i,l),Bl(t)&&function Y(e,t){const n=Hi(t,e);16&n[2]||(n[2]|=32)}(n,t.index)):3&t.type&&(i=function N(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),l=null!=y?y(l,t.value||"",i):l,Kr(p)?p.setProperty(M,i,l):vt(i)||(M.setProperty?M.setProperty(i,l):M[i]=l))}(er(),R(),i,e,t,i[11],n,!1),Rn}function x0(e,t,n,i,l){const y=l?"class":"style";ei(e,n,t.inputs[y],y,i)}function xt(e,t,n,i){const l=lt(),p=er(),y=22+e,w=l[11],M=l[y]=Yp(w,t,function G(){return Mn.lFrame.currentNamespace}()),A=p.firstCreatePass?function nI(e,t,n,i,l,p,y){const w=t.consts,A=Uh(t,e,2,l,Gs(w,p));return fe(t,n,A,Gs(w,y)),null!==A.attrs&&ci(A,A.attrs,!1),null!==A.mergedAttrs&&ci(A,A.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,A),A}(y,p,l,0,t,n,i):p.data[y];Po(A,!0);const F=A.mergedAttrs;null!==F&&Rt(w,M,F);const V=A.classes;null!==V&&tf(w,M,V);const K=A.styles;return null!==K&&su(w,M,K),64!=(64&A.flags)&&Kd(p,l,M,A),0===function uh(){return Mn.lFrame.elementDepthCount}()&&ao(M,l),function Ot(){Mn.lFrame.elementDepthCount++}(),Cs(A)&&(a(p,l,A),r(p,A,l)),null!==i&&c(l,A),xt}function Dt(){let e=di();Hl()?ql():(e=e.parent,Po(e,!1));const t=e;!function Rp(){Mn.lFrame.elementDepthCount--}();const n=er();return n.firstCreatePass&&(W(n,e),zl(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Ie(e){return 0!=(16&e.flags)}(t)&&x0(n,t,lt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Ze(e){return 0!=(32&e.flags)}(t)&&x0(n,t,lt(),t.stylesWithoutHost,!1),Dt}function Ln(e,t,n,i){return xt(e,t,n,i),Dt(),Ln}function Rf(e,t,n){const i=lt(),l=er(),p=e+22,y=l.firstCreatePass?function rI(e,t,n,i,l){const p=t.consts,y=Gs(p,i),w=Uh(t,e,8,"ng-container",y);return null!==y&&ci(w,y,!0),fe(t,n,w,Gs(p,l)),null!==t.queries&&t.queries.elementStart(t,w),w}(p,l,i,t,n):l.data[p];Po(y,!0);const w=i[p]=i[11].createComment("");return Kd(l,i,w,y),ao(w,i),Cs(y)&&(a(l,i,y),r(l,y,i)),null!=n&&c(i,y),Rf}function Lf(){let e=di();const t=er();return Hl()?ql():(e=e.parent,Po(e,!1)),t.firstCreatePass&&(W(t,e),zl(e)&&t.queries.elementEnd(e)),Lf}function Zh(){return lt()}function xg(e){return!!e&&"function"==typeof e.then}function Mw(e){return!!e&&"function"==typeof e.subscribe}const b0=Mw;function nr(e,t,n,i){const l=lt(),p=er(),y=di();return function Dw(e,t,n,i,l,p,y,w){const M=Cs(i),F=e.firstCreatePass&&Rr(e),V=t[8],K=tr(t);let re=!0;if(3&i.type||w){const ut=Io(i,t),Ye=w?w(ut):ut,Ct=K.length,nt=w?Zt=>w(Jr(Zt[i.index])):i.index;if(Kr(n)){let Zt=null;if(!w&&M&&(Zt=function iI(e,t,n,i){const l=e.cleanup;if(null!=l)for(let p=0;p<l.length-1;p+=2){const y=l[p];if(y===n&&l[p+1]===i){const w=t[7],M=l[p+2];return w.length>M?w[M]:null}"string"==typeof y&&(p+=2)}return null}(e,t,l,i.index)),null!==Zt)(Zt.__ngLastListenerFn__||Zt).__ngNextListenerFn__=p,Zt.__ngLastListenerFn__=p,re=!1;else{p=w0(i,t,V,p,!1);const Bn=n.listen(Ye,l,p);K.push(p,Bn),F&&F.push(l,nt,Ct,Ct+1)}}else p=w0(i,t,V,p,!0),Ye.addEventListener(l,p,y),K.push(p),F&&F.push(l,nt,Ct,y)}else p=w0(i,t,V,p,!1);const Se=i.outputs;let Ge;if(re&&null!==Se&&(Ge=Se[l])){const ut=Ge.length;if(ut)for(let Ye=0;Ye<ut;Ye+=2){const yr=t[Ge[Ye]][Ge[Ye+1]].subscribe(p),Oa=K.length;K.push(p,yr),F&&F.push(l,i.index,Oa,-(Oa+1))}}}(p,l,l[11],y,e,t,!!n,i),nr}function Sw(e,t,n,i){try{return!1!==n(i)}catch(l){return Ar(e,l),!1}}function w0(e,t,n,i,l){return function p(y){if(y===Function)return i;_r(2&e.flags?Hi(e.index,t):t);let M=Sw(t,0,i,y),A=p.__ngNextListenerFn__;for(;A;)M=Sw(t,0,A,y)&&M,A=A.__ngNextListenerFn__;return l&&!1===M&&(y.preventDefault(),y.returnValue=!1),M}}function ti(e=1){return function T(e){return(Mn.lFrame.contextLView=function D(e,t){for(;e>0;)t=t[15],e--;return t}(e,Mn.lFrame.contextLView))[8]}(e)}function oI(e,t){let n=null;const i=function of(e){const t=e.attrs;if(null!=t){const n=t.indexOf(5);if(0==(1&n))return t[n+1]}return null}(e);for(let l=0;l<t.length;l++){const p=t[l];if("*"!==p){if(null===i?rf(e,p,!0):ty(i,p))return l}else n=l}return n}function C0(e,t=0,n){const i=lt(),l=er(),p=Uh(l,22+e,16,null,n||null);null===p.projection&&(p.projection=t),ql(),64!=(64&p.flags)&&function jx(e,t,n){Y_(t[11],0,t,n,$_(e,n,t),Jp(n.parent||t[6],n,t))}(l,i,p)}function Nw(e,t,n,i,l){const p=e[n+1],y=null===t;let w=i?ps(p):ia(p),M=!1;for(;0!==w&&(!1===M||y);){const F=e[w+1];lI(e[w],t)&&(M=!0,e[w+1]=i?cg(F):lg(F)),w=i?ps(F):ia(F)}M&&(e[n+1]=i?lg(p):cg(p))}function lI(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&vh(e,t)>=0}const uo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Vw(e){return e.substring(uo.key,uo.keyEnd)}function Uw(e,t){const n=uo.textEnd;return n===t?-1:(t=uo.keyEnd=function dI(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,uo.key=t,n),Ff(e,t,n))}function Ff(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function fl(e,t,n){return ml(e,t,n,!1),fl}function bo(e,t){return ml(e,t,null,!0),bo}function qw(e){!function gl(e,t,n,i){const l=er(),p=Es(2);l.firstUpdatePass&&Ww(l,null,p,i);const y=lt();if(n!==On&&Qo(y,p,n)){const w=l.data[I()];if(Jw(w,i)&&!Zw(l,p)){let M=i?w.classesWithoutHost:w.stylesWithoutHost;null!==M&&(n=La(M,n||"")),x0(l,w,y,n,i)}else!function bI(e,t,n,i,l,p,y,w){l===On&&(l=dr);let M=0,A=0,F=0<l.length?l[0]:null,V=0<p.length?p[0]:null;for(;null!==F||null!==V;){const K=M<l.length?l[M+1]:void 0,re=A<p.length?p[A+1]:void 0;let Ge,Se=null;F===V?(M+=2,A+=2,K!==re&&(Se=V,Ge=re)):null===V||null!==F&&F<V?(M+=2,Se=F):(A+=2,Se=V,Ge=re),null!==Se&&Yw(e,t,n,i,Se,Ge,y,w),F=M<l.length?l[M]:null,V=A<p.length?p[A]:null}}(l,w,y,y[11],y[p+1],y[p+1]=function xI(e,t,n){if(null==n||""===n)return dr;const i=[],l=Lo(n);if(Array.isArray(l))for(let p=0;p<l.length;p++)e(i,l[p],!0);else if("object"==typeof l)for(const p in l)l.hasOwnProperty(p)&&e(i,p,l[p]);else"string"==typeof l&&t(i,l);return i}(e,t,n),i,p)}}(hs,uc,e,!0)}function uc(e,t){for(let n=function uI(e){return function $w(e){uo.key=0,uo.keyEnd=0,uo.value=0,uo.valueEnd=0,uo.textEnd=e.length}(e),Uw(e,Ff(e,0,uo.textEnd))}(t);n>=0;n=Uw(t,n))hs(e,Vw(t),!0)}function ml(e,t,n,i){const l=lt(),p=er(),y=Es(2);p.firstUpdatePass&&Ww(p,e,y,i),t!==On&&Qo(l,y,t)&&Yw(p,p.data[I()],l,l[11],e,l[y+1]=function wI(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=ur(Lo(e)))),e}(t,n),i,y)}function Zw(e,t){return t>=e.expandoStartIndex}function Ww(e,t,n,i){const l=e.data;if(null===l[n+1]){const p=l[I()],y=Zw(e,n);Jw(p,i)&&null===t&&!y&&(t=!1),t=function gI(e,t,n,i){const l=function Ws(e){const t=Mn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let p=i?t.residualClasses:t.residualStyles;if(null===l)0===(i?t.classBindings:t.styleBindings)&&(n=bg(n=M0(null,e,t,n,i),t.attrs,i),p=null);else{const y=t.directiveStylingLast;if(-1===y||e[y]!==l)if(n=M0(l,e,t,n,i),null===p){let M=function _I(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==ia(i))return e[ps(i)]}(e,t,i);void 0!==M&&Array.isArray(M)&&(M=M0(null,e,t,M[1],i),M=bg(M,t.attrs,i),function yI(e,t,n,i){e[ps(n?t.classBindings:t.styleBindings)]=i}(e,t,i,M))}else p=function vI(e,t,n){let i;const l=t.directiveEnd;for(let p=1+t.directiveStylingLast;p<l;p++)i=bg(i,e[p].hostAttrs,n);return bg(i,t.attrs,n)}(e,t,i)}return void 0!==p&&(i?t.residualClasses=p:t.residualStyles=p),n}(l,p,t,i),function sI(e,t,n,i,l,p){let y=p?t.classBindings:t.styleBindings,w=ps(y),M=ia(y);e[i]=n;let F,A=!1;if(Array.isArray(n)){const V=n;F=V[1],(null===F||vh(V,F)>0)&&(A=!0)}else F=n;if(l)if(0!==M){const K=ps(e[w+1]);e[i+1]=gf(K,w),0!==K&&(e[K+1]=yf(e[K+1],i)),e[w+1]=function sc(e,t){return 131071&e|t<<17}(e[w+1],i)}else e[i+1]=gf(w,0),0!==w&&(e[w+1]=yf(e[w+1],i)),w=i;else e[i+1]=gf(M,0),0===w?w=i:e[M+1]=yf(e[M+1],i),M=i;A&&(e[i+1]=lg(e[i+1])),Nw(e,F,i,!0),Nw(e,F,i,!1),function aI(e,t,n,i,l){const p=l?e.residualClasses:e.residualStyles;null!=p&&"string"==typeof t&&vh(p,t)>=0&&(n[i+1]=cg(n[i+1]))}(t,F,e,i,p),y=gf(w,M),p?t.classBindings=y:t.styleBindings=y}(l,p,t,n,y,i)}}function M0(e,t,n,i,l){let p=null;const y=n.directiveEnd;let w=n.directiveStylingLast;for(-1===w?w=n.directiveStart:w++;w<y&&(p=t[w],i=bg(i,p.hostAttrs,l),p!==e);)w++;return null!==e&&(n.directiveStylingLast=w),i}function bg(e,t,n){const i=n?1:2;let l=-1;if(null!==t)for(let p=0;p<t.length;p++){const y=t[p];"number"==typeof y?l=y:l===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),hs(e,y,!!n||t[++p]))}return void 0===e?null:e}function Yw(e,t,n,i,l,p,y,w){if(!(3&t.type))return;const M=e.data,A=M[w+1];Fy(function op(e){return 1==(1&e)}(A)?Kw(M,t,n,l,ia(A),y):void 0)||(Fy(p)||function _f(e){return 2==(2&e)}(A)&&(p=Kw(M,null,n,l,w,y)),function ef(e,t,n,i,l){const p=Kr(e);if(t)l?p?e.addClass(n,i):n.classList.add(i):p?e.removeClass(n,i):n.classList.remove(i);else{let y=-1===i.indexOf("-")?void 0:kr.DashCase;if(null==l)p?e.removeStyle(n,i,y):n.style.removeProperty(i);else{const w="string"==typeof l&&l.endsWith("!important");w&&(l=l.slice(0,-10),y|=kr.Important),p?e.setStyle(n,i,l,y):n.style.setProperty(i,l,w?"important":"")}}}(i,y,Xa(I(),n),l,p))}function Kw(e,t,n,i,l,p){const y=null===t;let w;for(;l>0;){const M=e[l],A=Array.isArray(M),F=A?M[1]:M,V=null===F;let K=n[l+1];K===On&&(K=V?dr:void 0);let re=V?dm(K,i):F===i?K:void 0;if(A&&!Fy(re)&&(re=dm(M,i)),Fy(re)&&(w=re,y))return w;const Se=e[l+1];l=y?ps(Se):ia(Se)}if(null!==t){let M=p?t.residualClasses:t.residualStyles;null!=M&&(w=dm(M,i))}return w}function Fy(e){return void 0!==e}function Jw(e,t){return 0!=(e.flags&(t?16:32))}function wn(e,t=""){const n=lt(),i=er(),l=e+22,p=i.firstCreatePass?Uh(i,l,1,t,null):i.data[l],y=n[l]=function Rm(e,t){return Kr(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Kd(i,n,y,p),Po(p,!1)}function wo(e){return bu("",e,""),wo}function bu(e,t,n){const i=lt(),l=function Tf(e,t,n,i){return Qo(e,ga(),n)?t+Sn(n)+i:On}(i,e,t,n);return l!==On&&Vr(i,I(),l),bu}const Bf="en-US";let xC=Bf;function S0(e,t,n,i,l){if(e=yn(e),Array.isArray(e))for(let p=0;p<e.length;p++)S0(e[p],t,n,i,l);else{const p=er(),y=lt();let w=au(e)?e:yn(e.provide),M=Qm(e);const A=di(),F=1048575&A.providerIndexes,V=A.directiveStart,K=A.providerIndexes>>20;if(au(e)||!e.multi){const re=new Pe(M,l,tt),Se=A0(w,t,l?F:F+K,V);-1===Se?(Ei(gr(A,y),p,w),I0(p,e,t.length),t.push(w),A.directiveStart++,A.directiveEnd++,l&&(A.providerIndexes+=1048576),n.push(re),y.push(re)):(n[Se]=re,y[Se]=re)}else{const re=A0(w,t,F+K,V),Se=A0(w,t,F,F+K),Ge=re>=0&&n[re],ut=Se>=0&&n[Se];if(l&&!ut||!l&&!Ge){Ei(gr(A,y),p,w);const Ye=function VA(e,t,n,i,l){const p=new Pe(e,n,tt);return p.multi=[],p.index=t,p.componentProviders=0,HC(p,l,i&&!n),p}(l?NA:BA,n.length,l,i,M);!l&&ut&&(n[Se].providerFactory=Ye),I0(p,e,t.length,0),t.push(w),A.directiveStart++,A.directiveEnd++,l&&(A.providerIndexes+=1048576),n.push(Ye),y.push(Ye)}else I0(p,e,re>-1?re:Se,HC(n[l?Se:re],M,!l&&i));!l&&i&&ut&&n[Se].componentProviders++}}}function I0(e,t,n,i){const l=au(t),p=function Xx(e){return!!e.useClass}(t);if(l||p){const M=(p?yn(t.useClass):t).prototype.ngOnDestroy;if(M){const A=e.destroyHooks||(e.destroyHooks=[]);if(!l&&t.multi){const F=A.indexOf(n);-1===F?A.push(n,[i,M]):A[F+1].push(i,M)}else A.push(n,M)}}}function HC(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function A0(e,t,n,i){for(let l=n;l<i;l++)if(t[l]===e)return l;return-1}function BA(e,t,n,i){return P0(this.multi,[])}function NA(e,t,n,i){const l=this.multi;let p;if(this.providerFactory){const y=this.providerFactory.componentProviders,w=pi(n,n[1],this.providerFactory.index,i);p=w.slice(0,y),P0(l,p);for(let M=y;M<w.length;M++)p.push(w[M])}else p=[],P0(l,p);return p}function P0(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function _i(e,t=[]){return n=>{n.providersResolver=(i,l)=>function zA(e,t,n){const i=er();if(i.firstCreatePass){const l=io(e);S0(n,i.data,i.blueprint,l,!0),S0(t,i.data,i.blueprint,l,!1)}}(i,l?l(e):e,t)}}class jA{resolveComponentFactory(t){throw function UA(e){const t=Error(`No component factory found for ${ur(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Tg=(()=>{class e{}return e.NULL=new jA,e})();class Wh{}class ZC{}class WC{}function GA(){return Vf(di(),lt())}function Vf(e,t){return new es(Io(e,t))}let es=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=GA,e})();function HA(e){return e instanceof es?e.nativeElement:e}class XC{}let wu=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function ZA(){const e=lt(),n=Hi(di().index,e);return function qA(e){return e[11]}(Gi(n)?n:e)}(),e})(),WA=(()=>{class e{}return e.\u0275prov=sn({token:e,providedIn:"root",factory:()=>null}),e})();class Dg{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const XA=new Dg("14.0.2"),k0={};function Uy(e,t,n,i,l=!1){for(;null!==n;){const p=t[n.index];if(null!==p&&i.push(Jr(p)),So(p))for(let w=10;w<p.length;w++){const M=p[w],A=M[1].firstChild;null!==A&&Uy(M[1],M,A,i)}const y=n.type;if(8&y)Uy(e,t,n.child,i);else if(32&y){const w=iu(n,t);let M;for(;M=w();)i.push(M)}else if(16&y){const w=W_(t,n);if(Array.isArray(w))i.push(...w);else{const M=Ih(t[16]);Uy(M[1],M,w,i,!0)}}n=l?n.projectionNext:n.next}return i}class Sg{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return Uy(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(So(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(ki(t,i),Wl(n,i))}this._attachedToViewContainer=!1}ta(this._lView[1],this._lView)}onDestroy(t){S(this._lView[1],this._lView,null,t)}markForCheck(){_r(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function Er(e,t,n){const i=t[10];i.begin&&i.begin();try{yu(e,t,e.template,n)}catch(l){throw Ar(t,l),l}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new En(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Nx(e,t){Jd(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new En(902,"");this._appRef=t}}class YA extends Sg{constructor(t){super(t),this._view=t}detectChanges(){Or(this._view)}checkNoChanges(){}get context(){return null}}class O0 extends Tg{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=br(t);return new R0(n,this.ngModule)}}function YC(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class JA{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){const l=this.injector.get(t,k0,i);return l!==k0||n===k0?l:this.parentInjector.get(t,n,i)}}class R0 extends WC{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function iy(e){return e.map(ry).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return YC(this.componentDef.inputs)}get outputs(){return YC(this.componentDef.outputs)}create(t,n,i,l){let p=(l=l||this.ngModule)instanceof lu?l:l?.injector;p&&null!==this.componentDef.getStandaloneInjector&&(p=this.componentDef.getStandaloneInjector(p)||p);const y=p?new JA(t,p):t,w=y.get(XC,Pc),M=y.get(WA,null),A=w.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",V=i?function E(e,t,n){if(Kr(e))return e.selectRootElement(t,n===no.ShadowDom);let i="string"==typeof t?e.querySelector(t):t;return i.textContent="",i}(A,i,this.componentDef.encapsulation):Yp(w.createRenderer(null,this.componentDef),F,function KA(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(F)),K=this.componentDef.onPush?288:272,re=function pw(e,t){return{components:[],scheduler:e||Hd,clean:lo,playerHandler:t||null,flags:0}}(),Se=m(0,null,null,1,0,null,null,null,null,null),Ge=Vh(null,Se,re,K,null,null,w,A,M,y,null);let ut,Ye;f(Ge);try{const Ct=function hw(e,t,n,i,l,p){const y=n[1];n[22]=e;const M=Uh(y,22,2,"#host",null),A=M.mergedAttrs=t.hostAttrs;null!==A&&(ci(M,A,!0),null!==e&&(Rt(l,e,A),null!==M.classes&&tf(l,e,M.classes),null!==M.styles&&su(l,e,M.styles)));const F=i.createRenderer(e,t),V=Vh(n,d(t),null,t.onPush?32:16,n[22],M,i,F,p||null,null,null);return y.firstCreatePass&&(Ei(gr(M,n),y,t.type),Ae(y,M),st(M,n.length,1)),Un(n,V),n[22]=V}(V,this.componentDef,Ge,w,A);if(V)if(i)Rt(A,V,["ng-version",XA.full]);else{const{attrs:nt,classes:Zt}=function jm(e){const t=[],n=[];let i=1,l=2;for(;i<e.length;){let p=e[i];if("string"==typeof p)2===l?""!==p&&t.push(p,e[++i]):8===l&&n.push(p);else{if(!zo(l))break;l=p}i++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);nt&&Rt(A,V,nt),Zt&&Zt.length>0&&tf(A,V,Zt.join(" "))}if(Ye=Oc(Se,22),void 0!==n){const nt=Ye.projection=[];for(let Zt=0;Zt<this.ngContentSelectors.length;Zt++){const Bn=n[Zt];nt.push(null!=Bn?Array.from(Bn):null)}}ut=function dw(e,t,n,i,l){const p=n[1],y=function he(e,t,n){const i=di();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Tt(e,i,t,jh(e,t,1,null),n));const l=pi(t,e,i.directiveStart,i);ao(l,t);const p=Io(i,t);return p&&ao(p,t),l}(p,n,t);if(i.components.push(y),e[8]=y,null!==l)for(const M of l)M(y,t);if(t.contentQueries){const M=di();t.contentQueries(1,y,M.directiveStart)}const w=di();return!p.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(O(w.index),ge(n[1],w,0,w.directiveStart,w.directiveEnd,t),We(t,y)),y}(Ct,this.componentDef,Ge,re,[jS]),_u(Se,Ge,null)}finally{b()}return new e2(this.componentType,ut,Vf(Ye,Ge),Ge,Ye)}}class e2 extends class $A{}{constructor(t,n,i,l,p){super(),this.location=i,this._rootLView=l,this._tNode=p,this.instance=n,this.hostView=this.changeDetectorRef=new YA(l),this.componentType=t}get injector(){return new zc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class KC extends Wh{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new O0(this);const i=Fi(t);this._bootstrapComponents=Ma(i.bootstrap),this._r3Injector=ic(t,n,[{provide:Wh,useValue:this},{provide:Tg,useValue:this.componentFactoryResolver}],ur(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,n=qi.THROW_IF_NOT_FOUND,i=fn.Default){return t===qi||t===Wh||t===Wm?this:this._r3Injector.get(t,n,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class L0 extends ZC{constructor(t){super(),this.moduleType=t}create(t){return new KC(this.moduleType,t)}}class n2 extends Wh{constructor(t,n,i){super(),this.componentFactoryResolver=new O0(this),this.instance=null;const l=new uf([...t,{provide:Wh,useValue:this},{provide:Tg,useValue:this.componentFactoryResolver}],n||cf(),i,new Set(["environment"]));this.injector=l,l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function jy(e,t=null,n=null){return new n2(e,t,n).injector}function JC(e,t,n,i,l,p){const y=t+n;return Qo(e,y,l)?function lc(e,t,n){return e[t]=n}(e,y+1,p?i.call(p,l):i(l)):function Ig(e,t){const n=e[t];return n===On?void 0:n}(e,y+1)}function $y(e,t){const n=er();let i;const l=e+22;n.firstCreatePass?(i=function g2(e,t){if(t)for(let n=t.length-1;n>=0;n--){const i=t[n];if(e===i.name)return i}}(t,n.pipeRegistry),n.data[l]=i,i.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(l,i.onDestroy)):i=n.data[l];const p=i.factory||(i.factory=Ai(i.type)),y=ui(tt);try{const w=Qn(!1),M=p();return Qn(w),function eI(e,t,n,i){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=i}(n,lt(),l,M),M}finally{ui(y)}}function Gy(e,t,n){const i=e+22,l=lt(),p=function Ya(e,t){return e[t]}(l,i);return function Ag(e,t){return e[1].data[t].pure}(l,i)?JC(l,function Pi(){const e=Mn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),t,p.transform,n,p):p.transform(n)}function F0(e){return t=>{setTimeout(e,void 0,t)}}const qr=class b2 extends $n{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,i){let l=t,p=n||(()=>null),y=i;if(t&&"object"==typeof t){const M=t;l=M.next?.bind(M),p=M.error?.bind(M),y=M.complete?.bind(M)}this.__isAsync&&(p=F0(p),l&&(l=F0(l)),y&&(y=F0(y)));const w=super.subscribe({next:l,error:p,complete:y});return t instanceof H&&t.add(w),w}};function w2(){return this._results[cp()]()}class z0{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=cp(),i=z0.prototype;i[n]||(i[n]=w2)}get changes(){return this._changes||(this._changes=new qr)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const i=this;i.dirty=!1;const l=us(t);(this._changesDetected=!function ex(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let l=e[i],p=t[i];if(n&&(l=n(l),p=n(p)),p!==l)return!1}return!0}(i._results,l,n))&&(i._results=l,i.length=l.length,i.last=l[this.length-1],i.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Cu=(()=>{class e{}return e.__NG_ELEMENT_ID__=M2,e})();const C2=Cu,E2=class extends C2{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(t,n){const i=this._declarationTContainer.tViews,l=Vh(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,n||null);l[17]=this._declarationLView[this._declarationTContainer.index];const y=this._declarationLView[19];return null!==y&&(l[19]=y.createEmbeddedView(i)),_u(i,l,t),new Sg(l)}};function M2(){return Hy(di(),lt())}function Hy(e,t){return 4&e.type?new E2(t,e,Vf(e,t)):null}let _l=(()=>{class e{}return e.__NG_ELEMENT_ID__=T2,e})();function T2(){return oE(di(),lt())}const D2=_l,rE=class extends D2{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return Vf(this._hostTNode,this._hostLView)}get injector(){return new zc(this._hostTNode,this._hostLView)}get parentInjector(){const t=$r(this._hostTNode,this._hostLView);if(It(t)){const n=Nt(t,this._hostLView),i=Jt(t);return new zc(n[1].data[i+8],n)}return new zc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=iE(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,i){let l,p;"number"==typeof i?l=i:null!=i&&(l=i.index,p=i.injector);const y=t.createEmbeddedView(n||{},p);return this.insert(y,l),y}createComponent(t,n,i,l,p){const y=t&&!function _h(e){return"function"==typeof e}(t);let w;if(y)w=n;else{const V=n||{};w=V.index,i=V.injector,l=V.projectableNodes,p=V.environmentInjector||V.ngModuleRef}const M=y?t:new R0(br(t)),A=i||this.parentInjector;if(!p&&null==M.ngModule){const K=(y?A:this.parentInjector).get(lu,null);K&&(p=K)}const F=M.create(A,l,void 0,p);return this.insert(F.hostView,w),F}insert(t,n){const i=t._lView,l=i[1];if(function kp(e){return So(e[3])}(i)){const F=this.indexOf(t);if(-1!==F)this.detach(F);else{const V=i[3],K=new rE(V,V[6],V[3]);K.detach(K.indexOf(t))}}const p=this._adjustIndex(n),y=this._lContainer;!function Ux(e,t,n,i){const l=10+i,p=n.length;i>0&&(n[l-1][4]=t),i<p-10?(t[4]=n[l],Vp(n,10+i,t)):(n.push(t),t[4]=null),t[3]=n;const y=t[17];null!==y&&n!==y&&function U_(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(y,t);const w=t[19];null!==w&&w.insertView(e),t[2]|=64}(l,i,y,p);const w=Nm(p,y),M=i[11],A=tc(M,y[7]);return null!==A&&function Bx(e,t,n,i,l,p){i[0]=l,i[6]=t,Jd(e,i,n,1,l,p)}(l,y[6],M,i,A,w),t.attachToViewContainerRef(),Vp(B0(y),p,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=iE(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=ki(this._lContainer,n);i&&(Wl(B0(this._lContainer),n),ta(i[1],i))}detach(t){const n=this._adjustIndex(t,-1),i=ki(this._lContainer,n);return i&&null!=Wl(B0(this._lContainer),n)?new Sg(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function iE(e){return e[8]}function B0(e){return e[8]||(e[8]=[])}function oE(e,t){let n;const i=t[e.index];if(So(i))n=i;else{let l;if(8&e.type)l=Jr(i);else{const p=t[11];l=p.createComment("");const y=Io(e,t);na(p,tc(p,y),l,function Cr(e,t){return Kr(e)?e.nextSibling(t):t.nextSibling}(p,y),!1)}t[e.index]=n=zn(i,t,l,e),Un(t,n)}return new rE(n,e,t)}class N0{constructor(t){this.queryList=t,this.matches=null}clone(){return new N0(this.queryList)}setDirty(){this.queryList.setDirty()}}class V0{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,l=[];for(let p=0;p<i;p++){const y=n.getByIndex(p);l.push(this.queries[y.indexInDeclarationView].clone())}return new V0(l)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==uE(t,n).matches&&this.queries[n].setDirty()}}class sE{constructor(t,n,i=null){this.predicate=t,this.flags=n,this.read=i}}class U0{constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const l=null!==n?n.length:0,p=this.getByIndex(i).embeddedTView(t,l);p&&(p.indexInDeclarationView=i,null!==n?n.push(p):n=[p])}return null!==n?new U0(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class j0{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new j0(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let l=0;l<i.length;l++){const p=i[l];this.matchTNodeWithReadOption(t,n,A2(n,p)),this.matchTNodeWithReadOption(t,n,ls(n,t,p,!1,!1))}else i===Cu?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,ls(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const l=this.metadata.read;if(null!==l)if(l===es||l===_l||l===Cu&&4&n.type)this.addMatch(n.index,-2);else{const p=ls(n,t,l,!1,!1);null!==p&&this.addMatch(n.index,p)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function A2(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function k2(e,t,n,i){return-1===n?function P2(e,t){return 11&e.type?Vf(e,t):4&e.type?Hy(e,t):null}(t,e):-2===n?function O2(e,t,n){return n===es?Vf(t,e):n===Cu?Hy(t,e):n===_l?oE(t,e):void 0}(e,t,i):pi(e,e[1],n,t)}function aE(e,t,n,i){const l=t[19].queries[i];if(null===l.matches){const p=e.data,y=n.matches,w=[];for(let M=0;M<y.length;M+=2){const A=y[M];w.push(A<0?null:k2(t,p[A],y[M+1],n.metadata.read))}l.matches=w}return l.matches}function $0(e,t,n,i){const l=e.queries.getByIndex(n),p=l.matches;if(null!==p){const y=aE(e,t,l,n);for(let w=0;w<p.length;w+=2){const M=p[w];if(M>0)i.push(y[w/2]);else{const A=p[w+1],F=t[-M];for(let V=10;V<F.length;V++){const K=F[V];K[17]===K[3]&&$0(K[1],K,A,i)}if(null!==F[9]){const V=F[9];for(let K=0;K<V.length;K++){const re=V[K];$0(re[1],re,A,i)}}}}}return i}function Eu(e){const t=lt(),n=er(),i=Sd();Fc(i+1);const l=uE(n,i);if(e.dirty&&hi(t)===(2==(2&l.metadata.flags))){if(null===l.matches)e.reset([]);else{const p=l.crossesNgTemplate?$0(n,t,i,[]):aE(n,t,l,i);e.reset(p,HA),e.notifyOnChanges()}return!0}return!1}function dp(e,t,n){const i=er();i.firstCreatePass&&(function cE(e,t,n){null===e.queries&&(e.queries=new U0),e.queries.track(new j0(t,n))}(i,new sE(e,t,n),-1),2==(2&t)&&(i.staticViewQueries=!0)),function lE(e,t,n){const i=new z0(4==(4&n));S(e,t,i,i.destroy),null===t[19]&&(t[19]=new V0),t[19].queries.push(new N0(i))}(i,lt(),t)}function Mu(){return function R2(e,t){return e[19].queries[t].queryList}(lt(),Sd())}function uE(e,t){return e.queries.getByIndex(t)}function Zy(...e){}const X0=new Tn("Application Initializer");let Wy=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Zy,this.reject=Zy,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,l)=>{this.resolve=i,this.reject=l})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const p=this.appInits[l]();if(xg(p))n.push(p);else if(b0(p)){const y=new Promise((w,M)=>{p.subscribe({complete:w,error:M})});n.push(y)}}Promise.all(n).then(()=>{i()}).catch(l=>{this.reject(l)}),0===n.length&&i(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Gt(X0,8))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const kg=new Tn("AppId",{providedIn:"root",factory:function IE(){return`${Y0()}${Y0()}${Y0()}`}});function Y0(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const AE=new Tn("Platform Initializer"),K0=new Tn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),PE=new Tn("appBootstrapListener");let nP=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Tu=new Tn("LocaleId",{providedIn:"root",factory:()=>function ox(e,t=fn.Default){return Gt(e,t)}(Tu,fn.Optional|fn.SkipSelf)||function rP(){return typeof $localize<"u"&&$localize.locale||Bf}()});class oP{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let J0=(()=>{class e{compileModuleSync(n){return new L0(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),p=Ma(Fi(n).declarations).reduce((y,w)=>{const M=br(w);return M&&y.push(new R0(M)),y},[]);return new oP(i,p)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const aP=(()=>Promise.resolve(0))();function Q0(e){typeof Zone>"u"?aP.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Yi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new qr(!1),this.onMicrotaskEmpty=new qr(!1),this.onStable=new qr(!1),this.onError=new qr(!1),typeof Zone>"u")throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!i&&n,l.shouldCoalesceRunChangeDetection=i,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function lP(){let e=fr.requestAnimationFrame,t=fr.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function hP(e){const t=()=>{!function uP(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(fr,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,tb(e),e.isCheckStableRunning=!0,eb(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),tb(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,l,p,y,w)=>{try{return kE(e),n.invokeTask(l,p,y,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===p.type||e.shouldCoalesceRunChangeDetection)&&t(),OE(e)}},onInvoke:(n,i,l,p,y,w,M)=>{try{return kE(e),n.invoke(l,p,y,w,M)}finally{e.shouldCoalesceRunChangeDetection&&t(),OE(e)}},onHasTask:(n,i,l,p)=>{n.hasTask(l,p),i===l&&("microTask"==p.change?(e._hasPendingMicrotasks=p.microTask,tb(e),eb(e)):"macroTask"==p.change&&(e.hasPendingMacrotasks=p.macroTask))},onHandleError:(n,i,l,p)=>(n.handleError(l,p),e.runOutsideAngular(()=>e.onError.emit(p)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Yi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Yi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,l){const p=this._inner,y=p.scheduleEventTask("NgZoneEvent: "+l,t,cP,Zy,Zy);try{return p.runTask(y,n,i)}finally{p.cancelTask(y)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const cP={};function eb(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function tb(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function kE(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function OE(e){e._nesting--,eb(e)}class dP{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qr,this.onMicrotaskEmpty=new qr,this.onStable=new qr,this.onError=new qr}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,l){return t.apply(n,i)}}const RE=new Tn(""),Xy=new Tn("");let ib,nb=(()=>{class e{constructor(n,i,l){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ib||(function pP(e){ib=e}(l),l.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Yi.assertNotInAngularZone(),Q0(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Q0(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,l){let p=-1;i&&i>0&&(p=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==p),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:p,updateCb:l})}whenStable(n,i,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,l){return[]}}return e.\u0275fac=function(n){return new(n||e)(Gt(Yi),Gt(rb),Gt(Xy))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),rb=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return ib?.findTestabilityInTree(this,n,i)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Xh=null;const LE=new Tn("AllowMultipleToken"),FE=new Tn("PlatformOnDestroy");class zE{constructor(t,n){this.name=t,this.token=n}}function NE(e,t,n=[]){const i=`Platform: ${t}`,l=new Tn(i);return(p=[])=>{let y=ob();if(!y||y.injector.get(LE,!1)){const w=[...n,...p,{provide:l,useValue:!0}];e?e(w):function gP(e){if(Xh&&!Xh.get(LE,!1))throw new En(400,"");Xh=e;const t=e.get(UE);(function BE(e){const t=e.get(AE,null);t&&t.forEach(n=>n())})(e)}(function VE(e=[],t){return qi.create({name:t,providers:[{provide:Xm,useValue:"platform"},{provide:FE,useValue:()=>Xh=null},...e]})}(w,i))}return function yP(e){const t=ob();if(!t)throw new En(401,"");return t}()}}function ob(){return Xh?.get(UE)??null}let UE=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const l=function vP(e,t){let n;return n="noop"===e?new dP:("zone.js"===e?void 0:e)||new Yi(t),n}(i?.ngZone,function jE(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(i)),p=[{provide:Yi,useValue:l}];return l.run(()=>{const y=qi.create({providers:p,parent:this.injector,name:n.moduleType.name}),w=n.create(y),M=w.injector.get(tu,null);if(!M)throw new En(402,"");return l.runOutsideAngular(()=>{const A=l.onError.subscribe({next:F=>{M.handleError(F)}});w.onDestroy(()=>{Ky(this._modules,w),A.unsubscribe()})}),function $E(e,t,n){try{const i=n();return xg(i)?i.catch(l=>{throw t.runOutsideAngular(()=>e.handleError(l)),l}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(M,l,()=>{const A=w.injector.get(Wy);return A.runInitializers(),A.donePromise.then(()=>(function bC(e){Do(e,"Expected localeId to be defined"),"string"==typeof e&&(xC=e.toLowerCase().replace(/_/g,"-"))}(w.injector.get(Tu,Bf)||Bf),this._moduleDoBootstrap(w),w))})})}bootstrapModule(n,i=[]){const l=GE({},i);return function fP(e,t,n){const i=new L0(n);return Promise.resolve(i)}(0,0,n).then(p=>this.bootstrapModuleFactory(p,l))}_moduleDoBootstrap(n){const i=n.injector.get(Yy);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(l=>i.bootstrap(l));else{if(!n.instance.ngDoBootstrap)throw new En(403,"");n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new En(404,"");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i()),this._injector.get(FE,null)?.(),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Gt(qi))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function GE(e,t){return Array.isArray(t)?t.reduce(GE,e):{...e,...t}}let Yy=(()=>{class e{constructor(n,i,l,p){this._zone=n,this._injector=i,this._exceptionHandler=l,this._initStatus=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new qt(M=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{M.next(this._stable),M.complete()})}),w=new qt(M=>{let A;this._zone.runOutsideAngular(()=>{A=this._zone.onStable.subscribe(()=>{Yi.assertNotInAngularZone(),Q0(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,M.next(!0))})})});const F=this._zone.onUnstable.subscribe(()=>{Yi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{M.next(!1)}))});return()=>{A.unsubscribe(),F.unsubscribe()}});this.isStable=function Gn(...e){const t=cr(e),n=function sr(e,t){return"number"==typeof bn(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?z(i[0]):Qe(n)(ct(i,t)):Ut}(y,w.pipe(function rs(e={}){const{connector:t=(()=>new $n),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:l=!0}=e;return p=>{let y=null,w=null,M=null,A=0,F=!1,V=!1;const K=()=>{w?.unsubscribe(),w=null},re=()=>{K(),y=M=null,F=V=!1},Se=()=>{const Ge=y;re(),Ge?.unsubscribe()};return Yn((Ge,ut)=>{A++,!V&&!F&&K();const Ye=M=M??t();ut.add(()=>{A--,0===A&&!V&&!F&&(w=Ns(Se,l))}),Ye.subscribe(ut),y||(y=new Pt({next:Ct=>Ye.next(Ct),error:Ct=>{V=!0,K(),w=Ns(re,n,Ct),Ye.error(Ct)},complete:()=>{F=!0,K(),w=Ns(re,i),Ye.complete()}}),ct(Ge).subscribe(y))})(p)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,i){const l=n instanceof WC;if(!this._initStatus.done)throw!l&&function jf(e){const t=br(e)||Ui(e)||ji(e);return null!==t&&t.standalone}(n),new En(405,false);let p;p=l?n:this._injector.get(Tg).resolveComponentFactory(n),this.componentTypes.push(p.componentType);const y=function mP(e){return e.isBoundToModule}(p)?void 0:this._injector.get(Wh),M=p.create(qi.NULL,[],i||p.selector,y),A=M.location.nativeElement,F=M.injector.get(RE,null);return F?.registerApplication(A),M.onDestroy(()=>{this.detachView(M.hostView),Ky(this.components,M),F?.unregisterApplication(A)}),this._loadComponent(M),M}tick(){if(this._runningTick)throw new En(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;Ky(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(PE,[]).concat(this._bootstrapListeners).forEach(l=>l(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Ky(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new En(406,false);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Gt(Yi),Gt(qi),Gt(tu),Gt(Wy))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Ky(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let qE=!0,Jy=(()=>{class e{}return e.__NG_ELEMENT_ID__=wP,e})();function wP(e){return function CP(e,t,n){if(Bl(e)&&!n){const i=Hi(e.index,t);return new Sg(i,i)}return 47&e.type?new Sg(t[16],t):null}(di(),lt(),16==(16&e))}class KE{constructor(){}supports(t){return yg(t)}create(t){return new IP(t)}}const SP=(e,t)=>t;class IP{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||SP}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,l=0,p=null;for(;n||i;){const y=!i||n&&n.currentIndex<QE(i,l,p)?n:i,w=QE(y,l,p),M=y.currentIndex;if(y===i)l--,i=i._nextRemoved;else if(n=n._next,null==y.previousIndex)l++;else{p||(p=[]);const A=w-l,F=M-l;if(A!=F){for(let K=0;K<A;K++){const re=K<p.length?p[K]:p[K]=0,Se=re+K;F<=Se&&Se<A&&(p[K]=re+1)}p[y.previousIndex]=F-A}}w!==M&&t(y,w,M)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!yg(t))throw new En(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let l,p,y,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let w=0;w<this.length;w++)p=t[w],y=this._trackByFn(w,p),null!==n&&Object.is(n.trackById,y)?(i&&(n=this._verifyReinsertion(n,p,y,w)),Object.is(n.item,p)||this._addIdentityChange(n,p)):(n=this._mismatch(n,p,y,w),i=!0),n=n._next}else l=0,function KS(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[cp()]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,w=>{y=this._trackByFn(l,w),null!==n&&Object.is(n.trackById,y)?(i&&(n=this._verifyReinsertion(n,w,y,l)),Object.is(n.item,w)||this._addIdentityChange(n,w)):(n=this._mismatch(n,w,y,l),i=!0),n=n._next,l++}),this.length=l;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,l){let p;return null===t?p=this._itTail:(p=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,p,l)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,l))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,p,l)):t=this._addAfter(new AP(n,i),p,l),t}_verifyReinsertion(t,n,i,l){let p=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==p?t=this._reinsertAfter(p,t._prev,l):t.currentIndex!=l&&(t.currentIndex=l,this._addToMoves(t,l)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const l=t._prevRemoved,p=t._nextRemoved;return null===l?this._removalsHead=p:l._nextRemoved=p,null===p?this._removalsTail=l:p._prevRemoved=l,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const l=null===n?this._itHead:n._next;return t._next=l,t._prev=n,null===l?this._itTail=t:l._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new JE),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new JE),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class AP{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class PP{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class JE{constructor(){this.map=new Map}put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new PP,this.map.set(n,i)),i.add(t)}get(t,n){const l=this.map.get(t);return l?l.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function QE(e,t,n){const i=e.previousIndex;if(null===i)return i;let l=0;return n&&i<n.length&&(l=n[i]),i+t+l}function tM(){return new tv([new KE])}let tv=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(null!=i){const l=i.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||tM()),deps:[[e,new bh,new Ts]]}}find(n){const i=this.factories.find(l=>l.supports(n));if(null!=i)return i;throw new En(901,"")}}return e.\u0275prov=sn({token:e,providedIn:"root",factory:tM}),e})();const FP=NE(null,"core",[]);let zP=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Gt(Yy))},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({}),e})();let nv=null;function dc(){return nv}const No=new Tn("DocumentToken");let Rg=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:function(){return function UP(){return Gt(rM)}()},providedIn:"platform"}),e})();const jP=new Tn("Location Initialized");let rM=(()=>{class e extends Rg{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return dc().getBaseHref(this._doc)}onPopState(n){const i=dc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=dc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,i,l){iM()?this._history.pushState(n,i,l):this.location.hash=l}replaceState(n,i,l){iM()?this._history.replaceState(n,i,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:function(){return function $P(){return new rM(Gt(No))}()},providedIn:"platform"}),e})();function iM(){return!!window.history.pushState}function ub(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function oM(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Su(e){return e&&"?"!==e[0]?"?"+e:e}let Gf=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:function(){return function GP(){const e=Gt(No).location;return new sM(Gt(Rg),e&&e.origin||"")}()},providedIn:"root"}),e})();const hb=new Tn("appBaseHref");let sM=(()=>{class e extends Gf{constructor(n,i){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return ub(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Su(this._platformLocation.search),l=this._platformLocation.hash;return l&&n?`${i}${l}`:i}pushState(n,i,l,p){const y=this.prepareExternalUrl(l+Su(p));this._platformLocation.pushState(n,i,y)}replaceState(n,i,l,p){const y=this.prepareExternalUrl(l+Su(p));this._platformLocation.replaceState(n,i,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Gt(Rg),Gt(hb,8))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),HP=(()=>{class e extends Gf{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=ub(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,l,p){let y=this.prepareExternalUrl(l+Su(p));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,i,y)}replaceState(n,i,l,p){let y=this.prepareExternalUrl(l+Su(p));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Gt(Rg),Gt(hb,8))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),db=(()=>{class e{constructor(n){this._subject=new qr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._baseHref=oM(aM(i)),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Su(i))}normalize(n){return e.stripTrailingSlash(function ZP(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,aM(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",l=null){this._locationStrategy.pushState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Su(i)),l)}replaceState(n,i="",l=null){this._locationStrategy.replaceState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Su(i)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(l=>l(n,i))}subscribe(n,i,l){return this._subject.subscribe({next:n,error:i,complete:l})}}return e.normalizeQueryParams=Su,e.joinWithSlash=ub,e.stripTrailingSlash=oM,e.\u0275fac=function(n){return new(n||e)(Gt(Gf))},e.\u0275prov=sn({token:e,factory:function(){return function qP(){return new db(Gt(Gf))}()},providedIn:"root"}),e})();function aM(e){return e.replace(/\/index.html$/,"")}function gM(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[l,p]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(l.trim()===t)return decodeURIComponent(p)}return null}class kk{constructor(t,n,i,l){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let yM=(()=>{class e{constructor(n,i,l){this._viewContainer=n,this._template=i,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((l,p,y)=>{if(null==l.previousIndex)i.createEmbeddedView(this._template,new kk(l.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)i.remove(null===p?void 0:p);else if(null!==p){const w=i.get(p);i.move(w,y),vM(w,l)}});for(let l=0,p=i.length;l<p;l++){const w=i.get(l).context;w.index=l,w.count=p,w.ngForOf=this._ngForOf}n.forEachIdentityChange(l=>{vM(i.get(l.currentIndex),l)})}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(tt(_l),tt(Cu),tt(tv))},e.\u0275dir=un({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();function vM(e,t){e.context.$implicit=t.item}let Yh=(()=>{class e{constructor(n,i){this._viewContainer=n,this._context=new Ok,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){xM("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){xM("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(tt(_l),tt(Cu))},e.\u0275dir=un({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class Ok{constructor(){this.$implicit=null,this.ngIf=null}}function xM(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${ur(t)}'.`)}class Nk{createSubscription(t,n){return t.subscribe({next:n,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class Vk{createSubscription(t,n){return t.then(n,i=>{throw i})}dispose(t){}}const Uk=new Vk,jk=new Nk;let wM=(()=>{class e{constructor(n){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){return this._obj?n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue:(n&&this._subscribe(n),this._latestValue)}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,i=>this._updateLatestValue(n,i))}_selectStrategy(n){if(xg(n))return Uk;if(Mw(n))return jk;throw function vl(e,t){return new En(2100,"")}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,i){n===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return e.\u0275fac=function(n){return new(n||e)(tt(Jy,16))},e.\u0275pipe=Li({name:"async",type:e,pure:!1}),e})(),oO=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({}),e})();let cO=(()=>{class e{}return e.\u0275prov=sn({token:e,providedIn:"root",factory:()=>new uO(Gt(No),window)}),e})();class uO{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function hO(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=i.currentNode;for(;l;){const p=l.shadowRoot;if(p){const y=p.getElementById(t)||p.querySelector(`[name="${t}"]`);if(y)return y}l=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,l=n.top+this.window.pageYOffset,p=this.offset();this.window.scrollTo(i-p[0],l-p[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=MM(this.window.history)||MM(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function MM(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class TM{}class Tb extends class dO extends class VP{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function NP(e){nv||(nv=e)}(new Tb)}onAndCancel(t,n,i){return t.addEventListener(n,i,!1),()=>{t.removeEventListener(n,i,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function pO(){return zg=zg||document.querySelector("base"),zg?zg.getAttribute("href"):null}();return null==n?null:function fO(e){dv=dv||document.createElement("a"),dv.setAttribute("href",e);const t=dv.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){zg=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return gM(document.cookie,t)}}let dv,zg=null;const DM=new Tn("TRANSITION_ID"),gO=[{provide:X0,useFactory:function mO(e,t,n){return()=>{n.get(Wy).donePromise.then(()=>{const i=dc(),l=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let p=0;p<l.length;p++)i.remove(l[p])})}},deps:[DM,No,qi],multi:!0}];let yO=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const pv=new Tn("EventManagerPlugins");let fv=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(l=>l.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,i,l){return this._findPluginFor(i).addEventListener(n,i,l)}addGlobalEventListener(n,i,l){return this._findPluginFor(i).addGlobalEventListener(n,i,l)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const l=this._plugins;for(let p=0;p<l.length;p++){const y=l[p];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Gt(pv),Gt(Yi))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();class SM{constructor(t){this._doc=t}addGlobalEventListener(t,n,i){const l=dc().getGlobalEventTarget(this._doc,t);if(!l)throw new Error(`Unsupported event target ${l} for event ${n}`);return this.addEventListener(l,n,i)}}let IM=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const i=new Set;n.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),i.add(l))}),this.onStylesAdded(i)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),Bg=(()=>{class e extends IM{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,i,l){n.forEach(p=>{const y=this._doc.createElement("style");y.textContent=p,l.push(i.appendChild(y))})}addHost(n){const i=[];this._addStylesToHost(this._stylesSet,n,i),this._hostNodes.set(n,i)}removeHost(n){const i=this._hostNodes.get(n);i&&i.forEach(AM),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((i,l)=>{this._addStylesToHost(n,l,i)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(AM))}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();function AM(e){dc().remove(e)}const Db={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Sb=/%COMP%/g;function mv(e,t,n){for(let i=0;i<t.length;i++){let l=t[i];Array.isArray(l)?mv(e,l,n):(l=l.replace(Sb,e),n.push(l))}return n}function OM(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Ib=(()=>{class e{constructor(n,i,l){this.eventManager=n,this.sharedStylesHost=i,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new Ab(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;switch(i.encapsulation){case no.Emulated:{let l=this.rendererByCompId.get(i.id);return l||(l=new EO(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,l)),l.applyToHost(n),l}case 1:case no.ShadowDom:return new MO(this.eventManager,this.sharedStylesHost,n,i);default:if(!this.rendererByCompId.has(i.id)){const l=mv(i.id,i.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Gt(fv),Gt(Bg),Gt(kg))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();class Ab{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(Db[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(LM(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(LM(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,l){if(l){n=l+":"+n;const p=Db[l];p?t.setAttributeNS(p,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const l=Db[i];l?t.removeAttributeNS(l,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,l){l&(kr.DashCase|kr.Important)?t.style.setProperty(n,i,l&kr.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&kr.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){t[n]=i}setValue(t,n){t.nodeValue=n}listen(t,n,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,OM(i)):this.eventManager.addEventListener(t,n,OM(i))}}function LM(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class EO extends Ab{constructor(t,n,i,l){super(t),this.component=i;const p=mv(l+"-"+i.id,i.styles,[]);n.addStyles(p),this.contentAttr=function bO(e){return"_ngcontent-%COMP%".replace(Sb,e)}(l+"-"+i.id),this.hostAttr=function wO(e){return"_nghost-%COMP%".replace(Sb,e)}(l+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}class MO extends Ab{constructor(t,n,i,l){super(t),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const p=mv(l.id,l.styles,[]);for(let y=0;y<p.length;y++){const w=document.createElement("style");w.textContent=p[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let TO=(()=>{class e extends SM{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,l){return n.addEventListener(i,l,!1),()=>this.removeEventListener(n,i,l)}removeEventListener(n,i,l){return n.removeEventListener(i,l)}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const FM=["alt","control","meta","shift"],SO={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},zM={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},IO={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let AO=(()=>{class e extends SM{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,l){const p=e.parseEventName(i),y=e.eventCallback(p.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>dc().onAndCancel(n,p.domEventName,y))}static parseEventName(n){const i=n.toLowerCase().split("."),l=i.shift();if(0===i.length||"keydown"!==l&&"keyup"!==l)return null;const p=e._normalizeKey(i.pop());let y="";if(FM.forEach(M=>{const A=i.indexOf(M);A>-1&&(i.splice(A,1),y+=M+".")}),y+=p,0!=i.length||0===p.length)return null;const w={};return w.domEventName=l,w.fullKey=y,w}static getEventFullKey(n){let i="",l=function PO(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&zM.hasOwnProperty(t)&&(t=zM[t]))}return SO[t]||t}(n);return l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),FM.forEach(p=>{p!=l&&IO[p](n)&&(i+=p+".")}),i+=l,i}static eventCallback(n,i,l){return p=>{e.getEventFullKey(p)===n&&l.runGuarded(()=>i(p))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const LO=NE(FP,"browser",[{provide:K0,useValue:"browser"},{provide:AE,useValue:function kO(){Tb.makeCurrent()},multi:!0},{provide:No,useFactory:function RO(){return function Sp(e){Wa=e}(document),document},deps:[]}]),NM=new Tn(""),VM=[{provide:Xy,useClass:class _O{addToWindow(t){fr.getAngularTestability=(i,l=!0)=>{const p=t.findTestabilityInTree(i,l);if(null==p)throw new Error("Could not find testability for element.");return p},fr.getAllAngularTestabilities=()=>t.getAllTestabilities(),fr.getAllAngularRootElements=()=>t.getAllRootElements(),fr.frameworkStabilizers||(fr.frameworkStabilizers=[]),fr.frameworkStabilizers.push(i=>{const l=fr.getAllAngularTestabilities();let p=l.length,y=!1;const w=function(M){y=y||M,p--,0==p&&i(y)};l.forEach(function(M){M.whenStable(w)})})}findTestabilityInTree(t,n,i){return null==n?null:t.getTestability(n)??(i?dc().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:RE,useClass:nb,deps:[Yi,rb,Xy]},{provide:nb,useClass:nb,deps:[Yi,rb,Xy]}],UM=[{provide:Xm,useValue:"root"},{provide:tu,useFactory:function OO(){return new tu},deps:[]},{provide:pv,useClass:TO,multi:!0,deps:[No,Yi,K0]},{provide:pv,useClass:AO,multi:!0,deps:[No]},{provide:Ib,useClass:Ib,deps:[fv,Bg,kg]},{provide:XC,useExisting:Ib},{provide:IM,useExisting:Bg},{provide:Bg,useClass:Bg,deps:[No]},{provide:fv,useClass:fv,deps:[pv,Yi]},{provide:TM,useClass:yO,deps:[]},[]];let FO=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:kg,useValue:n.appId},{provide:DM,useExisting:kg},gO]}}}return e.\u0275fac=function(n){return new(n||e)(Gt(NM,12))},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({providers:[...UM,...VM],imports:[oO,zP]}),e})(),kb=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:function(n){let i=null;return i=n?new n:function BO(){return new kb(Gt(No))}(),i},providedIn:"root"}),e})();typeof window<"u"&&window;let gv=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:function(n){let i=null;return i=n?new(n||e):Gt(GM),i},providedIn:"root"}),e})(),GM=(()=>{class e extends gv{constructor(n){super(),this._doc=n}sanitize(n,i){if(null==i)return null;switch(n){case Gr.NONE:return i;case Gr.HTML:return Nr(i,"HTML")?Lo(i):al(this._doc,String(i)).toString();case Gr.STYLE:return Nr(i,"Style")?Lo(i):i;case Gr.SCRIPT:if(Nr(i,"Script"))return Lo(i);throw new Error("unsafe value used in a script context");case Gr.URL:return vm(i),Nr(i,"URL")?Lo(i):Jc(String(i));case Gr.RESOURCE_URL:if(Nr(i,"ResourceURL"))return Lo(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${n} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(n){return function Rd(e){return new Hp(e)}(n)}bypassSecurityTrustStyle(n){return function Ss(e){return new Ca(e)}(n)}bypassSecurityTrustScript(n){return function px(e){return new qp(e)}(n)}bypassSecurityTrustUrl(n){return function fx(e){return new go(e)}(n)}bypassSecurityTrustResourceUrl(n){return function v_(e){return new Ds(e)}(n)}}return e.\u0275fac=function(n){return new(n||e)(Gt(No))},e.\u0275prov=sn({token:e,factory:function(n){let i=null;return i=n?new n:function qO(e){return new GM(e.get(No))}(Gt(qi)),i},providedIn:"root"}),e})();function jn(...e){return ct(e,cr(e))}class Vo extends $n{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const{isArray:ZO}=Array,{getPrototypeOf:WO,prototype:XO,keys:YO}=Object;function HM(e){if(1===e.length){const t=e[0];if(ZO(t))return{args:t,keys:null};if(function KO(e){return e&&"object"==typeof e&&WO(e)===XO}(t)){const n=YO(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}const{isArray:JO}=Array;function Rb(e){return hn(t=>function QO(e,t){return JO(t)?e(...t):e(t)}(e,t))}function qM(e,t){return e.reduce((n,i,l)=>(n[i]=t[l],n),{})}function ZM(...e){const t=cr(e),n=Kn(e),{args:i,keys:l}=HM(e);if(0===i.length)return ct([],t);const p=new qt(function eR(e,t,n=St){return i=>{WM(t,()=>{const{length:l}=e,p=new Array(l);let y=l,w=l;for(let M=0;M<l;M++)WM(t,()=>{const A=ct(e[M],t);let F=!1;A.subscribe(en(i,V=>{p[M]=V,F||(F=!0,w--),w||i.next(n(p.slice()))},()=>{--y||i.complete()}))},i)},i)}}(i,t,l?y=>qM(l,y):St));return n?p.pipe(Rb(n)):p}function WM(e,t,n){e?De(n,e,t):t()}function Ng(e,t){const n=Ue(e)?e:()=>e,i=l=>l.error(n());return new qt(t?l=>t.schedule(i,0,l):i)}const Vg=Ne(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function _v(...e){return function tR(){return Qe(1)}()(ct(e,cr(e)))}function XM(e){return new qt(t=>{z(e()).subscribe(t)})}function Lb(){return Yn((e,t)=>{let n=null;e._refCount++;const i=en(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const l=e._connection,p=n;n=null,l&&(!p||l===p)&&l.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class YM extends qt{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Si(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new H;const n=this.getSubject();t.add(this.source.subscribe(en(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=H.EMPTY)}return t}refCount(){return Lb()(this)}}function pc(e,t){return Yn((n,i)=>{let l=null,p=0,y=!1;const w=()=>y&&!l&&i.complete();n.subscribe(en(i,M=>{l?.unsubscribe();let A=0;const F=p++;z(e(M,F)).subscribe(l=en(i,V=>i.next(t?t(M,V,F,A++):V),()=>{l=null,w()}))},()=>{y=!0,w()}))})}function rR(e,t,n,i,l){return(p,y)=>{let w=n,M=t,A=0;p.subscribe(en(y,F=>{const V=A++;M=w?e(M,F,V):(w=!0,F),i&&y.next(M)},l&&(()=>{w&&y.next(M),y.complete()})))}}function KM(e,t){return Yn(rR(e,t,arguments.length>=2,!0))}function Au(e,t){return Yn((n,i)=>{let l=0;n.subscribe(en(i,p=>e.call(t,p,l++)&&i.next(p)))})}function Jh(e){return Yn((t,n)=>{let p,i=null,l=!1;i=t.subscribe(en(n,void 0,void 0,y=>{p=z(e(y,Jh(e)(t))),i?(i.unsubscribe(),i=null,p.subscribe(n)):l=!0})),l&&(i.unsubscribe(),i=null,p.subscribe(n))})}function Hf(e,t){return Ue(t)?ht(e,t,1):ht(e,1)}function yv(e){return e<=0?()=>Ut:Yn((t,n)=>{let i=[];t.subscribe(en(n,l=>{i.push(l),e<i.length&&i.shift()},()=>{for(const l of i)n.next(l);n.complete()},void 0,()=>{i=null}))})}function JM(e=iR){return Yn((t,n)=>{let i=!1;t.subscribe(en(n,l=>{i=!0,n.next(l)},()=>i?n.complete():n.error(e())))})}function iR(){return new Vg}function Fb(e){return Yn((t,n)=>{let i=!1;t.subscribe(en(n,l=>{i=!0,n.next(l)},()=>{i||n.next(e),n.complete()}))})}function Co(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Au((l,p)=>e(l,p,i)):St,cn(1),n?Fb(t):JM(()=>new Vg))}function Eo(e,t,n){const i=Ue(e)||t||n?{next:e,error:t,complete:n}:e;return i?Yn((l,p)=>{var y;null===(y=i.subscribe)||void 0===y||y.call(i);let w=!0;l.subscribe(en(p,M=>{var A;null===(A=i.next)||void 0===A||A.call(i,M),p.next(M)},()=>{var M;w=!1,null===(M=i.complete)||void 0===M||M.call(i),p.complete()},M=>{var A;w=!1,null===(A=i.error)||void 0===A||A.call(i,M),p.error(M)},()=>{var M,A;w&&(null===(M=i.unsubscribe)||void 0===M||M.call(i)),null===(A=i.finalize)||void 0===A||A.call(i)}))}):St}function QM(e){return hn(()=>e)}function zb(e){return Yn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}class Pu{constructor(t,n){this.id=t,this.url=n}}class Bb extends Pu{constructor(t,n,i="imperative",l=null){super(t,n),this.type=0,this.navigationTrigger=i,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ug extends Pu{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class eT extends Pu{constructor(t,n,i){super(t,n),this.reason=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class sR extends Pu{constructor(t,n,i){super(t,n),this.error=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class aR extends Pu{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class lR extends Pu{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cR extends Pu{constructor(t,n,i,l,p){super(t,n),this.urlAfterRedirects=i,this.state=l,this.shouldActivate=p,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class uR extends Pu{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hR extends Pu{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class dR{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class pR{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class fR{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class mR{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gR{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _R{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tT{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const rr="primary";class yR{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function qf(e){return new yR(e)}const nT="ngNavigationCancelingError";function Nb(e){const t=Error("NavigationCancelingError: "+e);return t[nT]=!0,t}function xR(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const l={};for(let p=0;p<i.length;p++){const y=i[p],w=e[p];if(y.startsWith(":"))l[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:e.slice(0,i.length),posParams:l}}function fc(e,t){const n=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!n||!i||n.length!=i.length)return!1;let l;for(let p=0;p<n.length;p++)if(l=n[p],!rT(e[l],t[l]))return!1;return!0}function rT(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((l,p)=>i[p]===l)}return e===t}function iT(e){return Array.prototype.concat.apply([],e)}function oT(e){return e.length>0?e[e.length-1]:null}function Uo(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function xl(e){return b0(e)?e:xg(e)?ct(Promise.resolve(e)):jn(e)}const CR={exact:function lT(e,t,n){if(!mp(e.segments,t.segments)||!vv(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!lT(e.children[i],t.children[i],n))return!1;return!0},subset:cT},sT={exact:function ER(e,t){return fc(e,t)},subset:function MR(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>rT(e[n],t[n]))},ignored:()=>!0};function aT(e,t,n){return CR[n.paths](e.root,t.root,n.matrixParams)&&sT[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function cT(e,t,n){return uT(e,t,t.segments,n)}function uT(e,t,n,i){if(e.segments.length>n.length){const l=e.segments.slice(0,n.length);return!(!mp(l,n)||t.hasChildren()||!vv(l,n,i))}if(e.segments.length===n.length){if(!mp(e.segments,n)||!vv(e.segments,n,i))return!1;for(const l in t.children)if(!e.children[l]||!cT(e.children[l],t.children[l],i))return!1;return!0}{const l=n.slice(0,e.segments.length),p=n.slice(e.segments.length);return!!(mp(e.segments,l)&&vv(e.segments,l,i)&&e.children[rr])&&uT(e.children[rr],t,p,i)}}function vv(e,t,n){return t.every((i,l)=>sT[n](e[l].parameters,i.parameters))}class fp{constructor(t,n,i){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qf(this.queryParams)),this._queryParamMap}toString(){return SR.serialize(this)}}class pr{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Uo(n,(i,l)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return xv(this)}}class jg{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=qf(this.parameters)),this._parameterMap}toString(){return mT(this)}}function mp(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}class hT{}class dT{parse(t){const n=new zR(t);return new fp(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${$g(t.root,!0)}`,i=function PR(e){const t=Object.keys(e).map(n=>{const i=e[n];return Array.isArray(i)?i.map(l=>`${bv(n)}=${bv(l)}`).join("&"):`${bv(n)}=${bv(i)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function IR(e){return encodeURI(e)}(t.fragment)}`:""}`}}const SR=new dT;function xv(e){return e.segments.map(t=>mT(t)).join("/")}function $g(e,t){if(!e.hasChildren())return xv(e);if(t){const n=e.children[rr]?$g(e.children[rr],!1):"",i=[];return Uo(e.children,(l,p)=>{p!==rr&&i.push(`${p}:${$g(l,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function DR(e,t){let n=[];return Uo(e.children,(i,l)=>{l===rr&&(n=n.concat(t(i,l)))}),Uo(e.children,(i,l)=>{l!==rr&&(n=n.concat(t(i,l)))}),n}(e,(i,l)=>l===rr?[$g(e.children[rr],!1)]:[`${l}:${$g(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[rr]?`${xv(e)}/${n[0]}`:`${xv(e)}/(${n.join("//")})`}}function pT(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function bv(e){return pT(e).replace(/%3B/gi,";")}function Vb(e){return pT(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function wv(e){return decodeURIComponent(e)}function fT(e){return wv(e.replace(/\+/g,"%20"))}function mT(e){return`${Vb(e.path)}${function AR(e){return Object.keys(e).map(t=>`;${Vb(t)}=${Vb(e[t])}`).join("")}(e.parameters)}`}const kR=/^[^\/()?;=#]+/;function Cv(e){const t=e.match(kR);return t?t[0]:""}const OR=/^[^=?&#]+/,LR=/^[^&#]+/;class zR{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new pr([],{}):new pr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[rr]=new pr(t,n)),i}parseSegment(){const t=Cv(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new jg(wv(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=Cv(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const l=Cv(this.remaining);l&&(i=l,this.capture(i))}t[wv(n)]=wv(i)}parseQueryParam(t){const n=function RR(e){const t=e.match(OR);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const y=function FR(e){const t=e.match(LR);return t?t[0]:""}(this.remaining);y&&(i=y,this.capture(i))}const l=fT(n),p=fT(i);if(t.hasOwnProperty(l)){let y=t[l];Array.isArray(y)||(y=[y],t[l]=y),y.push(p)}else t[l]=p}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Cv(this.remaining),l=this.remaining[i.length];if("/"!==l&&")"!==l&&";"!==l)throw new Error(`Cannot parse url '${this.url}'`);let p;i.indexOf(":")>-1?(p=i.slice(0,i.indexOf(":")),this.capture(p),this.capture(":")):t&&(p=rr);const y=this.parseChildren();n[p]=1===Object.keys(y).length?y[rr]:new pr([],y),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class gT{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Ub(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=Ub(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=jb(t,this._root);return n.length<2?[]:n[n.length-2].children.map(l=>l.value).filter(l=>l!==t)}pathFromRoot(t){return jb(t,this._root).map(n=>n.value)}}function Ub(e,t){if(e===t.value)return t;for(const n of t.children){const i=Ub(e,n);if(i)return i}return null}function jb(e,t){if(e===t.value)return[t];for(const n of t.children){const i=jb(e,n);if(i.length)return i.unshift(t),i}return[]}class ku{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Zf(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class _T extends gT{constructor(t,n){super(t),this.snapshot=n,$b(this,t)}toString(){return this.snapshot.toString()}}function yT(e,t){const n=function BR(e,t){const y=new Ev([],{},{},"",{},rr,t,null,e.root,-1,{});return new xT("",new ku(y,[]))}(e,t),i=new Vo([new jg("",{})]),l=new Vo({}),p=new Vo({}),y=new Vo({}),w=new Vo(""),M=new gp(i,l,y,w,p,rr,t,n.root);return M.snapshot=n.root,new _T(new ku(M,[]),n)}class gp{constructor(t,n,i,l,p,y,w,M){this.url=t,this.params=n,this.queryParams=i,this.fragment=l,this.data=p,this.outlet=y,this.component=w,this._futureSnapshot=M}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(hn(t=>qf(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(hn(t=>qf(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function vT(e,t="emptyOnly"){const n=e.pathFromRoot;let i=0;if("always"!==t)for(i=n.length-1;i>=1;){const l=n[i],p=n[i-1];if(l.routeConfig&&""===l.routeConfig.path)i--;else{if(p.component)break;i--}}return function NR(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(i))}class Ev{constructor(t,n,i,l,p,y,w,M,A,F,V,K){this.url=t,this.params=n,this.queryParams=i,this.fragment=l,this.data=p,this.outlet=y,this.component=w,this.routeConfig=M,this._urlSegment=A,this._lastPathIndex=F,this._correctedLastPathIndex=K??F,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=qf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class xT extends gT{constructor(t,n){super(n),this.url=t,$b(this,n)}toString(){return bT(this._root)}}function $b(e,t){t.value._routerState=e,t.children.forEach(n=>$b(e,n))}function bT(e){const t=e.children.length>0?` { ${e.children.map(bT).join(", ")} } `:"";return`${e.value}${t}`}function Gb(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,fc(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),fc(t.params,n.params)||e.params.next(n.params),function bR(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!fc(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),fc(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Hb(e,t){const n=fc(e.params,t.params)&&function TR(e,t){return mp(e,t)&&e.every((n,i)=>fc(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||Hb(e.parent,t.parent))}function Gg(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const l=function UR(e,t,n){return t.children.map(i=>{for(const l of n.children)if(e.shouldReuseRoute(i.value,l.value.snapshot))return Gg(e,i,l);return Gg(e,i)})}(e,t,n);return new ku(i,l)}{if(e.shouldAttach(t.value)){const p=e.retrieve(t.value);if(null!==p){const y=p.route;return y.value._futureSnapshot=t.value,y.children=t.children.map(w=>Gg(e,w)),y}}const i=function jR(e){return new gp(new Vo(e.url),new Vo(e.params),new Vo(e.queryParams),new Vo(e.fragment),new Vo(e.data),e.outlet,e.component,e)}(t.value),l=t.children.map(p=>Gg(e,p));return new ku(i,l)}}function Mv(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Hg(e){return"object"==typeof e&&null!=e&&e.outlets}function qb(e,t,n,i,l){let p={};if(i&&Uo(i,(w,M)=>{p[M]=Array.isArray(w)?w.map(A=>`${A}`):`${w}`}),e===t)return new fp(n,p,l);const y=wT(e,t,n);return new fp(y,p,l)}function wT(e,t,n){const i={};return Uo(e.children,(l,p)=>{i[p]=l===t?n:wT(l,t,n)}),new pr(e.segments,i)}class CT{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&Mv(i[0]))throw new Error("Root segment cannot have matrix parameters");const l=i.find(Hg);if(l&&l!==oT(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Zb{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function ET(e,t,n){if(e||(e=new pr([],{})),0===e.segments.length&&e.hasChildren())return Tv(e,t,n);const i=function WR(e,t,n){let i=0,l=t;const p={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(i>=n.length)return p;const y=e.segments[l],w=n[i];if(Hg(w))break;const M=`${w}`,A=i<n.length-1?n[i+1]:null;if(l>0&&void 0===M)break;if(M&&A&&"object"==typeof A&&void 0===A.outlets){if(!TT(M,A,y))return p;i+=2}else{if(!TT(M,{},y))return p;i++}l++}return{match:!0,pathIndex:l,commandIndex:i}}(e,t,n),l=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const p=new pr(e.segments.slice(0,i.pathIndex),{});return p.children[rr]=new pr(e.segments.slice(i.pathIndex),e.children),Tv(p,0,l)}return i.match&&0===l.length?new pr(e.segments,{}):i.match&&!e.hasChildren()?Wb(e,t,n):i.match?Tv(e,0,l):Wb(e,t,n)}function Tv(e,t,n){if(0===n.length)return new pr(e.segments,{});{const i=function ZR(e){return Hg(e[0])?e[0].outlets:{[rr]:e}}(n),l={};return Uo(i,(p,y)=>{"string"==typeof p&&(p=[p]),null!==p&&(l[y]=ET(e.children[y],t,p))}),Uo(e.children,(p,y)=>{void 0===i[y]&&(l[y]=p)}),new pr(e.segments,l)}}function Wb(e,t,n){const i=e.segments.slice(0,t);let l=0;for(;l<n.length;){const p=n[l];if(Hg(p)){const M=XR(p.outlets);return new pr(i,M)}if(0===l&&Mv(n[0])){i.push(new jg(e.segments[t].path,MT(n[0]))),l++;continue}const y=Hg(p)?p.outlets[rr]:`${p}`,w=l<n.length-1?n[l+1]:null;y&&w&&Mv(w)?(i.push(new jg(y,MT(w))),l+=2):(i.push(new jg(y,{})),l++)}return new pr(i,{})}function XR(e){const t={};return Uo(e,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=Wb(new pr([],{}),0,n))}),t}function MT(e){const t={};return Uo(e,(n,i)=>t[i]=`${n}`),t}function TT(e,t,n){return e==n.path&&fc(t,n.parameters)}class YR{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new qg,this.attachRef=null}}class qg{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const i=this.getOrCreateContext(t);i.outlet=n,this.contexts.set(t,i)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new YR,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let Xb=(()=>{class e{constructor(n,i,l,p,y){this.parentContexts=n,this.location=i,this.changeDetector=p,this.environmentInjector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new qr,this.deactivateEvents=new qr,this.attachEvents=new qr,this.detachEvents=new qr,this.name=l||rr,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const l=this.location,y=n._futureSnapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,M=new KR(n,w,l.injector);if(i&&function JR(e){return!!e.resolveComponentFactory}(i)){const A=i.resolveComponentFactory(y);this.activated=l.createComponent(A,l.length,M)}else this.activated=l.createComponent(y,{index:l.length,injector:M,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(tt(qg),tt(_l),function fh(e){return function wr(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let l=0;for(;l<i;){const p=n[l];if(mt(p))break;if(0===p)l+=2;else if("number"==typeof p)for(l++;l<i&&"string"==typeof n[l];)l++;else{if(p===t)return n[l+1];l+=2}}}return null}(di(),e)}("name"),tt(Jy),tt(lu))},e.\u0275dir=un({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class KR{constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===gp?this.route:t===qg?this.childContexts:this.parent.get(t,n)}}let DT=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,i){1&n&&Ln(0,"router-outlet")},dependencies:[Xb],encapsulation:2}),e})();function ST(e,t){return e.providers&&!e._injector&&(e._injector=jy(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Kb(e){const t=e.children&&e.children.map(Kb),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==rr&&(n.component=DT),n}function ka(e){return e.outlet||rr}function IT(e,t){const n=e.filter(i=>ka(i)===t);return n.push(...e.filter(i=>ka(i)!==t)),n}function AT(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class rL{constructor(t,n,i,l){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=l}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),Gb(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const l=Zf(n);t.children.forEach(p=>{const y=p.value.outlet;this.deactivateRoutes(p,l[y],i),delete l[y]}),Uo(l,(p,y)=>{this.deactivateRouteAndItsChildren(p,i)})}deactivateRoutes(t,n,i){const l=t.value,p=n?n.value:null;if(l===p)if(l.component){const y=i.getContext(l.outlet);y&&this.deactivateChildRoutes(t,n,y.children)}else this.deactivateChildRoutes(t,n,i);else p&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),l=i&&t.value.component?i.children:n,p=Zf(t);for(const y of Object.keys(p))this.deactivateRouteAndItsChildren(p[y],l);if(i&&i.outlet){const y=i.outlet.detach(),w=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:y,route:t,contexts:w})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),l=i&&t.value.component?i.children:n,p=Zf(t);for(const y of Object.keys(p))this.deactivateRouteAndItsChildren(p[y],l);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,n,i){const l=Zf(n);t.children.forEach(p=>{this.activateRoutes(p,l[p.value.outlet],i),this.forwardEvent(new _R(p.value.snapshot))}),t.children.length&&this.forwardEvent(new mR(t.value.snapshot))}activateRoutes(t,n,i){const l=t.value,p=n?n.value:null;if(Gb(l),l===p)if(l.component){const y=i.getOrCreateContext(l.outlet);this.activateChildRoutes(t,n,y.children)}else this.activateChildRoutes(t,n,i);else if(l.component){const y=i.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const w=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),Gb(w.route.value),this.activateChildRoutes(t,null,y.children)}else{const w=AT(l.snapshot),M=w?.get(Tg)??null;y.attachRef=null,y.route=l,y.resolver=M,y.injector=w,y.outlet&&y.outlet.activateWith(l,y.injector),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,i)}}function Qh(e){return"function"==typeof e}function _p(e){return e instanceof fp}const Zg=Symbol("INITIAL_VALUE");function Wg(){return pc(e=>ZM(e.map(t=>t.pipe(cn(1),function nR(...e){const t=cr(e);return Yn((n,i)=>{(t?_v(e,n,t):_v(e,n)).subscribe(i)})}(Zg)))).pipe(KM((t,n)=>{let i=!1;return n.reduce((l,p,y)=>l!==Zg?l:(p===Zg&&(i=!0),i||!1!==p&&y!==n.length-1&&!_p(p)?l:p),t)},Zg),Au(t=>t!==Zg),hn(t=>_p(t)?t:!0===t),cn(1)))}const PT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Dv(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...PT}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const l=(t.matcher||xR)(n,e,t);if(!l)return{...PT};const p={};Uo(l.posParams,(w,M)=>{p[M]=w.path});const y=l.consumed.length>0?{...p,...l.consumed[l.consumed.length-1].parameters}:p;return{matched:!0,consumedSegments:l.consumed,remainingSegments:n.slice(l.consumed.length),parameters:y,positionalParamSegments:l.posParams??{}}}function Sv(e,t,n,i,l="corrected"){if(n.length>0&&function hL(e,t,n){return n.some(i=>Iv(e,t,i)&&ka(i)!==rr)}(e,n,i)){const y=new pr(t,function uL(e,t,n,i){const l={};l[rr]=i,i._sourceSegment=e,i._segmentIndexShift=t.length;for(const p of n)if(""===p.path&&ka(p)!==rr){const y=new pr([],{});y._sourceSegment=e,y._segmentIndexShift=t.length,l[ka(p)]=y}return l}(e,t,i,new pr(n,e.children)));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function dL(e,t,n){return n.some(i=>Iv(e,t,i))}(e,n,i)){const y=new pr(e.segments,function cL(e,t,n,i,l,p){const y={};for(const w of i)if(Iv(e,n,w)&&!l[ka(w)]){const M=new pr([],{});M._sourceSegment=e,M._segmentIndexShift="legacy"===p?e.segments.length:t.length,y[ka(w)]=M}return{...l,...y}}(e,t,n,i,e.children,l));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:n}}const p=new pr(e.segments,e.children);return p._sourceSegment=e,p._segmentIndexShift=t.length,{segmentGroup:p,slicedSegments:n}}function Iv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function kT(e,t,n,i){return!!(ka(e)===i||i!==rr&&Iv(t,n,e))&&("**"===e.path||Dv(t,e,n).matched)}function OT(e,t,n){return 0===t.length&&!e.children[n]}class Av{constructor(t){this.segmentGroup=t||null}}class RT{constructor(t){this.urlTree=t}}function Xg(e){return Ng(new Av(e))}function LT(e){return Ng(new RT(e))}class gL{constructor(t,n,i,l,p){this.injector=t,this.configLoader=n,this.urlSerializer=i,this.urlTree=l,this.config=p,this.allowRedirects=!0}apply(){const t=Sv(this.urlTree.root,[],[],this.config).segmentGroup,n=new pr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,rr).pipe(hn(p=>this.createUrlTree(Jb(p),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Jh(p=>{if(p instanceof RT)return this.allowRedirects=!1,this.match(p.urlTree);throw p instanceof Av?this.noMatchError(p):p}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,rr).pipe(hn(l=>this.createUrlTree(Jb(l),t.queryParams,t.fragment))).pipe(Jh(l=>{throw l instanceof Av?this.noMatchError(l):l}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,i){const l=t.segments.length>0?new pr([],{[rr]:t}):t;return new fp(l,n,i)}expandSegmentGroup(t,n,i,l){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,n,i).pipe(hn(p=>new pr([],p))):this.expandSegment(t,i,n,i.segments,l,!0)}expandChildren(t,n,i){const l=[];for(const p of Object.keys(i.children))"primary"===p?l.unshift(p):l.push(p);return ct(l).pipe(Hf(p=>{const y=i.children[p],w=IT(n,p);return this.expandSegmentGroup(t,w,y,p).pipe(hn(M=>({segment:M,outlet:p})))}),KM((p,y)=>(p[y.outlet]=y.segment,p),{}),function oR(e,t){const n=arguments.length>=2;return i=>i.pipe(e?Au((l,p)=>e(l,p,i)):St,yv(1),n?Fb(t):JM(()=>new Vg))}())}expandSegment(t,n,i,l,p,y){return ct(i).pipe(Hf(w=>this.expandSegmentAgainstRoute(t,n,i,w,l,p,y).pipe(Jh(A=>{if(A instanceof Av)return jn(null);throw A}))),Co(w=>!!w),Jh((w,M)=>{if(w instanceof Vg||"EmptyError"===w.name)return OT(n,l,p)?jn(new pr([],{})):Xg(n);throw w}))}expandSegmentAgainstRoute(t,n,i,l,p,y,w){return kT(l,n,p,y)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(t,n,l,p,y):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,i,l,p,y):Xg(n):Xg(n)}expandSegmentAgainstRouteUsingRedirect(t,n,i,l,p,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,l,p,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,l){const p=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?LT(p):this.lineralizeSegments(i,p).pipe(ht(y=>{const w=new pr(y,{});return this.expandSegment(t,w,n,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,l,p,y){const{matched:w,consumedSegments:M,remainingSegments:A,positionalParamSegments:F}=Dv(n,l,p);if(!w)return Xg(n);const V=this.applyRedirectCommands(M,l.redirectTo,F);return l.redirectTo.startsWith("/")?LT(V):this.lineralizeSegments(l,V).pipe(ht(K=>this.expandSegment(t,n,i,K.concat(A),y,!1)))}matchSegmentAgainstRoute(t,n,i,l,p){if("**"===i.path)return t=ST(i,t),i.loadChildren?(i._loadedRoutes?jn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(hn(V=>(i._loadedRoutes=V.routes,i._loadedInjector=V.injector,new pr(l,{})))):jn(new pr(l,{}));const{matched:y,consumedSegments:w,remainingSegments:M}=Dv(n,i,l);return y?(t=ST(i,t),this.getChildConfig(t,i,l).pipe(ht(F=>{const V=F.injector??t,K=F.routes,{segmentGroup:re,slicedSegments:Se}=Sv(n,w,M,K),Ge=new pr(re.segments,re.children);if(0===Se.length&&Ge.hasChildren())return this.expandChildren(V,K,Ge).pipe(hn(nt=>new pr(w,nt)));if(0===K.length&&0===Se.length)return jn(new pr(w,{}));const ut=ka(i)===p;return this.expandSegment(V,Ge,K,Se,ut?rr:p,!0).pipe(hn(Ct=>new pr(w.concat(Ct.segments),Ct.children)))}))):Xg(n)}getChildConfig(t,n,i){return n.children?jn({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?jn({routes:n._loadedRoutes,injector:n._loadedInjector}):this.runCanLoadGuards(t,n,i).pipe(ht(l=>l?this.configLoader.loadChildren(t,n).pipe(Eo(p=>{n._loadedRoutes=p.routes,n._loadedInjector=p.injector})):function fL(e){return Ng(Nb(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`))}(n))):jn({routes:[],injector:t})}runCanLoadGuards(t,n,i){const l=n.canLoad;return l&&0!==l.length?jn(l.map(y=>{const w=t.get(y);let M;if(function oL(e){return e&&Qh(e.canLoad)}(w))M=w.canLoad(n,i);else{if(!Qh(w))throw new Error("Invalid CanLoad guard");M=w(n,i)}return xl(M)})).pipe(Wg(),Eo(y=>{if(!_p(y))return;const w=Nb(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw w.url=y,w}),hn(y=>!0===y)):jn(!0)}lineralizeSegments(t,n){let i=[],l=n.root;for(;;){if(i=i.concat(l.segments),0===l.numberOfChildren)return jn(i);if(l.numberOfChildren>1||!l.children[rr])return Ng(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t.redirectTo}'`));l=l.children[rr]}}applyRedirectCommands(t,n,i){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,i)}applyRedirectCreatreUrlTree(t,n,i,l){const p=this.createSegmentGroup(t,n.root,i,l);return new fp(p,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Uo(t,(l,p)=>{if("string"==typeof l&&l.startsWith(":")){const w=l.substring(1);i[p]=n[w]}else i[p]=l}),i}createSegmentGroup(t,n,i,l){const p=this.createSegments(t,n.segments,i,l);let y={};return Uo(n.children,(w,M)=>{y[M]=this.createSegmentGroup(t,w,i,l)}),new pr(p,y)}createSegments(t,n,i,l){return n.map(p=>p.path.startsWith(":")?this.findPosParam(t,p,l):this.findOrReturn(p,i))}findPosParam(t,n,i){const l=i[n.path.substring(1)];if(!l)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return l}findOrReturn(t,n){let i=0;for(const l of n){if(l.path===t.path)return n.splice(i),l;i++}return t}}function Jb(e){const t={};for(const i of Object.keys(e.children)){const p=Jb(e.children[i]);(p.segments.length>0||p.hasChildren())&&(t[i]=p)}return function _L(e){if(1===e.numberOfChildren&&e.children[rr]){const t=e.children[rr];return new pr(e.segments.concat(t.segments),t.children)}return e}(new pr(e.segments,t))}class FT{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Pv{constructor(t,n){this.component=t,this.route=n}}function vL(e,t,n){const i=e._root;return Yg(i,t?t._root:null,n,[i.value])}function kv(e,t,n){return(AT(t)??n).get(e)}function Yg(e,t,n,i,l={canDeactivateChecks:[],canActivateChecks:[]}){const p=Zf(t);return e.children.forEach(y=>{(function bL(e,t,n,i,l={canDeactivateChecks:[],canActivateChecks:[]}){const p=e.value,y=t?t.value:null,w=n?n.getContext(e.value.outlet):null;if(y&&p.routeConfig===y.routeConfig){const M=function wL(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!mp(e.url,t.url);case"pathParamsOrQueryParamsChange":return!mp(e.url,t.url)||!fc(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Hb(e,t)||!fc(e.queryParams,t.queryParams);default:return!Hb(e,t)}}(y,p,p.routeConfig.runGuardsAndResolvers);M?l.canActivateChecks.push(new FT(i)):(p.data=y.data,p._resolvedData=y._resolvedData),Yg(e,t,p.component?w?w.children:null:n,i,l),M&&w&&w.outlet&&w.outlet.isActivated&&l.canDeactivateChecks.push(new Pv(w.outlet.component,y))}else y&&Kg(t,w,l),l.canActivateChecks.push(new FT(i)),Yg(e,null,p.component?w?w.children:null:n,i,l)})(y,p[y.value.outlet],n,i.concat([y.value]),l),delete p[y.value.outlet]}),Uo(p,(y,w)=>Kg(y,n.getContext(w),l)),l}function Kg(e,t,n){const i=Zf(e),l=e.value;Uo(i,(p,y)=>{Kg(p,l.component?t?t.children.getContext(y):null:t,n)}),n.canDeactivateChecks.push(new Pv(l.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,l))}class PL{}function BT(e){return new qt(t=>t.error(e))}class OL{constructor(t,n,i,l,p,y){this.rootComponentType=t,this.config=n,this.urlTree=i,this.url=l,this.paramsInheritanceStrategy=p,this.relativeLinkResolution=y}recognize(){const t=Sv(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,rr);if(null===n)return null;const i=new Ev([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},rr,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new ku(i,n),p=new xT(this.url,l);return this.inheritParamsAndData(p._root),p}inheritParamsAndData(t){const n=t.value,i=vT(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(t,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,i)}processChildren(t,n){const i=[];for(const p of Object.keys(n.children)){const y=n.children[p],w=IT(t,p),M=this.processSegmentGroup(w,y,p);if(null===M)return null;i.push(...M)}const l=NT(i);return function RL(e){e.sort((t,n)=>t.value.outlet===rr?-1:n.value.outlet===rr?1:t.value.outlet.localeCompare(n.value.outlet))}(l),l}processSegment(t,n,i,l){for(const p of t){const y=this.processSegmentAgainstRoute(p,n,i,l);if(null!==y)return y}return OT(n,i,l)?[]:null}processSegmentAgainstRoute(t,n,i,l){if(t.redirectTo||!kT(t,n,i,l))return null;let p,y=[],w=[];if("**"===t.path){const re=i.length>0?oT(i).parameters:{},Se=UT(n)+i.length;p=new Ev(i,re,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$T(t),ka(t),t.component??t._loadedComponent??null,t,VT(n),Se,GT(t),Se)}else{const re=Dv(n,t,i);if(!re.matched)return null;y=re.consumedSegments,w=re.remainingSegments;const Se=UT(n)+y.length;p=new Ev(y,re.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$T(t),ka(t),t.component??t._loadedComponent??null,t,VT(n),Se,GT(t),Se)}const M=function LL(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(t),{segmentGroup:A,slicedSegments:F}=Sv(n,y,w,M.filter(re=>void 0===re.redirectTo),this.relativeLinkResolution);if(0===F.length&&A.hasChildren()){const re=this.processChildren(M,A);return null===re?null:[new ku(p,re)]}if(0===M.length&&0===F.length)return[new ku(p,[])];const V=ka(t)===l,K=this.processSegment(M,A,F,V?rr:l);return null===K?null:[new ku(p,K)]}}function FL(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function NT(e){const t=[],n=new Set;for(const i of e){if(!FL(i)){t.push(i);continue}const l=t.find(p=>i.value.routeConfig===p.value.routeConfig);void 0!==l?(l.children.push(...i.children),n.add(l)):t.push(i)}for(const i of n){const l=NT(i.children);t.push(new ku(i.value,l))}return t.filter(i=>!n.has(i))}function VT(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function UT(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function $T(e){return e.data||{}}function GT(e){return e.resolve||{}}const Qb=Symbol("RouteTitle");function HT(e){return"string"==typeof e.title||null===e.title}function e1(e){return pc(t=>{const n=e(t);return n?ct(n).pipe(hn(()=>t)):jn(t)})}class HL extends class GL{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const t1=new Tn("ROUTES");let n1=(()=>{class e{constructor(n,i){this.injector=n,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return jn(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=xl(n.loadComponent()).pipe(Eo(p=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=p}),zb(()=>{this.componentLoaders.delete(n)})),l=new YM(i,()=>new $n).pipe(Lb());return this.componentLoaders.set(n,l),l}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return jn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const p=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(hn(w=>{this.onLoadEndListener&&this.onLoadEndListener(i);let M,A,F=!1;Array.isArray(w)?A=w:(M=w.create(n).injector,A=iT(M.get(t1,[],fn.Self|fn.Optional)));return{routes:A.map(Kb),injector:M}}),zb(()=>{this.childrenLoaders.delete(i)})),y=new YM(p,()=>new $n).pipe(Lb());return this.childrenLoaders.set(i,y),y}loadModuleFactoryOrRoutes(n){return xl(n()).pipe(ht(i=>i instanceof ZC||Array.isArray(i)?jn(i):ct(this.compiler.compileModuleAsync(i))))}}return e.\u0275fac=function(n){return new(n||e)(Gt(qi),Gt(J0))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();class ZL{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function XL(e){throw e}function YL(e,t,n){return t.parse("/")}const KL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},JL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let la=(()=>{class e{constructor(n,i,l,p,y,w,M){this.rootComponentType=n,this.urlSerializer=i,this.rootContexts=l,this.location=p,this.config=M,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new $n,this.errorHandler=XL,this.malformedUriErrorHandler=YL,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>jn(void 0),this.urlHandlingStrategy=new ZL,this.routeReuseStrategy=new HL,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=y.get(n1),this.configLoader.onLoadEndListener=K=>this.triggerEvent(new pR(K)),this.configLoader.onLoadStartListener=K=>this.triggerEvent(new dR(K)),this.ngModule=y.get(Wh),this.console=y.get(nP);const V=y.get(Yi);this.isNgZoneEnabled=V instanceof Yi&&Yi.isInAngularZone(),this.resetConfig(M),this.currentUrlTree=function wR(){return new fp(new pr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=yT(this.currentUrlTree,this.rootComponentType),this.transitions=new Vo({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const i=this.events;return n.pipe(Au(l=>0!==l.id),hn(l=>({...l,extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),pc(l=>{let p=!1,y=!1;return jn(l).pipe(Eo(w=>{this.currentNavigation={id:w.id,initialUrl:w.rawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),pc(w=>{const M=this.browserUrlTree.toString(),A=!this.navigated||w.extractedUrl.toString()!==M||M!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||A)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return ZT(w.source)&&(this.browserUrlTree=w.extractedUrl),jn(w).pipe(pc(V=>{const K=this.transitions.getValue();return i.next(new Bb(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),K!==this.transitions.getValue()?Ut:Promise.resolve(V)}),function yL(e,t,n,i){return pc(l=>function mL(e,t,n,i,l){return new gL(e,t,n,i,l).apply()}(e,t,n,l.extractedUrl,i).pipe(hn(p=>({...l,urlAfterRedirects:p}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Eo(V=>{this.currentNavigation={...this.currentNavigation,finalUrl:V.urlAfterRedirects}}),function zL(e,t,n,i,l){return ht(p=>function kL(e,t,n,i,l="emptyOnly",p="legacy"){try{const y=new OL(e,t,n,i,l,p).recognize();return null===y?BT(new PL):jn(y)}catch(y){return BT(y)}}(e,t,p.urlAfterRedirects,n(p.urlAfterRedirects),i,l).pipe(hn(y=>({...p,targetSnapshot:y}))))}(this.rootComponentType,this.config,V=>this.serializeUrl(V),this.paramsInheritanceStrategy,this.relativeLinkResolution),Eo(V=>{if("eager"===this.urlUpdateStrategy){if(!V.extras.skipLocationChange){const re=this.urlHandlingStrategy.merge(V.urlAfterRedirects,V.rawUrl);this.setBrowserUrl(re,V)}this.browserUrlTree=V.urlAfterRedirects}const K=new aR(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);i.next(K)}));if(A&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:K,extractedUrl:re,source:Se,restoredState:Ge,extras:ut}=w,Ye=new Bb(K,this.serializeUrl(re),Se,Ge);i.next(Ye);const Ct=yT(re,this.rootComponentType).snapshot;return jn({...w,targetSnapshot:Ct,urlAfterRedirects:re,extras:{...ut,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=w.rawUrl,w.resolve(null),Ut}),Eo(w=>{const M=new lR(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(M)}),hn(w=>({...w,guards:vL(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function CL(e,t){return ht(n=>{const{targetSnapshot:i,currentSnapshot:l,guards:{canActivateChecks:p,canDeactivateChecks:y}}=n;return 0===y.length&&0===p.length?jn({...n,guardsResult:!0}):function EL(e,t,n,i){return ct(e).pipe(ht(l=>function AL(e,t,n,i,l){const p=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return p&&0!==p.length?jn(p.map(w=>{const M=kv(w,t,l);let A;if(function lL(e){return e&&Qh(e.canDeactivate)}(M))A=xl(M.canDeactivate(e,t,n,i));else{if(!Qh(M))throw new Error("Invalid CanDeactivate guard");A=xl(M(e,t,n,i))}return A.pipe(Co())})).pipe(Wg()):jn(!0)}(l.component,l.route,n,t,i)),Co(l=>!0!==l,!0))}(y,i,l,e).pipe(ht(w=>w&&function iL(e){return"boolean"==typeof e}(w)?function ML(e,t,n,i){return ct(t).pipe(Hf(l=>_v(function DL(e,t){return null!==e&&t&&t(new fR(e)),jn(!0)}(l.route.parent,i),function TL(e,t){return null!==e&&t&&t(new gR(e)),jn(!0)}(l.route,i),function IL(e,t,n){const i=t[t.length-1],p=t.slice(0,t.length-1).reverse().map(y=>function xL(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(y)).filter(y=>null!==y).map(y=>XM(()=>jn(y.guards.map(M=>{const A=kv(M,y.node,n);let F;if(function aL(e){return e&&Qh(e.canActivateChild)}(A))F=xl(A.canActivateChild(i,e));else{if(!Qh(A))throw new Error("Invalid CanActivateChild guard");F=xl(A(i,e))}return F.pipe(Co())})).pipe(Wg())));return jn(p).pipe(Wg())}(e,l.path,n),function SL(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return jn(!0);const l=i.map(p=>XM(()=>{const y=kv(p,t,n);let w;if(function sL(e){return e&&Qh(e.canActivate)}(y))w=xl(y.canActivate(t,e));else{if(!Qh(y))throw new Error("Invalid CanActivate guard");w=xl(y(t,e))}return w.pipe(Co())}));return jn(l).pipe(Wg())}(e,l.route,n))),Co(l=>!0!==l,!0))}(i,p,e,t):jn(w)),hn(w=>({...n,guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),Eo(w=>{if(_p(w.guardsResult)){const A=Nb(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw A.url=w.guardsResult,A}const M=new cR(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(M)}),Au(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),e1(w=>{if(w.guards.canActivateChecks.length)return jn(w).pipe(Eo(M=>{const A=new uR(M.id,this.serializeUrl(M.extractedUrl),this.serializeUrl(M.urlAfterRedirects),M.targetSnapshot);this.triggerEvent(A)}),pc(M=>{let A=!1;return jn(M).pipe(function BL(e,t){return ht(n=>{const{targetSnapshot:i,guards:{canActivateChecks:l}}=n;if(!l.length)return jn(n);let p=0;return ct(l).pipe(Hf(y=>function NL(e,t,n,i){const l=e.routeConfig,p=e._resolve;return void 0!==l?.title&&!HT(l)&&(p[Qb]=l.title),function VL(e,t,n,i){const l=function UL(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===l.length)return jn({});const p={};return ct(l).pipe(ht(y=>function jL(e,t,n,i){const l=kv(e,t,i);return xl(l.resolve?l.resolve(t,n):l(t,n))}(e[y],t,n,i).pipe(Co(),Eo(w=>{p[y]=w}))),yv(1),QM(p),Jh(y=>y instanceof Vg?Ut:Ng(y)))}(p,e,t,i).pipe(hn(y=>(e._resolvedData=y,e.data=vT(e,n).resolve,l&&HT(l)&&(e.data[Qb]=l.title),null)))}(y.route,i,e,t)),Eo(()=>p++),yv(1),ht(y=>p===l.length?jn(n):Ut))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Eo({next:()=>A=!0,complete:()=>{A||(this.restoreHistory(M),this.cancelNavigationTransition(M,"At least one route resolver didn't emit any value."))}}))}),Eo(M=>{const A=new hR(M.id,this.serializeUrl(M.extractedUrl),this.serializeUrl(M.urlAfterRedirects),M.targetSnapshot);this.triggerEvent(A)}))}),e1(()=>this.afterPreactivation()),e1(w=>{const M=A=>{const F=[];A.routeConfig?.loadComponent&&!A.routeConfig._loadedComponent&&F.push(this.configLoader.loadComponent(A.routeConfig).pipe(Eo(V=>{A.component=V}),hn(()=>{})));for(const V of A.children)F.push(...M(V));return F};return ZM(M(w.targetSnapshot.root)).pipe(Fb(),cn(1))}),hn(w=>{const M=function VR(e,t,n){const i=Gg(e,t._root,n?n._root:void 0);return new _T(i,t)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return{...w,targetRouterState:M}}),Eo(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((e,t,n)=>hn(i=>(new rL(t,i.targetRouterState,i.currentRouterState,n).activate(e),i)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),Eo({next(){p=!0},complete(){p=!0}}),zb(()=>{p||y||this.cancelNavigationTransition(l,`Navigation ID ${l.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===l.id&&(this.currentNavigation=null)}),Jh(w=>{if(y=!0,function vR(e){return e&&e[nT]}(w)){const M=_p(w.url);M||(this.navigated=!0,this.restoreHistory(l,!0));const A=new eT(l.id,this.serializeUrl(l.extractedUrl),w.message);if(i.next(A),M){const F=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),V={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ZT(l.source)};this.scheduleNavigation(F,"imperative",null,V,{resolve:l.resolve,reject:l.reject,promise:l.promise})}else l.resolve(!1)}else{this.restoreHistory(l,!0);const M=new sR(l.id,this.serializeUrl(l.extractedUrl),w);i.next(M);try{l.resolve(this.errorHandler(w))}catch(A){l.reject(A)}}return Ut}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{const l={replaceUrl:!0},p=n.state?.navigationId?n.state:null;if(p){const w={...p};delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(l.state=w)}const y=this.parseUrl(n.url);this.scheduleNavigation(y,i,p,l)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){this.config=n.map(Kb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:l,queryParams:p,fragment:y,queryParamsHandling:w,preserveFragment:M}=i,A=l||this.routerState.root,F=M?this.currentUrlTree.fragment:y;let V=null;switch(w){case"merge":V={...this.currentUrlTree.queryParams,...p};break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=p||null}return null!==V&&(V=this.removeEmptyProps(V)),function $R(e,t,n,i,l){if(0===n.length)return qb(t.root,t.root,t.root,i,l);const p=function GR(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new CT(!0,0,e);let t=0,n=!1;const i=e.reduce((l,p,y)=>{if("object"==typeof p&&null!=p){if(p.outlets){const w={};return Uo(p.outlets,(M,A)=>{w[A]="string"==typeof M?M.split("/"):M}),[...l,{outlets:w}]}if(p.segmentPath)return[...l,p.segmentPath]}return"string"!=typeof p?[...l,p]:0===y?(p.split("/").forEach((w,M)=>{0==M&&"."===w||(0==M&&""===w?n=!0:".."===w?t++:""!=w&&l.push(w))}),l):[...l,p]},[]);return new CT(n,t,i)}(n);return p.toRoot()?qb(t.root,t.root,new pr([],{}),i,l):function y(M){const A=function HR(e,t,n,i){return e.isAbsolute?new Zb(t.root,!0,0):-1===i?new Zb(n,n===t.root,0):function qR(e,t,n){let i=e,l=t,p=n;for(;p>l;){if(p-=l,i=i.parent,!i)throw new Error("Invalid number of '../'");l=i.segments.length}return new Zb(i,!1,l-p)}(n,i+(Mv(e.commands[0])?0:1),e.numberOfDoubleDots)}(p,t,e.snapshot?._urlSegment,M),F=A.processChildren?Tv(A.segmentGroup,A.index,p.commands):ET(A.segmentGroup,A.index,p.commands);return qb(t.root,A.segmentGroup,F,i,l)}(e.snapshot?._lastPathIndex)}(A,this.currentUrlTree,n,V,F??null)}navigateByUrl(n,i={skipLocationChange:!1}){const l=_p(n)?n:this.parseUrl(n),p=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(p,"imperative",null,i)}navigate(n,i={skipLocationChange:!1}){return function QL(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(l){i=this.malformedUriErrorHandler(l,this.urlSerializer,n)}return i}isActive(n,i){let l;if(l=!0===i?{...KL}:!1===i?{...JL}:i,_p(n))return aT(this.currentUrlTree,n,l);const p=this.parseUrl(n);return aT(this.currentUrlTree,p,l)}removeEmptyProps(n){return Object.keys(n).reduce((i,l)=>{const p=n[l];return null!=p&&(i[l]=p),i},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Ug(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,i,l,p,y){if(this.disposed)return Promise.resolve(!1);let w,M,A;y?(w=y.resolve,M=y.reject,A=y.promise):A=new Promise((K,re)=>{w=K,M=re});const F=++this.navigationId;let V;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),V=l&&l.\u0275routerPageId?l.\u0275routerPageId:p.replaceUrl||p.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):V=0,this.setTransition({id:F,targetPageId:V,source:i,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:p,resolve:w,reject:M,promise:A,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),A.catch(K=>Promise.reject(K))}setBrowserUrl(n,i){const l=this.urlSerializer.serialize(n),p={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.isCurrentPathEqualTo(l)||i.extras.replaceUrl?this.location.replaceState(l,"",p):this.location.go(l,"",p)}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===l?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===l&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(l)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,i){const l=new eT(n.id,this.serializeUrl(n.extractedUrl),i);this.triggerEvent(l),n.resolve(!1)}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return e.\u0275fac=function(n){og()},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();function ZT(e){return"imperative"!==e}class WT{buildTitle(t){let n,i=t.root;for(;void 0!==i;)n=this.getResolvedTitleForRoute(i)??n,i=i.children.find(l=>l.outlet===rr);return n}getResolvedTitleForRoute(t){return t.data[Qb]}}let nF=(()=>{class e extends WT{constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}}return e.\u0275fac=function(n){return new(n||e)(Gt(kb))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class XT{}class KT{preload(t,n){return jn(null)}}let JT=(()=>{class e{constructor(n,i,l,p,y){this.router=n,this.injector=l,this.preloadingStrategy=p,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(Au(n=>n instanceof Ug),Hf(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const l=[];for(const p of i){p.providers&&!p._injector&&(p._injector=jy(p.providers,n,`Route: ${p.path}`));const y=p._injector??n,w=p._loadedInjector??y;p.loadChildren&&!p._loadedRoutes||p.loadComponent&&!p._loadedComponent?l.push(this.preloadConfig(y,p)):(p.children||p._loadedRoutes)&&l.push(this.processRoutes(w,p.children??p._loadedRoutes))}return ct(l).pipe(Qe())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let l;l=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(n,i):jn(null);const p=l.pipe(ht(y=>null===y?jn(void 0):(i._loadedRoutes=y.routes,i._loadedInjector=y.injector,this.processRoutes(y.injector??n,y.routes))));return i.loadComponent&&!i._loadedComponent?ct([p,this.loader.loadComponent(i)]).pipe(Qe()):p})}}return e.\u0275fac=function(n){return new(n||e)(Gt(la),Gt(J0),Gt(lu),Gt(XT),Gt(n1))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),o1=(()=>{class e{constructor(n,i,l={}){this.router=n,this.viewportScroller=i,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Bb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Ug&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof tT&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.router.triggerEvent(new tT(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){og()},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const yp=new Tn("ROUTER_CONFIGURATION"),QT=new Tn("ROUTER_FORROOT_GUARD"),iF=[db,{provide:hT,useClass:dT},{provide:la,useFactory:function cF(e,t,n,i,l,p,y={},w,M,A,F){const V=new la(null,e,t,n,i,l,iT(p));return A&&(V.urlHandlingStrategy=A),F&&(V.routeReuseStrategy=F),V.titleStrategy=M??w,function uF(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(y,V),V},deps:[hT,qg,db,qi,J0,t1,yp,nF,[WT,new Ts],[class qL{},new Ts],[class $L{},new Ts]]},qg,{provide:gp,useFactory:function hF(e){return e.routerState.root},deps:[la]},JT,KT,class rF{preload(t,n){return n().pipe(Jh(()=>jn(null)))}},{provide:yp,useValue:{enableTracing:!1}},n1];function oF(){return new zE("Router",la)}let eD=(()=>{class e{constructor(n,i){}static forRoot(n,i){return{ngModule:e,providers:[iF,tD(n),{provide:QT,useFactory:lF,deps:[[la,new Ts,new bh]]},{provide:yp,useValue:i||{}},{provide:Gf,useFactory:aF,deps:[Rg,[new Hc(hb),new Ts],yp]},{provide:o1,useFactory:sF,deps:[la,cO,yp]},{provide:XT,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:KT},{provide:zE,multi:!0,useFactory:oF},[s1,{provide:X0,multi:!0,useFactory:dF,deps:[s1]},{provide:nD,useFactory:pF,deps:[s1]},{provide:PE,multi:!0,useExisting:nD}]]}}static forChild(n){return{ngModule:e,providers:[tD(n)]}}}return e.\u0275fac=function(n){return new(n||e)(Gt(QT,8),Gt(la,8))},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({}),e})();function sF(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new o1(e,t,n)}function aF(e,t,n={}){return n.useHash?new HP(e,t):new sM(e,t)}function lF(e){return"guarded"}function tD(e){return[{provide:Kv,multi:!0,useValue:e},{provide:t1,multi:!0,useValue:e}]}let s1=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new $n}appInitializer(){return this.injector.get(jP,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const l=new Promise(w=>i=w),p=this.injector.get(la),y=this.injector.get(yp);return"disabled"===y.initialNavigation?(p.setUpLocationChangeListener(),i(!0)):"enabledBlocking"===y.initialNavigation?(p.afterPreactivation=()=>this.initNavigation?jn(void 0):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),p.initialNavigation()):i(!0),l})}bootstrapListener(n){const i=this.injector.get(yp),l=this.injector.get(JT),p=this.injector.get(o1),y=this.injector.get(la),w=this.injector.get(Yy);n===w.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&y.initialNavigation(),l.setUpPreloading(),p.init(),y.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(void 0),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(Gt(qi))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();function dF(e){return e.appInitializer.bind(e)}function pF(e){return e.bootstrapListener.bind(e)}const nD=new Tn("Router Initializer"),rD="appRnQ9BAYyi110Vu",iD="mapbox://styles/atlasmedliq/cl59k9bun000y14rzt3yy5ljt";var oD=Fe(764);const a1={now:()=>(a1.delegate||Date).now(),delegate:void 0};class Jg extends $n{constructor(t=1/0,n=1/0,i=a1){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){const{isStopped:n,_buffer:i,_infiniteTimeWindow:l,_timestampProvider:p,_windowTime:y}=this;n||(i.push(t),!l&&i.push(p.now()+y)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const n=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:l}=this,p=l.slice();for(let y=0;y<p.length&&!t.closed;y+=i?1:2)t.next(p[y]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){const{_bufferSize:t,_timestampProvider:n,_buffer:i,_infiniteTimeWindow:l}=this,p=(l?1:2)*t;if(t<1/0&&p<i.length&&i.splice(0,i.length-p),!l){const y=n.now();let w=0;for(let M=1;M<i.length&&i[M]<=y;M+=2)w=M;w&&i.splice(0,w+1)}}}function Ov(...e){const t=Kn(e),{args:n,keys:i}=HM(e),l=new qt(p=>{const{length:y}=n;if(!y)return void p.complete();const w=new Array(y);let M=y,A=y;for(let F=0;F<y;F++){let V=!1;z(n[F]).subscribe(en(p,K=>{V||(V=!0,A--),w[F]=K},()=>M--,void 0,()=>{(!M||!V)&&(A||p.next(i?qM(i,w):w),p.complete())}))}});return t?l.pipe(Rb(t)):l}class yF{constructor(t,n){this.api=t,this.baseId=n,this.YEAR_START=1901,this.YEAR_END=2100,this.YEAR_CURRENT=2050,this.TITLE="",this.SUBTITLE="",this.INFOBAR_TITLE="",this.INFOBAR_SUBTITLE="",this.ABOUT="",this.CONTRIBUTE_MESSAGE="",this.ready=new Jg(1),this.data=new Jg(1)}fetchSettings(){return this.api.airtableFetch(this.baseId,"Settings","website").pipe(hn(t=>{const n={};return t.records.forEach(i=>{n[i.fields.key]=i.fields.value}),n}))}fetchAudioTimestamps(){return this.api.airtableFetch(this.baseId,"AudioTimestamps","website").pipe(this.api.airtableToMapping())}fetchMapLayers(){return this.api.airtableFetch(this.baseId,"MapLayers","website").pipe(this.api.airtableToMapping())}fetchMapViews(){return this.api.airtableFetch(this.baseId,"MapViews","website").pipe(this.api.airtableToMapping())}fetchContent(){return this.api.airtableFetch(this.baseId,this.api.CONTENT_TABLE,"website").pipe(this.api.airtableToArray())}fetchMapData(){return Ov([this.fetchMapLayers(),this.fetchMapViews()]).pipe(hn(([t,n])=>{const i=new Set;return Object.values(n).forEach(l=>{const p=[];(l.map_layers||[]).forEach(y=>{p.push(...t[y].on_layers)}),p.forEach(i.add,i),l.onLayers=p}),Object.values(n).forEach(l=>{l.offLayers=[...i].filter(p=>l.onLayers.indexOf(p)<0)}),n}))}fetchData(){return this.fetchSettings().pipe(pc(t=>(this.YEAR_START=parseInt(t["from year"]),this.YEAR_END=parseInt(t["to year"]),this.YEAR_CURRENT=parseInt(t["start year"]),this.ABOUT=t.about,this.TITLE=t.title,this.SUBTITLE=t.subtitle,this.INFOBAR_TITLE=t.infobar_title,this.INFOBAR_SUBTITLE=t.infobar_subtitle,this.CONTRIBUTE_MESSAGE=t.contribute_message,Ov([this.fetchAudioTimestamps(),this.fetchContent()]))),hn(([t,n])=>(n.forEach(i=>{i.audio_timestamps=i.audio_timestamps?i.audio_timestamps.map(l=>t[l]):[],i.hasContent=!0,i.year=oD(i.post_timestamp).year()}),n.sort((i,l)=>i.year-l.year))),hn(t=>{const n=[],i=[];for(let l=this.YEAR_START;l<=this.YEAR_END;l++)n.push(t.length>0&&t[0].year===l?t.shift():{year:l,content:i});this.ready.next(!0),this.ready.complete(),this.data.next(n),this.data.complete()}))}}class sD{}class aD{}class Ou{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const l=n.slice(0,i),p=l.toLowerCase(),y=n.slice(i+1).trim();this.maybeSetNormalizedName(l,p),this.headers.has(p)?this.headers.get(p).push(y):this.headers.set(p,[y])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let i=t[n];const l=n.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(l,i),this.maybeSetNormalizedName(n,l))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof Ou?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new Ou;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Ou?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,n);const l=("a"===t.op?this.headers.get(n):void 0)||[];l.push(...i),this.headers.set(n,l);break;case"d":const p=t.value;if(p){let y=this.headers.get(n);if(!y)return;y=y.filter(w=>-1===p.indexOf(w)),0===y.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,y)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class vF{encodeKey(t){return lD(t)}encodeValue(t){return lD(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const bF=/%(\d[a-f0-9])/gi,wF={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function lD(e){return encodeURIComponent(e).replace(bF,(t,n)=>wF[n]??t)}function Rv(e){return`${e}`}class ed{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new vF,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function xF(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const p=l.indexOf("="),[y,w]=-1==p?[t.decodeKey(l),""]:[t.decodeKey(l.slice(0,p)),t.decodeValue(l.slice(p+1))],M=n.get(y)||[];M.push(w),n.set(y,M)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const i=t.fromObject[n],l=Array.isArray(i)?i.map(Rv):[Rv(i)];this.map.set(n,l)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(i=>{const l=t[i];Array.isArray(l)?l.forEach(p=>{n.push({param:i,value:p,op:"a"})}):n.push({param:i,value:l,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new ed({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(Rv(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const l=i.indexOf(Rv(t.value));-1!==l&&i.splice(l,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class CF{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function cD(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function uD(e){return typeof Blob<"u"&&e instanceof Blob}function hD(e){return typeof FormData<"u"&&e instanceof FormData}class Qg{constructor(t,n,i,l){let p;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function EF(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==i?i:null,p=l):p=i,p&&(this.reportProgress=!!p.reportProgress,this.withCredentials=!!p.withCredentials,p.responseType&&(this.responseType=p.responseType),p.headers&&(this.headers=p.headers),p.context&&(this.context=p.context),p.params&&(this.params=p.params)),this.headers||(this.headers=new Ou),this.context||(this.context=new CF),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=n;else{const w=n.indexOf("?");this.urlWithParams=n+(-1===w?"?":w<n.length-1?"&":"")+y}}else this.params=new ed,this.urlWithParams=n}serializeBody(){return null===this.body?null:cD(this.body)||uD(this.body)||hD(this.body)||function MF(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ed?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||hD(this.body)?null:uD(this.body)?this.body.type||null:cD(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ed?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,i=t.url||this.url,l=t.responseType||this.responseType,p=void 0!==t.body?t.body:this.body,y=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,w=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let M=t.headers||this.headers,A=t.params||this.params;const F=t.context??this.context;return void 0!==t.setHeaders&&(M=Object.keys(t.setHeaders).reduce((V,K)=>V.set(K,t.setHeaders[K]),M)),t.setParams&&(A=Object.keys(t.setParams).reduce((V,K)=>V.set(K,t.setParams[K]),A)),new Qg(n,i,p,{params:A,headers:M,context:F,reportProgress:w,responseType:l,withCredentials:y})}}var Qi=(()=>((Qi=Qi||{})[Qi.Sent=0]="Sent",Qi[Qi.UploadProgress=1]="UploadProgress",Qi[Qi.ResponseHeader=2]="ResponseHeader",Qi[Qi.DownloadProgress=3]="DownloadProgress",Qi[Qi.Response=4]="Response",Qi[Qi.User=5]="User",Qi))();class l1{constructor(t,n=200,i="OK"){this.headers=t.headers||new Ou,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class c1 extends l1{constructor(t={}){super(t),this.type=Qi.ResponseHeader}clone(t={}){return new c1({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Lv extends l1{constructor(t={}){super(t),this.type=Qi.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Lv({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class dD extends l1{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function u1(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let h1=(()=>{class e{constructor(n){this.handler=n}request(n,i,l={}){let p;if(n instanceof Qg)p=n;else{let M,A;M=l.headers instanceof Ou?l.headers:new Ou(l.headers),l.params&&(A=l.params instanceof ed?l.params:new ed({fromObject:l.params})),p=new Qg(n,i,void 0!==l.body?l.body:null,{headers:M,context:l.context,params:A,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=jn(p).pipe(Hf(M=>this.handler.handle(M)));if(n instanceof Qg||"events"===l.observe)return y;const w=y.pipe(Au(M=>M instanceof Lv));switch(l.observe||"body"){case"body":switch(p.responseType){case"arraybuffer":return w.pipe(hn(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return M.body}));case"blob":return w.pipe(hn(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new Error("Response is not a Blob.");return M.body}));case"text":return w.pipe(hn(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new Error("Response is not a string.");return M.body}));default:return w.pipe(hn(M=>M.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new ed).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,l={}){return this.request("PATCH",n,u1(l,i))}post(n,i,l={}){return this.request("POST",n,u1(l,i))}put(n,i,l={}){return this.request("PUT",n,u1(l,i))}}return e.\u0275fac=function(n){return new(n||e)(Gt(sD))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();class pD{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const fD=new Tn("HTTP_INTERCEPTORS");let TF=(()=>{class e{intercept(n,i){return i.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const DF=/^\)\]\}',?\n/;let mD=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new qt(i=>{const l=this.xhrFactory.build();if(l.open(n.method,n.urlWithParams),n.withCredentials&&(l.withCredentials=!0),n.headers.forEach((re,Se)=>l.setRequestHeader(re,Se.join(","))),n.headers.has("Accept")||l.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const re=n.detectContentTypeHeader();null!==re&&l.setRequestHeader("Content-Type",re)}if(n.responseType){const re=n.responseType.toLowerCase();l.responseType="json"!==re?re:"text"}const p=n.serializeBody();let y=null;const w=()=>{if(null!==y)return y;const re=l.statusText||"OK",Se=new Ou(l.getAllResponseHeaders()),Ge=function SF(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(l)||n.url;return y=new c1({headers:Se,status:l.status,statusText:re,url:Ge}),y},M=()=>{let{headers:re,status:Se,statusText:Ge,url:ut}=w(),Ye=null;204!==Se&&(Ye=typeof l.response>"u"?l.responseText:l.response),0===Se&&(Se=Ye?200:0);let Ct=Se>=200&&Se<300;if("json"===n.responseType&&"string"==typeof Ye){const nt=Ye;Ye=Ye.replace(DF,"");try{Ye=""!==Ye?JSON.parse(Ye):null}catch(Zt){Ye=nt,Ct&&(Ct=!1,Ye={error:Zt,text:Ye})}}Ct?(i.next(new Lv({body:Ye,headers:re,status:Se,statusText:Ge,url:ut||void 0})),i.complete()):i.error(new dD({error:Ye,headers:re,status:Se,statusText:Ge,url:ut||void 0}))},A=re=>{const{url:Se}=w(),Ge=new dD({error:re,status:l.status||0,statusText:l.statusText||"Unknown Error",url:Se||void 0});i.error(Ge)};let F=!1;const V=re=>{F||(i.next(w()),F=!0);let Se={type:Qi.DownloadProgress,loaded:re.loaded};re.lengthComputable&&(Se.total=re.total),"text"===n.responseType&&!!l.responseText&&(Se.partialText=l.responseText),i.next(Se)},K=re=>{let Se={type:Qi.UploadProgress,loaded:re.loaded};re.lengthComputable&&(Se.total=re.total),i.next(Se)};return l.addEventListener("load",M),l.addEventListener("error",A),l.addEventListener("timeout",A),l.addEventListener("abort",A),n.reportProgress&&(l.addEventListener("progress",V),null!==p&&l.upload&&l.upload.addEventListener("progress",K)),l.send(p),i.next({type:Qi.Sent}),()=>{l.removeEventListener("error",A),l.removeEventListener("abort",A),l.removeEventListener("load",M),l.removeEventListener("timeout",A),n.reportProgress&&(l.removeEventListener("progress",V),null!==p&&l.upload&&l.upload.removeEventListener("progress",K)),l.readyState!==l.DONE&&l.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(Gt(TM))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})();const d1=new Tn("XSRF_COOKIE_NAME"),p1=new Tn("XSRF_HEADER_NAME");class gD{}let IF=(()=>{class e{constructor(n,i,l){this.doc=n,this.platform=i,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=gM(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(Gt(No),Gt(K0),Gt(d1))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),f1=(()=>{class e{constructor(n,i){this.tokenService=n,this.headerName=i}intercept(n,i){const l=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||l.startsWith("http://")||l.startsWith("https://"))return i.handle(n);const p=this.tokenService.getToken();return null!==p&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,p)})),i.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(Gt(gD),Gt(p1))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),AF=(()=>{class e{constructor(n,i){this.backend=n,this.injector=i,this.chain=null}handle(n){if(null===this.chain){const i=this.injector.get(fD,[]);this.chain=i.reduceRight((l,p)=>new pD(l,p),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(Gt(aD),Gt(qi))},e.\u0275prov=sn({token:e,factory:e.\u0275fac}),e})(),PF=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:f1,useClass:TF}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:d1,useValue:n.cookieName}:[],n.headerName?{provide:p1,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({providers:[f1,{provide:fD,useExisting:f1,multi:!0},{provide:gD,useClass:IF},{provide:d1,useValue:"XSRF-TOKEN"},{provide:p1,useValue:"X-XSRF-TOKEN"}]}),e})(),kF=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({providers:[h1,{provide:sD,useClass:AF},mD,{provide:aD,useExisting:mD}],imports:[PF.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),e})(),_D=(()=>{class e{constructor(n){this.http=n,this.API_KEY="keysbVnYZk16tqIT0",this.AIRTABLE_BASE="https://api.airtable.com/v0",this.CONTENT_TABLE="Content"}airtableToMapping(){return hn(n=>{const i={};return n.records.forEach(l=>{i[l.id]=Object.assign(l.fields,{id:l.id})}),i})}airtableToArray(){return hn(n=>n.records.map(l=>l.fields))}airtableFetch(n,i,l,p,y){const w={Authorization:`Bearer ${this.API_KEY}`};let M=`${this.AIRTABLE_BASE}/${n}/${i}`,A={};return p?M+=`/${p}`:(A={maxRecords:1e3,view:l},y&&(A.fields=y)),this.http.get(M,{headers:w,params:A})}}return e.\u0275fac=function(n){return new(n||e)(Gt(h1))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),m1=(()=>{class e{constructor(){this.showMapSelector=!1,this.results=new $n}submitResult(n){this.showMapSelector=!1,console.log("SUBMITTING RESULT",n),this.results.next(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Wf=Fe(898);class OF extends H{constructor(t,n){super()}schedule(t,n=0){return this}}const Fv={setInterval(e,t,...n){const{delegate:i}=Fv;return i?.setInterval?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=Fv;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class e_{constructor(t,n=e_.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}e_.now=a1.now;const g1=new class LF extends e_{constructor(t,n=e_.now){super(t,n),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}(class RF extends OF{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){if(this.closed)return this;this.state=t;const i=this.id,l=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(l,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(l,this.id,n),this}requestAsyncId(t,n,i=0){return Fv.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;Fv.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let l,i=!1;try{this.work(t)}catch(p){i=!0,l=p||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),l}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,h(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),FF=g1;function _1(e=0,t,n=FF){let i=-1;return null!=t&&(rn(t)?n=t:i=t),new qt(l=>{let p=function zF(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;p<0&&(p=0);let y=0;return n.schedule(function(){l.closed||(l.next(y++),0<=i?this.schedule(void 0,i):l.complete())},p)})}function yD(e,t){return t?n=>_v(t.pipe(cn(1),function BF(){return Yn((e,t)=>{e.subscribe(en(t,Xe))})}()),n.pipe(yD(e))):ht((n,i)=>e(n,i).pipe(cn(1),QM(n)))}let vD=(()=>{class e{constructor(n){this.http=n,this.ACCESS_TOKEN="pk.eyJ1IjoiYXRsYXNtZWRsaXEiLCJhIjoiY2tpbXgzNW5qMHhhcjJ5cGtydHpkNnJqYyJ9.vfietFuvTA8S1vaGlm3CUQ",Wf.accessToken=this.ACCESS_TOKEN,Wf.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",console.error,!0)}setLayerSource(n,i,l){const p=n.getStyle().layers,y=p.findIndex(A=>A.id===i),w=p[y],M=p[y+1]&&p[y+1].id;w.source=l,w["source-layer"]&&delete w["source-layer"],n.removeLayer(i),n.addLayer(w,M)}parseMapView(n){if(!n.geo)return{};const l=/center:\s*\{\s*lon:\s*([-0-9.]+),\s*lat:\s*([-0-9.]+)\s*\},\s*zoom:\s*([-0-9.]+),\s*pitch:\s*([-0-9.]+),\s*bearing:\s*([-0-9.]+)/g.exec(n.geo);if(null!==l){const p={center:{lon:parseFloat(l[1]),lat:parseFloat(l[2])},zoom:parseFloat(l[3]),pitch:parseFloat(l[4]),bearing:parseFloat(l[5])};return n.curve&&(p.curve=n.curve),n.speed&&(p.speed=n.speed),p}return{}}}return e.\u0275fac=function(n){return new(n||e)(Gt(h1))},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const VF=[[["",8,"content"]],[["",8,"header-title"]]],UF=[".content",".header-title"];let jF=(()=>{class e{constructor(){this.hideHeader=!1,this.info=new qr,this.addNew=new qr}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-layout"]],inputs:{hideHeader:"hideHeader"},outputs:{info:"info",addNew:"addNew"},ngContentSelectors:UF,decls:10,vars:2,consts:[[1,"layout"],[1,"header"],["href","/"],["src","assets/img/globe-logo-left.svg",1,"logo","layout-mobile"],["src","assets/img/globe-logo-up.svg",1,"logo","layout-desktop"],[1,"text"],["src","assets/img/icon-add-new.svg",1,"addNew",3,"click"],["src","assets/img/wawb-info-icon.svg",1,"info",3,"click"]],template:function(n,i){1&n&&(function Iw(e){const t=lt()[16][6];if(!t.projection){const i=t.projection=va(e?e.length:1,null),l=i.slice();let p=t.child;for(;null!==p;){const y=e?oI(p,e):0;null!==y&&(l[y]?l[y].projectionNext=p:i[y]=p,l[y]=p),p=p.next}}}(VF),xt(0,"div",0),C0(1),xt(2,"div",1)(3,"a",2),Ln(4,"img",3)(5,"img",4),Dt(),xt(6,"div",5),C0(7,1),Dt(),xt(8,"img",6),nr("click",function(){return i.addNew.emit(!0)}),Dt(),xt(9,"img",7),nr("click",function(){return i.info.emit(!0)}),Dt()()()),2&n&&(Vt(2),bo("hidden",i.hideHeader))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;display:flex;align-items:stretch}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:row}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:column-reverse}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex:0 0 auto;background:white;display:flex;align-items:center}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:96px;min-width:96px;flex-flow:column;padding:16px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:64px;min-height:64px;flex-flow:row;padding:12px;margin-top:0;transition-property:margin-top;transition-duration:.5s}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header.hidden[_ngcontent-%COMP%]{margin-top:-64px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{margin:0;cursor:pointer}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:64px;height:89px;margin-bottom:20px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:58px;height:40px;margin-right:20px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{transform:rotate(90deg);transform-origin:96px/2 96px/2;flex-flow:row;align-items:center;width:96px;height:96px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex-flow:column;align-items:flex-start;margin-right:12px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1, [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-family:Source Code Pro,monospace;font-style:normal;color:#00a881;margin:0;white-space:nowrap}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-weight:700;text-transform:uppercase}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:30px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:14px;line-height:18px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-weight:500;font-size:20px}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{margin-top:auto}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{margin-left:auto}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{cursor:pointer}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{width:24px;height:24px;margin-bottom:12px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{width:20px;height:20px;margin-right:12px}}']}),e})();let Xf={baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};const GF=/[&<>"']/,HF=/[&<>"']/g,qF=/[<>"']|&(?!#?\w+;)/,ZF=/[<>"']|&(?!#?\w+;)/g,WF={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bD=e=>WF[e];function Mo(e,t){if(t){if(GF.test(e))return e.replace(HF,bD)}else if(qF.test(e))return e.replace(ZF,bD);return e}const XF=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function wD(e){return e.replace(XF,(t,n)=>"colon"===(n=n.toLowerCase())?":":"#"===n.charAt(0)?"x"===n.charAt(1)?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):"")}const YF=/(^|[^\[])\^/g;function ni(e,t){e="string"==typeof e?e:e.source,t=t||"";const n={replace:(i,l)=>(l=(l=l.source||l).replace(YF,"$1"),e=e.replace(i,l),n),getRegex:()=>new RegExp(e,t)};return n}const KF=/[^\w:]/g,JF=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function CD(e,t,n){if(e){let i;try{i=decodeURIComponent(wD(n)).replace(KF,"").toLowerCase()}catch{return null}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return null}t&&!JF.test(n)&&(n=function nz(e,t){zv[" "+e]||(zv[" "+e]=QF.test(e)?e+"/":Nv(e,"/",!0));const n=-1===(e=zv[" "+e]).indexOf(":");return"//"===t.substring(0,2)?n?t:e.replace(ez,"$1")+t:"/"===t.charAt(0)?n?t:e.replace(tz,"$1")+t:e+t}(t,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const zv={},QF=/^[^:]+:\/*[^/]*$/,ez=/^([^:]+:)[\s\S]*$/,tz=/^([^:]+:\/*[^/]*)[\s\S]*$/,Bv={exec:function(){}};function bl(e){let n,i,t=1;for(;t<arguments.length;t++)for(i in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}function ED(e,t){const i=e.replace(/\|/g,(p,y,w)=>{let M=!1,A=y;for(;--A>=0&&"\\"===w[A];)M=!M;return M?"|":" |"}).split(/ \|/);let l=0;if(i[0].trim()||i.shift(),i.length>0&&!i[i.length-1].trim()&&i.pop(),i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;l<i.length;l++)i[l]=i[l].trim().replace(/\\\|/g,"|");return i}function Nv(e,t,n){const i=e.length;if(0===i)return"";let l=0;for(;l<i;){const p=e.charAt(i-l-1);if(p!==t||n){if(p===t||!n)break;l++}else l++}return e.slice(0,i-l)}function MD(e){e&&e.sanitize&&!e.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function TD(e,t){if(t<1)return"";let n="";for(;t>1;)1&t&&(n+=e),t>>=1,e+=e;return n+e}function DD(e,t,n,i){const l=t.href,p=t.title?Mo(t.title):null,y=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){i.state.inLink=!0;const w={type:"link",raw:n,href:l,title:p,text:y,tokens:i.inlineTokens(y,[])};return i.state.inLink=!1,w}return{type:"image",raw:n,href:l,title:p,text:Mo(y)}}class y1{constructor(t){this.options=t||Xf}space(t){const n=this.rules.block.newline.exec(t);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(t){const n=this.rules.block.code.exec(t);if(n){const i=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?i:Nv(i,"\n")}}}fences(t){const n=this.rules.block.fences.exec(t);if(n){const i=n[0],l=function iz(e,t){const n=e.match(/^(\s+)(?:```)/);if(null===n)return t;const i=n[1];return t.split("\n").map(l=>{const p=l.match(/^\s+/);if(null===p)return l;const[y]=p;return y.length>=i.length?l.slice(i.length):l}).join("\n")}(i,n[3]||"");return{type:"code",raw:i,lang:n[2]?n[2].trim():n[2],text:l}}}heading(t){const n=this.rules.block.heading.exec(t);if(n){let i=n[2].trim();if(/#$/.test(i)){const p=Nv(i,"#");(this.options.pedantic||!p||/ $/.test(p))&&(i=p.trim())}const l={type:"heading",raw:n[0],depth:n[1].length,text:i,tokens:[]};return this.lexer.inline(l.text,l.tokens),l}}hr(t){const n=this.rules.block.hr.exec(t);if(n)return{type:"hr",raw:n[0]}}blockquote(t){const n=this.rules.block.blockquote.exec(t);if(n){const i=n[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:n[0],tokens:this.lexer.blockTokens(i,[]),text:i}}}list(t){let n=this.rules.block.list.exec(t);if(n){let i,l,p,y,w,M,A,F,V,K,re,Se,Ge=n[1].trim();const ut=Ge.length>1,Ye={type:"list",raw:"",ordered:ut,start:ut?+Ge.slice(0,-1):"",loose:!1,items:[]};Ge=ut?`\\d{1,9}\\${Ge.slice(-1)}`:`\\${Ge}`,this.options.pedantic&&(Ge=ut?Ge:"[*+-]");const Ct=new RegExp(`^( {0,3}${Ge})((?:[\t ][^\\n]*)?(?:\\n|$))`);for(;t&&(Se=!1,(n=Ct.exec(t))&&!this.rules.block.hr.test(t));){if(i=n[0],t=t.substring(i.length),F=n[2].split("\n",1)[0],V=t.split("\n",1)[0],this.options.pedantic?(y=2,re=F.trimLeft()):(y=n[2].search(/[^ ]/),y=y>4?1:y,re=F.slice(y),y+=n[1].length),M=!1,!F&&/^ *$/.test(V)&&(i+=V+"\n",t=t.substring(V.length+1),Se=!0),!Se){const Zt=new RegExp(`^ {0,${Math.min(3,y-1)}}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))`),Bn=new RegExp(`^ {0,${Math.min(3,y-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),yr=new RegExp(`^( {0,${Math.min(3,y-1)}})(\`\`\`|~~~)`);for(;t&&(K=t.split("\n",1)[0],F=K,this.options.pedantic&&(F=F.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(yr.test(F)||this.rules.block.heading.test(F)||Zt.test(F)||Bn.test(t)));){if(F.search(/[^ ]/)>=y||!F.trim())re+="\n"+F.slice(y);else{if(M)break;re+="\n"+F}!M&&!F.trim()&&(M=!0),i+=K+"\n",t=t.substring(K.length+1)}}Ye.loose||(A?Ye.loose=!0:/\n *\n *$/.test(i)&&(A=!0)),this.options.gfm&&(l=/^\[[ xX]\] /.exec(re),l&&(p="[ ] "!==l[0],re=re.replace(/^\[[ xX]\] +/,""))),Ye.items.push({type:"list_item",raw:i,task:!!l,checked:p,loose:!1,text:re}),Ye.raw+=i}Ye.items[Ye.items.length-1].raw=i.trimRight(),Ye.items[Ye.items.length-1].text=re.trimRight(),Ye.raw=Ye.raw.trimRight();const nt=Ye.items.length;for(w=0;w<nt;w++){this.lexer.state.top=!1,Ye.items[w].tokens=this.lexer.blockTokens(Ye.items[w].text,[]);const Zt=Ye.items[w].tokens.filter(yr=>"space"===yr.type),Bn=Zt.every(yr=>{const Oa=yr.raw.split("");let Fu=0;for(const o_ of Oa)if("\n"===o_&&(Fu+=1),Fu>1)return!0;return!1});!Ye.loose&&Zt.length&&Bn&&(Ye.loose=!0,Ye.items[w].loose=!0)}return Ye}}html(t){const n=this.rules.block.html.exec(t);if(n){const i={type:"html",raw:n[0],pre:!this.options.sanitizer&&("pre"===n[1]||"script"===n[1]||"style"===n[1]),text:n[0]};return this.options.sanitize&&(i.type="paragraph",i.text=this.options.sanitizer?this.options.sanitizer(n[0]):Mo(n[0]),i.tokens=[],this.lexer.inline(i.text,i.tokens)),i}}def(t){const n=this.rules.block.def.exec(t);if(n)return n[3]&&(n[3]=n[3].substring(1,n[3].length-1)),{type:"def",tag:n[1].toLowerCase().replace(/\s+/g," "),raw:n[0],href:n[2],title:n[3]}}table(t){const n=this.rules.block.table.exec(t);if(n){const i={type:"table",header:ED(n[1]).map(l=>({text:l})),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(i.header.length===i.align.length){i.raw=n[0];let p,y,w,M,l=i.align.length;for(p=0;p<l;p++)i.align[p]=/^ *-+: *$/.test(i.align[p])?"right":/^ *:-+: *$/.test(i.align[p])?"center":/^ *:-+ *$/.test(i.align[p])?"left":null;for(l=i.rows.length,p=0;p<l;p++)i.rows[p]=ED(i.rows[p],i.header.length).map(A=>({text:A}));for(l=i.header.length,y=0;y<l;y++)i.header[y].tokens=[],this.lexer.inline(i.header[y].text,i.header[y].tokens);for(l=i.rows.length,y=0;y<l;y++)for(M=i.rows[y],w=0;w<M.length;w++)M[w].tokens=[],this.lexer.inline(M[w].text,M[w].tokens);return i}}}lheading(t){const n=this.rules.block.lheading.exec(t);if(n){const i={type:"heading",raw:n[0],depth:"="===n[2].charAt(0)?1:2,text:n[1],tokens:[]};return this.lexer.inline(i.text,i.tokens),i}}paragraph(t){const n=this.rules.block.paragraph.exec(t);if(n){const i={type:"paragraph",raw:n[0],text:"\n"===n[1].charAt(n[1].length-1)?n[1].slice(0,-1):n[1],tokens:[]};return this.lexer.inline(i.text,i.tokens),i}}text(t){const n=this.rules.block.text.exec(t);if(n){const i={type:"text",raw:n[0],text:n[0],tokens:[]};return this.lexer.inline(i.text,i.tokens),i}}escape(t){const n=this.rules.inline.escape.exec(t);if(n)return{type:"escape",raw:n[0],text:Mo(n[1])}}tag(t){const n=this.rules.inline.tag.exec(t);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Mo(n[0]):n[0]}}link(t){const n=this.rules.inline.link.exec(t);if(n){const i=n[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const y=Nv(i.slice(0,-1),"\\");if((i.length-y.length)%2==0)return}else{const y=function rz(e,t){if(-1===e.indexOf(t[1]))return-1;const n=e.length;let i=0,l=0;for(;l<n;l++)if("\\"===e[l])l++;else if(e[l]===t[0])i++;else if(e[l]===t[1]&&(i--,i<0))return l;return-1}(n[2],"()");if(y>-1){const M=(0===n[0].indexOf("!")?5:4)+n[1].length+y;n[2]=n[2].substring(0,y),n[0]=n[0].substring(0,M).trim(),n[3]=""}}let l=n[2],p="";if(this.options.pedantic){const y=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(l);y&&(l=y[1],p=y[3])}else p=n[3]?n[3].slice(1,-1):"";return l=l.trim(),/^</.test(l)&&(l=this.options.pedantic&&!/>$/.test(i)?l.slice(1):l.slice(1,-1)),DD(n,{href:l&&l.replace(this.rules.inline._escapes,"$1"),title:p&&p.replace(this.rules.inline._escapes,"$1")},n[0],this.lexer)}}reflink(t,n){let i;if((i=this.rules.inline.reflink.exec(t))||(i=this.rules.inline.nolink.exec(t))){let l=(i[2]||i[1]).replace(/\s+/g," ");if(l=n[l.toLowerCase()],!l||!l.href){const p=i[0].charAt(0);return{type:"text",raw:p,text:p}}return DD(i,l,i[0],this.lexer)}}emStrong(t,n,i=""){let l=this.rules.inline.emStrong.lDelim.exec(t);if(!l||l[3]&&i.match(/[\p{L}\p{N}]/u))return;const p=l[1]||l[2]||"";if(!p||p&&(""===i||this.rules.inline.punctuation.exec(i))){const y=l[0].length-1;let w,M,A=y,F=0;const V="*"===l[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(V.lastIndex=0,n=n.slice(-1*t.length+y);null!=(l=V.exec(n));){if(w=l[1]||l[2]||l[3]||l[4]||l[5]||l[6],!w)continue;if(M=w.length,l[3]||l[4]){A+=M;continue}if((l[5]||l[6])&&y%3&&!((y+M)%3)){F+=M;continue}if(A-=M,A>0)continue;if(M=Math.min(M,M+A+F),Math.min(y,M)%2){const re=t.slice(1,y+l.index+M);return{type:"em",raw:t.slice(0,y+l.index+M+1),text:re,tokens:this.lexer.inlineTokens(re,[])}}const K=t.slice(2,y+l.index+M-1);return{type:"strong",raw:t.slice(0,y+l.index+M+1),text:K,tokens:this.lexer.inlineTokens(K,[])}}}}codespan(t){const n=this.rules.inline.code.exec(t);if(n){let i=n[2].replace(/\n/g," ");const l=/[^ ]/.test(i),p=/^ /.test(i)&&/ $/.test(i);return l&&p&&(i=i.substring(1,i.length-1)),i=Mo(i,!0),{type:"codespan",raw:n[0],text:i}}}br(t){const n=this.rules.inline.br.exec(t);if(n)return{type:"br",raw:n[0]}}del(t){const n=this.rules.inline.del.exec(t);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2],[])}}autolink(t,n){const i=this.rules.inline.autolink.exec(t);if(i){let l,p;return"@"===i[2]?(l=Mo(this.options.mangle?n(i[1]):i[1]),p="mailto:"+l):(l=Mo(i[1]),p=l),{type:"link",raw:i[0],text:l,href:p,tokens:[{type:"text",raw:l,text:l}]}}}url(t,n){let i;if(i=this.rules.inline.url.exec(t)){let l,p;if("@"===i[2])l=Mo(this.options.mangle?n(i[0]):i[0]),p="mailto:"+l;else{let y;do{y=i[0],i[0]=this.rules.inline._backpedal.exec(i[0])[0]}while(y!==i[0]);l=Mo(i[0]),p="www."===i[1]?"http://"+l:l}return{type:"link",raw:i[0],text:l,href:p,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(t,n){const i=this.rules.inline.text.exec(t);if(i){let l;return l=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):Mo(i[0]):i[0]:Mo(this.options.smartypants?n(i[0]):i[0]),{type:"text",raw:i[0],text:l}}}}const xn={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Bv,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};xn.def=ni(xn.def).replace("label",xn._label).replace("title",xn._title).getRegex(),xn.bullet=/(?:[*+-]|\d{1,9}[.)])/,xn.listItemStart=ni(/^( *)(bull) */).replace("bull",xn.bullet).getRegex(),xn.list=ni(xn.list).replace(/bull/g,xn.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+xn.def.source+")").getRegex(),xn._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xn._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,xn.html=ni(xn.html,"i").replace("comment",xn._comment).replace("tag",xn._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),xn.paragraph=ni(xn._paragraph).replace("hr",xn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",xn._tag).getRegex(),xn.blockquote=ni(xn.blockquote).replace("paragraph",xn.paragraph).getRegex(),xn.normal=bl({},xn),xn.gfm=bl({},xn.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),xn.gfm.table=ni(xn.gfm.table).replace("hr",xn.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",xn._tag).getRegex(),xn.gfm.paragraph=ni(xn._paragraph).replace("hr",xn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",xn.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",xn._tag).getRegex(),xn.pedantic=bl({},xn.normal,{html:ni("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",xn._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Bv,paragraph:ni(xn.normal._paragraph).replace("hr",xn.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",xn.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const Qt={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Bv,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Bv,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};function oz(e){return e.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026")}function SD(e){let n,i,t="";const l=e.length;for(n=0;n<l;n++)i=e.charCodeAt(n),Math.random()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t}Qt._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",Qt.punctuation=ni(Qt.punctuation).replace(/punctuation/g,Qt._punctuation).getRegex(),Qt.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,Qt.escapedEmSt=/\\\*|\\_/g,Qt._comment=ni(xn._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),Qt.emStrong.lDelim=ni(Qt.emStrong.lDelim).replace(/punct/g,Qt._punctuation).getRegex(),Qt.emStrong.rDelimAst=ni(Qt.emStrong.rDelimAst,"g").replace(/punct/g,Qt._punctuation).getRegex(),Qt.emStrong.rDelimUnd=ni(Qt.emStrong.rDelimUnd,"g").replace(/punct/g,Qt._punctuation).getRegex(),Qt._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,Qt._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,Qt._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,Qt.autolink=ni(Qt.autolink).replace("scheme",Qt._scheme).replace("email",Qt._email).getRegex(),Qt._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,Qt.tag=ni(Qt.tag).replace("comment",Qt._comment).replace("attribute",Qt._attribute).getRegex(),Qt._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Qt._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,Qt._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,Qt.link=ni(Qt.link).replace("label",Qt._label).replace("href",Qt._href).replace("title",Qt._title).getRegex(),Qt.reflink=ni(Qt.reflink).replace("label",Qt._label).replace("ref",xn._label).getRegex(),Qt.nolink=ni(Qt.nolink).replace("ref",xn._label).getRegex(),Qt.reflinkSearch=ni(Qt.reflinkSearch,"g").replace("reflink",Qt.reflink).replace("nolink",Qt.nolink).getRegex(),Qt.normal=bl({},Qt),Qt.pedantic=bl({},Qt.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:ni(/^!?\[(label)\]\((.*?)\)/).replace("label",Qt._label).getRegex(),reflink:ni(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Qt._label).getRegex()}),Qt.gfm=bl({},Qt.normal,{escape:ni(Qt.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),Qt.gfm.url=ni(Qt.gfm.url,"i").replace("email",Qt.gfm._extended_email).getRegex(),Qt.breaks=bl({},Qt.gfm,{br:ni(Qt.br).replace("{2,}","*").getRegex(),text:ni(Qt.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});class Ru{constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Xf,this.options.tokenizer=this.options.tokenizer||new y1,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:xn.normal,inline:Qt.normal};this.options.pedantic?(n.block=xn.pedantic,n.inline=Qt.pedantic):this.options.gfm&&(n.block=xn.gfm,n.inline=this.options.breaks?Qt.breaks:Qt.gfm),this.tokenizer.rules=n}static get rules(){return{block:xn,inline:Qt}}static lex(t,n){return new Ru(n).lex(t)}static lexInline(t,n){return new Ru(n).inlineTokens(t)}lex(t){let n;for(t=t.replace(/\r\n|\r/g,"\n"),this.blockTokens(t,this.tokens);n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(t,n=[]){let i,l,p,y;for(t=this.options.pedantic?t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t.replace(/^( *)(\t+)/gm,(w,M,A)=>M+"    ".repeat(A.length));t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(w=>!!(i=w.call({lexer:this},t,n))&&(t=t.substring(i.raw.length),n.push(i),!0)))){if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length),1===i.raw.length&&n.length>0?n[n.length-1].raw+="\n":n.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length),l=n[n.length-1],!l||"paragraph"!==l.type&&"text"!==l.type?n.push(i):(l.raw+="\n"+i.raw,l.text+="\n"+i.text,this.inlineQueue[this.inlineQueue.length-1].src=l.text);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length),l=n[n.length-1],!l||"paragraph"!==l.type&&"text"!==l.type?this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title}):(l.raw+="\n"+i.raw,l.text+="\n"+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=l.text);continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),n.push(i);continue}if(p=t,this.options.extensions&&this.options.extensions.startBlock){let w=1/0;const M=t.slice(1);let A;this.options.extensions.startBlock.forEach(function(F){A=F.call({lexer:this},M),"number"==typeof A&&A>=0&&(w=Math.min(w,A))}),w<1/0&&w>=0&&(p=t.substring(0,w+1))}if(this.state.top&&(i=this.tokenizer.paragraph(p))){l=n[n.length-1],y&&"paragraph"===l.type?(l.raw+="\n"+i.raw,l.text+="\n"+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=l.text):n.push(i),y=p.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length),l=n[n.length-1],l&&"text"===l.type?(l.raw+="\n"+i.raw,l.text+="\n"+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=l.text):n.push(i);continue}if(t){const w="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(w);break}throw new Error(w)}}return this.state.top=!0,n}inline(t,n){this.inlineQueue.push({src:t,tokens:n})}inlineTokens(t,n=[]){let i,l,p,w,M,A,y=t;if(this.tokens.links){const F=Object.keys(this.tokens.links);if(F.length>0)for(;null!=(w=this.tokenizer.rules.inline.reflinkSearch.exec(y));)F.includes(w[0].slice(w[0].lastIndexOf("[")+1,-1))&&(y=y.slice(0,w.index)+"["+TD("a",w[0].length-2)+"]"+y.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(w=this.tokenizer.rules.inline.blockSkip.exec(y));)y=y.slice(0,w.index)+"["+TD("a",w[0].length-2)+"]"+y.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(w=this.tokenizer.rules.inline.escapedEmSt.exec(y));)y=y.slice(0,w.index)+"++"+y.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;t;)if(M||(A=""),M=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(F=>!!(i=F.call({lexer:this},t,n))&&(t=t.substring(i.raw.length),n.push(i),!0)))){if(i=this.tokenizer.escape(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.tag(t)){t=t.substring(i.raw.length),l=n[n.length-1],l&&"text"===i.type&&"text"===l.type?(l.raw+=i.raw,l.text+=i.text):n.push(i);continue}if(i=this.tokenizer.link(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(i.raw.length),l=n[n.length-1],l&&"text"===i.type&&"text"===l.type?(l.raw+=i.raw,l.text+=i.text):n.push(i);continue}if(i=this.tokenizer.emStrong(t,y,A)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.codespan(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.br(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.del(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.autolink(t,SD)){t=t.substring(i.raw.length),n.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(t,SD))){t=t.substring(i.raw.length),n.push(i);continue}if(p=t,this.options.extensions&&this.options.extensions.startInline){let F=1/0;const V=t.slice(1);let K;this.options.extensions.startInline.forEach(function(re){K=re.call({lexer:this},V),"number"==typeof K&&K>=0&&(F=Math.min(F,K))}),F<1/0&&F>=0&&(p=t.substring(0,F+1))}if(i=this.tokenizer.inlineText(p,oz)){t=t.substring(i.raw.length),"_"!==i.raw.slice(-1)&&(A=i.raw.slice(-1)),M=!0,l=n[n.length-1],l&&"text"===l.type?(l.raw+=i.raw,l.text+=i.text):n.push(i);continue}if(t){const F="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(F);break}throw new Error(F)}}return n}}class v1{constructor(t){this.options=t||Xf}code(t,n,i){const l=(n||"").match(/\S*/)[0];if(this.options.highlight){const p=this.options.highlight(t,l);null!=p&&p!==t&&(i=!0,t=p)}return t=t.replace(/\n$/,"")+"\n",l?'<pre><code class="'+this.options.langPrefix+Mo(l,!0)+'">'+(i?t:Mo(t,!0))+"</code></pre>\n":"<pre><code>"+(i?t:Mo(t,!0))+"</code></pre>\n"}blockquote(t){return`<blockquote>\n${t}</blockquote>\n`}html(t){return t}heading(t,n,i,l){return this.options.headerIds?`<h${n} id="${this.options.headerPrefix+l.slug(i)}">${t}</h${n}>\n`:`<h${n}>${t}</h${n}>\n`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(t,n,i){const l=n?"ol":"ul";return"<"+l+(n&&1!==i?' start="'+i+'"':"")+">\n"+t+"</"+l+">\n"}listitem(t){return`<li>${t}</li>\n`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(t){return`<p>${t}</p>\n`}table(t,n){return n&&(n=`<tbody>${n}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+n+"</table>\n"}tablerow(t){return`<tr>\n${t}</tr>\n`}tablecell(t,n){const i=n.header?"th":"td";return(n.align?`<${i} align="${n.align}">`:`<${i}>`)+t+`</${i}>\n`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(t){return`<del>${t}</del>`}link(t,n,i){if(null===(t=CD(this.options.sanitize,this.options.baseUrl,t)))return i;let l='<a href="'+Mo(t)+'"';return n&&(l+=' title="'+n+'"'),l+=">"+i+"</a>",l}image(t,n,i){if(null===(t=CD(this.options.sanitize,this.options.baseUrl,t)))return i;let l=`<img src="${t}" alt="${i}"`;return n&&(l+=` title="${n}"`),l+=this.options.xhtml?"/>":">",l}text(t){return t}}class ID{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,n,i){return""+i}image(t,n,i){return""+i}br(){return""}}class AD{constructor(){this.seen={}}serialize(t){return t.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(t,n){let i=t,l=0;if(this.seen.hasOwnProperty(i)){l=this.seen[t];do{l++,i=t+"-"+l}while(this.seen.hasOwnProperty(i))}return n||(this.seen[t]=l,this.seen[i]=0),i}slug(t,n={}){const i=this.serialize(t);return this.getNextSafeSlug(i,n.dryrun)}}class Lu{constructor(t){this.options=t||Xf,this.options.renderer=this.options.renderer||new v1,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ID,this.slugger=new AD}static parse(t,n){return new Lu(n).parse(t)}static parseInline(t,n){return new Lu(n).parseInline(t)}parse(t,n=!0){let l,p,y,w,M,A,F,V,K,re,Se,Ge,ut,Ye,Ct,nt,Zt,Bn,yr,i="";const Oa=t.length;for(l=0;l<Oa;l++)if(re=t[l],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[re.type]&&(yr=this.options.extensions.renderers[re.type].call({parser:this},re),!1!==yr||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(re.type)))i+=yr||"";else switch(re.type){case"space":continue;case"hr":i+=this.renderer.hr();continue;case"heading":i+=this.renderer.heading(this.parseInline(re.tokens),re.depth,wD(this.parseInline(re.tokens,this.textRenderer)),this.slugger);continue;case"code":i+=this.renderer.code(re.text,re.lang,re.escaped);continue;case"table":for(V="",F="",w=re.header.length,p=0;p<w;p++)F+=this.renderer.tablecell(this.parseInline(re.header[p].tokens),{header:!0,align:re.align[p]});for(V+=this.renderer.tablerow(F),K="",w=re.rows.length,p=0;p<w;p++){for(A=re.rows[p],F="",M=A.length,y=0;y<M;y++)F+=this.renderer.tablecell(this.parseInline(A[y].tokens),{header:!1,align:re.align[y]});K+=this.renderer.tablerow(F)}i+=this.renderer.table(V,K);continue;case"blockquote":K=this.parse(re.tokens),i+=this.renderer.blockquote(K);continue;case"list":for(Se=re.ordered,Ge=re.start,ut=re.loose,w=re.items.length,K="",p=0;p<w;p++)Ct=re.items[p],nt=Ct.checked,Zt=Ct.task,Ye="",Ct.task&&(Bn=this.renderer.checkbox(nt),ut?Ct.tokens.length>0&&"paragraph"===Ct.tokens[0].type?(Ct.tokens[0].text=Bn+" "+Ct.tokens[0].text,Ct.tokens[0].tokens&&Ct.tokens[0].tokens.length>0&&"text"===Ct.tokens[0].tokens[0].type&&(Ct.tokens[0].tokens[0].text=Bn+" "+Ct.tokens[0].tokens[0].text)):Ct.tokens.unshift({type:"text",text:Bn}):Ye+=Bn),Ye+=this.parse(Ct.tokens,ut),K+=this.renderer.listitem(Ye,Zt,nt);i+=this.renderer.list(K,Se,Ge);continue;case"html":i+=this.renderer.html(re.text);continue;case"paragraph":i+=this.renderer.paragraph(this.parseInline(re.tokens));continue;case"text":for(K=re.tokens?this.parseInline(re.tokens):re.text;l+1<Oa&&"text"===t[l+1].type;)re=t[++l],K+="\n"+(re.tokens?this.parseInline(re.tokens):re.text);i+=n?this.renderer.paragraph(K):K;continue;default:{const Fu='Token with "'+re.type+'" type was not found.';if(this.options.silent)return void console.error(Fu);throw new Error(Fu)}}return i}parseInline(t,n){n=n||this.renderer;let l,p,y,i="";const w=t.length;for(l=0;l<w;l++)if(p=t[l],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[p.type]&&(y=this.options.extensions.renderers[p.type].call({parser:this},p),!1!==y||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(p.type)))i+=y||"";else switch(p.type){case"escape":case"text":i+=n.text(p.text);break;case"html":i+=n.html(p.text);break;case"link":i+=n.link(p.href,p.title,this.parseInline(p.tokens,n));break;case"image":i+=n.image(p.href,p.title,p.text);break;case"strong":i+=n.strong(this.parseInline(p.tokens,n));break;case"em":i+=n.em(this.parseInline(p.tokens,n));break;case"codespan":i+=n.codespan(p.text);break;case"br":i+=n.br();break;case"del":i+=n.del(this.parseInline(p.tokens,n));break;default:{const M='Token with "'+p.type+'" type was not found.';if(this.options.silent)return void console.error(M);throw new Error(M)}}return i}}function _n(e,t,n){if(typeof e>"u"||null===e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if("function"==typeof t&&(n=t,t=null),MD(t=bl({},_n.defaults,t||{})),n){const i=t.highlight;let l;try{l=Ru.lex(e,t)}catch(w){return n(w)}const p=function(w){let M;if(!w)try{t.walkTokens&&_n.walkTokens(l,t.walkTokens),M=Lu.parse(l,t)}catch(A){w=A}return t.highlight=i,w?n(w):n(null,M)};if(!i||i.length<3||(delete t.highlight,!l.length))return p();let y=0;return _n.walkTokens(l,function(w){"code"===w.type&&(y++,setTimeout(()=>{i(w.text,w.lang,function(M,A){if(M)return p(M);null!=A&&A!==w.text&&(w.text=A,w.escaped=!0),y--,0===y&&p()})},0))}),void(0===y&&p())}try{const i=Ru.lex(e,t);return t.walkTokens&&_n.walkTokens(i,t.walkTokens),Lu.parse(i,t)}catch(i){if(i.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+Mo(i.message+"",!0)+"</pre>";throw i}}_n.options=_n.setOptions=function(e){return bl(_n.defaults,e),function $F(e){Xf=e}(_n.defaults),_n},_n.getDefaults=function xD(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}},_n.defaults=Xf,_n.use=function(...e){const t=bl({},...e),n=_n.defaults.extensions||{renderers:{},childTokens:{}};let i;e.forEach(l=>{if(l.extensions&&(i=!0,l.extensions.forEach(p=>{if(!p.name)throw new Error("extension name required");if(p.renderer){const y=n.renderers?n.renderers[p.name]:null;n.renderers[p.name]=y?function(...w){let M=p.renderer.apply(this,w);return!1===M&&(M=y.apply(this,w)),M}:p.renderer}if(p.tokenizer){if(!p.level||"block"!==p.level&&"inline"!==p.level)throw new Error("extension level must be 'block' or 'inline'");n[p.level]?n[p.level].unshift(p.tokenizer):n[p.level]=[p.tokenizer],p.start&&("block"===p.level?n.startBlock?n.startBlock.push(p.start):n.startBlock=[p.start]:"inline"===p.level&&(n.startInline?n.startInline.push(p.start):n.startInline=[p.start]))}p.childTokens&&(n.childTokens[p.name]=p.childTokens)})),l.renderer){const p=_n.defaults.renderer||new v1;for(const y in l.renderer){const w=p[y];p[y]=(...M)=>{let A=l.renderer[y].apply(p,M);return!1===A&&(A=w.apply(p,M)),A}}t.renderer=p}if(l.tokenizer){const p=_n.defaults.tokenizer||new y1;for(const y in l.tokenizer){const w=p[y];p[y]=(...M)=>{let A=l.tokenizer[y].apply(p,M);return!1===A&&(A=w.apply(p,M)),A}}t.tokenizer=p}if(l.walkTokens){const p=_n.defaults.walkTokens;t.walkTokens=function(y){l.walkTokens.call(this,y),p&&p.call(this,y)}}i&&(t.extensions=n),_n.setOptions(t)})},_n.walkTokens=function(e,t){for(const n of e)switch(t.call(_n,n),n.type){case"table":for(const i of n.header)_n.walkTokens(i.tokens,t);for(const i of n.rows)for(const l of i)_n.walkTokens(l.tokens,t);break;case"list":_n.walkTokens(n.items,t);break;default:_n.defaults.extensions&&_n.defaults.extensions.childTokens&&_n.defaults.extensions.childTokens[n.type]?_n.defaults.extensions.childTokens[n.type].forEach(function(i){_n.walkTokens(n[i],t)}):n.tokens&&_n.walkTokens(n.tokens,t)}},_n.parseInline=function(e,t){if(typeof e>"u"||null===e)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");MD(t=bl({},_n.defaults,t||{}));try{const n=Ru.lexInline(e,t);return t.walkTokens&&_n.walkTokens(n,t.walkTokens),Lu.parseInline(n,t)}catch(n){if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+Mo(n.message+"",!0)+"</pre>";throw n}},_n.Parser=Lu,_n.parser=Lu.parse,_n.Renderer=v1,_n.TextRenderer=ID,_n.Lexer=Ru,_n.lexer=Ru.lex,_n.Tokenizer=y1,_n.Slugger=AD,_n.parse=_n;let sz=(()=>{class e{constructor(n){this.sanitizer=n,this.close=new qr,this.marked=_n,this.aboutContent=""}ngOnInit(){this.api.ready.pipe(Co()).subscribe(()=>{this.aboutContent=this.sanitizer.bypassSecurityTrustHtml(_n(this.api.ABOUT))})}}return e.\u0275fac=function(n){return new(n||e)(tt(gv))},e.\u0275cmp=Yr({type:e,selectors:[["app-infobar"]],inputs:{title:"title",subtitle:"subtitle",api:"api"},outputs:{close:"close"},decls:7,vars:3,consts:[[1,"title"],["src","assets/img/wawb-close.svg",1,"close",3,"click"],[3,"innerHtml"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"h1"),wn(2),Dt(),xt(3,"h2"),wn(4),Dt(),xt(5,"img",1),nr("click",function(){return i.close.emit()}),Dt()(),Ln(6,"p",2)),2&n&&(Vt(2),wo(i.title),Vt(2),wo(i.subtitle),Vt(2),Rn("innerHtml",i.aboutContent,Nd))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;flex-flow:column;justify-content:flex-start;align-items:center;background:white;position:relative;z-index:2}@media only screen and (min-width: 601px){[_nghost-%COMP%]{max-width:360px;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:10px 24px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{position:relative;border-bottom:.5px solid #333333;margin-bottom:20px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], [_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;max-width:calc(100% - 46px);color:#333}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.02em;text-transform:uppercase;color:#333}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;line-height:21px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:17px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:400;font-size:15px;letter-spacing:-.01em}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;position:absolute;top:-5px;right:0;width:30px;height:30px}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{color:#00a881;font-weight:500}@media only screen and (min-width: 601px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 16px -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 16px 0}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 0 -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 0 0}}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{width:100%;background-color:#fff;padding-top:0}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{padding:24px 0 0}}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{border-top:.5px solid #333333}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;width:100%;letter-spacing:.01em;color:#333;border-bottom:.5px solid #BDBDBD;padding:8px 0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:13px;width:100%;letter-spacing:.02em;color:#333;padding:8px 0;display:flex;align-items:center;flex-flow:row}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{margin-left:auto;cursor:pointer}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:13px;font-weight:400;letter-spacing:.01em;color:#000;margin:0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;display:block;font-size:13px;font-weight:400;letter-spacing:.01em;color:#2d9cdb;margin:6px 0 0}[_nghost-%COMP%]{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:0}']}),e})();function PD(e,t=St){return e=e??az,Yn((n,i)=>{let l,p=!0;n.subscribe(en(i,y=>{const w=t(y);(p||!e(l,w))&&(p=!1,l=w,i.next(y))}))})}function az(e,t){return e===t}class x1{constructor(){this.visible$=new $n,this.detected=this.visible$.pipe(PD()),this.visible$.next(!1)}initVisibilityDetector(t,n,i){this.observer=new IntersectionObserver(y=>{this.visible$.next(y[0].isIntersecting)},{root:n,rootMargin:{active:"-50% 0% -50% 0%",visible:"100% 0% 100% 0%"}[i],threshold:0}),this.observer.observe(t)}}const lz=["addListener","removeListener"],cz=["addEventListener","removeEventListener"],uz=["on","off"];function mc(e,t,n,i){if(Ue(n)&&(i=n,n=void 0),i)return mc(e,t,n).pipe(Rb(i));const[l,p]=function pz(e){return Ue(e.addEventListener)&&Ue(e.removeEventListener)}(e)?cz.map(y=>w=>e[y](t,w,n)):function hz(e){return Ue(e.addListener)&&Ue(e.removeListener)}(e)?lz.map(kD(e,t)):function dz(e){return Ue(e.on)&&Ue(e.off)}(e)?uz.map(kD(e,t)):[];if(!l&&Tl(e))return ht(y=>mc(y,t,n))(z(e));if(!l)throw new TypeError("Invalid event target");return new qt(y=>{const w=(...M)=>y.next(1<M.length?M:M[0]);return l(w),()=>p(w)})}function kD(e,t){return n=>i=>e[n](t,i)}class mz{constructor(t,n){this.url=t,this.playerService=n,this.subscriptions=[],this.playing=new Vo(!1),this.ready=new Vo(!1),this.hiResTimestamp=new Vo(0),this.textTimestamp=new Vo("-00:00"),this.position=new Vo(0),this.ended=new $n,this.audio=new Audio(t),mc(this.audio,"canplaythrough").pipe(Co()).subscribe(()=>{this.ready.next(!0),this.updateTextTimestamp()}),this.subscriptions.push(mc(this.audio,"play").subscribe(()=>{this.playing.next(!0)}),mc(this.audio,"pause").subscribe(()=>{this.playing.next(!1)}),mc(this.audio,"ended").subscribe(()=>{this.ended.next(null),this.playing.next(!1),this.audio&&(this.audio.currentTime=0)}),mc(this.audio,"timeupdate").pipe(hn(()=>{if(null!==this.audio){const i=Math.floor(10*this.audio.currentTime),l=this.hiResTimestamp.getValue();if(i!==l)if(l<i&&i-l<20)for(let y=l+1;y<=i;y++)this.hiResTimestamp.next(y);else this.hiResTimestamp.next(i);return Math.floor(this.audio.currentTime),this.updateTextTimestamp(),Math.round(this.audio.currentTime/this.audio.duration*1e3)}return 0}),PD()).subscribe(i=>{this.position.next(i)})),this.playing.next(!1),this.audio.load()}seek(t){this.audio&&(this.audio.currentTime=this.audio.duration*t)}seekTime(t){return this.ready.pipe(Au(n=>n),Co(),Eo(()=>{null!==this.audio&&(this.audio.currentTime=t)})).toPromise()}play(){this.playing.getValue()||this.ready.pipe(Au(t=>t),Co()).subscribe(()=>{this.audio&&this.audio.play().then(()=>{this.playerService.playing(this)}).catch(()=>{console.log("FAILED TO PLAY...")})})}pause(){this.playing.getValue()&&this.audio&&(this.audio.pause(),this.playerService.stopped(this))}toggle(){this.playing.getValue()?this.pause():this.play()}cleanup(){for(null!==this.audio&&(this.pause(),this.audio.remove(),this.audio=null);this.subscriptions.length>0;)this.subscriptions.shift()?.unsubscribe()}updateTextTimestamp(){if(!this.audio||!Number.isFinite(this.audio.duration))return;const t=Math.floor(this.audio.duration-this.audio.currentTime);let n=""+t%60;n.length<2&&(n="0"+n),n=Math.floor(t/60)+":"+n,n.length<5&&(n="0"+n),n="-"+n,n!==this.textTimestamp.getValue()&&this.textTimestamp.next(n)}}let gz=(()=>{class e{constructor(){this.current=null,this.clock=new Jg(1),this.clockSub=null,this.playingSub=null,this.isPlaying=new Vo(!1),this.last=null,mc(window,"keyup").subscribe(n=>{"Space"===n.code&&(null!==this.current?this.current.toggle():null!==this.last&&(this.last.toggle(),this.last=null))})}playing(n){this.current!==n&&(null!==this.current&&this.current.pause(),this.current=n,this.clockSub&&this.clockSub.unsubscribe(),this.clockSub=n.textTimestamp.subscribe(i=>{this.clock.next(i)}),this.playingSub&&this.playingSub.unsubscribe(),this.playingSub=n.playing.subscribe(i=>{this.isPlaying.next(i)}))}stopped(n){this.current===n&&(this.last=n,this.current=null,this.isPlaying.next(!1),this.clockSub&&(this.clockSub.unsubscribe(),this.clockSub=null),this.playingSub&&(this.playingSub.unsubscribe(),this.playingSub=null))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _z=["handle"],yz=["component"];function vz(e,t){1&e&&Ln(0,"img",12)}function xz(e,t){1&e&&Ln(0,"img",13)}function bz(e,t){if(1&e){const n=Zh();B(),function Z(){!function X(){Mn.lFrame.currentNamespace=null}()}(),Rf(0),xt(1,"div",7,8),nr("mousedown",function(){return qs(n),Zo(ti().drag())}),Dt(),si(3,vz,1,0,"img",9),$y(4,"async"),si(5,xz,1,0,"img",10),$y(6,"async"),xt(7,"span",11),wn(8),$y(9,"async"),Dt(),Lf()}if(2&e){const n=ti();Vt(1),fl("left",n.handleX+"px")("top",n.handleY+"px"),Vt(2),Rn("ngIf",Gy(4,7,n.player.playing)),Vt(2),Rn("ngIf",!Gy(6,9,n.player.playing)),Vt(3),wo(Gy(9,11,n.player.textTimestamp))}}let OD=(()=>{class e{constructor(n,i){this.playerService=n,this.el=i,this.size=280,this.PADDING=2,this.BAR_WIDTH=4,this.player=null,this.progressBarPath=""}ngOnInit(){}ngAfterViewInit(){}drag(){const n=this.component.nativeElement.getBoundingClientRect();mc(window,"mousemove").pipe(function fz(e){return Yn((t,n)=>{z(e).subscribe(en(n,()=>n.complete(),Xe)),!n.closed&&t.subscribe(n)})}(mc(window,"mouseup")),Eo(i=>{const p=i.clientX-n.left-this.size/2,w=Math.atan((i.clientY-n.top-this.size/2)/p)+Math.PI/2+(p<0?Math.PI:0);this.player?.seek(w/2/Math.PI)}),yv(1)).subscribe(i=>{})}click(n){if(!this.player)return!1;const i=n.offsetX-this.size/2,l=n.offsetY-this.size/2,p=Math.atan(l/i)+Math.PI/2+(i<0?Math.PI:0),y=Math.sqrt(i*i+l*l);return Math.abs(y-this.size/2)<10?this.player.seek(p/2/Math.PI):y<this.size/2&&this.player.toggle(),!0}createPlayer(){this.audio&&(this.player=new mz(this.audio,this.playerService),this.positionSub=this.player.position.subscribe(n=>{this.calculateProgressBarPath(n/1e3*2*Math.PI)}))}cleanupPlayer(){null!==this.player&&(this.player.cleanup(),this.positionSub.unsubscribe(),this.player=null,this.progressBarPath="")}ngOnChanges(){this.cleanupPlayer(),this.createPlayer()}ngOnDestroy(){this.cleanupPlayer()}calculateProgressBarPath(n){const i=this.size/2,l=(this.size-this.BAR_WIDTH)/2,p=i+l*Math.sin(n),y=i-l*Math.cos(n),w=n>=Math.PI?"1 1":"0 1";this.progressBarPath=`M${i} ${i-l} A ${l} ${l} 0 ${w} ${p} ${y}`,this.handleX=p,this.handleY=y}}return e.\u0275fac=function(n){return new(n||e)(tt(gz),tt(es))},e.\u0275cmp=Yr({type:e,selectors:[["app-audio-player"]],viewQuery:function(n,i){if(1&n&&(dp(_z,7),dp(yz,7)),2&n){let l;Eu(l=Mu())&&(i.handle=l.first),Eu(l=Mu())&&(i.component=l.first)}},inputs:{audio:"audio",image:"image",size:"size"},features:[li],decls:7,vars:15,consts:[[1,"wrapper"],[1,"component"],["viewport","0 0 280 280",3,"click"],["component",""],["stroke","#dedede","stroke-width","4","fill","none"],["stroke","#0AB239","stroke-width","4","fill","none"],[4,"ngIf"],[1,"handle",3,"mousedown"],["handle",""],["src","assets/img/player-control-pause.svg",4,"ngIf"],["src","assets/img/player-control-play.svg",4,"ngIf"],[1,"timestamp"],["src","assets/img/player-control-pause.svg"],["src","assets/img/player-control-play.svg"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"div",1),B(),xt(2,"svg",2,3),nr("click",function(p){return i.click(p)}),Ln(4,"circle",4)(5,"path",5),Dt(),si(6,bz,10,13,"ng-container",6),Dt()()),2&n&&(fl("width",i.size+4+"px")("height",i.size+4+"px")("padding","2px"),Vt(1),fl("background-image","url("+i.image+")")("border-radius",i.size/2+"px"),Vt(3),Os("cx",i.size/2)("cy",i.size/2)("r",i.size/2-2),Vt(1),Os("d",i.progressBarPath),Vt(1),Rn("ngIf",i.player))},dependencies:[Yh,wM],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:flex;flex-flow:column;align-items:center;position:relative}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:center;justify-content:center;background-repeat:no-repeat;background-position:center;background-size:cover;position:relative;cursor:pointer;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:100%;width:100%;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:6px;border:2px solid white;background:#0AB239;transform:translate(-50%) translateY(-50%);position:absolute;pointer-events:all;z-index:1}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;color:#fff;display:block;line-height:16px;text-shadow:0px 0px 6px #000000;height:0px}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:700;font-size:16px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:400;font-size:12px}}']}),e})(),wz=(()=>{class e{constructor(){this.active=!1,this.mapView=new qr,this.sub=null}ngOnInit(){}ngOnChanges(){this.update()}ngAfterViewInit(){this.update()}update(){this.player&&this.player.player&&(this.active?(this.player.player.play(),null===this.sub&&this.item.audio_timestamps&&this.item.audio_timestamps.length&&(this.sub=this.player.player.hiResTimestamp.subscribe(n=>{const i=this.item.audio_timestamps.filter(l=>10*l.timestamp===n);i.length&&i[0].map_view&&i[0].map_view.length&&this.mapView.emit(i[0].map_view[0])}))):(this.player.player.pause(),null!==this.sub&&(this.sub.unsubscribe(),this.sub=null)))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-content-audio"]],viewQuery:function(n,i){if(1&n&&dp(OD,7),2&n){let l;Eu(l=Mu())&&(i.player=l.first)}},inputs:{item:"item",active:"active"},outputs:{mapView:"mapView"},features:[li],decls:1,vars:2,consts:[[3,"audio","image"]],template:function(n,i){1&n&&Ln(0,"app-audio-player",0),2&n&&Rn("audio",i.item.audio_s3url||i.item.audio[0].url)("image",i.item.image[0].thumbnails.large.url)},dependencies:[OD],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}@media only screen and (min-width: 601px){app-player[_ngcontent-%COMP%]{align-items:flex-start}}']}),e})();const Cz=["frame"];let Ez=(()=>{class e{constructor(n){this.sanitizer=n,this.active=!1,this.playerReady=new Jg(1)}ngOnInit(){}ngOnChanges(){this.active?this.playerReady.pipe(Co()).subscribe(()=>{this.active&&this.player.getPlayerState()!==YT.PlayerState.PLAYING&&this.player.playVideo()}):this.playerReady.pipe(Co()).subscribe(()=>{!this.active&&this.player.getPlayerState()!==YT.PlayerState.PAUSED&&this.player.getPlayerState()!==YT.PlayerState.ENDED&&this.player.pauseVideo()})}ngAfterViewInit(){const n=this.frame.nativeElement,i=Math.min(n.offsetWidth,640);this.player=new YT.Player(n,{videoId:this.item.youtube_video_id,height:3*i/4+"px",width:i+"px",events:{onReady:()=>{this.playerReady.next(),this.playerReady.complete()}},playerVars:{enablejsapi:1}})}}return e.\u0275fac=function(n){return new(n||e)(tt(gv))},e.\u0275cmp=Yr({type:e,selectors:[["app-content-video"]],viewQuery:function(n,i){if(1&n&&dp(Cz,7),2&n){let l;Eu(l=Mu())&&(i.frame=l.first)}},inputs:{item:"item",active:"active"},features:[li],decls:2,vars:0,consts:[["frame",""]],template:function(n,i){1&n&&Ln(0,"div",null,0)}}),e})(),Mz=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-content-image"]],inputs:{item:"item"},decls:1,vars:1,consts:[[3,"src"]],template:function(n,i){1&n&&Ln(0,"img",0),2&n&&Rn("src",i.item.image[0].url,Eh)},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:auto;display:block;padding-bottom:8px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;max-width:100%;max-height:100vh}@media only screen and (min-width: 601px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-position:left;max-width:600px;max-height:75vh}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}}']}),e})();function Tz(e,t){1&e&&Ln(0,"div",18),2&e&&fl("background-image","url("+ti().item.image[0].url+")")}function Dz(e,t){1&e&&Ln(0,"div",24),2&e&&fl("background-image","url("+ti(2).item.image[0].url+")")}function Sz(e,t){if(1&e&&(xt(0,"div",19),si(1,Dz,1,2,"div",20),xt(2,"div",21)(3,"div",22),wn(4),Dt(),xt(5,"div",23),wn(6),Dt()()()),2&e){const n=ti();Vt(1),Rn("ngIf",n.item.image),Vt(3),wo(n.item.link_title),Vt(2),wo(n.item.link_domain)}}let Iz=(()=>{class e{constructor(){this.marked=_n}ngOnInit(){}get timestamp(){return oD(this.item.post_timestamp).format("h:mm A - MMM D, YYYY")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-content-twitter"]],inputs:{item:"item"},decls:23,vars:10,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"username"],["src","assets/img/spectours-twitter-logo.svg",1,"twitter-logo"],[1,"caption",3,"innerHtml"],["class","image",3,"background-image",4,"ngIf"],["class","link",4,"ngIf"],[1,"deets"],[1,"timestamp"],["src","assets/img/spectours-twitter-info-icon.svg",1,"info"],[1,"social"],["src","assets/img/spectours-twitter-heart-icon.svg",1,"heart","icon"],[1,"like","count"],["src","assets/img/spectours-twitter-comment-icon.svg",1,"comment","icon"],[1,"comment","count"],[1,"image"],[1,"link"],["class","link-image",3,"background-image",4,"ngIf"],[1,"link-container"],[1,"link-title"],[1,"link-domain"],[1,"link-image"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"div",1),Ln(2,"div",2),xt(3,"div",3)(4,"div",4),wn(5),Dt(),xt(6,"div",5),wn(7),Dt()(),Ln(8,"img",6),Dt(),Ln(9,"div",7),si(10,Tz,1,2,"div",8),si(11,Sz,7,3,"div",9),xt(12,"div",10)(13,"div",11),wn(14),Dt(),Ln(15,"img",12),Dt(),xt(16,"div",13),Ln(17,"img",14),xt(18,"div",15),wn(19),Dt(),Ln(20,"img",16),xt(21,"div",17),wn(22),Dt()()()),2&n&&(Vt(2),fl("background-image","url("+i.item.profile_image[0].thumbnails.large.url+")"),Vt(3),wo(i.item.name),Vt(2),bu("@",i.item.username,""),Vt(2),Rn("innerHtml",i.marked(i.item.content),Nd),Vt(1),Rn("ngIf",!i.item.link_title&&i.item.image),Vt(1),Rn("ngIf",i.item.link_title),Vt(3),wo(i.timestamp),Vt(5),bu("",i.item.like_count,"K"),Vt(3),bu("",i.item.comment_count,"K people are talking about this"))},dependencies:[Yh],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.twitter-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif}.card[_ngcontent-%COMP%]{background:white;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:16px;padding:16px;display:flex;flex-flow:column;align-items:stretch;width:344px;max-width:100%}.card[_ngcontent-%COMP%]     a, .card[_ngcontent-%COMP%]     a:hover, .card[_ngcontent-%COMP%]     a:visited{color:#1b97f0}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin-bottom:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:24px;background-position:center;background-size:cover;background-repeat:no-repeat}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{margin:0 10px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:700;font-size:15px;line-height:18px;color:#141719}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:15px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .twitter-logo[_ngcontent-%COMP%]{width:23px;height:19px;align-self:flex-start;margin:6px 0 6px auto}.card[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;font-size:19px;line-height:23px;color:#141719;margin-bottom:8px}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:250px;background-position:center;background-size:cover;background-repeat:no-repeat;border-radius:16px;margin:0 0 8px}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{height:250px;display:flex;flex-flow:column;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:2px;margin:8px 0}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-image[_ngcontent-%COMP%]{flex:1 1 auto;background-position:center;background-size:cover;background-repeat:no-repeat;width:100%}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]{padding:8px;flex:0 0 auto}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-title[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:16px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-domain[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:400;font-size:14px;line-height:17px;color:#828282;margin-top:2px}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]{border-bottom:1px solid #C5D0D8;padding-bottom:8px;display:flex;flex-flow:row;align-items:center}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{margin-left:auto;width:20px;height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding-top:8px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:6px;width:20px;max-height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon.comment[_ngcontent-%COMP%]{margin-left:auto}']}),e})(),Az=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-content-instagram"]],inputs:{item:"item"},decls:26,vars:9,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"followers"],["src","assets/img/spectours-ig-view-profile.svg",1,"ig-view-profile"],[1,"image"],[1,"view-more"],[1,"buttons"],["src","assets/img/spectours-ig-heart-icon.svg",1,"heart","icon"],["src","assets/img/spectours-ig-comment-icon.svg",1,"comment","icon"],["src","assets/img/spectours-ig-share-icon.svg",1,"share","icon"],["src","assets/img/spectours-ig-save-icon.svg",1,"save","icon"],[1,"social"],[1,"comments"],[1,"username"],[1,"comment"],[1,"footer"],["src","assets/img/spectours-ig-logo.svg",1,"logo"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"div",1),Ln(2,"div",2),xt(3,"div",3)(4,"div",4),wn(5),Dt(),xt(6,"div",5),wn(7),Dt()(),Ln(8,"img",6),Dt(),Ln(9,"div",7),xt(10,"div",8),wn(11," View More on Instagram "),Dt(),xt(12,"div",9),Ln(13,"img",10)(14,"img",11)(15,"img",12)(16,"img",13),Dt(),xt(17,"div",14),wn(18),Dt(),xt(19,"div",15)(20,"div",16),wn(21),Dt(),xt(22,"div",17),wn(23),Dt()(),xt(24,"div",18),Ln(25,"img",19),Dt()()),2&n&&(Vt(2),fl("background-image","url("+i.item.profile_image[0].thumbnails.small.url+")"),Vt(3),wo(i.item.name),Vt(2),bu("",i.item.follower_count," followers"),Vt(2),fl("background-image","url("+i.item.image[0].url+")"),Vt(9),bu(" ",i.item.like_count," likes "),Vt(3),wo(i.item.username),Vt(2),wo(i.item.content))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.ig-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal}.card[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;background:white;border:1px solid #D6D6D6;border-radius:3px}@media only screen and (min-width: 601px){.card[_ngcontent-%COMP%]{width:344px}}@media only screen and (max-width: 600px){.card[_ngcontent-%COMP%]{width:100%}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding:12px;width:100%}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:15px;background-size:cover;background-repeat:no-repeat;background-position:center;margin-right:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{display:block}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:600;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .followers[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:14px;color:#848484}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .ig-view-profile[_ngcontent-%COMP%]{margin-left:auto}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:100%;padding-bottom:100%;background-size:cover;background-repeat:no-repeat;background-position:center}.card[_ngcontent-%COMP%]   .view-more[_ngcontent-%COMP%]{margin:0 16px;padding:13px 0;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#008af5;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin:0 16px;padding:8px 0}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:14px}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:last-child{margin-left:auto;margin-right:0}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{margin:0 16px;padding:0 0 8px;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{margin:0 16px 2px;padding:12px 0;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{margin-top:6px;font-weight:400}.card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-end;margin:8px 16px}']}),e})();function Pz(e,t){1&e&&Ln(0,"div",9),2&e&&fl("background-image","url("+ti().item.image[0].url+")")}let kz=(()=>{class e{constructor(){this.marked=_n}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-content-wikipedia"]],inputs:{item:"item"},decls:15,vars:5,consts:[[1,"article"],[1,"title"],[1,"content"],[1,"text"],[1,"excerpt",3,"innerHtml"],["target","_blank",1,"link",3,"href"],["class","image",3,"background-image",4,"ngIf"],[1,"bottom"],["target","_blank",1,"image-license",3,"href"],[1,"image"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"div",1)(2,"h1"),wn(3),Dt(),xt(4,"h2"),wn(5,"From Wikipedia, the free encyclopedia"),Dt()(),xt(6,"div",2)(7,"div",3),Ln(8,"div",4),xt(9,"a",5),wn(10,"Learn more at the English Wikipedia"),Dt()(),si(11,Pz,1,2,"div",6),xt(12,"div",7)(13,"a",8),wn(14,"Image licensing information here"),Dt()()()()),2&n&&(Vt(3),wo(i.item.title),Vt(5),Rn("innerHtml",i.marked(i.item.content),Nd),Vt(1),Rn("href",i.item.link_domain,Eh),Vt(2),Rn("ngIf",i.item.image&&i.item.image.length),Vt(2),Rn("href",i.item.source_link,Eh))},dependencies:[Yh],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.font-wikipedia-georgia[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal}.font-wikipedia-sans-serif[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal}.article[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;width:344px;max-width:100%;background:white;padding:8px 10px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:32px;line-height:36px;color:#000;border-bottom:1px solid #a2a2a2;margin:0 0 9px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:13px;line-height:15px;color:#000}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;height:0px;padding-bottom:66%;background-position:center;background-size:cover;background-repeat:no-repeat}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .excerpt[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:18px;line-height:21px;color:#000;margin-bottom:6px}.article[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{background-image:url(spectours-wikipedia-logo.b2e05984da61f3ad.png);background-repeat:no-repeat;background-position:bottom 4px right 4px;background-size:66px 64px;padding-top:47px;margin-top:-37px;padding-bottom:8px;margin-right:-10px}.article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .article[_ngcontent-%COMP%]   a.visited[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:15px;line-height:17px;color:#36b;text-decoration:none}.article[_ngcontent-%COMP%]   a.link[_ngcontent-%COMP%]{margin-bottom:30px}.article[_ngcontent-%COMP%]   a.source-link[_ngcontent-%COMP%]{margin-bottom:10px}']}),e})();function Oz(e,t){if(1&e){const n=Zh();xt(0,"app-content-audio",9),nr("mapView",function(l){return qs(n),Zo(ti(2).mapView.emit(l))}),Dt()}if(2&e){const n=ti(2);Rn("item",n.content)("active",n.active)}}function Rz(e,t){if(1&e&&Ln(0,"app-content-video",10),2&e){const n=ti(2);Rn("item",n.content)("active",n.active)}}function Lz(e,t){1&e&&Ln(0,"app-content-image",11),2&e&&Rn("item",ti(2).content)}function Fz(e,t){1&e&&Ln(0,"app-content-twitter",11),2&e&&Rn("item",ti(2).content)}function zz(e,t){1&e&&Ln(0,"app-content-instagram",11),2&e&&Rn("item",ti(2).content)}function Bz(e,t){1&e&&Ln(0,"app-content-wikipedia",11),2&e&&Rn("item",ti(2).content)}function Nz(e,t){if(1&e&&(xt(0,"div",5),si(1,Oz,1,2,"app-content-audio",6),si(2,Rz,1,2,"app-content-video",7),si(3,Lz,1,1,"app-content-image",8),si(4,Fz,1,1,"app-content-twitter",8),si(5,zz,1,1,"app-content-instagram",8),si(6,Bz,1,1,"app-content-wikipedia",8),Dt()),2&e){const n=ti();Vt(1),Rn("ngIf","audio"===n.contentType),Vt(1),Rn("ngIf","video"===n.contentType),Vt(1),Rn("ngIf","image"===n.contentType),Vt(1),Rn("ngIf","twitter"===n.contentType),Vt(1),Rn("ngIf","instagram"===n.contentType),Vt(1),Rn("ngIf","wikipedia"===n.contentType)}}let Vz=(()=>{class e{constructor(n){this.el=n,this.active=!1,this.mapView=new qr,this.contentType="",this.content=null,this.contentVisible=!1,this.visibleDetector=new x1,this.activeDetector=new x1}ngOnInit(){this.activeDetector.detected.subscribe(n=>{this.active=n,n&&(this.handleGeo(),location.replace(location.pathname+"#Y"+this.item.year))}),this.visibleDetector.detected.subscribe(n=>{this.contentVisible=this.contentVisible||n}),this.item.hasContent&&(this.content=this.item,this.contentType=this.content.type)}ngAfterViewInit(){const n=this.el.nativeElement;this.visibleDetector.initVisibilityDetector(n,n.parentElement,"visible"),this.activeDetector.initVisibilityDetector(n,n.parentElement,"active")}handleGeo(){let n=null;this.item.map_view&&this.item.map_view.length?(n=this.item.map_view[0],this.mapView.next(n)):this.mapView.next(this.item.title)}classes(){return this.item&&this.item.variants?this.item.variants.join(" "):""}}return e.\u0275fac=function(n){return new(n||e)(tt(es))},e.\u0275cmp=Yr({type:e,selectors:[["app-content"]],inputs:{item:"item",active:"active"},outputs:{mapView:"mapView"},decls:8,vars:5,consts:[[1,"header"],[1,"year"],[1,"title"],["class","content",4,"ngIf"],[1,"timeline","layout-desktop"],[1,"content"],[3,"item","active","mapView",4,"ngIf"],[3,"item","active",4,"ngIf"],[3,"item",4,"ngIf"],[3,"item","active","mapView"],[3,"item","active"],[3,"item"]],template:function(n,i){1&n&&(xt(0,"div")(1,"div",0)(2,"div",1),wn(3),Dt(),xt(4,"div",2),wn(5),Dt()(),si(6,Nz,7,6,"div",3),Ln(7,"div",4),Dt()),2&n&&(qw("wrapper "+i.classes()),Vt(3),wo(i.item.year),Vt(2),wo(i.item.title),Vt(1),Rn("ngIf",i.contentVisible))},dependencies:[Yh,wz,Ez,Mz,Iz,Az,kz],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;pointer-events:none;display:block}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 64px);width:100%;display:flex;flex-flow:column;align-items:flex-start;background:linear-gradient(270deg,rgba(0,0,0,0) 55.4%,rgba(0,0,0,.1) 67.51%);position:relative;z-index:0;overflow:hidden;outline:1px dashed #c5c5c5;border-top:2px solid #fff;border-bottom:3px solid #fff}[_nghost-%COMP%]   .wrapper.medium[_ngcontent-%COMP%]{min-height:75vh}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;align-items:flex-start;padding:8px 16px;height:40px;position:relative;z-index:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:16px;color:#ce0031}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:16px;color:#333;text-transform:uppercase;margin-left:20px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]{flex:1 1 100%;width:70px;height:100%;background-image:url(spectours-timeline-dots.b1ed30ec2ae7e989.svg);background-repeat:repeat-y;background-position-x:center;background-position-y:top;position:absolute;top:40px;left:0;z-index:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;z-index:0;pointer-events:all;overflow:hidden;flex:1 1 auto;display:flex;flex-flow:column-reverse}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:8px;margin-top:50vh}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-image[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-audio[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-video[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-twitter[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-instagram[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-wikipedia[_ngcontent-%COMP%]{display:flex;flex-flow:column;justify-content:flex-end;height:calc(100% - 80px)}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-image[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-audio[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-video[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-twitter[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-instagram[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-wikipedia[_ngcontent-%COMP%]{width:calc(100% - 140px);margin:40px 70px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-image[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-audio[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-video[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-twitter[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-instagram[_ngcontent-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   app-content-wikipedia[_ngcontent-%COMP%]{width:100%;margin:40px 0 0}}']}),e})(),Uz=(()=>{class e{constructor(n){this.el=n,this.active=!1,this.activeDetector=new x1}ngOnInit(){this.activeDetector.detected.subscribe(n=>{this.active=n,n&&(location.hash="")})}ngAfterViewInit(){const n=this.el.nativeElement;this.activeDetector.initVisibilityDetector(n,n.parentElement,"active")}}return e.\u0275fac=function(n){return new(n||e)(tt(es))},e.\u0275cmp=Yr({type:e,selectors:[["app-content-placeholder"]],inputs:{item:"item"},decls:3,vars:3,consts:[[1,"placeholder"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"span"),wn(2),Dt()()),2&n&&(bo("active",i.active),Vt(2),wo(i.item.year))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .placeholder[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;border-bottom:1px dashed #C5C5C5;height:80px;padding:0 16px;background-color:#fff}[_nghost-%COMP%]   .placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-style:normal;font-weight:400;font-size:16px;font-feature-settings:"tnum" on,"lnum" on;color:#828282}[_nghost-%COMP%]   .placeholder.active[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}']}),e})(),RD=(()=>{class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return e.\u0275fac=function(n){return new(n||e)(tt(wu),tt(es))},e.\u0275dir=un({type:e}),e})(),vp=(()=>{class e extends RD{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=function so(e){return Ho(()=>{const t=e.prototype.constructor,n=t[In]||Id(t),i=Object.prototype;let l=Object.getPrototypeOf(e.prototype).constructor;for(;l&&l!==i;){const p=l[In]||Id(l);if(p&&p!==n)return p;l=Object.getPrototypeOf(l)}return p=>new p})}(e)))(i||e)}}(),e.\u0275dir=un({type:e,features:[Ur]}),e})();const gc=new Tn("NgValueAccessor"),Gz={provide:gc,useExisting:dn(()=>Vv),multi:!0},qz=new Tn("CompositionEventMode");let Vv=(()=>{class e extends RD{constructor(n,i,l){super(n,i),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Hz(){const e=dc()?dc().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return e.\u0275fac=function(n){return new(n||e)(tt(wu),tt(es),tt(qz,8))},e.\u0275dir=un({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,i){1&n&&nr("input",function(p){return i._handleInput(p.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(p){return i._compositionEnd(p.target.value)})},features:[_i([Gz]),Ur]}),e})();const ts=new Tn("NgValidators"),nd=new Tn("NgAsyncValidators");function HD(e){return null!=e}function qD(e){const t=xg(e)?ct(e):e;return b0(t),t}function ZD(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function WD(e,t){return t.map(n=>n(e))}function XD(e){return e.map(t=>function Wz(e){return!e.validate}(t)?t:n=>t.validate(n))}function b1(e){return null!=e?function YD(e){if(!e)return null;const t=e.filter(HD);return 0==t.length?null:function(n){return ZD(WD(n,t))}}(XD(e)):null}function w1(e){return null!=e?function KD(e){if(!e)return null;const t=e.filter(HD);return 0==t.length?null:function(n){return Ov(WD(n,t).map(qD)).pipe(hn(ZD))}}(XD(e)):null}function JD(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function C1(e){return e?Array.isArray(e)?e:[e]:[]}function jv(e,t){return Array.isArray(e)?e.includes(t):e===t}function tS(e,t){const n=C1(t);return C1(e).forEach(l=>{jv(n,l)||n.push(l)}),n}function nS(e,t){return C1(t).filter(n=>!jv(e,n))}class rS{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=b1(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=w1(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class gs extends rS{get formDirective(){return null}get path(){return null}}class rd extends rS{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let oS=(()=>{class e extends class iS{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(tt(rd,2))},e.\u0275dir=un({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,i){2&n&&bo("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Ur]}),e})();const t_="VALID",Gv="INVALID",Yf="PENDING",n_="DISABLED";function aS(e){return Array.isArray(e)?b1(e):e||null}function lS(e){return Array.isArray(e)?w1(e):e||null}function Hv(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function r_(e,t){(function A1(e,t){const n=function QD(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(JD(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const i=function eS(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(JD(i,t.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]);const l=()=>e.updateValueAndValidity();Wv(t._rawValidators,l),Wv(t._rawAsyncValidators,l)})(e,t),t.valueAccessor.writeValue(e.value),e.disabled&&t.valueAccessor.setDisabledState?.(!0),function iB(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&dS(e,t)})}(e,t),function sB(e,t){const n=(i,l)=>{t.valueAccessor.writeValue(i),l&&t.viewToModelUpdate(i)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function oB(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&dS(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function rB(e,t){if(t.valueAccessor.setDisabledState){const n=i=>{t.valueAccessor.setDisabledState(i)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Wv(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function dS(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function gS(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function _S(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const fB={provide:rd,useExisting:dn(()=>R1)},bS=(()=>Promise.resolve(null))();let R1=(()=>{class e extends rd{constructor(n,i,l,p,y){super(),this._changeDetectorRef=y,this.control=new class extends class hS{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=n,this._composedValidatorFn=aS(this._rawValidators),this._composedAsyncValidatorFn=lS(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===t_}get invalid(){return this.status===Gv}get pending(){return this.status==Yf}get disabled(){return this.status===n_}get enabled(){return this.status!==n_}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=aS(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=lS(t)}addValidators(t){this.setValidators(tS(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(tS(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(nS(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(nS(t,this._rawAsyncValidators))}hasValidator(t){return jv(this._rawValidators,t)}hasAsyncValidator(t){return jv(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Yf,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=n_,this.errors=null,this._forEachChild(i=>{i.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=t_,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===t_||this.status===Yf)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?n_:t_}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Yf,this._hasOwnPendingAsyncValidator=!0;const n=qD(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((i,l)=>i&&i._find(l),this)}getError(t,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new qr,this.statusChanges=new qr}_calculateStatus(){return this._allControlsDisabled()?n_:this.errors?Gv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Yf)?Yf:this._anyControlsHaveStatus(Gv)?Gv:t_}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Hv(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}{constructor(t=null,n,i){super(function D1(e){return(Hv(e)?e.validators:e)||null}(n),function S1(e,t){return(Hv(t)?t.asyncValidators:e)||null}(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Hv(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=_S(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){gS(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){gS(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){_S(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},this._registered=!1,this.update=new qr,this._parent=n,this._setValidators(i),this._setAsyncValidators(l),this.valueAccessor=function k1(e,t){if(!t)return null;let n,i,l;return Array.isArray(t),t.forEach(p=>{p.constructor===Vv?n=p:function cB(e){return Object.getPrototypeOf(e.constructor)===vp}(p)?i=p:l=p}),l||i||n||null}(0,p)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function P1(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){r_(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){bS.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const i=n.isDisabled.currentValue,l=0!==i&&function Du(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}(i);bS.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?function qv(e,t){return[...t.path,e]}(n,this._parent):[n]}}return e.\u0275fac=function(n){return new(n||e)(tt(gs,9),tt(ts,10),tt(nd,10),tt(gc,10),tt(Jy,8))},e.\u0275dir=un({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[_i([fB]),Ur,li]}),e})(),CS=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({}),e})(),NB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({imports:[CS]}),e})(),VB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({imports:[NB]}),e})();function $B(e,t){if(1&e){const n=Zh();xt(0,"img",28),nr("click",function(){qs(n);const l=ti();return Zo(l.slide=l.slide-1)}),Dt()}}function GB(e,t){if(1&e){const n=Zh();xt(0,"button",9),nr("click",function(){qs(n);const l=ti();return Zo(l.slide=l.slide+1)}),wn(1,"next"),Dt()}}function HB(e,t){if(1&e){const n=Zh();xt(0,"div",8)(1,"button",9),nr("click",function(){qs(n);const l=ti();return Zo(l.slide=l.slide+1)}),wn(2,"next"),Dt()()}}function qB(e,t){1&e&&Ln(0,"iframe",29),2&e&&Rn("src",ti().iframeSrc,wm)}function ZB(e,t){if(1&e&&(Rf(0),Ln(1,"div",30)(2,"div",30)(3,"div",30)(4,"div",30),Lf()),2&e){const n=ti();Vt(1),bo("active",1==n.slide),Vt(1),bo("active",2==n.slide),Vt(1),bo("active",3==n.slide),Vt(1),bo("active",4==n.slide)}}let WB=(()=>{class e{constructor(n,i,l){this.sanitizer=n,this.mapSelector=i,this.airtable=l,this.close=new qr,this.marked=_n,this.contributeMessage="",this.slide=0,this.contentType="",this.iframeURL=null,this.subscription=null}ngOnInit(){this.api.ready.pipe(Co()).subscribe(()=>{this.contributeMessage=this.sanitizer.bypassSecurityTrustHtml(_n(this.api.CONTRIBUTE_MESSAGE))}),this.nonce=""+Math.floor(1e9*Math.random())}selectCT(n){this.contentType=n,this.slide+=1}get iframeSrc(){if(!this.selectedDate||!this.contentType||!this.selectedGeo)return null;const n=encodeURIComponent(this.selectedGeo),i=`https://airtable.com/embed/shr5JqYQkSnwWVOqX?prefill_type=${this.contentType}&hide_type=true&prefill_post_timestamp=${this.selectedDate}T00:00:00.000&hide_post_timestamp=true&prefill_geo=${n}&hide_geo=true&prefill_nonce=${this.nonce}&hide_nonce=true`;return this.iframeURL||this.initPolling(),this.iframeURL!==i&&(this.iframeURL=i,this.iframeSafeURL=this.sanitizer.bypassSecurityTrustResourceUrl(i)),this.iframeSafeURL}openMap(){this.mapSelector.showMapSelector=!0,this.mapSelector.results.pipe(Co()).subscribe(n=>{console.log("GOT GEO",n),n&&(this.selectedGeo=n)})}closeMe(){this.subscription?.unsubscribe(),this.subscription=null,this.close.emit()}initPolling(){this.subscription=function jz(e=0,t=g1){return e<0&&(e=0),_1(e,e,t)}(5e3).pipe(pc(()=>this.airtable.airtableFetch(rD,this.airtable.CONTENT_TABLE,"incoming")),this.airtable.airtableToArray()).subscribe(n=>{n.forEach(i=>{i.nonce===this.nonce&&(this.subscription?.unsubscribe(),this.subscription=null,this.slide=5)})})}}return e.\u0275fac=function(n){return new(n||e)(tt(gv),tt(m1),tt(_D))},e.\u0275cmp=Yr({type:e,selectors:[["app-add-new-bar"]],inputs:{api:"api"},outputs:{close:"close"},decls:91,vars:32,consts:[[1,"controls"],[1,"control"],["src","assets/img/button-back.svg",3,"click",4,"ngIf"],["src","assets/img/button-close.svg",3,"click"],[1,"slides"],[1,"slide"],[1,"header"],[3,"innerHtml"],[1,"bottom"],[3,"click"],[1,"content-types"],[1,"content-type",3,"click"],[1,"icon"],["src","assets/img/icon-audio-clip.svg"],[1,"name"],["src","assets/img/icon-twitter.svg"],["src","assets/img/icon-instagram.svg"],["src","assets/img/icon-youtube.svg"],["src","assets/img/icon-wikipedia.svg"],["src","assets/img/icon-image.svg"],[1,"center"],["src","assets/img/icon-pin.svg"],[3,"click",4,"ngIf"],["type","date","placeholder","pick the date",1,"date-selector",3,"ngModel","ngModelChange"],["class","bottom",4,"ngIf"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src",4,"ngIf"],[1,"progress"],[4,"ngIf"],["src","assets/img/button-back.svg",3,"click"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src"],[1,"progress-item"]],template:function(n,i){1&n&&(xt(0,"div",0)(1,"div",1),si(2,$B,1,0,"img",2),Dt(),xt(3,"div",1)(4,"img",3),nr("click",function(){return i.closeMe()}),Dt()()(),xt(5,"div",4)(6,"div",5)(7,"div",6)(8,"h1"),wn(9,"Be a part of this story"),Dt(),xt(10,"h2"),wn(11,"what other aspect of the past, present or future would you like to add to this timeline?"),Dt()(),Ln(12,"p",7),xt(13,"div",8)(14,"button",9),nr("click",function(){return i.slide=i.slide+1}),wn(15,"Add a moment"),Dt()()(),xt(16,"div",5)(17,"div",6)(18,"h1"),wn(19,"what?"),Dt(),xt(20,"h2"),wn(21,"What format would you choose for your contribution to the timeline?"),Dt()(),xt(22,"div",10)(23,"div",11),nr("click",function(){return i.selectCT("audio")}),xt(24,"div",12),Ln(25,"img",13),Dt(),xt(26,"div",14),wn(27,"Audio clip"),Dt()(),xt(28,"div",11),nr("click",function(){return i.selectCT("twitter")}),xt(29,"div",12),Ln(30,"img",15),Dt(),xt(31,"div",14),wn(32,"Twitter post"),Dt()(),xt(33,"div",11),nr("click",function(){return i.selectCT("instagram")}),xt(34,"div",12),Ln(35,"img",16),Dt(),xt(36,"div",14),wn(37,"Instagram post"),Dt()(),xt(38,"div",11),nr("click",function(){return i.selectCT("video")}),xt(39,"div",12),Ln(40,"img",17),Dt(),xt(41,"div",14),wn(42,"Youtube video"),Dt()(),xt(43,"div",11),nr("click",function(){return i.selectCT("wikipedia")}),xt(44,"div",12),Ln(45,"img",18),Dt(),xt(46,"div",14),wn(47,"Wikipedia article"),Dt()(),xt(48,"div",11),nr("click",function(){return i.selectCT("image")}),xt(49,"div",12),Ln(50,"img",19),Dt(),xt(51,"div",14),wn(52,"Image"),Dt()()()(),xt(53,"div",5)(54,"div",6)(55,"h1"),wn(56,"Where?"),Dt(),xt(57,"h2"),wn(58,"Position the camera on your location of choice"),Dt()(),xt(59,"div",20)(60,"button",9),nr("click",function(){return i.openMap()}),Ln(61,"img",21),wn(62,"Choose from the map"),Dt()(),xt(63,"div",8),si(64,GB,2,0,"button",22),Dt()(),xt(65,"div",5)(66,"div",6)(67,"h1"),wn(68,"When?"),Dt(),xt(69,"h2"),wn(70,"The exact year is less important than the order of events"),Dt()(),xt(71,"input",23),nr("ngModelChange",function(p){return i.selectedDate=p}),Dt(),si(72,HB,3,0,"div",24),Dt(),xt(73,"div",5)(74,"div",6)(75,"h1"),wn(76,"Add The Details"),Dt(),xt(77,"h2"),wn(78),Dt()(),si(79,qB,1,1,"iframe",25),Dt(),xt(80,"div",5)(81,"div",6)(82,"h1"),wn(83,"Thank you!"),Dt(),xt(84,"h2"),wn(85,"We will review your contribution and email you if it is added to the timeline"),Dt()(),xt(86,"div",8)(87,"button",9),nr("click",function(){return i.closeMe()}),wn(88,"close"),Dt()()()(),xt(89,"div",26),si(90,ZB,5,8,"ng-container",27),Dt()),2&n&&(Vt(2),Rn("ngIf",i.slide>0&&i.slide<5),Vt(4),bo("pre",i.slide<0)("post",i.slide>0),Vt(6),Rn("innerHtml",i.contributeMessage,Nd),Vt(4),bo("pre",i.slide<1)("post",i.slide>1),Vt(37),bo("pre",i.slide<2)("post",i.slide>2),Vt(11),Rn("ngIf",i.selectedGeo),Vt(1),bo("pre",i.slide<3)("post",i.slide>3),Vt(6),Rn("ngModel",i.selectedDate),Vt(1),Rn("ngIf",!!i.selectedDate),Vt(1),bo("pre",i.slide<4)("post",i.slide>4),Vt(5),bu("Now that we know time and space, let\u2019s add the details of your ",i.contentType,""),Vt(1),Rn("ngIf",i.iframeSrc),Vt(1),bo("pre",i.slide<5)("post",i.slide>5),Vt(10),Rn("ngIf",i.slide>0&&i.slide<5))},dependencies:[Yh,Vv,oS,R1],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;background:white;position:relative;z-index:2;overflow:hidden}@media only screen and (min-width: 601px){[_nghost-%COMP%]{max-width:360px;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:10px 24px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{color:#00a881;font-weight:500}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;justify-content:space-between;align-items:center}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]{height:100%;overflow:hidden;flex:1 1 auto;position:relative}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]{display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;width:100%;height:100%;transform:translate(0);transition:transform .25s linear;position:absolute;top:0;left:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.pre[_ngcontent-%COMP%]{transform:translate(100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.post[_ngcontent-%COMP%]{transform:translate(-100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;justify-content:flex-start;gap:4px;padding-top:16px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:700;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#333;margin:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:15px;line-height:21px;letter-spacing:-.01em;color:#333;padding-bottom:8px;border-bottom:.5px solid #333333;margin-bottom:32px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]     p{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;line-height:23px;letter-spacing:.01em;color:#333}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;width:100%;margin-top:auto}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:12px;padding:8px 24px;height:40px;background:rgba(255,255,255,.5);border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;justify-content:flex-start;gap:8px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-start;gap:16px;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:48px;height:48px;overflow:auto;border-radius:24px;border:1px solid rgba(252,13,28,.25);display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px;object-fit:contain}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:23px;color:#ce0031}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .date-selector[_ngcontent-%COMP%]{border:1px solid rgba(252,13,28,.25);height:48px;padding-left:44px;padding-right:16px;border-radius:4px;color:#ce0031;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;letter-spacing:.02em;text-transform:uppercase;background-image:url(icon-calendar.37810a4105ea3292.svg);background-repeat:no-repeat;background-position:12px center}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:16px;height:7px;display:flex;flex-flow:row;align-items:stretch;justify-content:stretch;gap:8px}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-item[_ngcontent-%COMP%]{flex:1 1 auto;height:100%;border-radius:2px;background:#E0E0E0;transition:background .25s linear}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-item.active[_ngcontent-%COMP%]{background:#CE0031}']}),e})();const XB=["mapEl"];function YB(e,t){if(1&e&&Ln(0,"app-content-placeholder",11),2&e){const n=ti().$implicit;Rn("item",n),Os("data-year","Y"+n.year)}}function KB(e,t){if(1&e){const n=Zh();xt(0,"app-content",12),nr("mapView",function(l){return qs(n),Zo(ti(2).changeMapView(l))}),Dt()}if(2&e){const n=ti().$implicit,i=ti();Rn("active",n.year===i.activeYear)("item",n),Os("data-year","Y"+n.year)}}function JB(e,t){if(1&e&&(Rf(0),si(1,YB,1,2,"app-content-placeholder",9),si(2,KB,1,3,"app-content",10),Lf()),2&e){const n=t.$implicit;Vt(1),Rn("ngIf",!n.hasContent),Vt(1),Rn("ngIf",n.hasContent)}}function QB(e,t){if(1&e){const n=Zh();xt(0,"app-add-new-bar",13),nr("close",function(){return qs(n),Zo(ti().addNew=!1)}),Dt()}if(2&e){const n=ti();bo("open",n.addNewOpen),Rn("api",n.api)}}let eN=(()=>{class e{constructor(n,i){this.activatedRoute=n,this.mapSvc=i,this.timeline=[],this.mapViews=new Jg(1),this._info=!1,this._addNew=!1,this.addNewOpen=!1,this.activeYear=-1}get info(){return this._info}set info(n){console.log("INFO=",n),this._addNew=!1,this._info=n,localStorage.setItem(this.id,"opened")}get addNew(){return this._addNew}set addNew(n){this._info=!1,this._addNew=n,_1(0).subscribe(()=>{this.addNewOpen=n})}ngOnInit(){this._info="opened"!==localStorage.getItem(this.id),this.api.data.pipe(pc(n=>(this.timeline=n,this.activatedRoute.fragment)),Co(),function NF(e,t=g1){const n=_1(e,t);return yD(()=>n)}(1e3)).subscribe(n=>{this.activeYear=this.api.YEAR_CURRENT,n&&(this.activeYear=parseInt(n.slice(1)),this.activeYear||(this.activeYear=this.api.YEAR_CURRENT)),n="Y"+this.activeYear;const i=document.querySelector(`[data-year=${n}]`);i&&i.scrollIntoView({block:"center",behavior:"auto"})}),this.theMap=new Wf.Map({container:this.mapEl.nativeElement,style:iD,minZoom:3}),this.theMap.on("style.load",()=>{Ov([this.api.fetchMapData(),this.api.data]).subscribe(([n,i])=>{i.forEach(l=>{if(l.hasContent){if(l.map_view&&l.map_view.length>0)return;l.map_view=[l.title],n[l.title]=l}}),this.mapViews.next(n)})})}changeMapView(n){this.mapViews.pipe(Co()).subscribe(i=>{const l=i[n],p=this.mapSvc.parseMapView(l);for(const y of l.onLayers||[])this.theMap.getLayer(y)&&this.theMap.setLayoutProperty(y,"visibility","visible");for(const y of l.offLayers||[])this.theMap.getLayer(y)&&this.theMap.setLayoutProperty(y,"visibility","none");this.theMap.flyTo(p)})}}return e.\u0275fac=function(n){return new(n||e)(tt(gp),tt(vD))},e.\u0275cmp=Yr({type:e,selectors:[["app-timeline-map"]],viewQuery:function(n,i){if(1&n&&dp(XB,7),2&n){let l;Eu(l=Mu())&&(i.mapEl=l.first)}},inputs:{id:"id",title:"title",subtitle:"subtitle",infobarTitle:"infobarTitle",infobarSubtitle:"infobarSubtitle",api:"api"},decls:14,vars:9,consts:[[3,"info","addNew"],[1,"content"],[1,"map"],["mapEl",""],[1,"timeline"],[4,"ngFor","ngForOf"],[3,"api","title","subtitle","close"],[3,"open","api","close",4,"ngIf"],[1,"header-title"],[3,"item",4,"ngIf"],[3,"active","item","mapView",4,"ngIf"],[3,"item"],[3,"active","item","mapView"],[3,"api","close"]],template:function(n,i){1&n&&(xt(0,"app-layout",0),nr("info",function(p){return i.info=p})("addNew",function(p){return i.addNew=p}),xt(1,"div",1)(2,"div",2),Ln(3,"div",null,3),Dt(),xt(5,"div",4),si(6,JB,3,2,"ng-container",5),Dt(),xt(7,"app-infobar",6),nr("close",function(){return i.info=!1}),Dt(),si(8,QB,1,3,"app-add-new-bar",7),Dt(),xt(9,"div",8)(10,"h2"),wn(11),Dt(),xt(12,"h1"),wn(13),Dt()()()),2&n&&(Vt(6),Rn("ngForOf",i.timeline),Vt(1),bo("open",i.info),Rn("api",i.api)("title",i.infobarTitle)("subtitle",i.infobarSubtitle),Vt(1),Rn("ngIf",i.addNew),Vt(3),wo(i.subtitle),Vt(2),wo(i.title))},dependencies:[yM,Yh,jF,sz,Vz,Uz,WB],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:row}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;z-index:10}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%]{transition-property:transform margin-left;transition-duration:.5s;z-index:20}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%]{top:0;height:100%;transform:translate(100%);width:360px;margin:0 4px 0 -354px;flex:0 0 auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%]{margin-left:4px;transform:translate(0)}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:100%;height:auto;transform:translateY(100%)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%]{transform:translateY(0)}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%]{min-height:80vh}']}),e})();var tN=Fe(545);const nN=["mapEl"];let rN=(()=>{class e{constructor(n,i){this.mapSvc=n,this.mapSelector=i}ngOnInit(){this.theMap=new Wf.Map({container:this.mapEl.nativeElement,style:iD,minZoom:3});var n=new tN({accessToken:Wf.accessToken});this.theMap.addControl(n),this.theMap.addControl(new Wf.NavigationControl({visualizePitch:!0}))}submit(){const n=this.theMap.getCenter(),i=`center: { lon: ${n.lng}, lat: ${n.lat} },\n    zoom: ${this.theMap.getZoom()},\n    pitch: ${this.theMap.getPitch()},\n    bearing: ${this.theMap.getBearing()}`;this.mapSelector.submitResult(i)}cancel(){this.mapSelector.submitResult(null)}}return e.\u0275fac=function(n){return new(n||e)(tt(vD),tt(m1))},e.\u0275cmp=Yr({type:e,selectors:[["app-map-selector"]],viewQuery:function(n,i){if(1&n&&dp(nN,7),2&n){let l;Eu(l=Mu())&&(i.mapEl=l.first)}},decls:8,vars:0,consts:[[1,"map"],["mapEl",""],[1,"controls"],[3,"click"]],template:function(n,i){1&n&&(xt(0,"div",0),Ln(1,"div",null,1),Dt(),xt(3,"div",2)(4,"button",3),nr("click",function(){return i.cancel()}),wn(5,"cancel"),Dt(),xt(6,"button",3),nr("click",function(){return i.submit()}),wn(7,"select"),Dt()())},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;z-index:10;display:flex;flex-flow:row;align-items:center;gap:32px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:8px 24px;height:40px;background:rgba(255,255,255,.5);border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{color:#333;border-color:#333}']}),e})();function iN(e,t){if(1&e&&Ln(0,"app-timeline-map",2),2&e){const n=ti();Rn("api",n.timelineService)("title",n.title)("subtitle",n.subtitle)("infobarTitle",n.infobarTitle)("infobarSubtitle",n.infobarSubtitle)}}function oN(e,t){1&e&&Ln(0,"app-map-selector")}const sN=[{path:"",component:(()=>{class e{constructor(n,i,l){this.api=n,this.titleSvc=i,this.mapSelector=l,this.title=null}ngOnInit(){this.timelineService=new yF(this.api,rD),this.timelineService.ready.pipe(Co()).subscribe(()=>{this.title=this.timelineService.TITLE||"",this.titleSvc.setTitle(this.title),this.subtitle=this.timelineService.SUBTITLE||"",this.infobarTitle=this.timelineService.INFOBAR_TITLE||"",this.infobarSubtitle=this.timelineService.INFOBAR_SUBTITLE||""}),this.timelineService.fetchData().subscribe(()=>{console.log("fetchData")})}}return e.\u0275fac=function(n){return new(n||e)(tt(_D),tt(kb),tt(m1))},e.\u0275cmp=Yr({type:e,selectors:[["app-spectours"]],decls:2,vars:2,consts:[["id","Speculatron",3,"api","title","subtitle","infobarTitle","infobarSubtitle",4,"ngIf"],[4,"ngIf"],["id","Speculatron",3,"api","title","subtitle","infobarTitle","infobarSubtitle"]],template:function(n,i){1&n&&(si(0,iN,1,5,"app-timeline-map",0),si(1,oN,1,0,"app-map-selector",1)),2&n&&(Rn("ngIf",i.title),Vt(1),Rn("ngIf",i.mapSelector.showMapSelector))},dependencies:[Yh,eN,rN],styles:["app-map-selector[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;z-index:20;background-color:#fff}"]}),e})()}];let aN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e}),e.\u0275inj=xi({imports:[eD.forRoot(sN),eD]}),e})(),lN=(()=>{class e{constructor(){const n=new _n.Renderer,i=n.link;n.link=(l,p,y)=>{const w=l.startsWith(`${location.protocol}//${location.hostname}`),M=i.call(n,l,p,y);return w?M:M.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},_n.use({renderer:n})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Yr({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,i){1&n&&Ln(0,"router-outlet")},dependencies:[Xb]}),e})(),cN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qo({type:e,bootstrap:[lN]}),e.\u0275inj=xi({imports:[FO,kF,VB,aN]}),e})();(function bP(){qE=!1})(),LO().bootstrapModule(cN).catch(e=>console.error(e))},49:function(At,Et,Fe){var Ue;At=Fe.nmd(At),function(Ne){"object"==typeof global&&global;var Me=function(ft){this.message=ft};(Me.prototype=new Error).name="InvalidCharacterError";var Ce=function(ft){throw new Me(ft)},ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Te=/[\t\n\f\r ]/g,Xe={encode:function(ft){ft=String(ft),/[^\0-\xFF]/.test(ft)&&Ce("The string to be encoded contains characters outside of the Latin1 range.");for(var Ve,Oe,ve,Je,dt=ft.length%3,le="",ze=-1,je=ft.length-dt;++ze<je;)Ve=ft.charCodeAt(ze)<<16,Oe=ft.charCodeAt(++ze)<<8,ve=ft.charCodeAt(++ze),le+=ce.charAt((Je=Ve+Oe+ve)>>18&63)+ce.charAt(Je>>12&63)+ce.charAt(Je>>6&63)+ce.charAt(63&Je);return 2==dt?(Ve=ft.charCodeAt(ze)<<8,Oe=ft.charCodeAt(++ze),le+=ce.charAt((Je=Ve+Oe)>>10)+ce.charAt(Je>>4&63)+ce.charAt(Je<<2&63)+"="):1==dt&&(Je=ft.charCodeAt(ze),le+=ce.charAt(Je>>2)+ce.charAt(Je<<4&63)+"=="),le},decode:function(ft){var dt=(ft=String(ft).replace(Te,"")).length;dt%4==0&&(dt=(ft=ft.replace(/==?$/,"")).length),(dt%4==1||/[^+a-zA-Z0-9/]/.test(ft))&&Ce("Invalid character: the string to be decoded is not correctly encoded.");for(var ze,Ve,le=0,Oe="",ve=-1;++ve<dt;)Ve=ce.indexOf(ft.charAt(ve)),ze=le%4?64*ze+Ve:Ve,le++%4&&(Oe+=String.fromCharCode(255&ze>>(-2*le&6)));return Oe},version:"0.1.0"};void 0!==(Ue=function(){return Xe}.call(Et,Fe,Et,At))&&(At.exports=Ue)}()},764:function(At){At.exports=function(){"use strict";var Ne="millisecond",xe="second",h="minute",H="hour",Me="day",Ce="week",ce="month",Te="quarter",rt="year",Ft="date",Xe="Invalid Date",yt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ft=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,dt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},le=function(jt,wt,Mt){var Yt=String(jt);return!Yt||Yt.length>=wt?jt:""+Array(wt+1-Yt.length).join(Mt)+jt},ze={s:le,z:function(jt){var wt=-jt.utcOffset(),Mt=Math.abs(wt),Yt=Math.floor(Mt/60),St=Mt%60;return(wt<=0?"+":"-")+le(Yt,2,"0")+":"+le(St,2,"0")},m:function jt(wt,Mt){if(wt.date()<Mt.date())return-jt(Mt,wt);var Yt=12*(Mt.year()-wt.year())+(Mt.month()-wt.month()),St=wt.clone().add(Yt,ce),on=Mt-St<0,an=wt.clone().add(Yt+(on?-1:1),ce);return+(-(Yt+(Mt-St)/(on?St-an:an-St))||0)},a:function(jt){return jt<0?Math.ceil(jt)||0:Math.floor(jt)},p:function(jt){return{M:ce,y:rt,w:Ce,d:Me,D:Ft,h:H,m:h,s:xe,ms:Ne,Q:Te}[jt]||String(jt||"").toLowerCase().replace(/s$/,"")},u:function(jt){return void 0===jt}},Ve="en",Oe={};Oe[Ve]=dt;var ve=function(jt){return jt instanceof Pt},He=function jt(wt,Mt,Yt){var St;if(!wt)return Ve;if("string"==typeof wt){var on=wt.toLowerCase();Oe[on]&&(St=on),Mt&&(Oe[on]=Mt,St=on);var an=wt.split("-");if(!St&&an.length>1)return jt(an[0])}else{var qt=wt.name;Oe[qt]=wt,St=qt}return!Yt&&St&&(Ve=St),St||!Yt&&Ve},Je=function(jt,wt){if(ve(jt))return jt.clone();var Mt="object"==typeof wt?wt:{};return Mt.date=jt,Mt.args=arguments,new Pt(Mt)},je=ze;je.l=He,je.i=ve,je.w=function(jt,wt){return Je(jt,{locale:wt.$L,utc:wt.$u,x:wt.$x,$offset:wt.$offset})};var Pt=function(){function jt(Mt){this.$L=He(Mt.locale,null,!0),this.parse(Mt)}var wt=jt.prototype;return wt.parse=function(Mt){this.$d=function(Yt){var St=Yt.date,on=Yt.utc;if(null===St)return new Date(NaN);if(je.u(St))return new Date;if(St instanceof Date)return new Date(St);if("string"==typeof St&&!/Z$/i.test(St)){var an=St.match(yt);if(an){var qt=an[2]-1||0,xr=(an[7]||"0").substring(0,3);return on?new Date(Date.UTC(an[1],qt,an[3]||1,an[4]||0,an[5]||0,an[6]||0,xr)):new Date(an[1],qt,an[3]||1,an[4]||0,an[5]||0,an[6]||0,xr)}}return new Date(St)}(Mt),this.$x=Mt.x||{},this.init()},wt.init=function(){var Mt=this.$d;this.$y=Mt.getFullYear(),this.$M=Mt.getMonth(),this.$D=Mt.getDate(),this.$W=Mt.getDay(),this.$H=Mt.getHours(),this.$m=Mt.getMinutes(),this.$s=Mt.getSeconds(),this.$ms=Mt.getMilliseconds()},wt.$utils=function(){return je},wt.isValid=function(){return this.$d.toString()!==Xe},wt.isSame=function(Mt,Yt){var St=Je(Mt);return this.startOf(Yt)<=St&&St<=this.endOf(Yt)},wt.isAfter=function(Mt,Yt){return Je(Mt)<this.startOf(Yt)},wt.isBefore=function(Mt,Yt){return this.endOf(Yt)<Je(Mt)},wt.$g=function(Mt,Yt,St){return je.u(Mt)?this[Yt]:this.set(St,Mt)},wt.unix=function(){return Math.floor(this.valueOf()/1e3)},wt.valueOf=function(){return this.$d.getTime()},wt.startOf=function(Mt,Yt){var St=this,on=!!je.u(Yt)||Yt,an=je.p(Mt),qt=function(Yn,en){var Tr=je.w(St.$u?Date.UTC(St.$y,en,Yn):new Date(St.$y,en,Yn),St);return on?Tr:Tr.endOf(Me)},xr=function(Yn,en){return je.w(St.toDate()[Yn].apply(St.toDate("s"),(on?[0,0,0,0]:[23,59,59,999]).slice(en)),St)},vn=this.$W,Xn=this.$M,Zr=this.$D,$n="set"+(this.$u?"UTC":"");switch(an){case rt:return on?qt(1,0):qt(31,11);case ce:return on?qt(1,Xn):qt(0,Xn+1);case Ce:var Di=this.$locale().weekStart||0,Si=(vn<Di?vn+7:vn)-Di;return qt(on?Zr-Si:Zr+(6-Si),Xn);case Me:case Ft:return xr($n+"Hours",0);case H:return xr($n+"Minutes",1);case h:return xr($n+"Seconds",2);case xe:return xr($n+"Milliseconds",3);default:return this.clone()}},wt.endOf=function(Mt){return this.startOf(Mt,!1)},wt.$set=function(Mt,Yt){var St,on=je.p(Mt),an="set"+(this.$u?"UTC":""),qt=(St={},St[Me]=an+"Date",St[Ft]=an+"Date",St[ce]=an+"Month",St[rt]=an+"FullYear",St[H]=an+"Hours",St[h]=an+"Minutes",St[xe]=an+"Seconds",St[Ne]=an+"Milliseconds",St)[on],xr=on===Me?this.$D+(Yt-this.$W):Yt;if(on===ce||on===rt){var vn=this.clone().set(Ft,1);vn.$d[qt](xr),vn.init(),this.$d=vn.set(Ft,Math.min(this.$D,vn.daysInMonth())).$d}else qt&&this.$d[qt](xr);return this.init(),this},wt.set=function(Mt,Yt){return this.clone().$set(Mt,Yt)},wt.get=function(Mt){return this[je.p(Mt)]()},wt.add=function(Mt,Yt){var St,on=this;Mt=Number(Mt);var an=je.p(Yt),qt=function(Xn){var Zr=Je(on);return je.w(Zr.date(Zr.date()+Math.round(Xn*Mt)),on)};if(an===ce)return this.set(ce,this.$M+Mt);if(an===rt)return this.set(rt,this.$y+Mt);if(an===Me)return qt(1);if(an===Ce)return qt(7);var xr=(St={},St[h]=6e4,St[H]=36e5,St[xe]=1e3,St)[an]||1,vn=this.$d.getTime()+Mt*xr;return je.w(vn,this)},wt.subtract=function(Mt,Yt){return this.add(-1*Mt,Yt)},wt.format=function(Mt){var Yt=this,St=this.$locale();if(!this.isValid())return St.invalidDate||Xe;var on=Mt||"YYYY-MM-DDTHH:mm:ssZ",an=je.z(this),qt=this.$H,xr=this.$m,vn=this.$M,Xn=St.weekdays,Zr=St.months,$n=function(en,Tr,hn,Ri){return en&&(en[Tr]||en(Yt,on))||hn[Tr].slice(0,Ri)},Di=function(en){return je.s(qt%12||12,en,"0")},Si=St.meridiem||function(en,Tr,hn){var Ri=en<12?"AM":"PM";return hn?Ri.toLowerCase():Ri},Yn={YY:String(this.$y).slice(-2),YYYY:this.$y,M:vn+1,MM:je.s(vn+1,2,"0"),MMM:$n(St.monthsShort,vn,Zr,3),MMMM:$n(Zr,vn),D:this.$D,DD:je.s(this.$D,2,"0"),d:String(this.$W),dd:$n(St.weekdaysMin,this.$W,Xn,2),ddd:$n(St.weekdaysShort,this.$W,Xn,3),dddd:Xn[this.$W],H:String(qt),HH:je.s(qt,2,"0"),h:Di(1),hh:Di(2),a:Si(qt,xr,!0),A:Si(qt,xr,!1),m:String(xr),mm:je.s(xr,2,"0"),s:String(this.$s),ss:je.s(this.$s,2,"0"),SSS:je.s(this.$ms,3,"0"),Z:an};return on.replace(ft,function(en,Tr){return Tr||Yn[en]||an.replace(":","")})},wt.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},wt.diff=function(Mt,Yt,St){var on,an=je.p(Yt),qt=Je(Mt),xr=6e4*(qt.utcOffset()-this.utcOffset()),vn=this-qt,Xn=je.m(this,qt);return Xn=(on={},on[rt]=Xn/12,on[ce]=Xn,on[Te]=Xn/3,on[Ce]=(vn-xr)/6048e5,on[Me]=(vn-xr)/864e5,on[H]=vn/36e5,on[h]=vn/6e4,on[xe]=vn/1e3,on)[an]||vn,St?Xn:je.a(Xn)},wt.daysInMonth=function(){return this.endOf(ce).$D},wt.$locale=function(){return Oe[this.$L]},wt.locale=function(Mt,Yt){if(!Mt)return this.$L;var St=this.clone(),on=He(Mt,Yt,!0);return on&&(St.$L=on),St},wt.clone=function(){return je.w(this.$d,this)},wt.toDate=function(){return new Date(this.valueOf())},wt.toJSON=function(){return this.isValid()?this.toISOString():null},wt.toISOString=function(){return this.$d.toISOString()},wt.toString=function(){return this.$d.toUTCString()},jt}(),Xt=Pt.prototype;return Je.prototype=Xt,[["$ms",Ne],["$s",xe],["$m",h],["$H",H],["$W",Me],["$M",ce],["$y",rt],["$D",Ft]].forEach(function(jt){Xt[jt[1]]=function(wt){return this.$g(wt,jt[0],jt[1])}}),Je.extend=function(jt,wt){return jt.$i||(jt(wt,Pt,Je),jt.$i=!0),Je},Je.locale=He,Je.isDayjs=ve,Je.unix=function(jt){return Je(1e3*jt)},Je.en=Oe[Ve],Je.Ls=Oe,Je.p={},Je}()},69:At=>{"use strict";var Ue,Et="object"==typeof Reflect?Reflect:null,Fe=Et&&"function"==typeof Et.apply?Et.apply:function(ve,He,Je){return Function.prototype.apply.call(ve,He,Je)};Ue=Et&&"function"==typeof Et.ownKeys?Et.ownKeys:Object.getOwnPropertySymbols?function(ve){return Object.getOwnPropertyNames(ve).concat(Object.getOwnPropertySymbols(ve))}:function(ve){return Object.getOwnPropertyNames(ve)};var xe=Number.isNaN||function(ve){return ve!=ve};function h(){h.init.call(this)}At.exports=h,At.exports.once=function le(Oe,ve){return new Promise(function(He,Je){function je(Xt){Oe.removeListener(ve,Pt),Je(Xt)}function Pt(){"function"==typeof Oe.removeListener&&Oe.removeListener("error",je),He([].slice.call(arguments))}Ve(Oe,ve,Pt,{once:!0}),"error"!==ve&&function ze(Oe,ve,He){"function"==typeof Oe.on&&Ve(Oe,"error",ve,He)}(Oe,je,{once:!0})})},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var H=10;function Me(Oe){if("function"!=typeof Oe)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Oe)}function Ce(Oe){return void 0===Oe._maxListeners?h.defaultMaxListeners:Oe._maxListeners}function ce(Oe,ve,He,Je){var je,Pt,Xt;if(Me(He),void 0===(Pt=Oe._events)?(Pt=Oe._events=Object.create(null),Oe._eventsCount=0):(void 0!==Pt.newListener&&(Oe.emit("newListener",ve,He.listener?He.listener:He),Pt=Oe._events),Xt=Pt[ve]),void 0===Xt)Xt=Pt[ve]=He,++Oe._eventsCount;else if("function"==typeof Xt?Xt=Pt[ve]=Je?[He,Xt]:[Xt,He]:Je?Xt.unshift(He):Xt.push(He),(je=Ce(Oe))>0&&Xt.length>je&&!Xt.warned){Xt.warned=!0;var jt=new Error("Possible EventEmitter memory leak detected. "+Xt.length+" "+String(ve)+" listeners added. Use emitter.setMaxListeners() to increase limit");jt.name="MaxListenersExceededWarning",jt.emitter=Oe,jt.type=ve,jt.count=Xt.length,function Ne(Oe){console&&console.warn&&console.warn(Oe)}(jt)}return Oe}function Te(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function rt(Oe,ve,He){var Je={fired:!1,wrapFn:void 0,target:Oe,type:ve,listener:He},je=Te.bind(Je);return je.listener=He,Je.wrapFn=je,je}function Ft(Oe,ve,He){var Je=Oe._events;if(void 0===Je)return[];var je=Je[ve];return void 0===je?[]:"function"==typeof je?He?[je.listener||je]:[je]:He?function dt(Oe){for(var ve=new Array(Oe.length),He=0;He<ve.length;++He)ve[He]=Oe[He].listener||Oe[He];return ve}(je):yt(je,je.length)}function Xe(Oe){var ve=this._events;if(void 0!==ve){var He=ve[Oe];if("function"==typeof He)return 1;if(void 0!==He)return He.length}return 0}function yt(Oe,ve){for(var He=new Array(ve),Je=0;Je<ve;++Je)He[Je]=Oe[Je];return He}function Ve(Oe,ve,He,Je){if("function"==typeof Oe.on)Je.once?Oe.once(ve,He):Oe.on(ve,He);else{if("function"!=typeof Oe.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Oe);Oe.addEventListener(ve,function je(Pt){Je.once&&Oe.removeEventListener(ve,je),He(Pt)})}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return H},set:function(Oe){if("number"!=typeof Oe||Oe<0||xe(Oe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Oe+".");H=Oe}}),h.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(ve){if("number"!=typeof ve||ve<0||xe(ve))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ve+".");return this._maxListeners=ve,this},h.prototype.getMaxListeners=function(){return Ce(this)},h.prototype.emit=function(ve){for(var He=[],Je=1;Je<arguments.length;Je++)He.push(arguments[Je]);var je="error"===ve,Pt=this._events;if(void 0!==Pt)je=je&&void 0===Pt.error;else if(!je)return!1;if(je){var Xt;if(He.length>0&&(Xt=He[0]),Xt instanceof Error)throw Xt;var jt=new Error("Unhandled error."+(Xt?" ("+Xt.message+")":""));throw jt.context=Xt,jt}var wt=Pt[ve];if(void 0===wt)return!1;if("function"==typeof wt)Fe(wt,this,He);else{var Mt=wt.length,Yt=yt(wt,Mt);for(Je=0;Je<Mt;++Je)Fe(Yt[Je],this,He)}return!0},h.prototype.on=h.prototype.addListener=function(ve,He){return ce(this,ve,He,!1)},h.prototype.prependListener=function(ve,He){return ce(this,ve,He,!0)},h.prototype.once=function(ve,He){return Me(He),this.on(ve,rt(this,ve,He)),this},h.prototype.prependOnceListener=function(ve,He){return Me(He),this.prependListener(ve,rt(this,ve,He)),this},h.prototype.off=h.prototype.removeListener=function(ve,He){var Je,je,Pt,Xt,jt;if(Me(He),void 0===(je=this._events))return this;if(void 0===(Je=je[ve]))return this;if(Je===He||Je.listener===He)0==--this._eventsCount?this._events=Object.create(null):(delete je[ve],je.removeListener&&this.emit("removeListener",ve,Je.listener||He));else if("function"!=typeof Je){for(Pt=-1,Xt=Je.length-1;Xt>=0;Xt--)if(Je[Xt]===He||Je[Xt].listener===He){jt=Je[Xt].listener,Pt=Xt;break}if(Pt<0)return this;0===Pt?Je.shift():function ft(Oe,ve){for(;ve+1<Oe.length;ve++)Oe[ve]=Oe[ve+1];Oe.pop()}(Je,Pt),1===Je.length&&(je[ve]=Je[0]),void 0!==je.removeListener&&this.emit("removeListener",ve,jt||He)}return this},h.prototype.removeAllListeners=function(ve){var He,Je,je;if(void 0===(Je=this._events))return this;if(void 0===Je.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Je[ve]&&(0==--this._eventsCount?this._events=Object.create(null):delete Je[ve]),this;if(0===arguments.length){var Xt,Pt=Object.keys(Je);for(je=0;je<Pt.length;++je)"removeListener"!==(Xt=Pt[je])&&this.removeAllListeners(Xt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(He=Je[ve]))this.removeListener(ve,He);else if(void 0!==He)for(je=He.length-1;je>=0;je--)this.removeListener(ve,He[je]);return this},h.prototype.listeners=function(ve){return Ft(this,ve,!0)},h.prototype.rawListeners=function(ve){return Ft(this,ve,!1)},h.listenerCount=function(Oe,ve){return"function"==typeof Oe.listenerCount?Oe.listenerCount(ve):Xe.call(Oe,ve)},h.prototype.listenerCount=Xe,h.prototype.eventNames=function(){return this._eventsCount>0?Ue(this._events):[]}},780:At=>{var Fe;At.exports=Fe={},Fe.simpleFilter=function(Ue,Ne){return Ne.filter(function(xe){return Fe.test(Ue,xe)})},Fe.test=function(Ue,Ne){return null!==Fe.match(Ue,Ne)},Fe.match=function(Ue,Ne,xe){var Xe,h=0,H=[],Me=Ne.length,Ce=0,ce=0,Te=(xe=xe||{}).pre||"",rt=xe.post||"",Ft=xe.caseSensitive&&Ne||Ne.toLowerCase();Ue=xe.caseSensitive&&Ue||Ue.toLowerCase();for(var yt=0;yt<Me;yt++)Xe=Ne[yt],Ft[yt]===Ue[h]?(Xe=Te+Xe+rt,h+=1,ce+=1+ce):ce=0,Ce+=ce,H[H.length]=Xe;return h===Ue.length?(Ce=Ft===Ue?1/0:Ce,{rendered:H.join(""),score:Ce}):null},Fe.filter=function(Ue,Ne,xe){return Ne&&0!==Ne.length?"string"!=typeof Ue?Ne:(xe=xe||{},Ne.reduce(function(h,H,Me,Ce){var ce=H;xe.extract&&(ce=xe.extract(H));var Te=Fe.match(Ue,ce,xe);return null!=Te&&(h[h.length]={string:Te.rendered,score:Te.score,index:Me,original:H}),h},[]).sort(function(h,H){return H.score-h.score||h.index-H.index})):[]}},82:At=>{var Ne=/^\s+|\s+$/g,xe=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,H=/^0o[0-7]+$/i,Me=parseInt,Ce="object"==typeof global&&global&&global.Object===Object&&global,ce="object"==typeof self&&self&&self.Object===Object&&self,Te=Ce||ce||Function("return this")(),Ft=Object.prototype.toString,Xe=Math.max,yt=Math.min,ft=function(){return Te.Date.now()};function le(ve){var He=typeof ve;return!!ve&&("object"==He||"function"==He)}function Oe(ve){if("number"==typeof ve)return ve;if(function Ve(ve){return"symbol"==typeof ve||function ze(ve){return!!ve&&"object"==typeof ve}(ve)&&"[object Symbol]"==Ft.call(ve)}(ve))return NaN;if(le(ve)){var He="function"==typeof ve.valueOf?ve.valueOf():ve;ve=le(He)?He+"":He}if("string"!=typeof ve)return 0===ve?ve:+ve;ve=ve.replace(Ne,"");var Je=h.test(ve);return Je||H.test(ve)?Me(ve.slice(2),Je?2:8):xe.test(ve)?NaN:+ve}At.exports=function dt(ve,He,Je){var je,Pt,Xt,jt,wt,Mt,Yt=0,St=!1,on=!1,an=!0;if("function"!=typeof ve)throw new TypeError("Expected a function");function qt(en){var Tr=je,hn=Pt;return je=Pt=void 0,Yt=en,jt=ve.apply(hn,Tr)}function xr(en){return Yt=en,wt=setTimeout(Zr,He),St?qt(en):jt}function Xn(en){var Tr=en-Mt;return void 0===Mt||Tr>=He||Tr<0||on&&en-Yt>=Xt}function Zr(){var en=ft();if(Xn(en))return $n(en);wt=setTimeout(Zr,function vn(en){var Ri=He-(en-Mt);return on?yt(Ri,Xt-(en-Yt)):Ri}(en))}function $n(en){return wt=void 0,an&&je?qt(en):(je=Pt=void 0,jt)}function Yn(){var en=ft(),Tr=Xn(en);if(je=arguments,Pt=this,Mt=en,Tr){if(void 0===wt)return xr(Mt);if(on)return wt=setTimeout(Zr,He),qt(Mt)}return void 0===wt&&(wt=setTimeout(Zr,He)),jt}return He=Oe(He)||0,le(Je)&&(St=!!Je.leading,Xt=(on="maxWait"in Je)?Xe(Oe(Je.maxWait)||0,He):Xt,an="trailing"in Je?!!Je.trailing:an),Yn.cancel=function Di(){void 0!==wt&&clearTimeout(wt),Yt=0,je=Mt=Pt=wt=void 0},Yn.flush=function Si(){return void 0===wt?jt:$n(ft())},Yn}},898:function(At){At.exports=function(){"use strict";var Et,Fe,Ue;function Ne(h,H){if(Et)if(Fe){var Me="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Et+")(sharedChunk); ("+Fe+")(sharedChunk); self.onerror = null;",Ce={};Et(Ce),Ue=H(Ce),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ue.workerUrl=window.URL.createObjectURL(new Blob([Me],{type:"text/javascript"})))}else Fe=H;else Et=H}return Ne(0,function(h){var H=typeof self<"u"?self:{},Me=Ce;function Ce(s,r,a,c){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=c,this.p2x=a,this.p2y=c}Ce.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},Ce.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},Ce.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},Ce.prototype.solveCurveX=function(s,r){var a,c,d,m,_;for(void 0===r&&(r=1e-6),d=s,_=0;_<8;_++){if(m=this.sampleCurveX(d)-s,Math.abs(m)<r)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=m/x}if((d=s)<(a=0))return a;if(d>(c=1))return c;for(;a<c;){if(m=this.sampleCurveX(d),Math.abs(m-s)<r)return d;s>m?a=d:c=d,d=.5*(c-a)+a}return d},Ce.prototype.solve=function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))};var ce=Te;function Te(s,r){this.x=s,this.y=r}Te.prototype={clone:function(){return new Te(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(s,r){var a=Math.cos(s),c=Math.sin(s),d=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Te.convert=function(s){return s instanceof Te?s:Array.isArray(s)?new Te(s[0],s[1]):s};const rt=Math.PI/180,Ft=180/Math.PI;function Xe(s){return s*rt}function yt(s){return s*Ft}const ft=[[0,0],[1,0],[1,1],[0,1]];function dt(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,a=r*s;return 4*(s<.5?a:3*(s-r)+a-.75)}function le(s,r,a,c){const d=new Me(s,r,a,c);return function(m){return d.solve(m)}}const ze=le(.25,.1,.25,1);function Ve(s,r,a){return Math.min(a,Math.max(r,s))}function Oe(s,r,a){return(a=Ve((a-s)/(r-s),0,1))*a*(3-2*a)}function ve(s,r,a){const c=a-r,d=((s-r)%c+c)%c+r;return d===r?a:d}function He(s,r,a){if(!s.length)return a(null,[]);let c=s.length;const d=new Array(s.length);let m=null;s.forEach((_,x)=>{r(_,(C,E)=>{C&&(m=C),d[x]=E,0==--c&&a(m,d)})})}function Je(s){const r=[];for(const a in s)r.push(s[a]);return r}function je(s,...r){for(const a of r)for(const c in a)s[c]=a[c];return s}let Pt=1;function Xt(){return Pt++}function jt(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function wt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Mt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Yt(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function St(s,r){return-1!==s.indexOf(r,s.length-r.length)}function on(s,r,a){const c={};for(const d in s)c[d]=r.call(a||this,s[d],d,s);return c}function an(s,r,a){const c={};for(const d in s)r.call(a||this,s[d],d,s)&&(c[d]=s[d]);return c}function qt(s){return Array.isArray(s)?s.map(qt):"object"==typeof s&&s?on(s,qt):s}const xr={};function vn(s){xr[s]||(typeof console<"u"&&console.warn(s),xr[s]=!0)}function Xn(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function Zr(s){let r=0;for(let a,c,d=0,m=s.length,_=m-1;d<m;_=d++)a=s[d],c=s[_],r+=(c.x-a.x)*(a.y+c.y);return r}function $n(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Di(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,d,m)=>{const _=d||m;return r[c]=!_||_.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Si=null;function Yn(s){if(null==Si){const r=s.navigator?s.navigator.userAgent:null;Si=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Si}function en(s){try{const r=H[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Tr(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const hn=H.performance;function Ri(s){const r=s?s.url.toString():void 0;return hn.getEntriesByName(r)}let Hn,ca,Cl,Ls;const ns={now:()=>void 0!==Cl?Cl:H.performance.now(),setNow(s){Cl=s},restoreNow(){Cl=void 0},frame(s){const r=H.requestAnimationFrame(s);return{cancel:()=>H.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:a,height:c}=s;Ls||(Ls=H.document.createElement("canvas"));const d=Ls.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return(a>Ls.width||c>Ls.height)&&(Ls.width=a,Ls.height=c),d.clearRect(-r,-r,a+2*r,c+2*r),d.drawImage(s,0,0,a,c),d.getImageData(-r,-r,a+2*r,c+2*r)},resolveURL:s=>(Hn||(Hn=H.document.createElement("a")),Hn.href=s,Hn.href),get devicePixelRatio(){return H.devicePixelRatio},get prefersReducedMotion(){return!!H.matchMedia&&(null==ca&&(ca=H.matchMedia("(prefers-reduced-motion: reduce)")),ca.matches)}};let El;const qn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==El){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{El=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{El=s}}return El},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Fs={supported:!1,testSupport:function(s){!Ra&&_s&&(_c?zu(s):ua=s)}};let ua,_s,Ra=!1,_c=!1;function zu(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,_s),s.isContextLost())return;Fs.supported=!0}catch{}s.deleteTexture(r),Ra=!0}H.document&&(_s=H.document.createElement("img"),_s.onload=function(){ua&&zu(ua),ua=null,_c=!0},_s.onerror=function(){Ra=!0,ua=null},_s.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bu="01",yi="NO_ACCESS_TOKEN";function ys(s){return 0===s.indexOf("mapbox:")}function Ml(s){return qn.API_URL_REGEX.test(s)}const Nu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jo(s){const r=s.match(Nu);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function zs(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}function id(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(H.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vu{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=id(qn.ACCESS_TOKEN);let c="";return c=a&&a.u?H.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):qn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=en("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const d=H.localStorage.getItem(a);d&&(this.eventData=JSON.parse(d));const m=H.localStorage.getItem(c);m&&(this.anonId=m)}catch{vn("Unable to read from LocalStorage")}}saveEventData(){const r=en("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{H.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&H.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{vn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,c,d){if(!qn.EVENTS_URL)return;const m=jo(qn.EVENTS_URL);m.params.push(`access_token=${d||qn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.1",skuId:Bu,userId:this.anonId},x=a?je(_,a):_,C={url:zs(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=De(C,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(d)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const Uu=new class extends Vu{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){qn.EVENTS_URL&&qn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>ys(a)||Ml(a))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=id(qn.ACCESS_TOKEN),a=r?r.u:qn.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;Mt(this.anonId)||(this.anonId=jt(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||m.getDate()!==_.getDate()}else c=!0;c?this.postEvent(d,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=a)},s):this.processRequests()}},ju=Uu.postTurnstileEvent.bind(Uu),$u=new class extends Vu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,a,c){this.skuToken=r,this.errorCb=c,qn.EVENTS_URL&&(a||qn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(yi)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Mt(this.anonId)||(this.anonId=jt()),this.postEvent(a,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},s))}},Tl=$u.postMapLoadEvent.bind($u),yc=new class extends Vu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,a,c){if(!qn.API_URL||!qn.SESSION_PATH)return;const d=jo(qn.API_URL+qn.SESSION_PATH);d.params.push(`sku=${r||""}`),d.params.push(`access_token=${c||qn.ACCESS_TOKEN||""}`);const m={url:zs(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ke(m,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(s,r,a,c){this.skuToken=r,this.errorCb=c,qn.SESSION_PATH&&qn.API_URL&&(a||qn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(yi)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},s)}},Gu=yc.getSessionAPI.bind(yc),Bs=new Set;let vs,Dl=500,vc=50,eo={};function Sl(s){const r=z(s);let a,c;r&&r.forEach(m=>{const _=m.split("=");"language"===_[0]?a=_[1]:"worldview"===_[0]&&(c=_[1])});let d="mapbox-tiles";return a&&(d+=`-${a}`),c&&(d+=`-${c}`),d}function ee(s){H.caches&&!eo[s]&&(eo[s]=H.caches.open(s))}function z(s){const r=s.indexOf("?");return r>0?s.slice(r+1).split("&"):[]}function j(s){const r=s.indexOf("?");if(r<0)return s;const a=z(s).filter(c=>{const d=c.split("=");return"language"===d[0]||"worldview"===d[0]});return a.length?`${s.slice(0,r)}?${a.join("&")}`:s.slice(0,r)}let Q=1/0;const se={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(se);class me extends Error{constructor(r,a,c){401===a&&Ml(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ee=$n()?()=>self.worker&&self.worker.referrer:()=>("blob:"===H.location.protocol?H.parent:H).location.href,we=function(s,r){if(!(/^file:/.test(a=s.url)||/^file:/.test(Ee())&&!/^\w+:/.test(a))){if(H.fetch&&H.Request&&H.AbortController&&H.Request.prototype.hasOwnProperty("signal"))return function(c,d){const m=new H.AbortController,_=new H.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ee(),signal:m.signal});let x=!1,C=!1;const E=(S=_.url).indexOf("sku=")>0&&Ml(S);var S;"json"===c.type&&_.headers.set("Accept","application/json");const P=(L,N,U)=>{if(C)return;if(L&&"SecurityError"!==L.message&&vn(L),N&&U)return k(N);const Y=Date.now();H.fetch(_).then(ne=>{if(ne.ok){const de=E?ne.clone():null;return k(ne,de,Y)}return d(new me(ne.statusText,ne.status,c.url))}).catch(ne=>{20!==ne.code&&d(new Error(ne.message))})},k=(L,N,U)=>{("arrayBuffer"===c.type?L.arrayBuffer():"json"===c.type?L.json():L.text()).then(Y=>{C||(N&&U&&function(ne,de,he){const fe=Sl(ne.url);if(ee(fe),!eo[fe])return;const ge={status:de.status,statusText:de.statusText,headers:new H.Headers};de.headers.forEach((Le,We)=>ge.headers.set(We,Le));const ye=Di(de.headers.get("Cache-Control")||"");if(ye["no-store"])return;ye["max-age"]&&ge.headers.set("Expires",new Date(he+1e3*ye["max-age"]).toUTCString());const Re=ge.headers.get("Expires");Re&&(new Date(Re).getTime()-he<42e4||function(Le,We){if(void 0===vs)try{new Response(new ReadableStream),vs=!0}catch{vs=!1}vs?We(Le.body):Le.blob().then(We)}(de,Le=>{const We=new H.Response(Le,ge);ee(fe),eo[fe]&&eo[fe].then(it=>it.put(j(ne.url),We)).catch(it=>vn(it.message))}))}(_,N,U),x=!0,d(null,Y,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(Y=>{C||d(new Error(Y.message))})};return E?function(L,N){const U=Sl(L.url);if(ee(U),!eo[U])return N(null);const Y=j(L.url);eo[U].then(ne=>{ne.match(Y).then(de=>{const he=function(fe){if(!fe)return!1;const ge=new Date(fe.headers.get("Expires")||0),ye=Di(fe.headers.get("Cache-Control")||"");return ge>Date.now()&&!ye["no-cache"]}(de);ne.delete(Y),he&&ne.put(Y,de.clone()),N(null,de,he)}).catch(N)}).catch(N)}(_,P):P(null,null),{cancel:()=>{C=!0,x||m.abort()}}}(s,r);if($n()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(c,d){const m=new H.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(m.responseType="arraybuffer");for(const _ in c.headers)m.setRequestHeader(_,c.headers[_]);return"json"===c.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===c.credentials,m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===c.type)try{_=JSON.parse(m.response)}catch(x){return d(x)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new me(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(s,r)},_e=function(s,r){return we(je(s,{type:"arrayBuffer"}),r)},De=function(s,r){return we(je(s,{method:"POST"}),r)},Ke=function(s,r){return we(je(s,{method:"GET"}),r)};function ht(s){const r=H.document.createElement("a");return r.href=s,r.protocol===H.document.location.protocol&&r.host===H.document.location.host}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ut,tn;Ut=[],tn=0;const Kt=function(s,r){if(Fs.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),tn>=qn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ut.push(m),m}tn++;let a=!1;const c=()=>{if(!a)for(a=!0,tn--;Ut.length&&tn<qn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Ut.shift(),{requestParameters:_,callback:x,cancelled:C}=m;C||(m.cancel=Kt(_,x).cancel)}},d=_e(s,(m,_,x,C)=>{c(),m?r(m):_&&(H.createImageBitmap?function(E,S){const P=new H.Blob([new Uint8Array(E)],{type:"image/png"});H.createImageBitmap(P).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,S)=>r(E,S,x,C)):function(E,S){const P=new H.Image,k=H.URL;P.onload=()=>{S(null,P),k.revokeObjectURL(P.src),P.onload=null,H.requestAnimationFrame(()=>{P.src=Qe})},P.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new H.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?k.createObjectURL(L):Qe}(_,(E,S)=>r(E,S,x,C)))});return{cancel:()=>{d.cancel(),c()}}};function rn(s,r,a){a[s]&&-1!==a[s].indexOf(r)||(a[s]=a[s]||[],a[s].push(r))}function bn(s,r,a){if(a&&a[s]){const c=a[s].indexOf(r);-1!==c&&a[s].splice(c,1)}}class Kn{constructor(r,a={}){je(this,a),this.type=r}}class cr extends Kn{constructor(r,a={}){super("error",je({error:r},a))}}class sr{on(r,a){return this._listeners=this._listeners||{},rn(r,a,this._listeners),this}off(r,a){return bn(r,a,this._listeners),bn(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},rn(r,a,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,a){"string"==typeof r&&(r=new Kn(r,a||{}));const c=r.type;if(this.listens(c)){r.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of m)bn(c,x,this._oneTimeListeners),x.call(this,r);const _=this._eventedParent;_&&(je(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof cr&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function po(s,...r){for(const a of r)for(const c in a)s[c]=a[c];return s}function Lr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function $o(s){if(Array.isArray(s))return s.map($o);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=$o(s[a]);return r}return Lr(s)}class Kf extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}var To=Kf;class xc{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[c,d]of a)this.bindings[c]=d}concat(r){return new xc(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var bp=xc;const bc={kind:"null"},ct={kind:"number"},Gn={kind:"string"},cn={kind:"boolean"},rs={kind:"color"},Ns={kind:"object"},Bt={kind:"value"},is={kind:"collator"},ur={kind:"formatted"},La={kind:"resolvedImage"};function Go(s,r){return{kind:"array",itemType:s,N:r}}function dn(s){if("array"===s.kind){const r=dn(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const yn=[bc,ct,Gn,cn,rs,ur,Ns,Go(Bt),La];function ha(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!ha(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const a of yn)if(!ha(a,r))return null}return`Expected ${dn(s)} but found ${dn(r)} instead.`}function od(s,r){return r.some(a=>a.kind===s.kind)}function En(s,r){return r.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}function Vs(s){var r={exports:{}};return s(r,r.exports),r.exports}var Sn=Vs(function(s,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function d(x){return c("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function m(x){return(C="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:C>1?1:C;var C}function _(x,C,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?x+(C-x)*E*6:2*E<1?C:3*E<2?x+(C-x)*(2/3-E)*6:x}try{r.parseCSSColor=function(x){var C,E=x.replace(/ /g,"").toLowerCase();if(E in a)return a[E].slice();if("#"===E[0])return 4===E.length?(C=parseInt(E.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===E.length&&(C=parseInt(E.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var S=E.indexOf("("),P=E.indexOf(")");if(-1!==S&&P+1===E.length){var k=E.substr(0,S),L=E.substr(S+1,P-(S+1)).split(","),N=1;switch(k){case"rgba":if(4!==L.length)return null;N=m(L.pop());case"rgb":return 3!==L.length?null:[d(L[0]),d(L[1]),d(L[2]),N];case"hsla":if(4!==L.length)return null;N=m(L.pop());case"hsl":if(3!==L.length)return null;var U=(parseFloat(L[0])%360+360)%360/360,Y=m(L[1]),ne=m(L[2]),de=ne<=.5?ne*(Y+1):ne+Y-ne*Y,he=2*ne-de;return[c(255*_(he,de,U+1/3)),c(255*_(he,de,U)),c(255*_(he,de,U-1/3)),N];default:return null}}return null}}catch{}});class pn{constructor(r,a,c,d=1){this.r=r,this.g=a,this.b=c,this.a=d}static parse(r){if(!r)return;if(r instanceof pn)return r;if("string"!=typeof r)return;const a=Sn.parseCSSColor(r);return a?new pn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,c,d]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(c)},${d})`}toArray(){const{r,g:a,b:c,a:d}=this;return 0===d?[0,0,0,0]:[255*r/d,255*a/d,255*c/d,d]}toArray01(){const{r,g:a,b:c,a:d}=this;return 0===d?[0,0,0,0]:[r/d,a/d,c/d,d]}toArray01PremultipliedAlpha(){const{r,g:a,b:c,a:d}=this;return[r,a,c,d]}}pn.black=new pn(0,0,0,1),pn.white=new pn(1,1,1,1),pn.transparent=new pn(0,0,0,0),pn.red=new pn(1,0,0,1),pn.blue=new pn(0,0,1,1);var Wr=pn;class os{constructor(r,a,c){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sd{constructor(r,a,c,d,m){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=c,this.fontStack=d,this.textColor=m}}class vi{constructor(r){this.sections=r}static fromString(r){return new vi([new sd(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof vi?r:vi.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(c)}return r}}class jr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new jr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function ad(s,r,a,c){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[s,r,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[s,r,a,c]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wc(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Wr||s instanceof os||s instanceof vi||s instanceof jr)return!0;if(Array.isArray(s)){for(const r of s)if(!wc(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!wc(s[r]))return!1;return!0}return!1}function Xr(s){if(null===s)return bc;if("string"==typeof s)return Gn;if("boolean"==typeof s)return cn;if("number"==typeof s)return ct;if(s instanceof Wr)return rs;if(s instanceof os)return is;if(s instanceof vi)return ur;if(s instanceof jr)return La;if(Array.isArray(s)){const r=s.length;let a;for(const c of s){const d=Xr(c);if(a){if(a===d)continue;a=Bt;break}a=d}return Go(a||Bt,r)}return Ns}function to(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Wr||s instanceof vi||s instanceof jr?s.toString():JSON.stringify(s)}class wp{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!wc(r[1]))return a.error("invalid value");const c=r[1];let d=Xr(c);const m=a.expectedType;return"array"!==d.kind||0!==d.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(d=m),new wp(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wr?["rgba"].concat(this.value.toArray()):this.value instanceof vi?this.value.serialize():this.value}}var Hu=wp,Vi=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const ld={string:Gn,number:ct,boolean:cn,object:Ns};class Cc{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let c,d=1;const m=r[0];if("array"===m){let x,C;if(r.length>2){const E=r[1];if("string"!=typeof E||!(E in ld)||"object"===E)return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=ld[E],d++}else x=Bt;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=r[2],d++}c=Go(x,C)}else c=ld[m];const _=[];for(;d<r.length;d++){const x=a.parse(r[d],d,Bt);if(!x)return null;_.push(x)}return new Cc(c,_)}evaluate(r){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(r);if(!ha(this.type,Xr(c)))return c;if(a===this.args.length-1)throw new Vi(`Expected value to be of type ${dn(this.type)}, but found ${dn(Xr(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){a.push(c.kind);const d=r.N;("number"==typeof d||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(c=>c.serialize()))}}var da=Cc;class pa{constructor(r){this.type=ur,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return a.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=r.length-1;++_){const x=r[_];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let C=null;if(x["font-scale"]&&(C=a.parse(x["font-scale"],1,ct),!C))return null;let E=null;if(x["text-font"]&&(E=a.parse(x["text-font"],1,Go(Gn)),!E))return null;let S=null;if(x["text-color"]&&(S=a.parse(x["text-color"],1,rs),!S))return null;const P=d[d.length-1];P.scale=C,P.font=E,P.textColor=S}else{const C=a.parse(r[_],1,Bt);if(!C)return null;const E=C.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:C,scale:null,font:null,textColor:null})}}return new pa(d)}evaluate(r){return new vi(this.sections.map(a=>{const c=a.content.evaluate(r);return Xr(c)===La?new sd("",c,null,null,null):new sd(to(c),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),r.push(c)}return r}}class cd{constructor(r){this.type=La,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,Gn);return c?new cd(c):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),c=jr.fromString(a);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(a)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Do={"to-boolean":cn,"to-color":rs,"to-number":ct,"to-string":Gn};class hr{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return a.error("Expected one argument.");const d=Do[c],m=[];for(let _=1;_<r.length;_++){const x=a.parse(r[_],_,Bt);if(!x)return null;m.push(x)}return new hr(d,m)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,c;for(const d of this.args){if(a=d.evaluate(r),c=null,a instanceof Wr)return a;if("string"==typeof a){const m=r.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:ad(a[0],a[1],a[2],a[3]),!c))return new Wr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Vi(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const c of this.args){if(a=c.evaluate(r),null===a)return 0;const d=Number(a);if(!isNaN(d))return d}throw new Vi(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?vi.fromString(to(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?jr.fromString(to(this.args[0].evaluate(r))):to(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new pa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new cd(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Ec=hr;const s_=["Unknown","Point","LineString","Polygon"];var Jf=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?s_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-s[0])+this.featureDistanceData.bearing[1]*(c*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Wr.parse(s)),r}};class sn{constructor(r,a,c,d){this.name=r,this.type=a,this._evaluate=c,this.args=d}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const c=r[0],d=sn.definitions[c];if(!d)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=_.filter(([E])=>!Array.isArray(E)||E.length===r.length-1);let C=null;for(const[E,S]of x){C=new dr(a.registry,a.path,null,a.scope);const P=[];let k=!1;for(let L=1;L<r.length;L++){const N=r[L],U=Array.isArray(E)?E[L-1]:E.type,Y=C.parse(N,1+P.length,U);if(!Y){k=!0;break}P.push(Y)}if(!k)if(Array.isArray(E)&&E.length!==P.length)C.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const N=Array.isArray(E)?E[L]:E.type,U=P[L];C.concat(L+1).checkSubtype(N,U.type)}if(0===C.errors.length)return new sn(c,m,S,P)}}if(1===x.length)a.errors.push(...C.errors);else{const E=(x.length?x:_).map(([P])=>{return k=P,Array.isArray(k)?`(${k.map(dn).join(", ")})`:`(${dn(k.type)}...)`;var k}).join(" | "),S=[];for(let P=1;P<r.length;P++){const k=a.parse(r[P],1+S.length);if(!k)return null;S.push(dn(k.type))}a.error(`Expected arguments of type ${E}, but found (${S.join(", ")}) instead.`)}return null}static register(r,a){sn.definitions=a;for(const c in a)r[c]=sn}}var fa=sn;class xi{constructor(r,a,c){this.type=is,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return a.error("Collator options argument must be an object.");const d=a.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,cn);if(!d)return null;const m=a.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,cn);if(!m)return null;let _=null;return c.locale&&(_=a.parse(c.locale,1,Gn),!_)?null:new xi(d,m,_)}evaluate(r){return new os(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const xs=8192;function qu(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Zu(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Qf(s,r){const a=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,r.z);return[Math.round(a*d*xs),Math.round(c*d*xs)]}function Cp(s,r,a){const c=s[0]-r[0],d=s[1]-r[1],m=s[0]-a[0],_=s[1]-a[1];return c*_-m*d==0&&c*m<=0&&d*_<=0}function Il(s,r){let a=!1;for(let _=0,x=r.length;_<x;_++){const C=r[_];for(let E=0,S=C.length;E<S-1;E++){if(Cp(s,C[E],C[E+1]))return!1;(d=C[E])[1]>(c=s)[1]!=(m=C[E+1])[1]>c[1]&&c[0]<(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1])+d[0]&&(a=!a)}}var c,d,m;return a}function Wu(s,r){for(let a=0;a<r.length;a++)if(Il(s,r[a]))return!0;return!1}function Al(s,r,a,c){const d=c[0]-a[0],m=c[1]-a[1],_=(s[0]-a[0])*m-d*(s[1]-a[1]),x=(r[0]-a[0])*m-d*(r[1]-a[1]);return _>0&&x<0||_<0&&x>0}function em(s,r,a){for(const E of a)for(let S=0;S<E.length-1;++S)if((x=[(_=E[S+1])[0]-(m=E[S])[0],_[1]-m[1]])[0]*(C=[(d=r)[0]-(c=s)[0],d[1]-c[1]])[1]-x[1]*C[0]!=0&&Al(c,d,m,_)&&Al(m,_,c,d))return!0;var c,d,m,_,x,C;return!1}function fn(s,r){for(let a=0;a<s.length;++a)if(!Il(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(em(s[a],s[a+1],r))return!1;return!0}function ud(s,r){for(let a=0;a<r.length;a++)if(fn(s,r[a]))return!0;return!1}function hd(s,r,a){const c=[];for(let d=0;d<s.length;d++){const m=[];for(let _=0;_<s[d].length;_++){const x=Qf(s[d][_],a);qu(r,x),m.push(x)}c.push(m)}return c}function ui(s,r,a){const c=[];for(let d=0;d<s.length;d++){const m=hd(s[d],r,a);c.push(m)}return c}function Xu(s,r,a,c){if(s[0]<a[0]||s[0]>a[2]){const d=.5*c;let m=s[0]-a[0]>d?-c:a[0]-s[0]>d?c:0;0===m&&(m=s[0]-a[2]>d?-c:a[2]-s[0]>d?c:0),s[0]+=m}qu(r,s)}function Ep(s,r,a,c){const d=Math.pow(2,c.z)*xs,m=[c.x*xs,c.y*xs],_=[];if(!s)return _;for(const x of s)for(const C of x){const E=[C.x+m[0],C.y+m[1]];Xu(E,r,a,d),_.push(E)}return _}function Ho(s,r,a,c){const d=Math.pow(2,c.z)*xs,m=[c.x*xs,c.y*xs],_=[];if(!s)return _;for(const C of s){const E=[];for(const S of C){const P=[S.x+m[0],S.y+m[1]];qu(r,P),E.push(P)}_.push(E)}if(r[2]-r[0]<=d/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const C of _)for(const E of C)Xu(E,r,a,d)}var x;return _}class bi{constructor(r,a){this.type=cn,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(wc(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let d=0;d<c.features.length;++d){const m=c.features[d].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new bi(c,c.features[d].geometry)}else if("Feature"===c.type){const d=c.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new bi(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new bi(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===c.type){const x=hd(c.coordinates,m,_),C=Ep(a.geometry(),d,m,_);if(!Zu(d,m))return!1;for(const E of C)if(!Il(E,x))return!1}if("MultiPolygon"===c.type){const x=ui(c.coordinates,m,_),C=Ep(a.geometry(),d,m,_);if(!Zu(d,m))return!1;for(const E of C)if(!Wu(E,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===c.type){const x=hd(c.coordinates,m,_),C=Ho(a.geometry(),d,m,_);if(!Zu(d,m))return!1;for(const E of C)if(!fn(E,x))return!1}if("MultiPolygon"===c.type){const x=ui(c.coordinates,m,_),C=Ho(a.geometry(),d,m,_);if(!Zu(d,m))return!1;for(const E of C)if(!ud(E,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var dd=bi;function Mc(s){if(s instanceof fa&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof dd)return!1;let r=!0;return s.eachChild(a=>{r&&!Mc(a)&&(r=!1)}),r}function no(s){if(s instanceof fa&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(a=>{r&&!no(a)&&(r=!1)}),r}function fr(s,r){if(s instanceof fa&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(c=>{a&&!fr(c,r)&&(a=!1)}),a}class ir{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const c=r[1];return a.scope.has(c)?new ir(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var tm=ir;class ma{constructor(r,a=[],c,d=new bp,m=[]){this.registry=r,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=m,this.expectedType=c}parse(r,a,c,d,m={}){return a?this.concat(a,c,d)._parse(r,m):this._parse(r,m)}_parse(r,a){function c(d,m,_){return"assert"===_?new da(m,[d]):"coerce"===_?new Ec(m,[d]):d}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=r[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let _=m.parse(r,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,C=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==C.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(x,C))return null}else _=c(_,x,a.typeAnnotation||"coerce");else _=c(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof Hu)&&"resolvedImage"!==_.type.kind&&Fa(_)){const x=new Jf;try{_=new Hu(_.type,_.evaluate(x))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,c){const d="number"==typeof r?this.path.concat(r):this.path,m=c?this.scope.concat(c):this.scope;return new ma(this.registry,d,a||null,m,this.errors)}error(r,...a){const c=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new To(c,r))}checkSubtype(r,a){const c=ha(r,a);return c&&this.error(c),c}}var dr=ma;function Fa(s){if(s instanceof tm)return Fa(s.boundExpression);if(s instanceof fa&&"error"===s.name||s instanceof xi||s instanceof dd)return!1;const r=s instanceof Ec||s instanceof da;let a=!0;return s.eachChild(c=>{a=r?a&&Fa(c):a&&c instanceof Hu}),!!a&&Mc(s)&&fr(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Pl(s,r){const a=s.length-1;let c,d,m=0,_=a,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),c=s[x],d=s[x+1],c<=r){if(x===a||r<d)return x;m=x+1}else{if(!(c>r))throw new Vi("Input is not a number.");_=x-1}return 0}class kl{constructor(r,a,c){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(r[1],1,ct);if(!c)return null;const d=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let _=1;_<r.length;_+=2){const x=1===_?-1/0:r[_],C=r[_+1],E=_,S=_+1;if("number"!=typeof x)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=a.parse(C,S,m);if(!P)return null;m=m||P.type,d.push([x,P])}return new kl(m,c,d)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const d=this.input.evaluate(r);if(d<=a[0])return c[0].evaluate(r);const m=a.length;return d>=a[m-1]?c[m-1].evaluate(r):c[Pl(a,d)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}var Tc=kl;function In(s,r,a){return s*(1-a)+r*a}var Us=Object.freeze({__proto__:null,number:In,color:function(s,r,a){return new Wr(In(s.r,r.r,a),In(s.g,r.g,a),In(s.b,r.b,a),In(s.a,r.a,a))},array:function(s,r,a){return s.map((c,d)=>In(c,r[d],a))}});const Mp=4/29,Ol=6/29,Yu=3*Ol*Ol,nm=Math.PI/180,qo=180/Math.PI;function Ku(s){return s>.008856451679035631?Math.pow(s,1/3):s/Yu+Mp}function Ju(s){return s>Ol?s*s*s:Yu*(s-Mp)}function un(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Li(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function br(s){const r=Li(s.r),a=Li(s.g),c=Li(s.b),d=Ku((.4124564*r+.3575761*a+.1804375*c)/.95047),m=Ku((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Ku((.0193339*r+.119192*a+.9503041*c)/1.08883)),alpha:s.a}}function Ui(s){let r=(s.l+16)/116,a=isNaN(s.a)?r:r+s.a/500,c=isNaN(s.b)?r:r-s.b/200;return r=1*Ju(r),a=.95047*Ju(a),c=1.08883*Ju(c),new Wr(un(3.2404542*a-1.5371385*r-.4985314*c),un(-.969266*a+1.8760108*r+.041556*c),un(.0556434*a-.2040259*r+1.0572252*c),s.alpha)}function ji(s,r,a){const c=r-s;return s+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const Fi={forward:br,reverse:Ui,interpolate:function(s,r,a){return{l:In(s.l,r.l,a),a:In(s.a,r.a,a),b:In(s.b,r.b,a),alpha:In(s.alpha,r.alpha,a)}}},zi={forward:function(s){const{l:r,a,b:c}=br(s),d=Math.atan2(c,a)*qo;return{h:d<0?d+360:d,c:Math.sqrt(a*a+c*c),l:r,alpha:s.a}},reverse:function(s){const r=s.h*nm,a=s.c;return Ui({l:s.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:s.alpha})},interpolate:function(s,r,a){return{h:ji(s.h,r.h,a),c:In(s.c,r.c,a),l:In(s.l,r.l,a),alpha:In(s.alpha,r.alpha,a)}}};var zt=Object.freeze({__proto__:null,lab:Fi,hcl:zi});class An{constructor(r,a,c,d,m){this.type=r,this.operator=a,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(r,a,c,d){let m=0;if("exponential"===r.name)m=Pr(a,r.base,c,d);else if("linear"===r.name)m=Pr(a,1,c,d);else if("cubic-bezier"===r.name){const _=r.controlPoints;m=new Me(_[0],_[1],_[2],_[3]).solve(Pr(a,1,c,d))}return m}static parse(r,a){let[c,d,m,..._]=r;if(!Array.isArray(d)||0===d.length)return a.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const E=d[1];if("number"!=typeof E)return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if("cubic-bezier"!==d[0])return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(4!==E.length||E.some(S=>"number"!=typeof S||S<0||S>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,ct),!m)return null;const x=[];let C=null;"interpolate-hcl"===c||"interpolate-lab"===c?C=rs:a.expectedType&&"value"!==a.expectedType.kind&&(C=a.expectedType);for(let E=0;E<_.length;E+=2){const S=_[E],P=_[E+1],k=E+3,L=E+4;if("number"!=typeof S)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=S)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const N=a.parse(P,L,C);if(!N)return null;C=C||N.type,x.push([S,N])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new An(C,c,d,m,x):a.error(`Type ${dn(C)} is not interpolatable.`)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const d=this.input.evaluate(r);if(d<=a[0])return c[0].evaluate(r);const m=a.length;if(d>=a[m-1])return c[m-1].evaluate(r);const _=Pl(a,d),x=An.interpolationFactor(this.interpolation,d,a[_],a[_+1]),C=c[_].evaluate(r),E=c[_+1].evaluate(r);return"interpolate"===this.operator?Us[this.type.kind.toLowerCase()](C,E,x):"interpolate-hcl"===this.operator?zi.reverse(zi.interpolate(zi.forward(C),zi.forward(E),x)):Fi.reverse(Fi.interpolate(Fi.forward(C),Fi.forward(E),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function Pr(s,r,a,c){const d=c-a,m=s-a;return 0===d?0:1===r?m/d:(Math.pow(r,m)-1)/(Math.pow(r,d)-1)}var ri=An;class js{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let c=null;const d=a.expectedType;d&&"value"!==d.kind&&(c=d);const m=[];for(const x of r.slice(1)){const C=a.parse(x,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,m.push(C)}const _=d&&m.some(x=>ha(d,x.type));return new js(_?Bt:c,m)}evaluate(r){let a,c=null,d=0;for(const m of this.args){if(d++,c=m.evaluate(r),c&&c instanceof jr&&!c.available&&(a||(a=c),c=null,d===this.args.length))return a;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var wi=js;class $s{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let m=1;m<r.length-1;m+=2){const _=r[m];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=a.parse(r[m+1],m+1);if(!x)return null;c.push([_,x])}const d=a.parse(r[r.length-1],r.length-1,a.expectedType,c);return d?new $s(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,c]of this.bindings)r.push(a,c.serialize());return r.push(this.result.serialize()),r}}var Fr=$s;class Ba{constructor(r,a,c){this.type=r,this.index=a,this.input=c}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,ct),d=a.parse(r[2],2,Go(a.expectedType||Bt));return c&&d?new Ba(d.type.itemType,c,d):null}evaluate(r){const a=this.index.evaluate(r),c=this.input.evaluate(r);if(a<0)throw new Vi(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new Vi(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new Vi(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Rl=Ba;class Fn{constructor(r,a){this.type=cn,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Bt),d=a.parse(r[2],2,Bt);return c&&d?od(c.type,[cn,Gn,ct,bc,Bt])?new Fn(c,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(c.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(null==c)return!1;if(!En(a,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Xr(a))} instead.`);if(!En(c,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${dn(Xr(c))} instead.`);return c.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Qu=Fn;class bs{constructor(r,a,c){this.type=ct,this.needle=r,this.haystack=a,this.fromIndex=c}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Bt),d=a.parse(r[2],2,Bt);if(!c||!d)return null;if(!od(c.type,[cn,Gn,ct,bc,Bt]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(c.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,ct);return m?new bs(c,d,m):null}return new bs(c,d)}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!En(a,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Xr(a))} instead.`);if(!En(c,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${dn(Xr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(r);return c.indexOf(a,d)}return c.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var eh=bs;class ws{constructor(r,a,c,d,m,_){this.inputType=r,this.type=a,this.input=c,this.cases=d,this.outputs=m,this.otherwise=_}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let c,d;a.expectedType&&"value"!==a.expectedType.kind&&(d=a.expectedType);const m={},_=[];for(let E=2;E<r.length-1;E+=2){let S=r[E];const P=r[E+1];Array.isArray(S)||(S=[S]);const k=a.concat(E);if(0===S.length)return k.error("Expected at least one branch label.");for(const N of S){if("number"!=typeof N&&"string"!=typeof N)return k.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,Xr(N)))return null}else c=Xr(N);if(void 0!==m[String(N)])return k.error("Branch labels must be unique.");m[String(N)]=_.length}const L=a.parse(P,E,d);if(!L)return null;d=d||L.type,_.push(L)}const x=a.parse(r[1],1,Bt);if(!x)return null;const C=a.parse(r[r.length-1],r.length-1,d);return C?"value"!==x.type.kind&&a.concat(1).checkSubtype(c,x.type)?null:new ws(c,d,x,m,_,C):null}evaluate(r){const a=this.input.evaluate(r);return(Xr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],d={};for(const _ of a){const x=d[this.cases[_]];void 0===x?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[x][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of c)r.push(1===x.length?m(x[0]):x.map(m)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}var $i=ws;class Na{constructor(r,a,c){this.type=r,this.branches=a,this.otherwise=c}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);const d=[];for(let _=1;_<r.length-1;_+=2){const x=a.parse(r[_],_,cn);if(!x)return null;const C=a.parse(r[_+1],_+1,c);if(!C)return null;d.push([x,C]),c=c||C.type}const m=a.parse(r[r.length-1],r.length-1,c);return m?new Na(c,d,m):null}evaluate(r){for(const[a,c]of this.branches)if(a.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,c]of this.branches)r(a),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Va=Na;class ro{constructor(r,a,c,d){this.type=r,this.input=a,this.beginIndex=c,this.endIndex=d}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Bt),d=a.parse(r[2],2,ct);if(!c||!d)return null;if(!od(c.type,[Go(Bt),Gn,Bt]))return a.error(`Expected first argument to be of type array or string, but found ${dn(c.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,ct);return m?new ro(c.type,c,d,m):null}return new ro(c.type,c,d)}evaluate(r){const a=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!En(a,["string","array"]))throw new Vi(`Expected first argument to be of type array or string, but found ${dn(Xr(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(r);return a.slice(c,d)}return a.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ua=ro;function pd(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Dr(s,r,a,c){return 0===c.compare(r,a)}function Ll(s,r,a){const c="=="!==s&&"!="!==s;return class US{constructor(m,_,x){this.type=cn,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const x=m[0];let C=_.parse(m[1],1,Bt);if(!C)return null;if(!pd(x,C.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${dn(C.type)}'.`);let E=_.parse(m[2],2,Bt);if(!E)return null;if(!pd(x,E.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${dn(E.type)}'.`);if(C.type.kind!==E.type.kind&&"value"!==C.type.kind&&"value"!==E.type.kind)return _.error(`Cannot compare types '${dn(C.type)}' and '${dn(E.type)}'.`);c&&("value"===C.type.kind&&"value"!==E.type.kind?C=new da(E.type,[C]):"value"!==C.type.kind&&"value"===E.type.kind&&(E=new da(C.type,[E])));let S=null;if(4===m.length){if("string"!==C.type.kind&&"string"!==E.type.kind&&"value"!==C.type.kind&&"value"!==E.type.kind)return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(m[3],3,is),!S)return null}return new US(C,E,S)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const C=Xr(_),E=Xr(x);if(C.kind!==E.kind||"string"!==C.kind&&"number"!==C.kind)throw new Vi(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=Xr(_),E=Xr(x);if("string"!==C.kind||"string"!==E.kind)return r(m,_,x)}return this.collator?a(m,_,x,this.collator.evaluate(m)):r(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const rm=Ll("==",function(s,r,a){return r===a},Dr),ja=Ll("!=",function(s,r,a){return r!==a},function(s,r,a,c){return!Dr(0,r,a,c)}),th=Ll("<",function(s,r,a){return r<a},function(s,r,a,c){return c.compare(r,a)<0}),Fl=Ll(">",function(s,r,a){return r>a},function(s,r,a,c){return c.compare(r,a)>0}),nh=Ll("<=",function(s,r,a){return r<=a},function(s,r,a,c){return c.compare(r,a)<=0}),$a=Ll(">=",function(s,r,a){return r>=a},function(s,r,a,c){return c.compare(r,a)>=0});class Ii{constructor(r,a,c,d,m){this.type=Gn,this.number=r,this.locale=a,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,ct);if(!c)return null;const d=r[2];if("object"!=typeof d||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=a.parse(d.locale,1,Gn),!m))return null;let _=null;if(d.currency&&(_=a.parse(d.currency,1,Gn),!_))return null;let x=null;if(d["min-fraction-digits"]&&(x=a.parse(d["min-fraction-digits"],1,ct),!x))return null;let C=null;return d["max-fraction-digits"]&&(C=a.parse(d["max-fraction-digits"],1,ct),!C)?null:new Ii(c,m,_,x,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class rh{constructor(r){this.type=ct,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=a.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?a.error(`Expected argument of type string or array, but found ${dn(c.type)} instead.`):new rh(c):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new Vi(`Expected value to be of type string or array, but found ${dn(Xr(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Gi={"==":rm,"!=":ja,">":Fl,"<":th,">=":$a,"<=":nh,array:da,at:Rl,boolean:da,case:Va,coalesce:wi,collator:xi,format:pa,image:cd,in:Qu,"index-of":eh,interpolate:ri,"interpolate-hcl":ri,"interpolate-lab":ri,length:rh,let:Fr,literal:Hu,match:$i,number:da,"number-format":Ii,object:da,slice:Ua,step:Tc,string:da,"to-boolean":Ec,"to-color":Ec,"to-number":Ec,"to-string":Ec,var:tm,within:dd};function So(s,[r,a,c,d]){r=r.evaluate(s),a=a.evaluate(s),c=c.evaluate(s);const m=d?d.evaluate(s):1,_=ad(r,a,c,m);if(_)throw new Vi(_);return new Wr(r/255*m,a/255*m,c/255*m,m)}function zl(s,r){return s in r}function Bl(s,r){const a=r[s];return void 0===a?null:a}function Cs(s){return{type:s}}fa.register(Gi,{error:[{kind:"error"},[Gn],(s,[r])=>{throw new Vi(r.evaluate(s))}],typeof:[Gn,[Bt],(s,[r])=>dn(Xr(r.evaluate(s)))],"to-rgba":[Go(ct,4),[rs],(s,[r])=>r.evaluate(s).toArray()],rgb:[rs,[ct,ct,ct],So],rgba:[rs,[ct,ct,ct,ct],So],has:{type:cn,overloads:[[[Gn],(s,[r])=>zl(r.evaluate(s),s.properties())],[[Gn,Ns],(s,[r,a])=>zl(r.evaluate(s),a.evaluate(s))]]},get:{type:Bt,overloads:[[[Gn],(s,[r])=>Bl(r.evaluate(s),s.properties())],[[Gn,Ns],(s,[r,a])=>Bl(r.evaluate(s),a.evaluate(s))]]},"feature-state":[Bt,[Gn],(s,[r])=>Bl(r.evaluate(s),s.featureState||{})],properties:[Ns,[],s=>s.properties()],"geometry-type":[Gn,[],s=>s.geometryType()],id:[Bt,[],s=>s.id()],zoom:[ct,[],s=>s.globals.zoom],pitch:[ct,[],s=>s.globals.pitch||0],"distance-from-center":[ct,[],s=>s.distanceFromCenter()],"heatmap-density":[ct,[],s=>s.globals.heatmapDensity||0],"line-progress":[ct,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[ct,[],s=>s.globals.skyRadialProgress||0],accumulated:[Bt,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[ct,Cs(ct),(s,r)=>{let a=0;for(const c of r)a+=c.evaluate(s);return a}],"*":[ct,Cs(ct),(s,r)=>{let a=1;for(const c of r)a*=c.evaluate(s);return a}],"-":{type:ct,overloads:[[[ct,ct],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[ct],(s,[r])=>-r.evaluate(s)]]},"/":[ct,[ct,ct],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[ct,[ct,ct],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[ct,[ct],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))],log2:[ct,[ct],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[ct,[ct],(s,[r])=>Math.sin(r.evaluate(s))],cos:[ct,[ct],(s,[r])=>Math.cos(r.evaluate(s))],tan:[ct,[ct],(s,[r])=>Math.tan(r.evaluate(s))],asin:[ct,[ct],(s,[r])=>Math.asin(r.evaluate(s))],acos:[ct,[ct],(s,[r])=>Math.acos(r.evaluate(s))],atan:[ct,[ct],(s,[r])=>Math.atan(r.evaluate(s))],min:[ct,Cs(ct),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[ct,Cs(ct),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[ct,[ct],(s,[r])=>Math.abs(r.evaluate(s))],round:[ct,[ct],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[ct,[ct],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[ct,[ct],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[cn,[Gn,Bt],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[cn,[Bt],(s,[r])=>s.id()===r.value],"filter-type-==":[cn,[Gn],(s,[r])=>s.geometryType()===r.value],"filter-<":[cn,[Gn,Bt],(s,[r,a])=>{const c=s.properties()[r.value],d=a.value;return typeof c==typeof d&&c<d}],"filter-id-<":[cn,[Bt],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a<c}],"filter->":[cn,[Gn,Bt],(s,[r,a])=>{const c=s.properties()[r.value],d=a.value;return typeof c==typeof d&&c>d}],"filter-id->":[cn,[Bt],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a>c}],"filter-<=":[cn,[Gn,Bt],(s,[r,a])=>{const c=s.properties()[r.value],d=a.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[cn,[Bt],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a<=c}],"filter->=":[cn,[Gn,Bt],(s,[r,a])=>{const c=s.properties()[r.value],d=a.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[cn,[Bt],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a>=c}],"filter-has":[cn,[Bt],(s,[r])=>r.value in s.properties()],"filter-has-id":[cn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[cn,[Go(Gn)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[cn,[Go(Bt)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[cn,[Gn,Go(Bt)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[cn,[Gn,Go(Bt)],(s,[r,a])=>function(c,d,m,_){for(;m<=_;){const x=m+_>>1;if(d[x]===c)return!0;d[x]>c?_=x-1:m=x+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:cn,overloads:[[[cn,cn],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[Cs(cn),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:cn,overloads:[[[cn,cn],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[Cs(cn),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[cn,[cn],(s,[r])=>!r.evaluate(s)],"is-supported-script":[cn,[Gn],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[Gn,[Gn],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Gn,[Gn],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Gn,Cs(Bt),(s,r)=>r.map(a=>to(a.evaluate(s))).join("")],"resolved-locale":[Gn,[is],(s,[r])=>r.evaluate(s).resolvedLocale()]});var io=Gi;function Tp(s){return{result:"success",value:s}}function Dc(s){return{result:"error",value:s}}function Nl(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function fd(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function md(s){return!!s.expression&&s.expression.interpolated}function Jn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function gd(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function a_(s){return s}function im(s,r){const a="color"===r.type,c=s.stops&&"object"==typeof s.stops[0][0],d=c||!(c||void 0!==s.property),m=s.type||(md(r)?"exponential":"interval");if(a&&((s=po({},s)).stops&&(s.stops=s.stops.map(E=>[E[0],Wr.parse(E[1])])),s.default=Wr.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!zt[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let _,x,C;if("exponential"===m)_=sm;else if("interval"===m)_=Sc;else if("categorical"===m){_=om,x=Object.create(null);for(const E of s.stops)x[E[0]]=E[1];C=typeof s.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=l_}if(c){const E={},S=[];for(let L=0;L<s.stops.length;L++){const N=s.stops[L],U=N[0].zoom;void 0===E[U]&&(E[U]={zoom:U,type:s.type,property:s.property,default:s.default,stops:[]},S.push(U)),E[U].stops.push([N[0].value,N[1]])}const P=[];for(const L of S)P.push([E[L].zoom,im(E[L],r)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:ri.interpolationFactor.bind(void 0,k),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},N)=>sm({stops:P,base:s.base},r,L).evaluate(L,N)}}if(d){const E="exponential"===m?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ri.interpolationFactor.bind(void 0,E),zoomStops:s.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(s,r,S,x,C)}}return{kind:"source",evaluate(E,S){const P=S&&S.properties?S.properties[s.property]:void 0;return void 0===P?ss(s.default,r.default):_(s,r,P,x,C)}}}function ss(s,r,a){return void 0!==s?s:void 0!==r?r:void 0!==a?a:void 0}function om(s,r,a,c,d){return ss(typeof a===d?c[a]:void 0,s.default,r.default)}function Sc(s,r,a){if("number"!==Jn(a))return ss(s.default,r.default);const c=s.stops.length;if(1===c||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[c-1][0])return s.stops[c-1][1];const d=Pl(s.stops.map(m=>m[0]),a);return s.stops[d][1]}function sm(s,r,a){const c=void 0!==s.base?s.base:1;if("number"!==Jn(a))return ss(s.default,r.default);const d=s.stops.length;if(1===d||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[d-1][0])return s.stops[d-1][1];const m=Pl(s.stops.map(S=>S[0]),a),_=function(S,P,k,L){const N=L-k,U=S-k;return 0===N?0:1===P?U/N:(Math.pow(P,U)-1)/(Math.pow(P,N)-1)}(a,c,s.stops[m][0],s.stops[m+1][0]),x=s.stops[m][1],C=s.stops[m+1][1];let E=Us[r.type]||a_;if(s.colorSpace&&"rgb"!==s.colorSpace){const S=zt[s.colorSpace];E=(P,k)=>S.reverse(S.interpolate(S.forward(P),S.forward(k),_))}return"function"==typeof x.evaluate?{evaluate(...S){const P=x.evaluate.apply(void 0,S),k=C.evaluate.apply(void 0,S);if(void 0!==P&&void 0!==k)return E(P,k,_)}}:E(x,C,_)}function l_(s,r,a){return"color"===r.type?a=Wr.parse(a):"formatted"===r.type?a=vi.fromString(a.toString()):"resolvedImage"===r.type?a=jr.fromString(a.toString()):Jn(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),ss(a,s.default,r.default)}class _d{constructor(r,a){var c;this.expression=r,this._warningHistory={},this._evaluator=new Jf,this._defaultValue=a?"color"===(c=a).type&&(gd(c.default)||Array.isArray(c.default))?new Wr(0,0,0,0):"color"===c.type?Wr.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,c,d,m,_,x,C){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,c,d,m,_,x,C){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function yd(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in io}function Vl(s,r){const a=new dr(io,[],r?function(d){const m={color:rs,string:Gn,number:ct,enum:Gn,boolean:cn,formatted:ur,resolvedImage:La};return"array"===d.type?Go(m[d.value]||Bt,d.length):m[d.type]}(r):void 0),c=a.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?Tp(new _d(c,r)):Dc(a.errors)}class vd{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!no(a.expression)}evaluateWithoutErrorHandling(r,a,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,d,m,_)}evaluate(r,a,c,d,m,_){return this._styleExpression.evaluate(r,a,c,d,m,_)}}class Ul{constructor(r,a,c,d){this.kind=r,this.zoomStops=c,this._styleExpression=a,this.isStateDependent="camera"!==r&&!no(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(r,a,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,d,m,_)}evaluate(r,a,c,d,m,_){return this._styleExpression.evaluate(r,a,c,d,m,_)}interpolationFactor(r,a,c){return this.interpolationType?ri.interpolationFactor(this.interpolationType,r,a,c):0}}function jl(s,r){if("error"===(s=Vl(s,r)).result)return s;const a=s.value.expression,c=Mc(a);if(!c&&!Nl(r))return Dc([new To("","data expressions not supported")]);const d=fr(a,["zoom","pitch","distance-from-center"]);if(!d&&!fd(r))return Dc([new To("","zoom expressions not supported")]);const m=Ic(a);return m||d?m instanceof To?Dc([m]):m instanceof ri&&!md(r)?Dc([new To("",'"interpolate" expressions cannot be used with this property')]):Tp(m?new Ul(c?"camera":"composite",s.value,m.labels,m instanceof ri?m.interpolation:void 0):new vd(c?"constant":"source",s.value)):Dc([new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ih{constructor(r,a){this._parameters=r,this._specification=a,po(this,im(this._parameters,this._specification))}static deserialize(r){return new ih(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ic(s){let r=null;if(s instanceof Fr)r=Ic(s.result);else if(s instanceof wi){for(const a of s.args)if(r=Ic(a),r)break}else(s instanceof Tc||s instanceof ri)&&s.input instanceof fa&&"zoom"===s.input.name&&(r=s);return r instanceof To||s.eachChild(a=>{const c=Ic(a);c instanceof To?r=c:!r&&c?r=new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new To("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class kt{constructor(r,a,c,d){this.message=(r?`${r}: `:"")+c,d&&(this.identifier=d),null!=a&&a.__line__&&(this.line=a.__line__)}}function Ai(s){const r=s.key,a=s.value,c=s.valueSpec||{},d=s.objectElementValidators||{},m=s.style,_=s.styleSpec;let x=[];const C=Jn(a);if("object"!==C)return[new kt(r,a,`object expected, ${C} found`)];for(const E in a){const S=E.split(".")[0],P=c[S]||c["*"];let k;d[S]?k=d[S]:c[S]?k=hi:d["*"]?k=d["*"]:c["*"]&&(k=hi),k?x=x.concat(k({key:(r&&`${r}.`)+E,value:a[E],valueSpec:P,style:m,styleSpec:_,object:a,objectKey:E},a)):x.push(new kt(r,a[E],`unknown property "${E}"`))}for(const E in c)d[E]||c[E].required&&void 0===c[E].default&&void 0===a[E]&&x.push(new kt(r,a,`missing required property "${E}"`));return x}function Ac(s){const r=s.value,a=s.valueSpec,c=s.style,d=s.styleSpec,m=s.key,_=s.arrayElementValidator||hi;if("array"!==Jn(r))return[new kt(m,r,`array expected, ${Jn(r)} found`)];if(a.length&&r.length!==a.length)return[new kt(m,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new kt(m,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};d.$version<7&&(x.function=a.function),"object"===Jn(a.value)&&(x=a.value);let C=[];for(let E=0;E<r.length;E++)C=C.concat(_({array:r,arrayIndex:E,value:r[E],valueSpec:x,style:c,styleSpec:d,key:`${m}[${E}]`}));return C}function li(s){const r=s.key,a=s.value,c=s.valueSpec;let d=Jn(a);if("number"===d&&a!=a&&(d="NaN"),"number"!==d)return[new kt(r,a,`number expected, ${d} found`)];if("minimum"in c){let m=c.minimum;if("array"===Jn(c.minimum)&&(m=c.minimum[s.arrayIndex]),a<m)return[new kt(r,a,`${a} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if("array"===Jn(c.maximum)&&(m=c.maximum[s.arrayIndex]),a>m)return[new kt(r,a,`${a} is greater than the maximum value ${m}`)]}return[]}function oh(s){const r=s.valueSpec,a=Lr(s.value.type);let c,d,m,_={};const x="categorical"!==a&&void 0===s.value.property,C=!x,E="array"===Jn(s.value.stops)&&"array"===Jn(s.value.stops[0])&&"object"===Jn(s.value.stops[0][0]),S=Ai({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(L){if("identity"===a)return[new kt(L.key,L.value,'identity function may not have a "stops" property')];let N=[];const U=L.value;return N=N.concat(Ac({key:L.key,value:U,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),"array"===Jn(U)&&0===U.length&&N.push(new kt(L.key,U,"array must have at least one stop")),N},default:function(L){return hi({key:L.key,value:L.value,valueSpec:r,style:L.style,styleSpec:L.styleSpec})}}});return"identity"===a&&x&&S.push(new kt(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||S.push(new kt(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!md(s.valueSpec)&&S.push(new kt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(C&&!Nl(s.valueSpec)?S.push(new kt(s.key,s.value,"property functions not supported")):x&&!fd(s.valueSpec)&&S.push(new kt(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!E||void 0!==s.value.property||S.push(new kt(s.key,s.value,'"property" property is required')),S;function P(L){let N=[];const U=L.value,Y=L.key;if("array"!==Jn(U))return[new kt(Y,U,`array expected, ${Jn(U)} found`)];if(2!==U.length)return[new kt(Y,U,`array length 2 expected, length ${U.length} found`)];if(E){if("object"!==Jn(U[0]))return[new kt(Y,U,`object expected, ${Jn(U[0])} found`)];if(void 0===U[0].zoom)return[new kt(Y,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new kt(Y,U,"object stop key must have value")];const ne=Lr(U[0].zoom);if("number"!=typeof ne)return[new kt(Y,U[0].zoom,"stop zoom values must be numbers")];if(m&&m>ne)return[new kt(Y,U[0].zoom,"stop zoom values must appear in ascending order")];ne!==m&&(m=ne,d=void 0,_={}),N=N.concat(Ai({key:`${Y}[0]`,value:U[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:li,value:k}}))}else N=N.concat(k({key:`${Y}[0]`,value:U[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},U));return yd($o(U[1]))?N.concat([new kt(`${Y}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(hi({key:`${Y}[1]`,value:U[1],valueSpec:r,style:L.style,styleSpec:L.styleSpec}))}function k(L,N){const U=Jn(L.value),Y=Lr(L.value),ne=null!==L.value?L.value:N;if(c){if(U!==c)return[new kt(L.key,ne,`${U} stop domain type must match previous stop domain type ${c}`)]}else c=U;if("number"!==U&&"string"!==U&&"boolean"!==U&&"number"!=typeof Y&&"string"!=typeof Y&&"boolean"!=typeof Y)return[new kt(L.key,ne,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==a){let de=`number expected, ${U} found`;return Nl(r)&&void 0===a&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(L.key,ne,de)]}return"categorical"!==a||"number"!==U||"number"==typeof Y&&isFinite(Y)&&Math.floor(Y)===Y?"categorical"!==a&&"number"===U&&"number"==typeof Y&&"number"==typeof d&&void 0!==d&&Y<d?[new kt(L.key,ne,"stop domain values must appear in ascending order")]:(d=Y,"categorical"===a&&Y in _?[new kt(L.key,ne,"stop domain values must be unique")]:(_[Y]=!0,[])):[new kt(L.key,ne,`integer expected, found ${String(Y)}`)]}}function Ga(s){const r=("property"===s.expressionContext?jl:Vl)($o(s.value),s.valueSpec);if("error"===r.result)return r.value.map(c=>new kt(`${s.key}${c.key}`,s.value,c.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new kt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!no(a))return[new kt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return sh(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!fr(a,["zoom","feature-state"]))return[new kt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Mc(a))return[new kt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sh(s,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const d of r.valueSpec.expression.parameters)a.delete(d);if(0===a.size)return[];const c=[];return s instanceof fa&&a.has(s.name)?[new kt(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(d=>{c.push(...sh(d,r))}),c)}function $l(s){const r=s.key,a=s.value,c=s.valueSpec,d=[];return Array.isArray(c.values)?-1===c.values.indexOf(Lr(a))&&d.push(new kt(r,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(c.values).indexOf(Lr(a))&&d.push(new kt(r,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function ah(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!ah(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Ha(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ah(s)||(s=Za(s));const a=s;let c=!0;try{c=function(E){if(!Bi(E))return E;let S=$o(E);return Dp(S),S=lh(S),S}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const d=be[`filter_${r}`],m=Vl(c,d);let _=null;if("error"===m.result)throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,S,P)=>m.value.evaluate(E,S,{},P);let x=null,C=null;if(c!==a){const E=Vl(a,d);if("error"===E.result)throw new Error(E.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,P,k,L,N)=>E.value.evaluate(S,P,{},k,void 0,void 0,L,N),C=!Mc(E.value.expression)}return{filter:_,dynamicFilter:x||void 0,needGeometry:qa(c),needFeature:!!C}}function lh(s){if(!Array.isArray(s))return s;const r=function(a){if(xd.has(a[0]))for(let c=1;c<a.length;c++)if(Bi(a[c]))return!0;return a}(s);return!0===r?r:r.map(a=>lh(a))}function Dp(s){let r=!1;const a=[];if("case"===s[0]){for(let c=1;c<s.length-1;c+=2)r=r||Bi(s[c]),a.push(s[c+1]);a.push(s[s.length-1])}else if("match"===s[0]){r=r||Bi(s[1]);for(let c=2;c<s.length-1;c+=2)a.push(s[c+1]);a.push(s[s.length-1])}else if("step"===s[0]){r=r||Bi(s[1]);for(let c=1;c<s.length-1;c+=2)a.push(s[c+1])}r&&(s.length=0,s.push("any",...a));for(let c=1;c<s.length;c++)Dp(s[c])}function Bi(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<s.length;a++)if(Bi(s[a]))return!0;return!1}const xd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function am(s,r){return s<r?-1:s>r?1:0}function qa(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(qa(s[r]))return!0;return!1}function Za(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?oo(s[1],s[2],"=="):"!="===r?Gl(oo(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?oo(s[1],s[2],r):"any"===r?(a=s.slice(1),["any"].concat(a.map(Za))):"all"===r?["all"].concat(s.slice(1).map(Za)):"none"===r?["all"].concat(s.slice(1).map(Za).map(Gl)):"in"===r?Wa(s[1],s.slice(2)):"!in"===r?Gl(Wa(s[1],s.slice(2))):"has"===r?Sp(s[1]):"!has"===r?Gl(Sp(s[1])):"within"!==r||s;var a}function oo(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function Wa(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(am)]]:["filter-in-small",s,["literal",r]]}}function Sp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Gl(s){return["!",s]}function Ip(s){return ah($o(s.value))?Ga(po({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Kr(s)}function Kr(s){const r=s.value,a=s.key;if("array"!==Jn(r))return[new kt(a,r,`array expected, ${Jn(r)} found`)];const c=s.styleSpec;let d,m=[];if(r.length<1)return[new kt(a,r,"filter array must have at least 1 element")];switch(m=m.concat($l({key:`${a}[0]`,value:r[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),Lr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Lr(r[1])&&m.push(new kt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&m.push(new kt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(d=Jn(r[1]),"string"!==d&&m.push(new kt(`${a}[1]`,r[1],`string expected, ${d} found`)));for(let _=2;_<r.length;_++)d=Jn(r[_]),"$type"===Lr(r[1])?m=m.concat($l({key:`${a}[${_}]`,value:r[_],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&m.push(new kt(`${a}[${_}]`,r[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)m=m.concat(Kr({key:`${a}[${_}]`,value:r[_],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":d=Jn(r[1]),2!==r.length?m.push(new kt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==d&&m.push(new kt(`${a}[1]`,r[1],`string expected, ${d} found`));break;case"within":d=Jn(r[1]),2!==r.length?m.push(new kt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==d&&m.push(new kt(`${a}[1]`,r[1],`object expected, ${d} found`))}return m}function Pc(s,r){const a=s.key,c=s.style,d=s.styleSpec,m=s.value,_=s.objectKey,x=d[`${r}_${s.layerType}`];if(!x)return[];const C=_.match(/^(.*)-transition$/);if("paint"===r&&C&&x[C[1]]&&x[C[1]].transition)return hi({key:a,value:m,valueSpec:d.transition,style:c,styleSpec:d});const E=s.valueSpec||x[_];if(!E)return[new kt(a,m,`unknown property "${_}"`)];let S;if("string"===Jn(m)&&Nl(E)&&!E.tokens&&(S=/^{([^}]+)}$/.exec(m)))return[new kt(a,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const P=[];return"symbol"===s.layerType&&("text-field"===_&&c&&!c.glyphs&&P.push(new kt(a,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&gd($o(m))&&"identity"===Lr(m.type)&&P.push(new kt(a,m,'"text-font" does not support identity functions'))),P.concat(hi({key:s.key,value:m,valueSpec:E,style:c,styleSpec:d,expressionContext:"property",propertyType:r,propertyKey:_}))}function Ap(s){return Pc(s,"paint")}function Jr(s){return Pc(s,"layout")}function Pp(s){let r=[];const a=s.value,c=s.key,d=s.style,m=s.styleSpec;a.type||a.ref||r.push(new kt(c,a,'either "type" or "ref" is required'));let _=Lr(a.type);const x=Lr(a.ref);if(a.id){const C=Lr(a.id);for(let E=0;E<s.arrayIndex;E++){const S=d.layers[E];Lr(S.id)===C&&r.push(new kt(c,a.id,`duplicate layer id "${a.id}", previously used at line ${S.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(E=>{E in a&&r.push(new kt(c,a[E],`"${E}" is prohibited for ref layers`))}),d.layers.forEach(E=>{Lr(E.id)===x&&(C=E)}),C?C.ref?r.push(new kt(c,a.ref,"ref cannot reference another ref layer")):_=Lr(C.type):"string"==typeof x&&r.push(new kt(c,a.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(a.source){const C=d.sources&&d.sources[a.source],E=C&&Lr(C.type);C?"vector"===E&&"raster"===_?r.push(new kt(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===E&&"raster"!==_?r.push(new kt(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==E||a["source-layer"]?"raster-dem"===E&&"hillshade"!==_?r.push(new kt(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===E&&C.lineMetrics||r.push(new kt(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new kt(c,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new kt(c,a.source,`source "${a.source}" not found`))}else r.push(new kt(c,a,'missing required property "source"'));return r=r.concat(Ai({key:c,value:a,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hi({key:`${c}.type`,value:a.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:C=>Ip(po({layerType:_},C)),layout:C=>Ai({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":E=>Jr(po({layerType:_},E))}}),paint:C=>Ai({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":E=>Ap(po({layerType:_},E))}})}})),r}function kc(s){const r=s.value,a=s.key,c=Jn(r);return"string"!==c?[new kt(a,r,`string expected, ${c} found`)]:[]}const Xa={promoteId:function({key:s,value:r}){if("string"===Jn(r))return kc({key:s,value:r});{const a=[];for(const c in r)a.push(...kc({key:`${s}.${c}`,value:r[c]}));return a}}};function Io(s){const r=s.value,a=s.key,c=s.styleSpec,d=s.style;if(!r.type)return[new kt(a,r,'"type" is required')];const m=Lr(r.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Ai({key:a,value:r,valueSpec:c[`source_${m.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:Xa}),_;case"geojson":if(_=Ai({key:a,value:r,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:Xa}),r.cluster)for(const x in r.clusterProperties){const[C,E]=r.clusterProperties[x],S="string"==typeof C?[C,["accumulated"],["get",x]]:C;_.push(...Ga({key:`${a}.${x}.map`,value:E,expressionContext:"cluster-map"})),_.push(...Ga({key:`${a}.${x}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return Ai({key:a,value:r,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return Ai({key:a,value:r,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new kt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $l({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:c})}}function bd(s){const r=s.value,a=s.styleSpec,c=a.light,d=s.style;let m=[];const _=Jn(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new kt("light",r,`object expected, ${_} found`)]),m;for(const x in r){const C=x.match(/^(.*)-transition$/);m=m.concat(C&&c[C[1]]&&c[C[1]].transition?hi({key:x,value:r[x],valueSpec:a.transition,style:d,styleSpec:a}):c[x]?hi({key:x,value:r[x],valueSpec:c[x],style:d,styleSpec:a}):[new kt(x,r[x],`unknown property "${x}"`)])}return m}function Oc(s){const r=s.value,a=s.key,c=s.style,d=s.styleSpec,m=d.terrain;let _=[];const x=Jn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new kt("terrain",r,`object expected, ${x} found`)]),_;for(const C in r){const E=C.match(/^(.*)-transition$/);_=_.concat(E&&m[E[1]]&&m[E[1]].transition?hi({key:C,value:r[C],valueSpec:d.transition,style:c,styleSpec:d}):m[C]?hi({key:C,value:r[C],valueSpec:m[C],style:c,styleSpec:d}):[new kt(C,r[C],`unknown property "${C}"`)])}if(r.source){const C=c.sources&&c.sources[r.source],E=C&&Lr(C.type);C?"raster-dem"!==E&&_.push(new kt(a,r.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):_.push(new kt(a,r.source,`source "${r.source}" not found`))}else _.push(new kt(a,r,'terrain is missing required property "source"'));return _}function Ya(s){const r=s.value,a=s.style,c=s.styleSpec,d=c.fog;let m=[];const _=Jn(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new kt("fog",r,`object expected, ${_} found`)]),m;for(const x in r){const C=x.match(/^(.*)-transition$/);m=m.concat(C&&d[C[1]]&&d[C[1]].transition?hi({key:x,value:r[x],valueSpec:c.transition,style:a,styleSpec:c}):d[x]?hi({key:x,value:r[x],valueSpec:d[x],style:a,styleSpec:c}):[new kt(x,r[x],`unknown property "${x}"`)])}return m}const Hi={"*":()=>[],array:Ac,boolean:function(s){const r=s.value,a=s.key,c=Jn(r);return"boolean"!==c?[new kt(a,r,`boolean expected, ${c} found`)]:[]},number:li,color:function(s){const r=s.key,a=s.value,c=Jn(a);return"string"!==c?[new kt(r,a,`color expected, ${c} found`)]:null===Sn.parseCSSColor(a)?[new kt(r,a,`color expected, "${a}" found`)]:[]},enum:$l,filter:Ip,function:oh,layer:Pp,object:Ai,source:Io,light:bd,terrain:Oc,fog:Ya,string:kc,formatted:function(s){return 0===kc(s).length?[]:Ga(s)},resolvedImage:function(s){return 0===kc(s).length?[]:Ga(s)},projection:function(s){const r=s.value,a=s.styleSpec,c=a.projection,d=s.style;let m=[];const _=Jn(r);if("object"===_)for(const x in r)m=m.concat(hi({key:x,value:r[x],valueSpec:c[x],style:d,styleSpec:a}));else"string"!==_&&(m=m.concat([new kt("projection",r,`object or string expected, ${_} found`)]));return m}};function hi(s){const r=s.value,a=s.valueSpec,c=s.styleSpec;return a.expression&&gd(Lr(r))?oh(s):a.expression&&yd($o(r))?Ga(s):a.type&&Hi[a.type]?Hi[a.type](s):Ai(po({},s,{valueSpec:a.type?c[a.type]:a}))}function ch(s){const r=s.value,a=s.key,c=kc(s);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new kt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new kt(a,r,'"glyphs" url must include a "{range}" token'))),c}function kp(s,r=be){return Ao(hi({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:ch,"*":()=>[]}}))}const Gs=s=>Ao(Ap(s)),Op=s=>Ao(Jr(s));function Ao(s){return s.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Mn(s,r){let a=!1;if(r&&r.length)for(const c of r)s.fire(new cr(new Error(c.message))),a=!0;return a}var Ka=Hs;function Hs(s,r,a){var c=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var d=new Int32Array(this.arrayBuffer);s=d[0],this.d=(r=d[1])+2*(a=d[2]);for(var m=0;m<this.d*this.d;m++){var _=d[3+m],x=d[3+m+1];c.push(_===x?null:d.subarray(_,x))}var C=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],C),this.bboxes=d.subarray(C),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=a,this.scale=r/s,this.uid=0;var S=a/r*s;this.min=-S,this.max=s+S}Hs.prototype.insert=function(s,r,a,c,d){this._forEachCell(r,a,c,d,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)},Hs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Hs.prototype._insertCell=function(s,r,a,c,d,m){this.cells[d].push(m)},Hs.prototype.query=function(s,r,a,c,d){var m=this.min,_=this.max;if(s<=m&&r<=m&&_<=a&&_<=c&&!d)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(s,r,a,c,this._queryCell,x,{},d),x},Hs.prototype._queryCell=function(s,r,a,c,d,m,_,x){var C=this.cells[d];if(null!==C)for(var E=this.keys,S=this.bboxes,P=0;P<C.length;P++){var k=C[P];if(void 0===_[k]){var L=4*k;(x?x(S[L+0],S[L+1],S[L+2],S[L+3]):s<=S[L+2]&&r<=S[L+3]&&a>=S[L+0]&&c>=S[L+1])?(_[k]=!0,m.push(E[k])):_[k]=!1}}},Hs.prototype._forEachCell=function(s,r,a,c,d,m,_,x){for(var C=this._convertToCellCoord(s),E=this._convertToCellCoord(r),S=this._convertToCellCoord(a),P=this._convertToCellCoord(c),k=C;k<=S;k++)for(var L=E;L<=P;L++){var N=this.d*L+k;if((!x||x(this._convertFromCellCoord(k),this._convertFromCellCoord(L),this._convertFromCellCoord(k+1),this._convertFromCellCoord(L+1)))&&d.call(this,s,r,a,c,N,m,_,x))return}},Hs.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Hs.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Hs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var d=new Int32Array(r+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=r,_=0;_<s.length;_++){var x=s[_];d[3+_]=m,d.set(x,m),m+=x.length}return d[3+s.length]=m,d.set(this.keys,m),d[3+s.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};const uh={};function Ot(s,r,a={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),uh[r]={klass:s,omit:a.omit||[]}}Ot(Object,"Object"),Ka.serialize=function(s,r){const a=s.toArrayBuffer();return r&&r.push(a),{buffer:a}},Ka.deserialize=function(s){return new Ka(s.buffer)},Object.defineProperty(Ka,"name",{value:"Grid"}),Ot(Ka,"Grid"),Ot(Wr,"Color"),Ot(Error,"Error"),Ot(me,"AJAXError"),Ot(jr,"ResolvedImage"),Ot(ih,"StylePropertyFunction"),Ot(_d,"StyleExpression",{omit:["_evaluator"]}),Ot(Ul,"ZoomDependentExpression"),Ot(vd,"ZoomConstantExpression"),Ot(fa,"CompoundExpression",{omit:["_evaluate"]});for(const s in io)uh[io[s]._classRegistryKey]||Ot(io[s],`Expression${s}`);function Rp(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function wd(s){return H.ImageBitmap&&s instanceof H.ImageBitmap}function Rc(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Rp(s)||wd(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof H.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const c of s)a.push(Rc(c,r));return a}if("object"==typeof s){const a=s.constructor,c=a._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const d=a.serialize?a.serialize(s,r):{};if(!a.serialize){for(const m in s)s.hasOwnProperty(m)&&(uh[c].omit.indexOf(m)>=0||(d[m]=Rc(s[m],r)));s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof s)}function Lc(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Rp(s)||wd(s)||ArrayBuffer.isView(s)||s instanceof H.ImageData)return s;if(Array.isArray(s))return s.map(Lc);if("object"==typeof s){const r=s.$name||"Object",{klass:a}=uh[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const c=Object.create(a.prototype);for(const d of Object.keys(s))"$name"!==d&&(c[d]=Lc(s[d]));return c}throw new Error("can't deserialize object of type "+typeof s)}class lt{constructor(){this.first=!0}update(r,a){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const er=s=>s>=1536&&s<=1791,qs=s=>s>=1872&&s<=1919,Zo=s=>s>=2208&&s<=2303,di=s=>s>=11904&&s<=12031,Cd=s=>s>=12032&&s<=12255,Zs=s=>s>=12272&&s<=12287,Po=s=>s>=12288&&s<=12351,Hl=s=>s>=12352&&s<=12447,ql=s=>s>=12448&&s<=12543,Lp=s=>s>=12544&&s<=12591,Ed=s=>s>=12704&&s<=12735,Fp=s=>s>=12736&&s<=12783,Zl=s=>s>=12784&&s<=12799,Pi=s=>s>=12800&&s<=13055,Wo=s=>s>=13056&&s<=13311,Md=s=>s>=13312&&s<=19903,ga=s=>s>=19968&&s<=40959,Es=s=>s>=40960&&s<=42127,hh=s=>s>=42128&&s<=42191,Td=s=>s>=44032&&s<=55215,zp=s=>s>=63744&&s<=64255,Dd=s=>s>=64336&&s<=65023,dh=s=>s>=65040&&s<=65055,Ws=s=>s>=65072&&s<=65103,Sd=s=>s>=65104&&s<=65135,Fc=s=>s>=65136&&s<=65279,ph=s=>s>=65280&&s<=65519;function Ja(s){for(const r of s)if(u(r.charCodeAt(0)))return!0;return!1}function f(s){for(const r of s)if(!o(r.charCodeAt(0)))return!1;return!0}function o(s){return!(er(s)||qs(s)||Zo(s)||Dd(s)||Fc(s))}function u(s){return!(746!==s&&747!==s&&(s<4352||!(Ed(s)||Lp(s)||Ws(s)&&!(s>=65097&&s<=65103)||zp(s)||Wo(s)||di(s)||Fp(s)||!(!Po(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Md(s)||ga(s)||Pi(s)||(r=s,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(s)||(r=>r>=55216&&r<=55295)(s)||(r=>r>=4352&&r<=4607)(s)||Td(s)||Hl(s)||Zs(s)||(r=>r>=12688&&r<=12703)(s)||Cd(s)||Zl(s)||ql(s)&&12540!==s||!(!ph(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Sd(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(r=>r>=5120&&r<=5759)(s)||(r=>r>=6320&&r<=6399)(s)||dh(s)||(r=>r>=19904&&r<=19967)(s)||Es(s)||hh(s))));var r}function g(s){return!(u(s)||(r=s,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Po(r)||ql(r)||(a=>a>=57344&&a<=63743)(r)||Ws(r)||Sd(r)||ph(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function v(s){return s>=1424&&s<=2303||Dd(s)||Fc(s)}function b(s,r){return!(!r&&v(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(a=s,a>=6016&&a<=6143));var a}function T(s){for(const r of s)if(v(r.charCodeAt(0)))return!0;return!1}const D="deferred",I="loading",O="loaded";let R=null,B="unavailable",$=null;const Z=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(B="error"),R&&R(s)};function X(){G.fire(new Kn("pluginStateChange",{pluginStatus:B,pluginURL:$}))}const G=new sr,ie=function(){return B},W=function(){if(B!==D||!$)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");B=I,X(),$&&_e({url:$},s=>{s?Z(s):(B=O,X())})},J={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>B===O||null!=J.applyArabicShaping,isLoading:()=>B===I,setState(s){B=s.pluginStatus,$=s.pluginURL},isParsed:()=>null!=J.applyArabicShaping&&null!=J.processBidirectionalText&&null!=J.processStyledBidirectionalText,getPluginURL:()=>$};class q{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lt,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,c){for(const d of a)if(!b(d.charCodeAt(0),c))return!1;return!0}(r,J.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*a}}}class ue{constructor(r,a){this.property=r,this.value=a,this.expression=function(c,d){if(gd(c))return new ih(c,d);if(yd(c)){const m=jl(c,d);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=c;return"string"==typeof c&&"color"===d.type&&(m=Wr.parse(c)),{kind:"constant",evaluate:()=>m}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,c){return this.property.possiblyEvaluate(this,r,a,c)}}class te{constructor(r){this.property=r,this.value=new ue(r,void 0)}transitioned(r,a){return new pe(this.property,this.value,a,je({},r.transition,this.transition),r.now)}untransitioned(){return new pe(this.property,this.value,null,{},0)}}class oe{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return qt(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].value=new ue(this._values[r].property,null===a?void 0:qt(a))}getTransition(r){return qt(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].transition=qt(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c);const d=this.getTransition(a);void 0!==d&&(r[`${a}-transition`]=d)}return r}transitioned(r,a){const c=new Pe(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(r,a._values[d]);return c}untransitioned(){const r=new Pe(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class pe{constructor(r,a,c,d,m){const _=d.delay||0,x=d.duration||0;m=m||0,this.property=r,this.value=a,this.begin=m+_,this.end=this.begin+x,r.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(r,a,c){const d=r.now||0,m=this.value.possiblyEvaluate(r,a,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(r,a,c);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,a,c),m,dt(x))}}return m}}class Pe{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,c){const d=new at(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(r,a,c);return d}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Be{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return qt(this._values[r].value)}setValue(r,a){this._values[r]=new ue(this._values[r].property,null===a?void 0:qt(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c)}return r}possiblyEvaluate(r,a,c){const d=new at(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(r,a,c);return d}}class ke{constructor(r,a,c){this.property=r,this.value=a,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,c,d){return this.property.evaluate(this.value,this.parameters,r,a,c,d)}}class at{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ae{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,c){const d=Us[this.specification.type];return d?d(r,a,c):r}}class Ie{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,c,d){return new ke(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},c,d)}:r.expression,a)}interpolate(r,a,c){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new ke(this,{kind:"constant",value:void 0},r.parameters);const d=Us[this.specification.type];return d?new ke(this,{kind:"constant",value:d(r.value.value,a.value.value,c)},r.parameters):r}evaluate(r,a,c,d,m,_){return"constant"===r.kind?r.value:r.evaluate(a,c,d,m,_)}}class Ze extends Ie{possiblyEvaluate(r,a,c,d){if(void 0===r.value)return new ke(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},c,d),_="resolvedImage"===r.property.specification.type&&"string"!=typeof m?m.name:m,x=this._calculate(_,_,_,a);return new ke(this,{kind:"constant",value:x},a)}if("camera"===r.expression.kind){const m=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new ke(this,{kind:"constant",value:m},a)}return new ke(this,r.expression,a)}evaluate(r,a,c,d,m,_){if("source"===r.kind){const x=r.evaluate(a,c,d,m,_);return this._calculate(x,x,x,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},c,d),r.evaluate({zoom:Math.floor(a.zoom)},c,d),r.evaluate({zoom:Math.floor(a.zoom)+1},c,d),a):r.value}_calculate(r,a,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:r,to:a,other:c}:{from:c,to:a,other:r}}interpolate(r){return r}}class bt{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,d){if(void 0!==r.value){if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},c,d);return this._calculate(m,m,m,a)}return this._calculate(r.expression.evaluate(new q(Math.floor(a.zoom-1),a)),r.expression.evaluate(new q(Math.floor(a.zoom),a)),r.expression.evaluate(new q(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:c,to:a}}interpolate(r){return r}}class qe{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,d){return!!r.expression.evaluate(a,null,{},c,d)}interpolate(){return!1}}class Rt{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new q(0,{});for(const c in r){const d=r[c];d.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new ue(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new te(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate(a)}}}function mt(s,r){return 256*(s=Ve(Math.floor(s),0,255))+Ve(Math.floor(r),0,255)}Ot(Ie,"DataDrivenProperty"),Ot(ae,"DataConstantProperty"),Ot(Ze,"CrossFadedDataDrivenProperty"),Ot(bt,"CrossFadedProperty"),Ot(qe,"ColorRampProperty");const vt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _t{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function It(s,r=1){let a=0,c=0;return{members:s.map(d=>{const m=vt[d.type].BYTES_PER_ELEMENT,_=a=Jt(a,Math.max(r,m)),x=d.components||1;return c=Math.max(c,m),a+=m*x,{name:d.name,type:d.type,components:x,offset:_}}),size:Jt(a,Math.max(c,r)),alignment:r}}function Jt(s,r){return Math.ceil(s/r)*r}class mn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const d=2*r;return this.int16[d+0]=a,this.int16[d+1]=c,r}}mn.prototype.bytesPerElement=4,Ot(mn,"StructArrayLayout2i4");class Nt extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,c)}emplace(r,a,c,d){const m=3*r;return this.int16[m+0]=a,this.int16[m+1]=c,this.int16[m+2]=d,r}}Nt.prototype.bytesPerElement=6,Ot(Nt,"StructArrayLayout3i6");class ln extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,d)}emplace(r,a,c,d,m){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=m,r}}ln.prototype.bytesPerElement=8,Ot(ln,"StructArrayLayout4i8");class Qn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,d,m,_,x)}emplace(r,a,c,d,m,_,x,C){const E=6*r,S=12*r,P=3*r;return this.int16[E+0]=a,this.int16[E+1]=c,this.uint8[S+4]=d,this.uint8[S+5]=m,this.uint8[S+6]=_,this.uint8[S+7]=x,this.float32[P+2]=C,r}}Qn.prototype.bytesPerElement=12,Ot(Qn,"StructArrayLayout2i4ub1f12");class Mr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,d)}emplace(r,a,c,d,m){const _=4*r;return this.float32[_+0]=a,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=m,r}}Mr.prototype.bytesPerElement=16,Ot(Mr,"StructArrayLayout4f16");class Sr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C,E,S){const P=this.length;return this.resize(P+1),this.emplace(P,r,a,c,d,m,_,x,C,E,S)}emplace(r,a,c,d,m,_,x,C,E,S,P){const k=10*r;return this.uint16[k+0]=a,this.uint16[k+1]=c,this.uint16[k+2]=d,this.uint16[k+3]=m,this.uint16[k+4]=_,this.uint16[k+5]=x,this.uint16[k+6]=C,this.uint16[k+7]=E,this.uint16[k+8]=S,this.uint16[k+9]=P,r}}Sr.prototype.bytesPerElement=20,Ot(Sr,"StructArrayLayout10ui20");class mr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,d,m,_,x,C)}emplace(r,a,c,d,m,_,x,C,E){const S=8*r;return this.uint16[S+0]=a,this.uint16[S+1]=c,this.uint16[S+2]=d,this.uint16[S+3]=m,this.uint16[S+4]=_,this.uint16[S+5]=x,this.uint16[S+6]=C,this.uint16[S+7]=E,r}}mr.prototype.bytesPerElement=16,Ot(mr,"StructArrayLayout8ui16");class fo extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,c,d,m,_)}emplace(r,a,c,d,m,_,x){const C=6*r;return this.int16[C+0]=a,this.int16[C+1]=c,this.int16[C+2]=d,this.int16[C+3]=m,this.int16[C+4]=_,this.int16[C+5]=x,r}}fo.prototype.bytesPerElement=12,Ot(fo,"StructArrayLayout6i12");class Ci extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C,E,S,P,k){const L=this.length;return this.resize(L+1),this.emplace(L,r,a,c,d,m,_,x,C,E,S,P,k)}emplace(r,a,c,d,m,_,x,C,E,S,P,k,L){const N=12*r;return this.int16[N+0]=a,this.int16[N+1]=c,this.int16[N+2]=d,this.int16[N+3]=m,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=C,this.uint16[N+7]=E,this.int16[N+8]=S,this.int16[N+9]=P,this.int16[N+10]=k,this.int16[N+11]=L,r}}Ci.prototype.bytesPerElement=24,Ot(Ci,"StructArrayLayout4i4ui4i24");class Xs extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,c,d,m,_)}emplace(r,a,c,d,m,_,x){const C=10*r,E=5*r;return this.int16[C+0]=a,this.int16[C+1]=c,this.int16[C+2]=d,this.float32[E+2]=m,this.float32[E+3]=_,this.float32[E+4]=x,r}}Xs.prototype.bytesPerElement=20,Ot(Xs,"StructArrayLayout3i3f20");class gr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}gr.prototype.bytesPerElement=4,Ot(gr,"StructArrayLayout1ul4");class Ir extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C,E,S,P,k,L){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,c,d,m,_,x,C,E,S,P,k,L)}emplace(r,a,c,d,m,_,x,C,E,S,P,k,L,N){const U=20*r,Y=10*r;return this.int16[U+0]=a,this.int16[U+1]=c,this.int16[U+2]=d,this.int16[U+3]=m,this.int16[U+4]=_,this.float32[Y+3]=x,this.float32[Y+4]=C,this.float32[Y+5]=E,this.float32[Y+6]=S,this.int16[U+14]=P,this.uint32[Y+8]=k,this.uint16[U+18]=L,this.uint16[U+19]=N,r}}Ir.prototype.bytesPerElement=40,Ot(Ir,"StructArrayLayout5i4f1i1ul2ui40");class Zn extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,d,m,_,x)}emplace(r,a,c,d,m,_,x,C){const E=8*r;return this.int16[E+0]=a,this.int16[E+1]=c,this.int16[E+2]=d,this.int16[E+4]=m,this.int16[E+5]=_,this.int16[E+6]=x,this.int16[E+7]=C,r}}Zn.prototype.bytesPerElement=16,Ot(Zn,"StructArrayLayout3i2i2i16");class $r extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,d,m)}emplace(r,a,c,d,m,_){const x=4*r,C=8*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=d,this.int16[C+6]=m,this.int16[C+7]=_,r}}$r.prototype.bytesPerElement=16,Ot($r,"StructArrayLayout2f1f2i16");class Ei extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,d)}emplace(r,a,c,d,m){const _=12*r,x=3*r;return this.uint8[_+0]=a,this.uint8[_+1]=c,this.float32[x+1]=d,this.float32[x+2]=m,r}}Ei.prototype.bytesPerElement=12,Ot(Ei,"StructArrayLayout2ub2f12");class wr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,c)}emplace(r,a,c,d){const m=3*r;return this.float32[m+0]=a,this.float32[m+1]=c,this.float32[m+2]=d,r}}wr.prototype.bytesPerElement=12,Ot(wr,"StructArrayLayout3f12");class zr extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,c)}emplace(r,a,c,d){const m=3*r;return this.uint16[m+0]=a,this.uint16[m+1]=c,this.uint16[m+2]=d,r}}zr.prototype.bytesPerElement=6,Ot(zr,"StructArrayLayout3ui6");class _a extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge)}emplace(r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge,ye){const Re=30*r,Le=15*r,We=60*r;return this.int16[Re+0]=a,this.int16[Re+1]=c,this.int16[Re+2]=d,this.float32[Le+2]=m,this.float32[Le+3]=_,this.uint16[Re+8]=x,this.uint16[Re+9]=C,this.uint32[Le+5]=E,this.uint32[Le+6]=S,this.uint32[Le+7]=P,this.uint16[Re+16]=k,this.uint16[Re+17]=L,this.uint16[Re+18]=N,this.float32[Le+10]=U,this.float32[Le+11]=Y,this.uint8[We+48]=ne,this.uint8[We+49]=de,this.uint8[We+50]=he,this.uint32[Le+13]=fe,this.int16[Re+28]=ge,this.uint8[We+58]=ye,r}}_a.prototype.bytesPerElement=60,Ot(_a,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class as extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge,ye,Re,Le,We,it,Ae,$e,ot,st){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge,ye,Re,Le,We,it,Ae,$e,ot,st)}emplace(r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y,ne,de,he,fe,ge,ye,Re,Le,We,it,Ae,$e,ot,st,Tt){const et=38*r,pt=19*r;return this.int16[et+0]=a,this.int16[et+1]=c,this.int16[et+2]=d,this.float32[pt+2]=m,this.float32[pt+3]=_,this.int16[et+8]=x,this.int16[et+9]=C,this.int16[et+10]=E,this.int16[et+11]=S,this.int16[et+12]=P,this.int16[et+13]=k,this.uint16[et+14]=L,this.uint16[et+15]=N,this.uint16[et+16]=U,this.uint16[et+17]=Y,this.uint16[et+18]=ne,this.uint16[et+19]=de,this.uint16[et+20]=he,this.uint16[et+21]=fe,this.uint16[et+22]=ge,this.uint16[et+23]=ye,this.uint16[et+24]=Re,this.uint16[et+25]=Le,this.uint16[et+26]=We,this.uint16[et+27]=it,this.uint16[et+28]=Ae,this.uint32[pt+15]=$e,this.float32[pt+16]=ot,this.float32[pt+17]=st,this.float32[pt+18]=Tt,r}}as.prototype.bytesPerElement=76,Ot(as,"StructArrayLayout3i2f6i15ui1ul3f76");class Qa extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Qa.prototype.bytesPerElement=4,Ot(Qa,"StructArrayLayout1f4");class el extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,d,m,_,x)}emplace(r,a,c,d,m,_,x,C){const E=7*r;return this.float32[E+0]=a,this.float32[E+1]=c,this.float32[E+2]=d,this.float32[E+3]=m,this.float32[E+4]=_,this.float32[E+5]=x,this.float32[E+6]=C,r}}el.prototype.bytesPerElement=28,Ot(el,"StructArrayLayout7f28");class ls extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,d,m)}emplace(r,a,c,d,m,_){const x=5*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=d,this.float32[x+3]=m,this.float32[x+4]=_,r}}ls.prototype.bytesPerElement=20,Ot(ls,"StructArrayLayout5f20");class pi extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,d)}emplace(r,a,c,d,m){const _=6*r;return this.uint32[3*r+0]=a,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=m,r}}pi.prototype.bytesPerElement=12,Ot(pi,"StructArrayLayout1ul3ui12");class ko extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const d=2*r;return this.uint16[d+0]=a,this.uint16[d+1]=c,r}}ko.prototype.bytesPerElement=4,Ot(ko,"StructArrayLayout2ui4");class cs extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}cs.prototype.bytesPerElement=2,Ot(cs,"StructArrayLayout1ui2");class ya extends gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const d=2*r;return this.float32[d+0]=a,this.float32[d+1]=c,r}}ya.prototype.bytesPerElement=8,Ot(ya,"StructArrayLayout2f8");class zc extends _t{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}zc.prototype.size=12;class c_ extends fo{get(r){return new zc(this,r)}}Ot(c_,"FillExtrusionExtArray");class so extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}so.prototype.size=40;class Id extends Ir{get(r){return new so(this,r)}}Ot(Id,"CollisionBoxArray");class u_ extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}u_.prototype.size=60;class lm extends _a{get(r){return new u_(this,r)}}Ot(lm,"PlacedSymbolArray");class fh extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}fh.prototype.size=76;class Bc extends as{get(r){return new fh(this,r)}}Ot(Bc,"SymbolInstanceArray");class Nc extends Qa{getoffsetX(r){return this.float32[1*r+0]}}Ot(Nc,"GlyphOffsetArray");class Vc extends Nt{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Ot(Vc,"SymbolLineVertexArray");class cm extends _t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}cm.prototype.size=12;class Bp extends pi{get(r){return new cm(this,r)}}Ot(Bp,"FeatureIndexArray");class Uc extends _t{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Uc.prototype.size=4;class Yv extends ko{get(r){return new Uc(this,r)}}Ot(Yv,"FillExtrusionCentroidArray");class h_ extends _t{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}h_.prototype.size=12;class Tn extends fo{get(r){return new h_(this,r)}}Ot(Tn,"CircleGlobeExtArray");const Kv=It([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),W1=It([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Jv=Vs(function(s){s.exports=function(r,a){var c,d,m,_,x,C,E,S;for(d=r.length-(c=3&r.length),m=a,x=3432918353,C=461845907,S=0;S<d;)E=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,m=27492+(65535&(_=5*(65535&(m=(m^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*C+(((E>>>16)*C&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,c){case 3:E^=(255&r.charCodeAt(S+2))<<16;case 2:E^=(255&r.charCodeAt(S+1))<<8;case 1:m^=E=(65535&(E=(E=(65535&(E^=255&r.charCodeAt(S)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*C+(((E>>>16)*C&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),X1=Vs(function(s){s.exports=function(r,a){for(var c,d=r.length,m=a^d,_=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++_;switch(d){case 3:m^=(255&r.charCodeAt(_+2))<<16;case 2:m^=(255&r.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Np=Jv,Y1=X1;Np.murmur3=Jv,Np.murmur2=Y1;class um{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,c,d){this.ids.push(mh(r)),this.positions.push(a,c,d)}getPositions(r){const a=mh(r);let c=0,d=this.ids.length-1;for(;c<d;){const _=c+d>>1;this.ids[_]>=a?d=_:c=_+1}const m=[];for(;this.ids[c]===a;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(r,a){const c=new Float64Array(r.ids),d=new Uint32Array(r.positions);return d_(c,d,0,c.length-1),a&&a.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(r){const a=new um;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function mh(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Np(String(s))}function d_(s,r,a,c){for(;a<c;){const d=s[a+c>>1];let m=a-1,_=c+1;for(;;){do{m++}while(s[m]<d);do{_--}while(s[_]>d);if(m>=_)break;hm(s,m,_),hm(r,3*m,3*_),hm(r,3*m+1,3*_+1),hm(r,3*m+2,3*_+2)}_-a<c-_?(d_(s,r,a,_),a=_+1):(d_(s,r,_+1,c),c=_)}}function hm(s,r,a){const c=s[r];s[r]=s[a],s[a]=c}Ot(um,"FeaturePositionMap");class Br{constructor(r,a){this.gl=r.gl,this.location=a}}class gh extends Br{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class _h extends Br{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Qv extends Br{constructor(r,a){super(r,a),this.current=Wr.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const ex=new Float32Array(16),us=new Float32Array(9),tl=new Float32Array(4);function Vp(s){return[mt(255*s.r,255*s.g),mt(255*s.b,255*s.a)]}class Wl{constructor(r,a,c){this.value=r,this.uniformNames=a.map(d=>`u_${d}`),this.type=c}setUniform(r,a,c){r.set(c.constantOr(this.value))}getBinding(r,a,c){return"color"===this.type?new Qv(r,a):new gh(r,a)}}class va{constructor(r,a){this.uniformNames=a.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,c,d){const m="u_pattern_to"===d||"u_dash_to"===d?this.patternTo:"u_pattern_from"===d||"u_dash_from"===d?this.patternFrom:"u_pixel_ratio_to"===d?this.pixelRatioTo:"u_pixel_ratio_from"===d?this.pixelRatioFrom:null;m&&r.set(m)}getBinding(r,a,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new _h(r,a):new gh(r,a)}}class xa{constructor(r,a,c,d){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(r,a,c,d,m,_){const x=this.paintVertexArray.length,C=this.expression.evaluate(new q(0),a,{},m,d,_);this.paintVertexArray.resize(r),this._setPaintValue(x,r,C)}updatePaintArray(r,a,c,d,m){const _=this.expression.evaluate({zoom:0},c,d,void 0,m);this._setPaintValue(r,a,_)}_setPaintValue(r,a,c){if("color"===this.type){const d=Vp(c);for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=r;d<a;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ys{constructor(r,a,c,d,m,_){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,a,c,d,m,_){const x=this.expression.evaluate(new q(this.zoom),a,{},m,d,_),C=this.expression.evaluate(new q(this.zoom+1),a,{},m,d,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(E,r,x,C)}updatePaintArray(r,a,c,d,m){const _=this.expression.evaluate({zoom:this.zoom},c,d,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},c,d,void 0,m);this._setPaintValue(r,a,_,x)}_setPaintValue(r,a,c,d){if("color"===this.type){const m=Vp(c),_=Vp(d);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=Ve(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(d)}getBinding(r,a,c){return new gh(r,a)}}class Xl{constructor(r,a,c,d,m,_,x){this.expression=r,this.type=c,this.useIntegerZoom=d,this.zoom=m,this.layerId=x,this.paintVertexAttributes=("array"===c?W1:Kv).members;for(let C=0;C<a.length;++C);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,a,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(d,r,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(r,a,c,d,m,_){this._setPaintValues(r,a,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(r,a,c,d){if(!d||!c)return;const{min:m,mid:_,max:x}=c,C=d[m],E=d[_],S=d[x];if(C&&E&&S)for(let P=r;P<a;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,C),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,S)}_setPaintValue(r,a,c,d){r.emplace(a,c.tl[0],c.tl[1],c.br[0],c.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],c.pixelRatio,d.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class jc{constructor(r,a,c=(()=>!0)){this.binders={},this._buffers=[];const d=[];for(const m in r.paint._values){if(!c(m))continue;const _=r.paint.get(m);if(!(_ instanceof ke&&Nl(_.property.specification)))continue;const x=hs(m,r.type),C=_.value,E=_.property.specification.type,S=_.property.useIntegerZoom,P=_.property.specification["property-type"],k="cross-faded"===P||"cross-faded-data-driven"===P,L="line-dasharray"===String(m)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==C.kind||L)if("source"===C.kind||L||k){const N=tx(m,E,"source");this.binders[m]=k?new Xl(C,x,E,S,a,N,r.id):new xa(C,x,E,N),d.push(`/a_${m}`)}else{const N=tx(m,E,"composite");this.binders[m]=new Ys(C,x,E,S,a,N),d.push(`/z_${m}`)}else this.binders[m]=k?new va(C.value,x):new Wl(C.value,x,E),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof xa||a instanceof Ys?a.maxValue:0}populatePaintArrays(r,a,c,d,m,_){for(const x in this.binders){const C=this.binders[x];(C instanceof xa||C instanceof Ys||C instanceof Xl)&&C.populatePaintArray(r,a,c,d,m,_)}}setConstantPatternPositions(r,a){for(const c in this.binders){const d=this.binders[c];d instanceof va&&d.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,c,d,m,_){let x=!1;for(const C in r){const E=a.getPositions(C);for(const S of E){const P=c.feature(S.index);for(const k in this.binders){const L=this.binders[k];if((L instanceof xa||L instanceof Ys||L instanceof Xl)&&!0===L.expression.isStateDependent){const N=d.paint.get(k);L.expression=N.value,L.updatePaintArray(S.start,S.end,P,r[C],m,_),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const c=this.binders[a];(c instanceof Wl||c instanceof va)&&r.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof xa||c instanceof Ys||c instanceof Xl)for(let d=0;d<c.paintVertexAttributes.length;d++)r.push(c.paintVertexAttributes[d].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Wl||c instanceof va||c instanceof Ys)for(const d of c.uniformNames)r.push(d)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const c=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof Wl||m instanceof va||m instanceof Ys)for(const _ of m.uniformNames)if(a[_]){const x=m.getBinding(r,a[_],_);c.push({name:_,property:d,binding:x})}}return c}setUniforms(r,a,c,d){for(const{name:m,property:_,binding:x}of a)this.binders[_].setUniform(x,d,c.get(_),m)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const c=this.binders[a];if(r&&c instanceof Xl){const d=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof xa||c instanceof Ys)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const a in this.binders){const c=this.binders[a];(c instanceof xa||c instanceof Ys||c instanceof Xl)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof xa||a instanceof Ys||a instanceof Xl)&&a.destroy()}}}class yh{constructor(r,a,c=(()=>!0)){this.programConfigurations={};for(const d of r)this.programConfigurations[d.id]=new jc(d,a,c);this.needsUpload=!1,this._featureMap=new um,this._bufferOffset=0}populatePaintArrays(r,a,c,d,m,_,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(r,a,d,m,_,x);void 0!==a.id&&this._featureMap.add(a.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,c,d,m){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,a,_,d,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const p_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function hs(s,r){return p_[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const dm={"line-pattern":{source:Sr,composite:Sr},"fill-pattern":{source:Sr,composite:Sr},"fill-extrusion-pattern":{source:Sr,composite:Sr},"line-dasharray":{source:mr,composite:mr}},vh={color:{source:ya,composite:Mr},number:{source:Qa,composite:ya}};function tx(s,r,a){const c=dm[s];return c&&c[a]||vh[r][a]}Ot(Wl,"ConstantBinder"),Ot(va,"CrossFadedConstantBinder"),Ot(xa,"SourceExpressionBinder"),Ot(Xl,"CrossFadedCompositeBinder"),Ot(Ys,"CompositeExpressionBinder"),Ot(jc,"ProgramConfiguration",{omit:["_buffers"]}),Ot(yh,"ProgramConfigurationSet");const Ad="-transition";class Ks extends sr{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Be(a.layout)),a.paint)){this._transitionablePaint=new oe(a.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new at(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,c={}){null!=a&&this._validate(Op,`layers.${this.id}.layout.${r}`,r,a,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return St(r,Ad)?this._transitionablePaint.getTransition(r.slice(0,-Ad.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,c={}){if(null!=a&&this._validate(Gs,`layers.${this.id}.paint.${r}`,r,a,c))return!1;if(St(r,Ad))return this._transitionablePaint.setTransition(r.slice(0,-Ad.length),a||void 0),!1;{const d=this._transitionablePaint._values[r],m="cross-faded-data-driven"===d.property.specification["property-type"],_=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const C=this._transitionablePaint._values[r].value;return C.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(r,x,C)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),an(r,(a,c)=>!(void 0===a||"layout"===c&&!Object.keys(a).length||"paint"===c&&!Object.keys(a).length))}_validate(r,a,c,d,m={}){return(!m||!1!==m.validate)&&Mn(this,r.call(kp,{key:a,layerType:this.type,objectKey:c,value:d,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof ke&&Nl(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ha(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const nx=It([{name:"a_pos",components:2,type:"Int16"}],4),rx=It([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ii{constructor(r=[]){this.segments=r}prepareSegment(r,a,c,d){let m=this.segments[this.segments.length-1];return r>ii.MAX_VERTEX_ARRAY_LENGTH&&vn(`Max vertices per segment is ${ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>ii.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==d&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,c,d){return new ii([{vertexOffset:r,primitiveOffset:a,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(ii,"SegmentVector");var nn=8192;class Yl{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof or?new or(r.lng,r.lat):or.convert(r),this}setSouthWest(r){return this._sw=r instanceof or?new or(r.lng,r.lat):or.convert(r),this}extend(r){const a=this._sw,c=this._ne;let d,m;if(r instanceof or)d=r,m=r;else{if(!(r instanceof Yl))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Yl.convert(r)):this.extend(or.convert(r)):this;if(d=r._sw,m=r._ne,!d||!m)return this}return a||c?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new or(d.lng,d.lat),this._ne=new or(m.lng,m.lat)),this}getCenter(){return new or((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new or(this.getWest(),this.getNorth())}getSouthEast(){return new or(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:c}=or.convert(r);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(r){return!r||r instanceof Yl?r:new Yl(r)}}const Pd=6371008.8;class or{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new or(ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,c=this.lat*a,d=r.lat*a,m=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((r.lng-this.lng)*a);return Pd*Math.acos(Math.min(m,1))}toBounds(r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new Yl(new or(this.lng-c,this.lat-a),new or(this.lng+c,this.lat+a))}static convert(r){if(r instanceof or)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new or(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new or(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ix=2*Math.PI*Pd;function $c(s){return ix*Math.cos(s*Math.PI/180)}function nl(s){return(180+s)/360}function ba(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Ms(s,r){return s/$c(r)}function mo(s){return 360*s-180}function fi(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function pm(s,r){return s*$c(fi(r))}const Xo=85.051129;class rl{constructor(r,a,c=0){this.x=+r,this.y=+a,this.z=+c}static fromLngLat(r,a=0){const c=or.convert(r);return new rl(nl(c.lng),ba(c.lat),Ms(a,c.lat))}toLngLat(){return new or(mo(this.x),fi(this.y))}toAltitude(){return pm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ix*(r=fi(this.y),1/Math.cos(r*Math.PI/180));var r}}function fm(s,r,a,c,d,m,_,x,C){const E=(r+c)/2,S=(a+d)/2,P=new ce(E,S);x(P),function(k,L,N,U,Y,ne){const de=N-Y,he=U-ne;return Math.abs((U-L)*de-(N-k)*he)/Math.hypot(de,he)}(P.x,P.y,m.x,m.y,_.x,_.y)>=C?(fm(s,r,a,E,S,m,P,x,C),fm(s,E,S,c,d,P,_,x,C)):s.push(_)}function Gt(s,r,a){let c=s[0],d=c.x,m=c.y;r(c);const _=[c];for(let x=1;x<s.length;x++){const C=s[x],{x:E,y:S}=C;r(C),fm(_,d,m,E,S,c,C,r,a),d=E,m=S,c=C}return _}function Up(s,r,a,c,d){if(d(r,a)){const m=r.add(a).mult(.5);c(m),Up(s,r,m,c,d),Up(s,m,a,c,d)}else s.push(a)}function ox(s,r,a){let c=s[0];r(c);const d=[c];for(let m=1;m<s.length;m++){const _=s[m];r(_),Up(d,c,_,r,a),c=_}return d}const kd=Math.pow(2,14)-1,xh=-kd-1;function sx(s,r){const a=Math.round(s.x*r),c=Math.round(s.y*r);return s.x=Ve(a,xh,kd),s.y=Ve(c,xh,kd),(a<s.x||a>s.x+1||c<s.y||c>s.y+1)&&vn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function il(s,r,a){const c=s.loadGeometry(),d=s.extent,m=nn/d;if(r&&a&&a.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:x,x:C,y:E,projection:S}=a,P=k=>{const L=mo((r.x+k.x/d)/_),N=fi((r.y+k.y/d)/_),U=S.project(L,N);k.x=(U.x*x-C)*d,k.y=(U.y*x-E)*d};for(let k=0;k<c.length;k++)if(1!==s.type)c[k]=Gt(c[k],P,1);else{const L=[];for(const N of c[k])N.x<0||N.x>=d||N.y<0||N.y>=d||(P(N),L.push(N));c[k]=L}}for(const _ of c)for(const x of _)sx(x,m);return c}function Gc(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?il(s):[]}}function Hc(s,r,a,c,d){s.emplaceBack(2*r+(c+1)/2,2*a+(d+1)/2)}function Ts(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class jp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new mn,this.indexArray=new zr,this.segments=new ii,this.programConfigurations=new yh(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,d){const m=this.layers[0],_=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:E,id:S,index:P,sourceLayerIndex:k}of r){const L=this.layers[0]._featureFilter.needGeometry,N=Gc(E,L);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),N,c))continue;const U=x?x.evaluate(N,{},c):void 0,Y={id:S,properties:E.properties,type:E.type,sourceLayerIndex:k,index:P,geometry:L?N.geometry:il(E,c,d),patterns:{},sortKey:U};_.push(Y)}x&&_.sort((E,S)=>E.sortKey-S.sortKey);let C=null;"globe"===d.projection.name&&(this.globeExtVertexArray=new Tn,C=d.projection);for(const E of _){const{geometry:S,index:P,sourceLayerIndex:k}=E,L=r[P].feature;this.addFeature(E,S,P,a.availableImages,c,C),a.featureIndex.insert(L,S,P,k,this.index)}}update(r,a,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,nx.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,rx.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,c,d,m,_){for(const x of a)for(const C of x){const E=C.x,S=C.y;if(E<0||E>=nn||S<0||S>=nn)continue;if(_){const L=_.projectTilePoint(E,S,m),N=_.upVector(m,E,S),U=this.globeExtVertexArray;Ts(U,L,N),Ts(U,L,N),Ts(U,L,N),Ts(U,L,N)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),k=P.vertexLength;Hc(this.layoutVertexArray,E,S,-1,-1),Hc(this.layoutVertexArray,E,S,1,-1),Hc(this.layoutVertexArray,E,S,1,1),Hc(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},d,m)}}function bh(s,r){for(let a=0;a<s.length;a++)if(Js(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(Js(s,r[a]))return!0;return!!wh(s,r)}function ax(s,r,a){return!!Js(s,r)||!!gm(r,s,a)}function mm(s,r){if(1===s.length)return qc(r,s[0]);for(let a=0;a<r.length;a++){const c=r[a];for(let d=0;d<c.length;d++)if(Js(s,c[d]))return!0}for(let a=0;a<s.length;a++)if(qc(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(wh(s,r[a]))return!0;return!1}function Od(s,r,a){if(s.length>1){if(wh(s,r))return!0;for(let c=0;c<r.length;c++)if(gm(r[c],s,a))return!0}for(let c=0;c<s.length;c++)if(gm(s[c],r,a))return!0;return!1}function wh(s,r){if(0===s.length||0===r.length)return!1;for(let a=0;a<s.length-1;a++){const c=s[a],d=s[a+1];for(let m=0;m<r.length-1;m++)if(f_(c,d,r[m],r[m+1]))return!0}return!1}function f_(s,r,a,c){return Xn(s,a,c)!==Xn(r,a,c)&&Xn(s,r,a)!==Xn(s,r,c)}function gm(s,r,a){const c=a*a;if(1===r.length)return s.distSqr(r[0])<c;for(let d=1;d<r.length;d++)if(m_(s,r[d-1],r[d])<c)return!0;return!1}function m_(s,r,a){const c=r.distSqr(a);if(0===c)return s.distSqr(r);const d=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/c;return s.distSqr(d<0?r:d>1?a:a.sub(r)._mult(d)._add(r))}function qc(s,r){let a,c,d,m=!1;for(let _=0;_<s.length;_++){a=s[_];for(let x=0,C=a.length-1;x<a.length;C=x++)c=a[x],d=a[C],c.y>r.y!=d.y>r.y&&r.x<(d.x-c.x)*(r.y-c.y)/(d.y-c.y)+c.x&&(m=!m)}return m}function Js(s,r){let a=!1;for(let c=0,d=s.length-1;c<s.length;d=c++){const m=s[c],_=s[d];m.y>r.y!=_.y>r.y&&r.x<(_.x-m.x)*(r.y-m.y)/(_.y-m.y)+m.x&&(a=!a)}return a}function g_(s,r,a,c,d){for(const _ of s)if(r<=_.x&&a<=_.y&&c>=_.x&&d>=_.y)return!0;const m=[new ce(r,a),new ce(r,d),new ce(c,d),new ce(c,a)];if(s.length>2)for(const _ of m)if(Js(s,_))return!0;for(let _=0;_<s.length-1;_++)if(K1(s[_],s[_+1],m))return!0;return!1}function K1(s,r,a){const c=a[0],d=a[2];if(s.x<c.x&&r.x<c.x||s.x>d.x&&r.x>d.x||s.y<c.y&&r.y<c.y||s.y>d.y&&r.y>d.y)return!1;const m=Xn(s,r,a[0]);return m!==Xn(s,r,a[1])||m!==Xn(s,r,a[2])||m!==Xn(s,r,a[3])}function Zc(s,r,a){const c=r.paint.get(s).value;return"constant"===c.kind?c.value:a.programConfigurations.get(r.id).getMaxValue(s)}function $p(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function lx(s,r,a,c,d){if(!r[0]&&!r[1])return s;const m=ce.convert(r)._mult(d);"viewport"===a&&m._rotate(-c);const _=[];for(let x=0;x<s.length;x++)_.push(s[x].sub(m));return _}function __(s,r,a,c){const d=ce.convert(s)._mult(c);return"viewport"===r&&d._rotate(-a),d}Ot(jp,"CircleBucket",{omit:["layers"]});const cx=new Rt({"circle-sort-key":new Ie(be.layout_circle["circle-sort-key"])});var ux={paint:new Rt({"circle-radius":new Ie(be.paint_circle["circle-radius"]),"circle-color":new Ie(be.paint_circle["circle-color"]),"circle-blur":new Ie(be.paint_circle["circle-blur"]),"circle-opacity":new Ie(be.paint_circle["circle-opacity"]),"circle-translate":new ae(be.paint_circle["circle-translate"]),"circle-translate-anchor":new ae(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ae(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ae(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ie(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ie(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ie(be.paint_circle["circle-stroke-opacity"])}),layout:cx},Wc=1e-6,Oo=typeof Float32Array<"u"?Float32Array:Array;function y_(){var s=new Oo(9);return Oo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Ro(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Xc(s,r,a){var c=r[0],d=r[1],m=r[2],_=r[3],x=r[4],C=r[5],E=r[6],S=r[7],P=r[8],k=r[9],L=r[10],N=r[11],U=r[12],Y=r[13],ne=r[14],de=r[15],he=a[0],fe=a[1],ge=a[2],ye=a[3];return s[0]=he*c+fe*x+ge*P+ye*U,s[1]=he*d+fe*C+ge*k+ye*Y,s[2]=he*m+fe*E+ge*L+ye*ne,s[3]=he*_+fe*S+ge*N+ye*de,s[4]=(he=a[4])*c+(fe=a[5])*x+(ge=a[6])*P+(ye=a[7])*U,s[5]=he*d+fe*C+ge*k+ye*Y,s[6]=he*m+fe*E+ge*L+ye*ne,s[7]=he*_+fe*S+ge*N+ye*de,s[8]=(he=a[8])*c+(fe=a[9])*x+(ge=a[10])*P+(ye=a[11])*U,s[9]=he*d+fe*C+ge*k+ye*Y,s[10]=he*m+fe*E+ge*L+ye*ne,s[11]=he*_+fe*S+ge*N+ye*de,s[12]=(he=a[12])*c+(fe=a[13])*x+(ge=a[14])*P+(ye=a[15])*U,s[13]=he*d+fe*C+ge*k+ye*Y,s[14]=he*m+fe*E+ge*L+ye*ne,s[15]=he*_+fe*S+ge*N+ye*de,s}function Kl(s,r,a){var c,d,m,_,x,C,E,S,P,k,L,N,U=a[0],Y=a[1],ne=a[2];return r===s?(s[12]=r[0]*U+r[4]*Y+r[8]*ne+r[12],s[13]=r[1]*U+r[5]*Y+r[9]*ne+r[13],s[14]=r[2]*U+r[6]*Y+r[10]*ne+r[14],s[15]=r[3]*U+r[7]*Y+r[11]*ne+r[15]):(d=r[1],m=r[2],_=r[3],x=r[4],C=r[5],E=r[6],S=r[7],P=r[8],k=r[9],L=r[10],N=r[11],s[0]=c=r[0],s[1]=d,s[2]=m,s[3]=_,s[4]=x,s[5]=C,s[6]=E,s[7]=S,s[8]=P,s[9]=k,s[10]=L,s[11]=N,s[12]=c*U+x*Y+P*ne+r[12],s[13]=d*U+C*Y+k*ne+r[13],s[14]=m*U+E*Y+L*ne+r[14],s[15]=_*U+S*Y+N*ne+r[15]),s}function ol(s,r,a){var c=a[0],d=a[1],m=a[2];return s[0]=r[0]*c,s[1]=r[1]*c,s[2]=r[2]*c,s[3]=r[3]*c,s[4]=r[4]*d,s[5]=r[5]*d,s[6]=r[6]*d,s[7]=r[7]*d,s[8]=r[8]*m,s[9]=r[9]*m,s[10]=r[10]*m,s[11]=r[11]*m,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function Yc(s,r,a){var c=Math.sin(a),d=Math.cos(a),m=r[4],_=r[5],x=r[6],C=r[7],E=r[8],S=r[9],P=r[10],k=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=m*d+E*c,s[5]=_*d+S*c,s[6]=x*d+P*c,s[7]=C*d+k*c,s[8]=E*d-m*c,s[9]=S*d-_*c,s[10]=P*d-x*c,s[11]=k*d-C*c,s}function Ch(s,r,a){var c=Math.sin(a),d=Math.cos(a),m=r[0],_=r[1],x=r[2],C=r[3],E=r[8],S=r[9],P=r[10],k=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*d-E*c,s[1]=_*d-S*c,s[2]=x*d-P*c,s[3]=C*d-k*c,s[8]=m*c+E*d,s[9]=_*c+S*d,s[10]=x*c+P*d,s[11]=C*c+k*d,s}function Kc(s,r,a){var c,d,m,_=a[0],x=a[1],C=a[2],E=Math.hypot(_,x,C);return E<Wc?null:(_*=E=1/E,x*=E,C*=E,c=Math.sin(r),d=Math.cos(r),s[0]=_*_*(m=1-d)+d,s[1]=x*_*m+C*c,s[2]=C*_*m-x*c,s[3]=0,s[4]=_*x*m-C*c,s[5]=x*x*m+d,s[6]=C*x*m+_*c,s[7]=0,s[8]=_*C*m+x*c,s[9]=x*C*m-_*c,s[10]=C*C*m+d,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var hx=Xc;function _m(){var s=new Oo(3);return Oo!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function dx(s){var r=new Oo(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function Jl(s){return Math.hypot(s[0],s[1],s[2])}function Ql(s,r,a){var c=new Oo(3);return c[0]=s,c[1]=r,c[2]=a,c}function sl(s,r,a){return s[0]=r[0]+a[0],s[1]=r[1]+a[1],s[2]=r[2]+a[2],s}function Gp(s,r,a){return s[0]=r[0]-a[0],s[1]=r[1]-a[1],s[2]=r[2]-a[2],s}function ym(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s}function wa(s,r,a){return s[0]=Math.min(r[0],a[0]),s[1]=Math.min(r[1],a[1]),s[2]=Math.min(r[2],a[2]),s}function Hp(s,r,a){return s[0]=Math.max(r[0],a[0]),s[1]=Math.max(r[1],a[1]),s[2]=Math.max(r[2],a[2]),s}function Ca(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s}function qp(s,r,a,c){return s[0]=r[0]+a[0]*c,s[1]=r[1]+a[1]*c,s[2]=r[2]+a[2]*c,s}function go(s,r){var a=r[0],c=r[1],d=r[2],m=a*a+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),s[0]=r[0]*m,s[1]=r[1]*m,s[2]=r[2]*m,s}function Ds(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Lo(s,r,a){var c=r[0],d=r[1],m=r[2],_=a[0],x=a[1],C=a[2];return s[0]=d*C-m*x,s[1]=m*_-c*C,s[2]=c*x-d*_,s}function Nr(s,r,a){var c=r[0],d=r[1],m=r[2],_=a[3]*c+a[7]*d+a[11]*m+a[15];return s[0]=(a[0]*c+a[4]*d+a[8]*m+a[12])/(_=_||1),s[1]=(a[1]*c+a[5]*d+a[9]*m+a[13])/_,s[2]=(a[2]*c+a[6]*d+a[10]*m+a[14])/_,s}function vm(s,r,a){var c=a[0],d=a[1],m=a[2],_=r[0],x=r[1],C=r[2],E=d*C-m*x,S=m*_-c*C,P=c*x-d*_,k=d*P-m*S,L=m*E-c*P,N=c*S-d*E,U=2*a[3];return S*=U,P*=U,L*=2,N*=2,s[0]=_+(E*=U)+(k*=2),s[1]=x+S+L,s[2]=C+P+N,s}var Rd,Ss=Gp,px=ym,fx=Jl;function v_(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s[3]=r[3]*a,s}function ec(s,r,a){var c=r[0],d=r[1],m=r[2],_=r[3];return s[0]=a[0]*c+a[4]*d+a[8]*m+a[12]*_,s[1]=a[1]*c+a[5]*d+a[9]*m+a[13]*_,s[2]=a[2]*c+a[6]*d+a[10]*m+a[14]*_,s[3]=a[3]*c+a[7]*d+a[11]*m+a[15]*_,s}function x_(){var s=new Oo(4);return Oo!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function b_(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function w_(s,r,a){a*=.5;var c=r[0],d=r[1],m=r[2],_=r[3],x=Math.sin(a),C=Math.cos(a);return s[0]=c*C+_*x,s[1]=d*C+m*x,s[2]=m*C-d*x,s[3]=_*C-c*x,s}function C_(s,r,a){a*=.5;var c=r[0],d=r[1],m=r[2],_=r[3],x=Math.sin(a),C=Math.cos(a);return s[0]=c*C-m*x,s[1]=d*C+_*x,s[2]=m*C+c*x,s[3]=_*C-d*x,s}_m(),Rd=new Oo(4),Oo!=Float32Array&&(Rd[0]=0,Rd[1]=0,Rd[2]=0,Rd[3]=0),_m(),Ql(1,0,0),Ql(0,1,0),x_(),x_(),y_();class E_{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,c){const d=Ds(a,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/d;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,c[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,a,c){if(U=(L=this.pos)[0],Y=L[1],ne=L[2],de=(N=r)[0],he=N[1],fe=N[2],Math.abs(U-de)<=Wc*Math.max(1,Math.abs(U),Math.abs(de))&&Math.abs(Y-he)<=Wc*Math.max(1,Math.abs(Y),Math.abs(he))&&Math.abs(ne-fe)<=Wc*Math.max(1,Math.abs(ne),Math.abs(fe))||0===a)return c[0]=c[1]=c[2]=0,!1;var L,N,U,Y,ne,de,he,fe;const[d,m,_]=this.dir,x=this.pos[0]-r[0],C=this.pos[1]-r[1],E=this.pos[2]-r[2],S=d*d+m*m+_*_,P=2*(x*d+C*m+E*_),k=P*P-4*S*(x*x+C*C+E*E-a*a);if(k<0){const L=Math.max(-P/2,0),N=x+d*L,U=C+m*L,Y=E+_*L,ne=Math.hypot(N,U,Y);return c[0]=N*a/ne,c[1]=U*a/ne,c[2]=Y*a/ne,!1}{const L=(-P-Math.sqrt(k))/(2*S);if(L<0){const N=Math.hypot(x,C,E);return c[0]=x*a/N,c[1]=C*a/N,c[2]=E*a/N,!1}return c[0]=x+d*L,c[1]=C+m*L,c[2]=E+_*L,!0}}}class xm{constructor(r,a,c,d,m){this.TL=r,this.TR=a,this.BR=c,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(r,a,c){const d=[-1,1,1],m=[1,1,1],_=[1,-1,1],x=[-1,-1,1],C=Nr(d,d,r),E=Nr(m,m,r),S=Nr(_,_,r),P=Nr(x,x,r);return new xm(C,E,S,P,a/c)}}class Jc{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,c,d){const m=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const E=ec([],C,r),S=1/E[3]/a*m;return(P=E)[0]=(k=E)[0]*(L=[S,S,d?1/E[3]:S,S])[0],P[1]=k[1]*L[1],P[2]=k[2]*L[2],P[3]=k[3]*L[3],P;var P,k,L}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const E=go([],Lo([],Ss([],_[C[0]],_[C[1]]),Ss([],_[C[2]],_[C[1]]))),S=-Ds(E,_[C[1]]);return E.concat(S)});return new Jc(_,x)}}class Yo{constructor(r,a){this.min=r,this.max=a,this.center=Ca([],sl([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],c=dx(this.min),d=dx(this.max);for(let m=0;m<a.length;m++)c[m]=a[m]?this.min[m]:this.center[m],d[m]=a[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Yo(c,d)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let c=!0;for(let d=0;d<r.planes.length;d++){const m=r.planes[d];let _=0;for(let x=0;x<a.length;x++)_+=Ds(m,a[x])+m[3]>=0;if(0===_)return 0;_!==a.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const C=r.points[x][d]-this.min[d];m=Math.min(m,C),_=Math.max(_,C)}if(_<0||m>this.max[d]-this.min[d])return 0}return 1}}function Qs(s,r,a,c,d,m,_,x,C){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(C*=s.pixelToTileUnitsFactor);const E=s.tileID.canonical,S=a.projection.upVectorScale(E,a.center.lat,a.worldSize).metersToTile;for(const P of r)for(const k of P){const L=k.add(x),N=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(L.x,L.y,!0):0,U=a.projection.projectTilePoint(L.x,L.y,E);if(N>0){const he=a.projection.upVector(E,L.x,L.y);U.x+=he[0]*S*N,U.y+=he[1]*S*N,U.z+=he[2]*S*N}const Y=m?L:Ld(U.x,U.y,U.z,c),ne=m?s.tilespaceRays.map(he=>T_(he,N)):s.queryGeometry.screenGeometry,de=ec([],[U.x,U.y,U.z,1],c);if(!_&&m?C*=de[3]/a.cameraToCenterDistance:_&&!m&&(C*=a.cameraToCenterDistance/de[3]),m){const he=fi((k.y/nn+E.y)/(1<<E.z));C/=a.projection.pixelsPerMeter(he,1)/Ms(1,he)}if(ax(ne,Y,C))return!0}return!1}function Ld(s,r,a,c){const d=ec([],[s,r,a,1],c);return new ce(d[0]/d[3],d[1]/d[3])}const bm=Ql(0,0,0),M_=Ql(0,0,1);function T_(s,r){const a=_m();return bm[2]=r,s.intersectsPlane(bm,M_,a),new ce(a[0],a[1])}class mx extends jp{}function gx(s,{width:r,height:a},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==r*a*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(r*a*c);return s.width=r,s.height=a,s.data=d,s}function _x(s,r,a){const{width:c,height:d}=r;c===s.width&&d===s.height||(Fd(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,d)},a),s.width=c,s.height=d,s.data=r.data)}function Fd(s,r,a,c,d,m){if(0===d.width||0===d.height)return r;if(d.width>s.width||d.height>s.height||a.x>s.width-d.width||a.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>r.width||d.height>r.height||c.x>r.width-d.width||c.y>r.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=s.data,x=r.data;for(let C=0;C<d.height;C++){const E=((a.y+C)*s.width+a.x)*m,S=((c.y+C)*r.width+c.x)*m;for(let P=0;P<d.width*m;P++)x[S+P]=_[E+P]}return r}Ot(mx,"HeatmapBucket",{omit:["layers"]});class ea{constructor(r,a){gx(this,r,1,a)}resize(r){_x(this,new ea(r),1)}clone(){return new ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,d,m){Fd(r,a,c,d,m,1)}}class _o{constructor(r,a){gx(this,r,4,a)}resize(r){_x(this,new _o(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,d,m){Fd(r,a,c,d,m,4)}}Ot(ea,"AlphaImage"),Ot(_o,"RGBAImage");var J1={paint:new Rt({"heatmap-radius":new Ie(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ie(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ae(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qe(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ae(be.paint_heatmap["heatmap-opacity"])})};function D_(s){const r={},a=s.resolution||256,c=s.clips?s.clips.length:1,d=s.image||new _o({width:a,height:c}),m=(_,x,C)=>{r[s.evaluationKey]=C;const E=s.expression.evaluate(r);d.data[_+x+0]=Math.floor(255*E.r/E.a),d.data[_+x+1]=Math.floor(255*E.g/E.a),d.data[_+x+2]=Math.floor(255*E.b/E.a),d.data[_+x+3]=Math.floor(255*E.a)};if(s.clips)for(let _=0,x=0;_<c;++_,x+=4*a)for(let C=0,E=0;C<a;C++,E+=4){const S=C/(a-1),{start:P,end:k}=s.clips[_];m(x,E,P*(1-S)+k*S)}else for(let _=0,x=0;_<a;_++,x+=4)m(0,x,_/(a-1));return d}var S_={paint:new Rt({"hillshade-illumination-direction":new ae(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ae(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ae(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ae(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ae(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ae(be.paint_hillshade["hillshade-accent-color"])})};const yx=It([{name:"a_pos",components:2,type:"Int16"}],4),{members:vx}=yx;var Zp=zd,xx=zd;function zd(s,r,a){a=a||2;var c,d,m,_,x,C,E,S=r&&r.length,P=S?r[0]*a:s.length,k=Bd(s,0,P,a,!0),L=[];if(!k||k.next===k.prev)return L;if(S&&(k=function(U,Y,ne,de){var he,fe,ge,ye=[];for(he=0,fe=Y.length;he<fe;he++)(ge=Bd(U,Y[he]*de,he<fe-1?Y[he+1]*de:U.length,de,!1))===ge.next&&(ge.steiner=!0),ye.push(Ex(ge));for(ye.sort(Eh),he=0;he<ye.length;he++)ne=al(ne=wm(ye[he],ne),ne.next);return ne}(s,r,k,a)),s.length>80*a){c=m=s[0],d=_=s[1];for(var N=a;N<P;N+=a)(x=s[N])<c&&(c=x),(C=s[N+1])<d&&(d=C),x>m&&(m=x),C>_&&(_=C);E=0!==(E=Math.max(m-c,_-d))?1/E:0}return Qc(k,L,a,c,d,E),L}function Bd(s,r,a,c,d){var m,_;if(d===Xp(s,r,a,c)>0)for(m=r;m<a;m+=c)_=I_(m,s[m],s[m+1],_);else for(m=a-c;m>=r;m-=c)_=I_(m,s[m],s[m+1],_);return _&&Em(_,_.next)&&(Vd(_),_=_.next),_}function al(s,r){if(!s)return s;r||(r=s);var a,c=s;do{if(a=!1,c.steiner||!Em(c,c.next)&&0!==mi(c.prev,c,c.next))c=c.next;else{if(Vd(c),(c=r=c.prev)===c.next)break;a=!0}}while(a||c!==r);return r}function Qc(s,r,a,c,d,m,_){if(s){!_&&m&&function(S,P,k,L){var N=S;do{null===N.z&&(N.z=Cm(N.x,N.y,P,k,L)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(U){var Y,ne,de,he,fe,ge,ye,Re,Le=1;do{for(ne=U,U=null,fe=null,ge=0;ne;){for(ge++,de=ne,ye=0,Y=0;Y<Le&&(ye++,de=de.nextZ);Y++);for(Re=Le;ye>0||Re>0&&de;)0!==ye&&(0===Re||!de||ne.z<=de.z)?(he=ne,ne=ne.nextZ,ye--):(he=de,de=de.nextZ,Re--),fe?fe.nextZ=he:U=he,he.prevZ=fe,fe=he;ne=de}fe.nextZ=null,Le*=2}while(ge>1)}(N)}(s,c,d,m);for(var x,C,E=s;s.prev!==s.next;)if(x=s.prev,C=s.next,m?Gr(s,c,d,m):bx(s))r.push(x.i/a),r.push(s.i/a),r.push(C.i/a),Vd(s),s=C.next,E=C.next;else if((s=C)===E){_?1===_?Qc(s=Nd(al(s),r,a),r,a,c,d,m,2):2===_&&wx(s,r,a,c,d,m):Qc(al(s),r,a,c,d,m,1);break}}}function bx(s){var r=s.prev,a=s,c=s.next;if(mi(r,a,c)>=0)return!1;for(var d=s.next.next;d!==s.prev;){if(Mh(r.x,r.y,a.x,a.y,c.x,c.y,d.x,d.y)&&mi(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Gr(s,r,a,c){var d=s.prev,m=s,_=s.next;if(mi(d,m,_)>=0)return!1;for(var x=d.x>m.x?d.x>_.x?d.x:_.x:m.x>_.x?m.x:_.x,C=d.y>m.y?d.y>_.y?d.y:_.y:m.y>_.y?m.y:_.y,E=Cm(d.x<m.x?d.x<_.x?d.x:_.x:m.x<_.x?m.x:_.x,d.y<m.y?d.y<_.y?d.y:_.y:m.y<_.y?m.y:_.y,r,a,c),S=Cm(x,C,r,a,c),P=s.prevZ,k=s.nextZ;P&&P.z>=E&&k&&k.z<=S;){if(P!==s.prev&&P!==s.next&&Mh(d.x,d.y,m.x,m.y,_.x,_.y,P.x,P.y)&&mi(P.prev,P,P.next)>=0||(P=P.prevZ,k!==s.prev&&k!==s.next&&Mh(d.x,d.y,m.x,m.y,_.x,_.y,k.x,k.y)&&mi(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;P&&P.z>=E;){if(P!==s.prev&&P!==s.next&&Mh(d.x,d.y,m.x,m.y,_.x,_.y,P.x,P.y)&&mi(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;k&&k.z<=S;){if(k!==s.prev&&k!==s.next&&Mh(d.x,d.y,m.x,m.y,_.x,_.y,k.x,k.y)&&mi(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function Nd(s,r,a){var c=s;do{var d=c.prev,m=c.next.next;!Em(d,m)&&Th(d,c,c.next,m)&&eu(d,m)&&eu(m,d)&&(r.push(d.i/a),r.push(c.i/a),r.push(m.i/a),Vd(c),Vd(c.next),c=s=m),c=c.next}while(c!==s);return al(c)}function wx(s,r,a,c,d,m){var _=s;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&Mx(_,x)){var C=tu(_,x);return _=al(_,_.next),C=al(C,C.next),Qc(_,r,a,c,d,m),void Qc(C,r,a,c,d,m)}x=x.next}_=_.next}while(_!==s)}function Eh(s,r){return s.x-r.x}function wm(s,r){var a=function(m,_){var x,C=_,E=m.x,S=m.y,P=-1/0;do{if(S<=C.y&&S>=C.next.y&&C.next.y!==C.y){var k=C.x+(S-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(k<=E&&k>P){if(P=k,k===E){if(S===C.y)return C;if(S===C.next.y)return C.next}x=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!x)return null;if(E===P)return x;var L,N=x,U=x.x,Y=x.y,ne=1/0;C=x;do{E>=C.x&&C.x>=U&&E!==C.x&&Mh(S<Y?E:P,S,U,Y,S<Y?P:E,S,C.x,C.y)&&(L=Math.abs(S-C.y)/(E-C.x),eu(C,m)&&(L<ne||L===ne&&(C.x>x.x||C.x===x.x&&Cx(x,C)))&&(x=C,ne=L)),C=C.next}while(C!==N);return x}(s,r);if(!a)return r;var c=tu(a,s),d=al(a,a.next);return al(c,c.next),r===a?d:r}function Cx(s,r){return mi(s.prev,s,r.prev)<0&&mi(r.next,s,s.next)<0}function Cm(s,r,a,c,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-a)*d)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*d)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Ex(s){var r=s,a=s;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==s);return a}function Mh(s,r,a,c,d,m,_,x){return(d-_)*(r-x)-(s-_)*(m-x)>=0&&(s-_)*(c-x)-(a-_)*(r-x)>=0&&(a-_)*(m-x)-(d-_)*(c-x)>=0}function Mx(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,c){var d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==c.i&&d.next.i!==c.i&&Th(d,d.next,a,c))return!0;d=d.next}while(d!==a);return!1}(s,r)&&(eu(s,r)&&eu(r,s)&&function(a,c){var d=a,m=!1,_=(a.x+c.x)/2,x=(a.y+c.y)/2;do{d.y>x!=d.next.y>x&&d.next.y!==d.y&&_<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next}while(d!==a);return m}(s,r)&&(mi(s.prev,s,r.prev)||mi(s,r.prev,r))||Em(s,r)&&mi(s.prev,s,s.next)>0&&mi(r.prev,r,r.next)>0)}function mi(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function Em(s,r){return s.x===r.x&&s.y===r.y}function Th(s,r,a,c){var d=Wp(mi(s,r,a)),m=Wp(mi(s,r,c)),_=Wp(mi(a,c,s)),x=Wp(mi(a,c,r));return d!==m&&_!==x||!(0!==d||!Dh(s,a,r))||!(0!==m||!Dh(s,c,r))||!(0!==_||!Dh(a,s,c))||!(0!==x||!Dh(a,r,c))}function Dh(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function Wp(s){return s>0?1:s<0?-1:0}function eu(s,r){return mi(s.prev,s,s.next)<0?mi(s,r,s.next)>=0&&mi(s,s.prev,r)>=0:mi(s,r,s.prev)<0||mi(s,s.next,r)<0}function tu(s,r){var a=new Mm(s.i,s.x,s.y),c=new Mm(r.i,r.x,r.y),d=s.next,m=r.prev;return s.next=r,r.prev=s,a.next=d,d.prev=a,c.next=a,a.prev=c,m.next=c,c.prev=m,c}function I_(s,r,a,c){var d=new Mm(s,r,a);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Vd(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Mm(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xp(s,r,a,c){for(var d=0,m=r,_=a-c;m<a;m+=c)d+=(s[_]-s[m])*(s[m+1]+s[_+1]),_=m;return d}function Tx(s,r,a,c,d){A_(s,r,a||0,c||s.length-1,d||Dx)}function A_(s,r,a,c,d){for(;c>a;){if(c-a>600){var m=c-a+1,_=r-a+1,x=Math.log(m),C=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*C*(m-C)/m)*(_-m/2<0?-1:1);A_(s,r,Math.max(a,Math.floor(r-_*C/m+E)),Math.min(c,Math.floor(r+(m-_)*C/m+E)),d)}var S=s[r],P=a,k=c;for(Ud(s,a,r),d(s[c],S)>0&&Ud(s,a,c);P<k;){for(Ud(s,P,k),P++,k--;d(s[P],S)<0;)P++;for(;d(s[k],S)>0;)k--}0===d(s[a],S)?Ud(s,a,k):Ud(s,++k,c),k<=r&&(a=k+1),r<=k&&(c=k-1)}}function Ud(s,r,a){var c=s[r];s[r]=s[a],s[a]=c}function Dx(s,r){return s<r?-1:s>r?1:0}function jd(s,r){const a=s.length;if(a<=1)return[s];const c=[];let d,m;for(let _=0;_<a;_++){const x=Zr(s[_]);0!==x&&(s[_].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(d&&c.push(d),d=[s[_]]):d.push(s[_]))}if(d&&c.push(d),r>1)for(let _=0;_<c.length;_++)c[_].length<=r||(Tx(c[_],r,1,c[_].length-1,Sx),c[_]=c[_].slice(0,r));return c}function Sx(s,r){return r.area-s.area}function Tm(s,r,a){const c=a.patternDependencies;let d=!1;for(const m of r){const _=m.paint.get(`${s}-pattern`);_.isConstant()||(d=!0);const x=_.constantOr(null);x&&(d=!0,c[x.to]=!0,c[x.from]=!0)}return d}function Dm(s,r,a,c,d){const m=d.patternDependencies;for(const _ of r){const x=_.paint.get(`${s}-pattern`).value;if("constant"!==x.kind){let C=x.evaluate({zoom:c-1},a,{},d.availableImages),E=x.evaluate({zoom:c},a,{},d.availableImages),S=x.evaluate({zoom:c+1},a,{},d.availableImages);C=C&&C.name?C.name:C,E=E&&E.name?E.name:E,S=S&&S.name?S.name:S,m[C]=!0,m[E]=!0,m[S]=!0,a.patterns[_.id]={min:C,mid:E,max:S}}}return a}zd.deviation=function(s,r,a,c){var d=r&&r.length,m=Math.abs(Xp(s,0,d?r[0]*a:s.length,a));if(d)for(var _=0,x=r.length;_<x;_++)m-=Math.abs(Xp(s,r[_]*a,_<x-1?r[_+1]*a:s.length,a));var C=0;for(_=0;_<c.length;_+=3){var E=c[_]*a,S=c[_+1]*a,P=c[_+2]*a;C+=Math.abs((s[E]-s[P])*(s[S+1]-s[E+1])-(s[E]-s[S])*(s[P+1]-s[E+1]))}return 0===m&&0===C?0:Math.abs((C-m)/m)},zd.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,d=0;d<s.length;d++){for(var m=0;m<s[d].length;m++)for(var _=0;_<r;_++)a.vertices.push(s[d][m][_]);d>0&&a.holes.push(c+=s[d-1].length)}return a},Zp.default=xx;class $d{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mn,this.indexArray=new zr,this.indexArray2=new ko,this.programConfigurations=new yh(r.layers,r.zoom),this.segments=new ii,this.segments2=new ii,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,c,d){this.hasPattern=Tm("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:C,index:E,sourceLayerIndex:S}of r){const P=this.layers[0]._featureFilter.needGeometry,k=Gc(x,P);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),k,c))continue;const L=m?m.evaluate(k,{},c,a.availableImages):void 0,N={id:C,properties:x.properties,type:x.type,sourceLayerIndex:S,index:E,geometry:P?k.geometry:il(x,c,d),patterns:{},sortKey:L};_.push(N)}m&&_.sort((x,C)=>x.sortKey-C.sortKey);for(const x of _){const{geometry:C,index:E,sourceLayerIndex:S}=x;if(this.hasPattern){const P=Dm("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(P)}else this.addFeature(x,C,E,c,{},a.availableImages);a.featureIndex.insert(r[E].feature,C,E,S,this.index)}}update(r,a,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,d)}addFeatures(r,a,c,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,vx),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,c,d,m,_=[]){for(const x of jd(a,500)){let C=0;for(const N of x)C+=N.length;const E=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),S=E.vertexLength,P=[],k=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&k.push(P.length/2);const U=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Y=U.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Y+N.length-1,Y),P.push(N[0].x),P.push(N[0].y);for(let ne=1;ne<N.length;ne++)this.layoutVertexArray.emplaceBack(N[ne].x,N[ne].y),this.indexArray2.emplaceBack(Y+ne-1,Y+ne),P.push(N[ne].x),P.push(N[ne].y);U.vertexLength+=N.length,U.primitiveLength+=N.length}const L=Zp(P,k);for(let N=0;N<L.length;N+=3)this.indexArray.emplaceBack(S+L[N],S+L[N+1],S+L[N+2]);E.vertexLength+=C,E.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,d)}}Ot($d,"FillBucket",{omit:["layers","patternFeatures"]});const Ix=new Rt({"fill-sort-key":new Ie(be.layout_fill["fill-sort-key"])});var Ax={paint:new Rt({"fill-antialias":new ae(be.paint_fill["fill-antialias"]),"fill-opacity":new Ie(be.paint_fill["fill-opacity"]),"fill-color":new Ie(be.paint_fill["fill-color"]),"fill-outline-color":new Ie(be.paint_fill["fill-outline-color"]),"fill-translate":new ae(be.paint_fill["fill-translate"]),"fill-translate-anchor":new ae(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ze(be.paint_fill["fill-pattern"])}),layout:Ix};const Fo=It([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Sm=It([{name:"a_centroid_pos",components:2,type:"Uint16"}]),P_=It([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Im}=Fo;var ao=Ea;function Ea(s,r,a,c,d){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=d,s.readFields(Am,this,r)}function Am(s,r,a){1==s?r.id=a.readVarint():2==s?function(c,d){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=d._keys[c.readVarint()],x=d._values[c.readVarint()];d.properties[_]=x}}(a,r):3==s?r.type=a.readVarint():4==s&&(r._geometry=a.pos)}function Px(s){for(var r,a,c=0,d=0,m=s.length,_=m-1;d<m;_=d++)c+=((a=s[_]).x-(r=s[d]).x)*(r.y+a.y);return c}Ea.types=["Unknown","Point","LineString","Polygon"],Ea.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,c=1,d=0,m=0,_=0,x=[];s.pos<a;){if(d<=0){var C=s.readVarint();c=7&C,d=C>>3}if(d--,1===c||2===c)m+=s.readSVarint(),_+=s.readSVarint(),1===c&&(r&&x.push(r),r=[]),r.push(new ce(m,_));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},Ea.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,c=0,d=0,m=0,_=1/0,x=-1/0,C=1/0,E=-1/0;s.pos<r;){if(c<=0){var S=s.readVarint();a=7&S,c=S>>3}if(c--,1===a||2===a)(d+=s.readSVarint())<_&&(_=d),d>x&&(x=d),(m+=s.readSVarint())<C&&(C=m),m>E&&(E=m);else if(7!==a)throw new Error("unknown command "+a)}return[_,C,x,E]},Ea.prototype.toGeoJSON=function(s,r,a){var c,d,m=this.extent*Math.pow(2,a),_=this.extent*s,x=this.extent*r,C=this.loadGeometry(),E=Ea.types[this.type];function S(L){for(var N=0;N<L.length;N++){var U=L[N];L[N]=[360*(U.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(c=0;c<C.length;c++)P[c]=C[c][0];S(C=P);break;case 2:for(c=0;c<C.length;c++)S(C[c]);break;case 3:for(C=function(L){var N=L.length;if(N<=1)return[L];for(var U,Y,ne=[],de=0;de<N;de++){var he=Px(L[de]);0!==he&&(void 0===Y&&(Y=he<0),Y===he<0?(U&&ne.push(U),U=[L[de]]):U.push(L[de]))}return U&&ne.push(U),ne}(C),c=0;c<C.length;c++)for(d=0;d<C[c].length;d++)S(C[c][d])}1===C.length?C=C[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:C},properties:this.properties};return"id"in this&&(k.id=this.id),k};var k_=Pm;function Pm(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(kx,this,r),this.length=this._features.length}function kx(s,r,a){15===s?r.version=a.readVarint():1===s?r.name=a.readString():5===s?r.extent=a.readVarint():2===s?r._features.push(a.pos):3===s?r._keys.push(a.readString()):4===s&&r._values.push(function(c){for(var d=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;d=1===_?c.readString():2===_?c.readFloat():3===_?c.readDouble():4===_?c.readVarint64():5===_?c.readVarint():6===_?c.readSVarint():7===_?c.readBoolean():null}return d}(a))}function O_(s,r,a){if(3===s){var c=new k_(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}Pm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new ao(this._pbf,r,this.extent,this._keys,this._values)};var nu={VectorTile:function(s,r){this.layers=s.readFields(O_,{},r)},VectorTileFeature:ao,VectorTileLayer:k_};function Gd(s,r,a,c){const d=[],m=0===c?(_,x,C,E,S,P)=>{_.push(new ce(P,C+(P-x)/(E-x)*(S-C)))}:(_,x,C,E,S,P)=>{_.push(new ce(x+(P-C)/(S-C)*(E-x),P))};for(const _ of s){const x=[];for(const C of _){if(C.length<=2)continue;const E=[];for(let k=0;k<C.length-1;k++){const L=C[k].x,N=C[k].y,U=C[k+1].x,Y=C[k+1].y,ne=0===c?L:N,de=0===c?U:Y;ne<r?de>r&&m(E,L,N,U,Y,r):ne>a?de<a&&m(E,L,N,U,Y,a):E.push(C[k]),de<r&&ne>=r&&m(E,L,N,U,Y,r),de>a&&ne<=a&&m(E,L,N,U,Y,a)}let S=C[C.length-1];const P=0===c?S.x:S.y;P>=r&&P<=a&&E.push(S),E.length&&(S=E[E.length-1],E[0].x===S.x&&E[0].y===S.y||E.push(E[0]),x.push(E))}x.length&&d.push(x)}return d}const Ox=nu.VectorTileFeature.types,Rx=Math.pow(2,13);function Hd(s,r,a,c,d,m,_,x){s.emplaceBack((r<<1)+_,(a<<1)+m,(Math.floor(c*Rx)<<1)+d,Math.round(x))}function qd(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class R_{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(r.x,r.y),this.max=new ce(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,d=this.max;r.x<c.x?c.x=r.x:r.x>d.x&&(d.x=r.x),r.y<c.y?c.y=r.y:r.y>d.y&&(d.y=r.y),((0===r.x||r.x===nn)&&r.x===a.x)!=((0===r.y||r.y===nn)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,In(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>nn!=r.x>nn&&this.addBorderIntersection(1,In(a.y,r.y,(nn-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,In(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>nn!=r.y>nn&&this.addBorderIntersection(3,In(a.x,r.x,(nn-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((a,c)=>a+c.edges,0);return 0!==r?this.acc.div(r)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class Zd{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ln,this.centroidVertexArray=new Yv,this.indexArray=new zr,this.programConfigurations=new yh(r.layers,r.zoom),this.segments=new ii,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,c,d){this.features=[],this.hasPattern=Tm("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/nn/(1<<m.z)}(c);for(const{feature:m,id:_,index:x,sourceLayerIndex:C}of r){const E=this.layers[0]._featureFilter.needGeometry,S=Gc(m,E);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),S,c))continue;const P={id:_,sourceLayerIndex:C,index:x,geometry:E?S.geometry:il(m,c,d),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Dm("fill-extrusion",this.layers,P,this.zoom,a)):this.addFeature(P,P.geometry,x,c,{},a.availableImages,d),a.featureIndex.insert(m,P.geometry,x,C,this.index,k)}this.sortBorders()}addFeatures(r,a,c,d,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,a,c,d,m)}this.sortBorders()}update(r,a,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Im),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,P_.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Sm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,d,m,_,x){const C=[new ce(0,0),new ce(nn,nn)],E=x.projection,S="globe"===E.name,P=this.enableTerrain&&!S?new R_:null;S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new c_);const k=jd(a,500);for(let U=k.length-1;U>=0;U--){const Y=k[U];(0===Y.length||(L=Y[0]).every(ne=>ne.x<=0)||L.every(ne=>ne.x>=nn)||L.every(ne=>ne.y<=0)||L.every(ne=>ne.y>=nn))&&k.splice(U,1)}var L;let N;if(S)N=L_(k,C,d);else{N=[];for(const U of k)N.push({polygon:U,bounds:C})}for(const U of N){const Y=U.polygon;let ne=0,de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Re=0;Re<Y.length;Re++){const Le=Y[Re];if(0===Le.length)continue;ne+=Le.length;let We=0;P&&P.startRing(Le[0]);for(let it=0;it<Le.length;it++){const Ae=Le[it];if(it>=1){const $e=Le[it-1];if(!Sh(Ae,$e,U.bounds)){P&&P.append(Ae,$e),de.vertexLength+4>ii.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ot=Ae.sub($e)._perp(),st=ot.x/(Math.abs(ot.x)+Math.abs(ot.y)),Tt=ot.y>0?1:0,et=$e.dist(Ae);We+et>32768&&(We=0),Hd(this.layoutVertexArray,Ae.x,Ae.y,st,Tt,0,0,We),Hd(this.layoutVertexArray,Ae.x,Ae.y,st,Tt,0,1,We),We+=et,Hd(this.layoutVertexArray,$e.x,$e.y,st,Tt,0,0,We),Hd(this.layoutVertexArray,$e.x,$e.y,st,Tt,0,1,We);const pt=de.vertexLength;if(this.indexArray.emplaceBack(pt,pt+2,pt+1),this.indexArray.emplaceBack(pt+1,pt+2,pt+3),de.vertexLength+=4,de.primitiveLength+=2,S){const gn=this.layoutVertexExtArray,Pn=E.projectTilePoint(Ae.x,Ae.y,d),Wt=E.projectTilePoint($e.x,$e.y,d),Lt=E.upVector(d,Ae.x,Ae.y),zn=E.upVector(d,$e.x,$e.y);qd(gn,Pn,Lt),qd(gn,Pn,Lt),qd(gn,Wt,zn),qd(gn,Wt,zn)}}}}}if(de.vertexLength+ne>ii.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(ne,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ox[r.type])continue;const he=[],fe=[],ge=de.vertexLength;for(let Re=0;Re<Y.length;Re++){const Le=Y[Re];if(0!==Le.length){Le!==Y[0]&&fe.push(he.length/2);for(let We=0;We<Le.length;We++){const it=Le[We];Hd(this.layoutVertexArray,it.x,it.y,0,0,1,1,0),he.push(it.x),he.push(it.y),P&&P.currentPolyCount.top++,S&&qd(this.layoutVertexExtArray,E.projectTilePoint(it.x,it.y,d),E.upVector(d,it.x,it.y))}}}const ye=Zp(he,fe);for(let Re=0;Re<ye.length;Re+=3)this.indexArray.emplaceBack(ge+ye[Re],ge+ye[Re+2],ge+ye[Re+1]);de.primitiveLength+=ye.length/3,de.vertexLength+=ne}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const U=P.borders,Y=this.featuresOnBorder.push(P)-1;for(let ne=0;ne<4;ne++)U[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(Y)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,d)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,c)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,a,c=!0){let d,m;if(r)if(0!==r.y){const x=a.span()._mult(this.tileToMeter);d=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else d=Math.ceil(7*(r.x+450)),m=0;else d=0,m=+c;let _=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let C=0;C<2*x.edges;C++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,d,m);for(let C=0;C<x.top;C++)this.centroidVertexArray.emplace(_++,d,m)}}}function Sh(s,r,a){return s.x===r.x&&(s.x<a[0].x||s.x>a[1].x)||s.y===r.y&&(s.y<a[0].y||s.y>a[1].y)}function Ma(){const s=Math.PI/32,r=Math.tan(s),a=Pd;return a*Math.sqrt(1+2*r*r)-a}function L_(s,r,a){const c=1<<a.z,d=mo(a.x/c),m=mo((a.x+1)/c),_=fi(a.y/c),x=fi((a.y+1)/c);return function(C,E,S,P,k=0,L){const N=[];if(!C.length||!S||!P)return N;const U=(ye,Re)=>{for(const Le of ye)N.push({polygon:Le,bounds:Re})},Y=Math.ceil(Math.log2(S)),ne=Math.ceil(Math.log2(P)),de=Y-ne,he=[];for(let ye=0;ye<Math.abs(de);ye++)he.push(de>0?0:1);for(let ye=0;ye<Math.min(Y,ne);ye++)he.push(0),he.push(1);let fe=C;if(fe=Gd(fe,E[0].y-k,E[1].y+k,1),fe=Gd(fe,E[0].x-k,E[1].x+k,0),!fe.length)return N;const ge=[];for(he.length?ge.push({polygons:fe,bounds:E,depth:0}):U(fe,E);ge.length;){const ye=ge.pop(),Re=ye.depth,Le=he[Re],We=ye.bounds[0],it=ye.bounds[1],Ae=0===Le?We.x:We.y,$e=0===Le?it.x:it.y,ot=L?L(Le,Ae,$e):.5*(Ae+$e),st=Gd(ye.polygons,Ae-k,ot+k,Le),Tt=Gd(ye.polygons,ot-k,$e+k,Le);if(st.length){const et=[We,new ce(0===Le?ot:it.x,1===Le?ot:it.y)];he.length>Re+1?ge.push({polygons:st,bounds:et,depth:Re+1}):U(st,et)}if(Tt.length){const et=[new ce(0===Le?ot:We.x,1===Le?ot:We.y),it];he.length>Re+1?ge.push({polygons:Tt,bounds:et,depth:Re+1}):U(Tt,et)}}return N}(s,r,Math.ceil((m-d)/11.25),Math.ceil((_-x)/11.25),1,(C,E,S)=>{if(0===C)return.5*(E+S);{const P=fi((a.y+E/nn)/c);return(ba(.5*(fi((a.y+S/nn)/c)+P))*c-a.y)*nn}})}Ot(Zd,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(R_,"PartMetadata");var Q1={paint:new Rt({"fill-extrusion-opacity":new ae(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ie(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ae(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ae(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ze(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ie(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ie(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ae(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Lx(s,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[s*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class Wd{constructor(r,a,c){this.z=r,this.x=a,this.y=c,this.key=ru(0,r,r,a,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const c=(_=this.y,x=this.z,C=Lx(256*(m=this.x),256*(_=Math.pow(2,x)-_-1),x),E=Lx(256*(m+1),256*(_+1),x),C[0]+","+C[1]+","+E[0]+","+E[1]),d=function(m,_,x){let C,E="";for(let S=m;S>0;S--)C=1<<S-1,E+=(_&C?1:0)+(x&C?2:0);return E}(this.z,this.x,this.y);var m,_,x,C,E;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fx{constructor(r,a){this.wrap=r,this.canonical=a,this.key=ru(r,a.z,a.z,a.x,a.y)}}class kr{constructor(r,a,c,d,m){this.overscaledZ=r,this.wrap=a,this.canonical=new Wd(c,+d,+m),this.key=0===a&&r===c?this.canonical.key:ru(a,r,c,d,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new kr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new kr(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return ru(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return ru(this.wrap*+a,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new kr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new kr(a,this.wrap,a,c,d),new kr(a,this.wrap,a,c+1,d),new kr(a,this.wrap,a,c,d+1),new kr(a,this.wrap,a,c+1,d+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new kr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new kr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ru(s,r,a,c,d){const m=1<<Math.min(a,22);let _=m*(d%m)+c%m;return s&&a<22&&(_+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*_+a)+(r-a)}function iu(s,r){return s.x*r.x+s.y*r.y}function F_(s,r){if(1===s.length){let a=0;const c=r[a++];let d;for(;!d||c.equals(d);)if(d=r[a++],!d)return 1/0;for(;a<r.length;a++){const m=r[a],_=s[0],x=d.sub(c),C=m.sub(c),E=_.sub(c),S=iu(x,x),P=iu(x,C),k=iu(C,C),L=iu(E,x),N=iu(E,C),U=S*k-P*P,Y=(k*L-P*N)/U,ne=(S*N-P*L)/U,de=c.z*(1-Y-ne)+d.z*Y+m.z*ne;if(isFinite(de))return de}return 1/0}{let a=1/0;for(const c of r)a=Math.min(a,c.z);return a}}function Xd(s){const r=new ce(s[0],s[1]);return r.z=s[2],r}function Ih(s,r,a,c,d,m,_,x){const C=_*d.getElevationAt(s,r,!0,!0),E=0!==m[0],S=E?0===m[1]?_*(m[0]/7-450):_*function(P,k,L){const N=Math.floor(k[0]/8),U=Math.floor(k[1]/8),Y=10*(k[0]-8*N),ne=10*(k[1]-8*U),de=P.getElevationAt(N,U,!0,!0),he=P.getMeterToDEM(L),fe=Math.floor(.5*(Y*he-1)),ge=Math.floor(.5*(ne*he-1)),ye=P.tileCoordToPixel(N,U),Re=2*fe+1,Le=2*ge+1,We=(gn=Re,Pn=Le,[(Tt=P).getElevationAtPixel(et=ye.x-fe,pt=ye.y-ge,!0),Tt.getElevationAtPixel(et+Pn,pt,!0),Tt.getElevationAtPixel(et,pt+Pn,!0),Tt.getElevationAtPixel(et+gn,pt+Pn,!0)]),it=Math.abs(We[0]-We[1]),Ae=Math.abs(We[2]-We[3]),$e=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),ot=Math.min(.25,.5*he*(it+Ae)/Re),st=Math.min(.25,.5*he*$e/Le);var Tt,et,pt,gn,Pn;return de+Math.max(ot*Y,st*ne)}(d,m,x):C;return{base:C+(0===a)?-1:a,top:E?Math.max(S+c,C+a+2):C+c}}Ot(Wd,"CanonicalTileID"),Ot(kr,"OverscaledTileID",{omit:["projMatrix"]});const z_=It([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:B_}=z_,km=It([{name:"a_packed",components:4,type:"Float32"}]),{members:Om}=km,N_=nu.VectorTileFeature.types,ew=Math.cos(Math.PI/180*37.5);class ll{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Qn,this.layoutVertexArray2=new Mr,this.indexArray=new zr,this.programConfigurations=new yh(r.layers,r.zoom),this.segments=new ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,d){this.hasPattern=Tm("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:P,index:k,sourceLayerIndex:L}of r){const N=this.layers[0]._featureFilter.needGeometry,U=Gc(S,N);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),U,c))continue;const Y=m?m.evaluate(U,{},c):void 0,ne={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:k,geometry:N?U.geometry:il(S,c,d),patterns:{},sortKey:Y};_.push(ne)}m&&_.sort((S,P)=>S.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:C}=a,E=this.addConstantDashes(x);for(const S of _){const{geometry:P,index:k,sourceLayerIndex:L}=S;if(E&&this.addFeatureDashes(S,x),this.hasPattern){const N=Dm("line",this.layers,S,this.zoom,a);this.patternFeatures.push(N)}else this.addFeature(S,P,k,c,x.positions,a.availableImages);C.insert(r[k].feature,P,k,L,this.index)}}addConstantDashes(r){let a=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==m.kind)a=!0;else{const _=m.value,x=d.value;if(!x)continue;r.addDash(x.from,_),r.addDash(x.to,_),x.other&&r.addDash(x.other,_)}}return a}addFeatureDashes(r,a){const c=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let x,C,E,S,P,k;if("constant"===m.kind){const Y=m.value;if(!Y)continue;x=Y.other||Y.to,C=Y.to,E=Y.from}else x=m.evaluate({zoom:c-1},r),C=m.evaluate({zoom:c},r),E=m.evaluate({zoom:c+1},r);"constant"===_.kind?S=P=k=_.value:(S=_.evaluate({zoom:c-1},r),P=_.evaluate({zoom:c},r),k=_.evaluate({zoom:c+1},r)),a.addDash(x,S),a.addDash(C,P),a.addDash(E,k);const L=a.getKey(x,S),N=a.getKey(C,P),U=a.getKey(E,k);r.patterns[d.id]={min:L,mid:N,max:U}}}update(r,a,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,d)}addFeatures(r,a,c,d,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Om)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,B_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,c,d,m,_){const x=this.layers[0].layout,C=x.get("line-join").evaluate(r,{}),E=x.get("line-cap").evaluate(r,{}),S=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const k of a)this.addLine(k,r,C,E,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,d)}addLine(r,a,c,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<r.length-1;ne++)this.totalDistance+=r[ne].dist(r[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===N_[a.type];let C=r.length;for(;C>=2&&r[C-1].equals(r[C-2]);)C--;let E=0;for(;E<C-1&&r[E].equals(r[E+1]);)E++;if(C<(x?3:2))return;"bevel"===c&&(m=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let k,L,N,U,Y;this.e1=this.e2=-1,x&&(k=r[C-2],Y=r[E].sub(k)._unit()._perp());for(let ne=E;ne<C;ne++){if(N=ne===C-1?x?r[E+1]:void 0:r[ne+1],N&&r[ne].equals(N))continue;Y&&(U=Y),k&&(L=k),k=r[ne],Y=N?N.sub(k)._unit()._perp():U,U=U||Y;let de=U.add(Y);0===de.x&&0===de.y||de._unit();const he=U.x*Y.x+U.y*Y.y,fe=de.x*Y.x+de.y*Y.y,ge=0!==fe?1/fe:1/0,ye=2*Math.sqrt(2-2*fe),Re=fe<ew&&L&&N,Le=U.x*Y.y-U.y*Y.x>0;if(Re&&ne>E){const Ae=k.dist(L);if(Ae>2*S){const $e=k.sub(k.sub(L)._mult(S/Ae)._round());this.updateDistance(L,$e),this.addCurrentVertex($e,U,0,0,P),L=$e}}const We=L&&N;let it=We?c:x?"butt":d;if(We&&"round"===it&&(ge<_?it="miter":ge<=2&&(it="fakeround")),"miter"===it&&ge>m&&(it="bevel"),"bevel"===it&&(ge>2&&(it="flipbevel"),ge<m&&(it="miter")),L&&this.updateDistance(L,k),"miter"===it)de._mult(ge),this.addCurrentVertex(k,de,0,0,P);else if("flipbevel"===it){if(ge>100)de=Y.mult(-1);else{const Ae=ge*U.add(Y).mag()/U.sub(Y).mag();de._perp()._mult(Ae*(Le?-1:1))}this.addCurrentVertex(k,de,0,0,P),this.addCurrentVertex(k,de.mult(-1),0,0,P)}else if("bevel"===it||"fakeround"===it){const Ae=-Math.sqrt(ge*ge-1),$e=Le?Ae:0,ot=Le?0:Ae;if(L&&this.addCurrentVertex(k,U,$e,ot,P),"fakeround"===it){const st=Math.round(180*ye/Math.PI/20);for(let Tt=1;Tt<st;Tt++){let et=Tt/st;if(.5!==et){const gn=et-.5;et+=et*gn*(et-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*gn*gn+(.848013+he*(.215638*he-1.06021)))}const pt=Y.sub(U)._mult(et)._add(U)._unit()._mult(Le?-1:1);this.addHalfVertex(k,pt.x,pt.y,!1,Le,0,P)}}N&&this.addCurrentVertex(k,Y,-$e,-ot,P)}else if("butt"===it)this.addCurrentVertex(k,de,0,0,P);else if("square"===it){const Ae=L?1:-1;L||this.addCurrentVertex(k,de,Ae,Ae,P),this.addCurrentVertex(k,de,0,0,P),L&&this.addCurrentVertex(k,de,Ae,Ae,P)}else"round"===it&&(L&&(this.addCurrentVertex(k,U,0,0,P),this.addCurrentVertex(k,U,1,1,P,!0)),N&&(this.addCurrentVertex(k,Y,-1,-1,P,!0),this.addCurrentVertex(k,Y,0,0,P)));if(Re&&ne<C-1){const Ae=k.dist(N);if(Ae>2*S){const $e=k.add(N.sub(k)._mult(S/Ae)._round());this.updateDistance(k,$e),this.addCurrentVertex($e,Y,0,0,P),k=$e}}}}addCurrentVertex(r,a,c,d,m,_=!1){const x=a.y*d-a.x,C=-a.y-a.x*d;this.addHalfVertex(r,a.x+a.y*c,a.y-a.x*c,_,!1,c,m),this.addHalfVertex(r,x,C,_,!0,-d,m)}addHalfVertex({x:r,y:a},c,d,m,_,x,C){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(a<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),C.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}Ot(ll,"LineBucket",{omit:["layers","patternFeatures"]});const Rm=new Rt({"line-cap":new Ie(be.layout_line["line-cap"]),"line-join":new Ie(be.layout_line["line-join"]),"line-miter-limit":new ae(be.layout_line["line-miter-limit"]),"line-round-limit":new ae(be.layout_line["line-round-limit"]),"line-sort-key":new Ie(be.layout_line["line-sort-key"])});var Lm={paint:new Rt({"line-opacity":new Ie(be.paint_line["line-opacity"]),"line-color":new Ie(be.paint_line["line-color"]),"line-translate":new ae(be.paint_line["line-translate"]),"line-translate-anchor":new ae(be.paint_line["line-translate-anchor"]),"line-width":new Ie(be.paint_line["line-width"]),"line-gap-width":new Ie(be.paint_line["line-gap-width"]),"line-offset":new Ie(be.paint_line["line-offset"]),"line-blur":new Ie(be.paint_line["line-blur"]),"line-dasharray":new Ze(be.paint_line["line-dasharray"]),"line-pattern":new Ze(be.paint_line["line-pattern"]),"line-gradient":new qe(be.paint_line["line-gradient"]),"line-trim-offset":new ae(be.paint_line["line-trim-offset"])}),layout:Rm};const V_=new class extends Ie{possiblyEvaluate(s,r){return r=new q(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,a,c){return r=je({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,a,c)}}(Lm.paint.properties["line-width"].specification);function Yp(s,r){return r>0?r+2*s:s}V_.useIntegerZoom=!0;const zx=It([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bx=It([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Nx=It([{name:"a_projected_pos",components:4,type:"Float32"}],4);It([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vx=It([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ux=It([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);It([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const U_=It([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),j_=It([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);It([{name:"triangle",components:3,type:"Uint16"}]),It([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),It([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),It([{type:"Float32",name:"offsetX"}]),It([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ta=128;function Yd(s,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new q(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:d}=a;let m=0;for(;m<c.length&&c[m]<=s;)m++;m=Math.max(0,m-1);let _=m;for(;_<c.length&&c[_]<s+1;)_++;_=Math.min(c.length-1,_);const x=c[m],C=c[_];return"composite"===a.kind?{kind:"composite",minZoom:x,maxZoom:C,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:C,minSize:a.evaluate(new q(x)),maxSize:a.evaluate(new q(C)),interpolationType:d}}}function Kp(s,{uSize:r,uSizeT:a},{lowerSize:c,upperSize:d}){return"source"===s.kind?c/ta:"composite"===s.kind?In(c/ta,d/ta,a):r}function Ah(s,r){let a=0,c=0;if("constant"===s.kind)c=s.layoutSize;else if("source"!==s.kind){const{interpolationType:d,minZoom:m,maxZoom:_}=s,x=d?Ve(ri.interpolationFactor(d,r,m,_),0,1):0;"camera"===s.kind?c=In(s.minSize,s.maxSize,x):a=x}return{uSizeT:a,uSize:c}}var $_=Object.freeze({__proto__:null,getSizeData:Yd,evaluateSizeForFeature:Kp,evaluateSizeForZoom:Ah,SIZE_PACK_FACTOR:ta});function G_(s,r,a){return s.sections.forEach(c=>{c.text=function(d,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?d=d.toLocaleUpperCase():"lowercase"===x&&(d=d.toLocaleLowerCase()),J.applyArabicShaping&&(d=J.applyArabicShaping(d)),d}(c.text,r,a)}),s}const na={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function H_(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function q_(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var Z_=function(s,r,a,c,d){var m,_,x=8*d-c-1,C=(1<<x)-1,E=C>>1,S=-7,P=a?d-1:0,k=a?-1:1,L=s[r+P];for(P+=k,m=L&(1<<-S)-1,L>>=-S,S+=x;S>0;m=256*m+s[r+P],P+=k,S-=8);for(_=m&(1<<-S)-1,m>>=-S,S+=c;S>0;_=256*_+s[r+P],P+=k,S-=8);if(0===m)m=1-E;else{if(m===C)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,c),m-=E}return(L?-1:1)*_*Math.pow(2,m-c)},Fm=function(s,r,a,c,d,m){var _,x,C,E=8*m-d-1,S=(1<<E)-1,P=S>>1,k=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,L=c?0:m-1,N=c?1:-1,U=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,_=S):(_=Math.floor(Math.log(r)/Math.LN2),r*(C=Math.pow(2,-_))<1&&(_--,C*=2),(r+=_+P>=1?k/C:k*Math.pow(2,1-P))*C>=2&&(_++,C/=2),_+P>=S?(x=0,_=S):_+P>=1?(x=(r*C-1)*Math.pow(2,d),_+=P):(x=r*Math.pow(2,P-1)*Math.pow(2,d),_=0));d>=8;s[a+L]=255&x,L+=N,x/=256,d-=8);for(_=_<<d|x,E+=d;E>0;s[a+L]=255&_,L+=N,_/=256,E-=8);s[a+L-N]|=128*U},tc=Cr;function Cr(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Cr.Varint=0,Cr.Fixed64=1,Cr.Bytes=2,Cr.Fixed32=5;var Jp=4294967296,zm=1/Jp,Bm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ra(s){return s.type===Cr.Bytes?s.readVarint()+s.pos:s.pos+1}function Kd(s,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var d=a.pos-1;d>=s;d--)a.buf[d+c]=a.buf[d]}function Qp(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function W_(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function Nm(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function X_(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function Vm(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function Jd(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function jx(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function Y_(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function $x(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function ef(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function su(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function tf(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}function K_(s,r,a){r.glyphs=[],1===s&&a.readMessage(tw,r)}function tw(s,r,a){if(3===s){const{id:c,bitmap:d,width:m,height:_,left:x,top:C,advance:E}=a.readMessage(J_,{});r.glyphs.push({id:c,bitmap:new ea({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:x,top:C,advance:E}})}else 4===s?r.ascender=a.readSVarint():5===s&&(r.descender=a.readSVarint())}function J_(s,r,a){1===s?r.id=a.readVarint():2===s?r.bitmap=a.readBytes():3===s?r.width=a.readVarint():4===s?r.height=a.readVarint():5===s?r.left=a.readSVarint():6===s?r.top=a.readSVarint():7===s&&(r.advance=a.readVarint())}function Um(s){let r=0,a=0;for(const _ of s)r+=_.w*_.h,a=Math.max(a,_.w);s.sort((_,x)=>x.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let d=0,m=0;for(const _ of s)for(let x=c.length-1;x>=0;x--){const C=c[x];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===C.w&&_.h===C.h){const E=c.pop();x<c.length&&(c[x]=E)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(c.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:d,h:m,fill:r/(d*m)||0}}Cr.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),d=c>>3,m=this.pos;this.type=7&c,s(d,r,this),this.pos===m&&this.skip(c)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=ef(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=tf(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=ef(this.buf,this.pos)+ef(this.buf,this.pos+4)*Jp;return this.pos+=8,s},readSFixed64:function(){var s=ef(this.buf,this.pos)+tf(this.buf,this.pos+4)*Jp;return this.pos+=8,s},readFloat:function(){var s=Z_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Z_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(d,m,_){var x,C,E=_.buf;if(x=(112&(C=E[_.pos++]))>>4,C<128||(x|=(127&(C=E[_.pos++]))<<3,C<128)||(x|=(127&(C=E[_.pos++]))<<10,C<128)||(x|=(127&(C=E[_.pos++]))<<17,C<128)||(x|=(127&(C=E[_.pos++]))<<24,C<128)||(x|=(1&(C=E[_.pos++]))<<31,C<128))return function ou(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(d,x,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Bm?Bm.decode(this.buf.subarray(r,s)):function(a,c,d){for(var m="",_=c;_<d;){var x,C,E,S=a[_],P=null,k=S>239?4:S>223?3:S>191?2:1;if(_+k>d)break;1===k?S<128&&(P=S):2===k?128==(192&(x=a[_+1]))&&(P=(31&S)<<6|63&x)<=127&&(P=null):3===k?(C=a[_+2],128==(192&(x=a[_+1]))&&128==(192&C)&&((P=(15&S)<<12|(63&x)<<6|63&C)<=2047||P>=55296&&P<=57343)&&(P=null)):4===k&&(C=a[_+2],E=a[_+3],128==(192&(x=a[_+1]))&&128==(192&C)&&128==(192&E)&&((P=(15&S)<<18|(63&x)<<12|(63&C)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,k=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),_+=k}return m}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Cr.Bytes)return s.push(this.readVarint(r));var a=ra(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Cr.Bytes)return s.push(this.readSVarint());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Cr.Bytes)return s.push(this.readBoolean());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Cr.Bytes)return s.push(this.readFloat());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Cr.Bytes)return s.push(this.readDouble());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Cr.Bytes)return s.push(this.readFixed32());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Cr.Bytes)return s.push(this.readSFixed32());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Cr.Bytes)return s.push(this.readFixed64());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Cr.Bytes)return s.push(this.readSFixed64());var r=ra(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Cr.Varint)for(;this.buf[this.pos++]>127;);else if(r===Cr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Cr.Fixed32)this.pos+=4;else{if(r!==Cr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),su(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),su(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),su(this.buf,-1&s,this.pos),su(this.buf,Math.floor(s*zm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),su(this.buf,-1&s,this.pos),su(this.buf,Math.floor(s*zm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var c,d,m,x;if(r>=0?(c=r%4294967296|0,d=r/4294967296|0):(d=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,d=d+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=c,(x=a).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(c,d,m){for(var _,x,C=0;C<d.length;C++){if((_=d.charCodeAt(C))>55295&&_<57344){if(!x){_>56319||C+1===d.length?(c[m++]=239,c[m++]=191,c[m++]=189):x=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(c[m++]=239,c[m++]=191,c[m++]=189,x=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&Kd(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),Fm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Fm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var c=this.pos-a;c>=128&&Kd(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,r,a){this.writeTag(s,Cr.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,Qp,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,W_,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,Vm,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,Nm,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,X_,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,Jd,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,jx,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,Y_,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,$x,r)},writeBytesField:function(s,r){this.writeTag(s,Cr.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Cr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Cr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Cr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Cr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Cr.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Cr.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Cr.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Cr.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Cr.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};class nf{constructor(r,{pixelRatio:a,version:c,stretchX:d,stretchY:m,content:_}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=d,this.stretchY=m,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Q_{constructor(r,a){const c={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,c,m),this.addImages(a,d,m);const{w:_,h:x}=Um(m),C=new _o({width:_||1,height:x||1});for(const E in r){const S=r[E],P=c[E].paddedRect;_o.copy(S.data,C,{x:0,y:0},{x:P.x+1,y:P.y+1},S.data)}for(const E in a){const S=a[E],P=d[E].paddedRect,k=P.x+1,L=P.y+1,N=S.data.width,U=S.data.height;_o.copy(S.data,C,{x:0,y:0},{x:k,y:L},S.data),_o.copy(S.data,C,{x:0,y:U-1},{x:k,y:L-1},{width:N,height:1}),_o.copy(S.data,C,{x:0,y:0},{x:k,y:L+U},{width:N,height:1}),_o.copy(S.data,C,{x:N-1,y:0},{x:k-1,y:L},{width:1,height:U}),_o.copy(S.data,C,{x:0,y:0},{x:k+N,y:L},{width:1,height:U})}this.image=C,this.iconPositions=c,this.patternPositions=d}addImages(r,a,c){for(const d in r){const m=r[d],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};c.push(_),a[d]=new nf(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),a)}patchUpdatedImage(r,a,c){if(!r||!a||r.version===a.version)return;r.version=a.version;const[d,m]=r.tl;c.update(a.data,void 0,{x:d,y:m})}}Ot(nf,"ImagePosition"),Ot(Q_,"ImageAtlas");const ds={horizontal:1,vertical:2,horizontalOnly:3};class zo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const c=new zo;return c.scale=r||1,c.fontStack=a,c}static forImage(r){const a=new zo;return a.imageName=r,a}}class Ph{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const c=new Ph;for(let d=0;d<r.sections.length;d++){const m=r.sections[d];m.image?c.addImageSection(m):c.addTextSection(m,a)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,c){let d="";for(let m=0;m<a.length;m++){const _=a.charCodeAt(m+1)||null,x=a.charCodeAt(m-1)||null;d+=!c&&(_&&g(_)&&!na[a[m+1]]||x&&g(x)&&!na[a[m-1]])||!na[a[m]]?a[m]:na[a[m]]}return d}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&of[this.text.charCodeAt(c)];c++)r++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&of[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const c=new Ph;return c.text=this.text.substring(r,a),c.sectionIndex=this.sectionIndex.slice(r,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(zo.forText(r.scale,r.fontStack||a));const c=this.sections.length-1;for(let d=0;d<r.text.length;++d)this.sectionIndex.push(c)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void vn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(zo.forImage(a)),this.sectionIndex.push(this.sections.length-1)):vn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rf(s,r,a,c,d,m,_,x,C,E,S,P,k,L,N,U){const Y=Ph.fromFeature(s,d);let ne;P===ds.vertical&&Y.verticalizePunctuation(k);const{processBidirectionalText:de,processStyledBidirectionalText:he}=J;if(de&&1===Y.sections.length){ne=[];const ye=de(Y.toString(),jm(Y,E,m,r,c,L,N));for(const Re of ye){const Le=new Ph;Le.text=Re,Le.sections=Y.sections;for(let We=0;We<Re.length;We++)Le.sectionIndex.push(0);ne.push(Le)}}else if(he){ne=[];const ye=he(Y.text,Y.sectionIndex,jm(Y,E,m,r,c,L,N));for(const Re of ye){const Le=new Ph;Le.text=Re[0],Le.sectionIndex=Re[1],Le.sections=Y.sections,ne.push(Le)}}else ne=function(ye,Re){const Le=[],We=ye.text;let it=0;for(const Ae of Re)Le.push(ye.substring(it,Ae)),it=Ae;return it<We.length&&Le.push(ye.substring(it,We.length)),Le}(Y,jm(Y,E,m,r,c,L,N));const fe=[],ge={positionedLines:fe,text:Y.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ye,Re,Le,We,it,Ae,$e,ot,st,Tt,et,pt){let gn=0,Pn=0,Wt=0;const Lt="right"===ot?1:"left"===ot?0:.5;let zn=!1;for(const Nn of it){const Un=Nn.getSections();for(const _r of Un){if(_r.imageName)continue;const vr=Re[_r.fontStack];if(vr&&(zn=void 0!==vr.ascender&&void 0!==vr.descender,!zn))break}if(!zn)break}let Dn=0;for(const Nn of it){Nn.trim();const Un=Nn.getMaxScale(),_r=24*(Un-1),vr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Dn]=vr;const ar=vr.positionedGlyphs;let Er=0;if(!Nn.length()){Pn+=Ae,++Dn;continue}let Or=0,Zi=0;for(let Vn=0;Vn<Nn.length();Vn++){const oi=Nn.getSection(Vn),lo=Nn.getSectionIndex(Vn),tr=Nn.getCharCode(Vn);let Rr=oi.scale,co=null,Ar=null,ei=null,Vr=24,ci=0;const Wi=!(st===ds.horizontal||!et&&!u(tr)||et&&(of[tr]||($t=tr,er($t)||qs($t)||Zo($t)||Dd($t)||Fc($t))));if(oi.imageName){const xo=We[oi.imageName];if(!xo)continue;ei=oi.imageName,ye.iconsInText=ye.iconsInText||!0,Ar=xo.paddedRect;const Xi=xo.displaySize;Rr=24*Rr/pt,co={width:Xi[0],height:Xi[1],left:1,top:-3,advance:Wi?Xi[1]:Xi[0],localGlyph:!1},ci=zn?-co.height*Rr:24*Un-17-Xi[1]*Rr,Vr=co.advance;const sa=(Wi?Xi[0]:Xi[1])*Rr-24*Un;sa>0&&sa>Er&&(Er=sa)}else{const xo=Le[oi.fontStack];if(!xo)continue;xo[tr]&&(Ar=xo[tr]);const Xi=Re[oi.fontStack];if(!Xi)continue;const sa=Xi.glyphs[tr];if(!sa)continue;if(co=sa.metrics,Vr=8203!==tr?24:0,zn){const vu=void 0!==Xi.ascender?Math.abs(Xi.ascender):0,$h=void 0!==Xi.descender?Math.abs(Xi.descender):0,Gh=(vu+$h)*Rr;Or<Gh&&(Or=Gh,Zi=(vu-$h)/2*Rr),ci=-vu*Rr}else ci=24*(Un-Rr)-17}Wi?(ye.verticalizable=!0,ar.push({glyph:tr,imageName:ei,x:gn,y:Pn+ci,vertical:Wi,scale:Rr,localGlyph:co.localGlyph,fontStack:oi.fontStack,sectionIndex:lo,metrics:co,rect:Ar}),gn+=Vr*Rr+Tt):(ar.push({glyph:tr,imageName:ei,x:gn,y:Pn+ci,vertical:Wi,scale:Rr,localGlyph:co.localGlyph,fontStack:oi.fontStack,sectionIndex:lo,metrics:co,rect:Ar}),gn+=co.advance*Rr+Tt)}0!==ar.length&&(Wt=Math.max(gn-Tt,Wt),zn?Vt(ar,Lt,Er,Zi,Ae*Un/2):Vt(ar,Lt,Er,0,Ae/2)),gn=0;const Ko=Ae*Un+Er;vr.lineOffset=Math.max(Er,_r),Pn+=Ko,++Dn}var $t;const gi=Pn,{horizontalAlign:Hr,verticalAlign:Qr}=On($e);(function(Nn,Un,_r,vr,ar,Er){const Or=(Un-_r)*ar,Zi=-Er*vr;for(const Ko of Nn)for(const Vn of Ko.positionedGlyphs)Vn.x+=Or,Vn.y+=Zi})(ye.positionedLines,Lt,Hr,Qr,Wt,gi),ye.top+=-Qr*gi,ye.bottom=ye.top+gi,ye.left+=-Hr*Wt,ye.right=ye.left+Wt,ye.hasBaseline=zn}(ge,r,a,c,ne,_,x,C,P,E,k,U),!function(ye){for(const Re of ye)if(0!==Re.positionedGlyphs.length)return!1;return!0}(fe)&&ge}const of={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ey(s,r,a,c,d,m){if(r.imageName){const _=c[r.imageName];return _?_.displaySize[0]*r.scale*24/m+d:0}{const _=a[r.fontStack],x=_&&_.glyphs[s];return x?x.metrics.advance*r.scale+d:0}}function ty(s,r,a,c){const d=Math.pow(s-r,2);return c?s<r?d/2:2*d:d+Math.abs(a)*a}function ny(s,r,a){let c=0;return 10===s&&(c-=1e4),a&&(c+=150),40!==s&&65288!==s||(c+=50),41!==r&&65289!==r||(c+=50),c}function ry(s,r,a,c,d,m){let _=null,x=ty(r,a,d,m);for(const C of c){const E=ty(r-C.x,a,d,m)+C.badness;E<=x&&(_=C,x=E)}return{index:s,x:r,priorBreak:_,badness:x}}function iy(s){return s?iy(s.priorBreak).concat(s.index):[]}function jm(s,r,a,c,d,m,_){if("point"!==m)return[];if(!s)return[];const x=[],C=function(k,L,N,U,Y,ne){let de=0;for(let he=0;he<k.length();he++){const fe=k.getSection(he);de+=ey(k.getCharCode(he),fe,U,Y,L,ne)}return de/Math.max(1,Math.ceil(de/N))}(s,r,a,c,d,_),E=s.text.indexOf("\u200b")>=0;let S=0;for(let k=0;k<s.length();k++){const L=s.getSection(k),N=s.getCharCode(k);if(of[N]||(S+=ey(N,L,c,d,r,_)),k<s.length()-1){const U=!((P=N)<11904||!(Ed(P)||Lp(P)||Ws(P)||zp(P)||Wo(P)||di(P)||Fp(P)||Po(P)||Md(P)||ga(P)||Pi(P)||ph(P)||Hl(P)||Zs(P)||Cd(P)||Zl(P)||ql(P)||dh(P)||hh(P)||Es(P)));(Gx[N]||U||L.imageName)&&x.push(ry(k+1,S,C,x,ny(N,s.getCharCode(k+1),U&&E),!1))}}var P;return iy(ry(s.length(),S,C,x,0,!0))}function On(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Vt(s,r,a,c,d){if(!(r||a||c||d))return;const m=s.length-1,_=s[m],x=(_.x+_.metrics.advance*_.scale)*r;for(let C=0;C<=m;C++)s[C].x-=x,s[C].y+=a+c+d}function oy(s,r,a){const{horizontalAlign:c,verticalAlign:d}=On(a),m=r[0]-s.displaySize[0]*c,_=r[1]-s.displaySize[1]*d;return{image:s,top:_,bottom:_+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function $m(s,r,a,c,d,m){const _=s.image;let x;if(_.content){const Y=_.content,ne=_.pixelRatio||1;x=[Y[0]/ne,Y[1]/ne,_.displaySize[0]-Y[2]/ne,_.displaySize[1]-Y[3]/ne]}const C=r.left*m,E=r.right*m;let S,P,k,L;"width"===a||"both"===a?(L=d[0]+C-c[3],P=d[0]+E+c[1]):(L=d[0]+(C+E-_.displaySize[0])/2,P=L+_.displaySize[0]);const N=r.top*m,U=r.bottom*m;return"height"===a||"both"===a?(S=d[1]+N-c[0],k=d[1]+U+c[2]):(S=d[1]+(N+U-_.displaySize[1])/2,k=S+_.displaySize[1]),{image:_,top:S,right:P,bottom:k,left:L,collisionPadding:x}}class cl extends ce{constructor(r,a,c,d,m){super(r,a),this.angle=d,this.z=c,void 0!==m&&(this.segment=m)}clone(){return new cl(this.x,this.y,this.z,this.angle,this.segment)}}function sy(s,r,a,c,d){if(void 0===r.segment)return!0;let m=r,_=r.segment+1,x=0;for(;x>-a/2;){if(_--,_<0)return!1;x-=s[_].dist(m),m=s[_]}x+=s[_].dist(s[_+1]),_++;const C=[];let E=0;for(;x<a/2;){const S=s[_],P=s[_+1];if(!P)return!1;let k=s[_-1].angleTo(S)-S.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:x,angleDelta:k}),E+=k;x-C[0].distance>c;)E-=C.shift().angleDelta;if(E>d)return!1;_++,x+=S.dist(P)}return!0}function Gm(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function ay(s,r,a){return s?.6*r*a:0}function Hm(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function Hx(s,r,a,c,d,m){const _=ay(a,d,m),x=Hm(a,c)*m;let C=0;const E=Gm(s)/2;for(let S=0;S<s.length-1;S++){const P=s[S],k=s[S+1],L=P.dist(k);if(C+L>E){const N=(E-C)/L,U=In(P.x,k.x,N),Y=In(P.y,k.y,N),ne=new cl(U,Y,0,k.angleTo(P),S);return!_||sy(s,ne,x,_,r)?ne:void 0}C+=L}}function qx(s,r,a,c,d,m,_,x,C){const E=ay(c,m,_),S=Hm(c,d),P=S*_,k=0===s[0].x||s[0].x===C||0===s[0].y||s[0].y===C;return r-P<r/4&&(r=P+r/4),Zx(s,k?r/2*x%r:(S/2+2*m)*_*x%r,r,E,a,P,k,!1,C)}function Zx(s,r,a,c,d,m,_,x,C){const E=m/2,S=Gm(s);let P=0,k=r-a,L=[];for(let N=0;N<s.length-1;N++){const U=s[N],Y=s[N+1],ne=U.dist(Y),de=Y.angleTo(U);for(;k+a<P+ne;){k+=a;const he=(k-P)/ne,fe=In(U.x,Y.x,he),ge=In(U.y,Y.y,he);if(fe>=0&&fe<C&&ge>=0&&ge<C&&k-E>=0&&k+E<=S){const ye=new cl(fe,ge,0,de,N);ye._round(),c&&!sy(s,ye,m,c,d)||L.push(ye)}}P+=ne}return x||L.length||_||(L=Zx(s,P/2,a,c,d,m,_,!0,C)),L}function qm(s,r,a,c,d){const m=[];for(let _=0;_<s.length;_++){const x=s[_];let C;for(let E=0;E<x.length-1;E++){let S=x[E],P=x[E+1];S.x<r&&P.x<r||(S.x<r?S=new ce(r,S.y+(r-S.x)/(P.x-S.x)*(P.y-S.y))._round():P.x<r&&(P=new ce(r,S.y+(r-S.x)/(P.x-S.x)*(P.y-S.y))._round()),S.y<a&&P.y<a||(S.y<a?S=new ce(S.x+(a-S.y)/(P.y-S.y)*(P.x-S.x),a)._round():P.y<a&&(P=new ce(S.x+(a-S.y)/(P.y-S.y)*(P.x-S.x),a)._round()),S.x>=c&&P.x>=c||(S.x>=c?S=new ce(c,S.y+(c-S.x)/(P.x-S.x)*(P.y-S.y))._round():P.x>=c&&(P=new ce(c,S.y+(c-S.x)/(P.x-S.x)*(P.y-S.y))._round()),S.y>=d&&P.y>=d||(S.y>=d?S=new ce(S.x+(d-S.y)/(P.y-S.y)*(P.x-S.x),d)._round():P.y>=d&&(P=new ce(S.x+(d-S.y)/(P.y-S.y)*(P.x-S.x),d)._round()),C&&S.equals(C[C.length-1])||(C=[S],m.push(C)),C.push(P)))))}}return m}Ot(cl,"Anchor");const kh=1e20;function ly(s,r,a,c,d,m,_,x,C){for(let E=r;E<r+c;E++)Zm(s,a*m+E,m,d,_,x,C);for(let E=a;E<a+d;E++)Zm(s,E*m+r,1,c,_,x,C)}function Zm(s,r,a,c,d,m,_){m[0]=0,_[0]=-kh,_[1]=kh,d[0]=s[r];for(let x=1,C=0,E=0;x<c;x++){d[x]=s[r+x*a];const S=x*x;do{const P=m[C];E=(d[x]-d[P]+S-P*P)/(x-P)/2}while(E<=_[C]&&--C>-1);C++,m[C]=x,_[C]=E,_[C+1]=kh}for(let x=0,C=0;x<c;x++){for(;_[C+1]<x;)C++;const E=m[C],S=x-E;s[r+x*a]=d[E]+S*S}}const sf={none:0,ideographs:1,all:2};class nc{constructor(r,a,c){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const c=[];for(const d in r)for(const m of r[d])c.push({stack:d,id:m});He(c,({stack:d,id:m},_)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=x.glyphs[m];if(void 0!==C)return void _(null,{stack:d,id:m,glyph:C});if(C=this._tinySDF(x,d,m),C)return x.glyphs[m]=C,void _(null,{stack:d,id:m,glyph:C});const E=Math.floor(m/256);if(256*E>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void _(null,{stack:d,id:m,glyph:C});let S=x.requests[E];S||(S=x.requests[E]=[],nc.loadGlyphRange(d,E,this.url,this.requestManager,(P,k)=>{if(k){x.ascender=k.ascender,x.descender=k.descender;for(const L in k.glyphs)this._doesCharSupportLocalGlyph(+L)||(x.glyphs[+L]=k.glyphs[+L]);x.ranges[E]=!0}for(const L of S)L(P,k);delete x.requests[E]})),S.push((P,k)=>{P?_(P):k&&_(null,{stack:d,id:m,glyph:k.glyphs[m]||null})})},(d,m)=>{if(d)a(d);else if(m){const _={};for(const{stack:x,id:C,glyph:E}of m)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[C]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;a(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==sf.none&&(this.localGlyphMode===sf.all?!!this.localFontFamily:!!this.localFontFamily&&(ga(r)||Td(r)||Hl(r)||ql(r)||Po(r)))}_tinySDF(r,a,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let m=r.tinySDF;if(!m){let U="400";/bold/i.test(a)?U="900":/medium/i.test(a)?U="500":/light/i.test(a)&&(U="200"),m=r.tinySDF=new nc.TinySDF({fontFamily:d,fontWeight:U,fontSize:48,buffer:6,radius:16}),m.fontWeight=U}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const _=String.fromCharCode(c),{data:x,width:C,height:E,glyphWidth:S,glyphHeight:P,glyphLeft:k,glyphTop:L,glyphAdvance:N}=m.draw(_);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new ea({width:C,height:E},x),metrics:{width:S/2,height:P/2,left:k/2,top:L/2-27,advance:N/2,localGlyph:!0}}}}function Wx(s,r,a,c){const d=[],m=s.image,_=m.pixelRatio,x=m.paddedRect.w-2,C=m.paddedRect.h-2,E=s.right-s.left,S=s.bottom-s.top,P=m.stretchX||[[0,x]],k=m.stretchY||[[0,C]],L=(Ae,$e)=>Ae+$e[1]-$e[0],N=P.reduce(L,0),U=k.reduce(L,0),Y=x-N,ne=C-U;let de=0,he=N,fe=0,ge=U,ye=0,Re=Y,Le=0,We=ne;if(m.content&&c){const Ae=m.content;de=af(P,0,Ae[0]),fe=af(k,0,Ae[1]),he=af(P,Ae[0],Ae[2]),ge=af(k,Ae[1],Ae[3]),ye=Ae[0]-de,Le=Ae[1]-fe,Re=Ae[2]-Ae[0]-he,We=Ae[3]-Ae[1]-ge}const it=(Ae,$e,ot,st)=>{const Tt=Qd(Ae.stretch-de,he,E,s.left),et=ep(Ae.fixed-ye,Re,Ae.stretch,N),pt=Qd($e.stretch-fe,ge,S,s.top),gn=ep($e.fixed-Le,We,$e.stretch,U),Pn=Qd(ot.stretch-de,he,E,s.left),Wt=ep(ot.fixed-ye,Re,ot.stretch,N),Lt=Qd(st.stretch-fe,ge,S,s.top),zn=ep(st.fixed-Le,We,st.stretch,U),Dn=new ce(Tt,pt),$t=new ce(Pn,pt),gi=new ce(Pn,Lt),Hr=new ce(Tt,Lt),Qr=new ce(et/_,gn/_),Nn=new ce(Wt/_,zn/_),Un=r*Math.PI/180;if(Un){const ar=Math.sin(Un),Er=Math.cos(Un),Or=[Er,-ar,ar,Er];Dn._matMult(Or),$t._matMult(Or),Hr._matMult(Or),gi._matMult(Or)}const _r=Ae.stretch+Ae.fixed,vr=$e.stretch+$e.fixed;return{tl:Dn,tr:$t,bl:Hr,br:gi,tex:{x:m.paddedRect.x+1+_r,y:m.paddedRect.y+1+vr,w:ot.stretch+ot.fixed-_r,h:st.stretch+st.fixed-vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qr,pixelOffsetBR:Nn,minFontScaleX:Re/_/E,minFontScaleY:We/_/S,isSDF:a}};if(c&&(m.stretchX||m.stretchY)){const Ae=lf(P,Y,N),$e=lf(k,ne,U);for(let ot=0;ot<Ae.length-1;ot++){const st=Ae[ot],Tt=Ae[ot+1];for(let et=0;et<$e.length-1;et++)d.push(it(st,$e[et],Tt,$e[et+1]))}}else d.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:C+1}));return d}function af(s,r,a){let c=0;for(const d of s)c+=Math.max(r,Math.min(a,d[1]))-Math.max(r,Math.min(a,d[0]));return c}function lf(s,r,a){const c=[{fixed:-1,stretch:0}];for(const[d,m]of s){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return c.push({fixed:r+1,stretch:a}),c}function Qd(s,r,a,c){return s/r*a+c}function ep(s,r,a,c){return s-r*a/c}function au(s,r,a,c){const d=r+s.positionedLines[c].lineOffset;return 0===c?a+d/2:a+(d+(r+s.positionedLines[c-1].lineOffset))/2}nc.loadGlyphRange=function(s,r,a,c,d){const m=256*r,_=m+255,x=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${m}-${_}`),se.Glyphs);_e(x,(C,E)=>{if(C)d(C);else if(E){const S={},P=new tc(E).readFields(K_,{});for(const k of P.glyphs)S[k.id]=k;d(null,{glyphs:S,ascender:P.ascender,descender:P.descender})}})},nc.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:a=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=r,this.cutoff=c,this.radius=a;const x=this.size=s+4*r,C=this._createCanvas(x),E=this.ctx=C.getContext("2d",{willReadFrequently:!0});E.font=`${_} ${m} ${s}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(s),_=Math.ceil(a),x=Math.min(this.size-this.buffer,Math.ceil(m-d)),C=Math.min(this.size-this.buffer,_+Math.ceil(c)),E=x+2*this.buffer,S=C+2*this.buffer,P=Math.max(E*S,0),k=new Uint8ClampedArray(P),L={data:k,width:E,height:S,glyphWidth:x,glyphHeight:C,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===x||0===C)return L;const{ctx:N,buffer:U,gridInner:Y,gridOuter:ne}=this;N.clearRect(U,U,x,C),N.fillText(s,U,U+_);const de=N.getImageData(U,U,x,C);ne.fill(kh,0,P),Y.fill(0,0,P);for(let he=0;he<C;he++)for(let fe=0;fe<x;fe++){const ge=de.data[4*(he*x+fe)+3]/255;if(0===ge)continue;const ye=(he+U)*E+fe+U;if(1===ge)ne[ye]=0,Y[ye]=kh;else{const Re=.5-ge;ne[ye]=Re>0?Re*Re:0,Y[ye]=Re<0?Re*Re:0}}ly(ne,0,0,E,S,E,this.f,this.v,this.z),ly(Y,U,U,x,C,E,this.f,this.v,this.z);for(let he=0;he<P;he++){const fe=Math.sqrt(ne[he])-Math.sqrt(Y[he]);k[he]=Math.round(255-255*(fe/this.radius+this.cutoff))}return L}};class Xx{constructor(r=[],a=Wm){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:c}=this,d=a[r];for(;r>0;){const m=r-1>>1,_=a[m];if(c(d,_)>=0)break;a[r]=_,r=m}a[r]=d}_down(r){const{data:a,compare:c}=this,d=this.length>>1,m=a[r];for(;r<d;){let _=1+(r<<1),x=a[_];const C=_+1;if(C<this.length&&c(a[C],x)<0&&(_=C,x=a[C]),c(x,m)>=0)break;a[r]=x,r=_}a[r]=m}}function Wm(s,r){return s<r?-1:s>r?1:0}function cy(s,r=1,a=!1){let c=1/0,d=1/0,m=-1/0,_=-1/0;const x=s[0];for(let L=0;L<x.length;L++){const N=x[L];(!L||N.x<c)&&(c=N.x),(!L||N.y<d)&&(d=N.y),(!L||N.x>m)&&(m=N.x),(!L||N.y>_)&&(_=N.y)}const C=Math.min(m-c,_-d);let E=C/2;const S=new Xx([],Xm);if(0===C)return new ce(c,d);for(let L=c;L<m;L+=C)for(let N=d;N<_;N+=C)S.push(new ul(L+E,N+E,E,s));let P=function(L){let N=0,U=0,Y=0;const ne=L[0];for(let de=0,he=ne.length,fe=he-1;de<he;fe=de++){const ge=ne[de],ye=ne[fe],Re=ge.x*ye.y-ye.x*ge.y;U+=(ge.x+ye.x)*Re,Y+=(ge.y+ye.y)*Re,N+=3*Re}return new ul(U/N,Y/N,0,L)}(s),k=S.length;for(;S.length;){const L=S.pop();(L.d>P.d||!P.d)&&(P=L,a&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,k)),L.max-P.d<=r||(E=L.h/2,S.push(new ul(L.p.x-E,L.p.y-E,E,s)),S.push(new ul(L.p.x+E,L.p.y-E,E,s)),S.push(new ul(L.p.x-E,L.p.y+E,E,s)),S.push(new ul(L.p.x+E,L.p.y+E,E,s)),k+=4)}return a&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function Xm(s,r){return r.max-s.max}function ul(s,r,a,c){this.p=new ce(s,r),this.h=a,this.d=function(d,m){let _=!1,x=1/0;for(let C=0;C<m.length;C++){const E=m[C];for(let S=0,P=E.length,k=P-1;S<P;k=S++){const L=E[S],N=E[k];L.y>d.y!=N.y>d.y&&d.x<(N.x-L.x)*(d.y-L.y)/(N.y-L.y)+L.x&&(_=!_),x=Math.min(x,m_(d,L,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Ym=Number.POSITIVE_INFINITY,Km=Math.sqrt(2);function cf(s,r){return r[1]!==Ym?function(a,c,d){let m=0,_=0;switch(c=Math.abs(c),d=Math.abs(d),a){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(a){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(s,r[0],r[1]):function(a,c){let d=0,m=0;c<0&&(c=0);const _=c/Km;switch(a){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(a){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=c;break;case"right":d=-c}return[d,m]}(s,r[0])}function lu(s,r,a,c,d,m,_,x,C,E){s.createArrays(),s.tilePixelRatio=nn/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const S=s.layers[0].layout,P=s.layers[0]._unevaluatedLayout._values,k={};if("composite"===s.textSizeData.kind){const{minZoom:U,maxZoom:Y}=s.textSizeData;k.compositeTextSizes=[P["text-size"].possiblyEvaluate(new q(U),x),P["text-size"].possiblyEvaluate(new q(Y),x)]}if("composite"===s.iconSizeData.kind){const{minZoom:U,maxZoom:Y}=s.iconSizeData;k.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new q(U),x),P["icon-size"].possiblyEvaluate(new q(Y),x)]}k.layoutTextSize=P["text-size"].possiblyEvaluate(new q(C+1),x),k.layoutIconSize=P["icon-size"].possiblyEvaluate(new q(C+1),x),k.textMaxSize=P["text-size"].possiblyEvaluate(new q(18),x);const L="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),N=S.get("text-size");for(const U of s.features){const Y=S.get("text-font").evaluate(U,{},x).join(","),ne=N.evaluate(U,{},x),de=k.layoutTextSize.evaluate(U,{},x),he=(k.layoutIconSize.evaluate(U,{},x),{horizontal:{},vertical:void 0}),fe=U.text;let ge,ye=[0,0];if(fe){const We=fe.toString(),it=24*S.get("text-letter-spacing").evaluate(U,{},x),Ae=24*S.get("text-line-height").evaluate(U,{},x),$e=f(We)?it:0,ot=S.get("text-anchor").evaluate(U,{},x),st=S.get("text-variable-anchor");if(!st){const Wt=S.get("text-radial-offset").evaluate(U,{},x);ye=Wt?cf(ot,[24*Wt,Ym]):S.get("text-offset").evaluate(U,{},x).map(Lt=>24*Lt)}let Tt=L?"center":S.get("text-justify").evaluate(U,{},x);const et=S.get("symbol-placement"),pt="point"===et,gn="point"===et?24*S.get("text-max-width").evaluate(U,{},x):0,Pn=Wt=>{s.allowVerticalPlacement&&Ja(We)&&(he.vertical=rf(fe,r,a,d,Y,gn,Ae,ot,Wt,$e,ye,ds.vertical,!0,et,de,ne))};if(!L&&st){const Wt="auto"===Tt?st.map(zn=>uf(zn)):[Tt];let Lt=!1;for(let zn=0;zn<Wt.length;zn++){const Dn=Wt[zn];if(!he.horizontal[Dn])if(Lt)he.horizontal[Dn]=he.horizontal[0];else{const $t=rf(fe,r,a,d,Y,gn,Ae,"center",Dn,$e,ye,ds.horizontal,!1,et,de,ne);$t&&(he.horizontal[Dn]=$t,Lt=1===$t.positionedLines.length)}}Pn("left")}else{if("auto"===Tt&&(Tt=uf(ot)),pt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Ja(We)){const Wt=rf(fe,r,a,d,Y,gn,Ae,ot,Tt,$e,ye,ds.horizontal,!1,et,de,ne);Wt&&(he.horizontal[Tt]=Wt)}Pn("point"===et?"left":Tt)}}let Re=!1;if(U.icon&&U.icon.name){const We=c[U.icon.name];We&&(ge=oy(d[U.icon.name],S.get("icon-offset").evaluate(U,{},x),S.get("icon-anchor").evaluate(U,{},x)),Re=We.sdf,void 0===s.sdfIcons?s.sdfIcons=We.sdf:s.sdfIcons!==We.sdf&&vn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==s.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Le=Qm(he.horizontal)||he.vertical;s.iconsInText||(s.iconsInText=!!Le&&Le.iconsInText),(Le||ge)&&Jm(s,U,he,ge,c,k,de,0,ye,Re,_,x,E)}m&&s.generateCollisionDebugBuffers(C,s.collisionBoxArray)}function uf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jm(s,r,a,c,d,m,_,x,C,E,S,P,k){let L=m.textMaxSize.evaluate(r,{},P);void 0===L&&(L=_);const N=s.layers[0].layout,U=N.get("icon-offset").evaluate(r,{},P),Y=Qm(a.horizontal)||a.vertical,ne="globe"===k.name,de=_/24,he=s.tilePixelRatio*L/24,fe=($e=s.overscaling,s.zoom>18&&$e>2&&($e>>=1),Math.max(nn/(512*$e),1)*N.get("symbol-spacing")),ge=N.get("text-padding")*s.tilePixelRatio,ye=N.get("icon-padding")*s.tilePixelRatio,Re=Xe(N.get("text-max-angle")),Le="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),We="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),it=N.get("symbol-placement"),Ae=fe/2;var $e;const ot=N.get("icon-text-fit");let st;c&&"none"!==ot&&(s.allowVerticalPlacement&&a.vertical&&(st=$m(c,a.vertical,ot,N.get("icon-text-fit-padding"),U,de)),Y&&(c=$m(c,Y,ot,N.get("icon-text-fit-padding"),U,de)));const Tt=(et,pt,gn)=>{if(pt.x<0||pt.x>=nn||pt.y<0||pt.y>=nn)return;let Pn=null;if(ne){const{x:Wt,y:Lt,z:zn}=k.projectTilePoint(pt.x,pt.y,gn);Pn={anchor:new cl(Wt,Lt,zn,0,void 0),up:k.upVector(gn,pt.x,pt.y)}}!function(Wt,Lt,zn,Dn,$t,gi,Hr,Qr,Nn,Un,_r,vr,ar,Er,Or,Zi,Ko,Vn,oi,lo,tr,Rr,co,Ar,ei){const Vr=Wt.addToLineVertexArray(Lt,Dn);let ci,Wi,xo,Xi,sa,vu,$h,Gh=0,pg=0,Ay=0,Py=0,fg=-1,mg=-1;const aa={};let g0=Np("");const ac=zn?zn.anchor:Lt;let gg=0,_g=0;if(void 0===Nn._unevaluatedLayout.getValue("text-radial-offset")?[gg,_g]=Nn.layout.get("text-offset").evaluate(tr,{},ei).map(Jo=>24*Jo):(gg=24*Nn.layout.get("text-radial-offset").evaluate(tr,{},ei),_g=Ym),Wt.allowVerticalPlacement&&$t.vertical){const Jo=$t.vertical;if(Or)vu=eg(Jo),Qr&&($h=eg(Qr));else{const Bo=Nn.layout.get("text-rotate").evaluate(tr,{},ei)+90;xo=hl(Un,ac,Lt,_r,vr,ar,Jo,Er,Bo,Zi),Qr&&(Xi=hl(Un,ac,Lt,_r,vr,ar,Qr,Vn,Bo))}}if(gi){const Jo=Nn.layout.get("icon-rotate").evaluate(tr,{},ei),Bo="none"!==Nn.layout.get("icon-text-fit"),Hh=Wx(gi,Jo,co,Bo),Oy=Qr?Wx(Qr,Jo,co,Bo):void 0;Wi=hl(Un,ac,Lt,_r,vr,ar,gi,Vn,Jo),Gh=4*Hh.length;const ks=Wt.iconSizeData;let qh=null;"source"===ks.kind?(qh=[ta*Nn.layout.get("icon-size").evaluate(tr,{},ei)],qh[0]>rc&&vn(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===ks.kind&&(qh=[ta*Rr.compositeIconSizes[0].evaluate(tr,{},ei),ta*Rr.compositeIconSizes[1].evaluate(tr,{},ei)],(qh[0]>rc||qh[1]>rc)&&vn(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,Hh,qh,lo,oi,tr,!1,zn,Lt,Vr.lineStartIndex,Vr.lineLength,-1,Ar,ei),fg=Wt.icon.placedSymbolArray.length-1,Oy&&(pg=4*Oy.length,Wt.addSymbols(Wt.icon,Oy,qh,lo,oi,tr,ds.vertical,zn,Lt,Vr.lineStartIndex,Vr.lineLength,-1,Ar,ei),mg=Wt.icon.placedSymbolArray.length-1)}for(const Jo in $t.horizontal){const Bo=$t.horizontal[Jo];ci||(g0=Np(Bo.text),Or?sa=eg(Bo):ci=hl(Un,ac,Lt,_r,vr,ar,Bo,Er,Nn.layout.get("text-rotate").evaluate(tr,{},ei),Zi));const Hh=1===Bo.positionedLines.length;if(Ay+=uy(Wt,zn,Lt,Bo,Hr,Nn,Or,tr,Zi,Vr,$t.vertical?ds.horizontal:ds.horizontalOnly,Hh?Object.keys($t.horizontal):[Jo],aa,fg,Rr,Ar,ei),Hh)break}$t.vertical&&(Py+=uy(Wt,zn,Lt,$t.vertical,Hr,Nn,Or,tr,Zi,Vr,ds.vertical,["vertical"],aa,mg,Rr,Ar,ei));let xu=-1;const ky=(Jo,Bo)=>Jo?Math.max(Jo,Bo):Bo;xu=ky(sa,xu),xu=ky(vu,xu),xu=ky($h,xu);const _0=xu>-1?1:0;Wt.glyphOffsetArray.length>=sc.MAX_GLYPHS&&vn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==tr.sortKey&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,tr.sortKey),Wt.symbolInstances.emplaceBack(ac.x,ac.y,ac.z,Lt.x,Lt.y,aa.right>=0?aa.right:-1,aa.center>=0?aa.center:-1,aa.left>=0?aa.left:-1,aa.vertical>=0?aa.vertical:-1,fg,mg,g0,void 0!==ci?ci:Wt.collisionBoxArray.length,void 0!==ci?ci+1:Wt.collisionBoxArray.length,void 0!==xo?xo:Wt.collisionBoxArray.length,void 0!==xo?xo+1:Wt.collisionBoxArray.length,void 0!==Wi?Wi:Wt.collisionBoxArray.length,void 0!==Wi?Wi+1:Wt.collisionBoxArray.length,Xi||Wt.collisionBoxArray.length,Xi?Xi+1:Wt.collisionBoxArray.length,_r,Ay,Py,Gh,pg,_0,0,gg,_g,xu)}(s,pt,Pn,et,a,c,d,st,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,ge,Le,C,0,ye,We,U,r,m,E,S,P)};if("line"===it)for(const et of qm(r.geometry,0,0,nn,nn)){const pt=qx(et,fe,Re,a.vertical||Y,c,24,he,s.overscaling,nn);for(const gn of pt){const Pn=Y;Pn&&Yx(s,Pn.text,Ae,gn)||Tt(et,gn,P)}}else if("line-center"===it){for(const et of r.geometry)if(et.length>1){const pt=Hx(et,Re,a.vertical||Y,c,24,he);pt&&Tt(et,pt,P)}}else if("Polygon"===r.type)for(const et of jd(r.geometry,0)){const pt=cy(et,16);Tt(et[0],new cl(pt.x,pt.y,0,0,void 0),P)}else if("LineString"===r.type)for(const et of r.geometry)Tt(et,new cl(et[0].x,et[0].y,0,0,void 0),P);else if("Point"===r.type)for(const et of r.geometry)for(const pt of et)Tt([pt],new cl(pt.x,pt.y,0,0,void 0),P)}const rc=32640;function uy(s,r,a,c,d,m,_,x,C,E,S,P,k,L,N,U,Y){const ne=function(fe,ge,ye,Re,Le,We,it,Ae){const $e=[];if(0===ge.positionedLines.length)return $e;const ot=Re.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,st=function(Pn){const Wt=Pn[0],Lt=Pn[1],zn=Wt*Lt;return zn>0?[Wt,-Lt]:zn<0?[-Wt,Lt]:0===Wt?[Lt,Wt]:[Lt,-Wt]}(ye);let Tt=Math.abs(ge.top-ge.bottom);for(const Pn of ge.positionedLines)Tt-=Pn.lineOffset;const et=ge.positionedLines.length,pt=Tt/et;let gn=ge.top-ye[1];for(let Pn=0;Pn<et;++Pn){const Wt=ge.positionedLines[Pn];gn=au(ge,pt,gn,Pn);for(const Lt of Wt.positionedGlyphs){if(!Lt.rect)continue;const zn=Lt.rect||{};let Dn=4,$t=!0,gi=1,Hr=0;if(Lt.imageName){const Ar=it[Lt.imageName];if(!Ar)continue;if(Ar.sdf){vn("SDF images are not supported in formatted text and will be ignored.");continue}$t=!1,gi=Ar.pixelRatio,Dn=1/gi}const Qr=(Le||Ae)&&Lt.vertical,Nn=Lt.metrics.advance*Lt.scale/2,Un=Lt.metrics,_r=Lt.rect;if(null===_r)continue;Ae&&ge.verticalizable&&(Hr=Lt.imageName?Nn-Lt.metrics.width*Lt.scale/2:0);const vr=Le?[Lt.x+Nn,Lt.y]:[0,0];let ar=[0,0],Er=[0,0],Or=!1;Le||(Qr?(Er=[Lt.x+Nn+st[0],Lt.y+st[1]-Hr],Or=!0):ar=[Lt.x+Nn+ye[0],Lt.y+ye[1]-Hr]);const Zi=_r.w*Lt.scale/(gi*(Lt.localGlyph?2:1)),Ko=_r.h*Lt.scale/(gi*(Lt.localGlyph?2:1));let Vn,oi,lo,tr;if(Qr){const Ar=Lt.y-gn,ei=new ce(-Nn,Nn-Ar),Vr=-Math.PI/2,ci=new ce(...Er);Vn=new ce(-Nn+ar[0],ar[1]),Vn._rotateAround(Vr,ei)._add(ci),Vn.x+=-Ar+Nn,Vn.y-=(Un.left-Dn)*Lt.scale;const Wi=Lt.imageName?Un.advance*Lt.scale:24*Lt.scale,xo=String.fromCharCode(Lt.glyph);H_(xo)?Vn.x+=(1-Dn)*Lt.scale:q_(xo)?Vn.x+=Wi-Un.height*Lt.scale+(-Dn-1)*Lt.scale:Vn.x+=Lt.imageName||Un.width+2*Dn===_r.w&&Un.height+2*Dn===_r.h?(Wi-Ko)/2:(Wi-(Un.height+2*Dn)*Lt.scale)/2,oi=new ce(Vn.x,Vn.y-Zi),lo=new ce(Vn.x+Ko,Vn.y),tr=new ce(Vn.x+Ko,Vn.y-Zi)}else{const Ar=(Un.left-Dn)*Lt.scale-Nn+ar[0],ei=(-Un.top-Dn)*Lt.scale+ar[1],Vr=Ar+Zi,ci=ei+Ko;Vn=new ce(Ar,ei),oi=new ce(Vr,ei),lo=new ce(Ar,ci),tr=new ce(Vr,ci)}if(ot){let Ar;Ar=Le?new ce(0,0):Or?new ce(st[0],st[1]):new ce(ye[0],ye[1]),Vn._rotateAround(ot,Ar),oi._rotateAround(ot,Ar),lo._rotateAround(ot,Ar),tr._rotateAround(ot,Ar)}const Rr=new ce(0,0),co=new ce(0,0);$e.push({tl:Vn,tr:oi,bl:lo,br:tr,tex:zn,writingMode:ge.writingMode,glyphOffset:vr,sectionIndex:Lt.sectionIndex,isSDF:$t,pixelOffsetTL:Rr,pixelOffsetBR:co,minFontScaleX:0,minFontScaleY:0})}}return $e}(0,c,C,m,_,x,d,s.allowVerticalPlacement),de=s.textSizeData;let he=null;"source"===de.kind?(he=[ta*m.layout.get("text-size").evaluate(x,{},Y)],he[0]>rc&&vn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===de.kind&&(he=[ta*N.compositeTextSizes[0].evaluate(x,{},Y),ta*N.compositeTextSizes[1].evaluate(x,{},Y)],(he[0]>rc||he[1]>rc)&&vn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,ne,he,C,_,x,S,r,a,E.lineStartIndex,E.lineLength,L,U,Y);for(const fe of P)k[fe]=s.text.placedSymbolArray.length-1;return 4*ne.length}function Qm(s){for(const r in s)return s[r];return null}function hl(s,r,a,c,d,m,_,x,C,E){let S=_.top,P=_.bottom,k=_.left,L=_.right;const N=_.collisionPadding;if(N&&(k-=N[0],S-=N[1],L+=N[2],P+=N[3]),C){const U=new ce(k,S),Y=new ce(L,S),ne=new ce(k,P),de=new ce(L,P),he=Xe(C);let fe=new ce(0,0);E&&(fe=new ce(E[0],E[1])),U._rotateAround(he,fe),Y._rotateAround(he,fe),ne._rotateAround(he,fe),de._rotateAround(he,fe),k=Math.min(U.x,Y.x,ne.x,de.x),L=Math.max(U.x,Y.x,ne.x,de.x),S=Math.min(U.y,Y.y,ne.y,de.y),P=Math.max(U.y,Y.y,ne.y,de.y)}return s.emplaceBack(r.x,r.y,r.z,a.x,a.y,k,S,L,P,x,c,d,m),s.length-1}function eg(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function Yx(s,r,a,c){const d=s.compareText;if(r in d){const m=d[r];for(let _=m.length-1;_>=0;_--)if(c.dist(m[_])<a)return!0}else d[r]=[];return d[r].push(c),!1}const Kx=It([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:hy}=Kx,hf=It([{name:"a_pos_3",components:3,type:"Int16"}]);var Oh=It([{name:"a_pos",type:"Int16",components:2}]);const ic=nn/Math.PI/2,qi=2*Ms(1,0)*ic*Math.PI,Rh=[64,32,16],yo=-ic,vo=ic,Jx=[new Yo([yo,yo,yo],[vo,vo,vo]),new Yo([yo,yo,yo],[0,0,vo]),new Yo([0,yo,yo],[vo,0,vo]),new Yo([yo,0,yo],[0,vo,vo]),new Yo([0,0,yo],[vo,vo,vo])];function Qx(s,r,a,c=!0){const d=Ca([],s._camera.position,s.worldSize),m=[r,a,1,1];ec(m,m,s.pixelMatrixInverse),v_(m,m,1/m[3]);const _=go([],Ss([],m,d)),x=s.globeMatrix,C=[x[12],x[13],x[14]],E=Ss([],C,d),S=Jl(E),P=go([],E),k=s.worldSize/(2*Math.PI),L=Ds(P,_),N=Math.asin(k/S);if(N<Math.acos(L)){if(!c)return null;const it=[],Ae=[];Ca(it,_,S/L),go(Ae,Ss(Ae,it,E)),go(_,sl(_,E,Ca(_,Ae,Math.tan(N)*S)))}const U=[];new E_(d,_).closestPointOnSphere(C,k,U);const Y=go([],Tr(x,0)),ne=go([],Tr(x,1)),de=go([],Tr(x,2)),he=Ds(Y,U),fe=Ds(ne,U),ge=Ds(de,U),ye=yt(Math.asin(-fe/k));let Re=yt(Math.atan2(he,ge));Re=s.center.lng+function(it,Ae){const $e=(Ae-it+180)%360-180;return $e<-180?$e+360:$e}(s.center.lng,Re);const Le=nl(Re),We=Ve(ba(ye),0,1);return new rl(Le,We)}class nw{constructor(r,a,c){this.a=Ss([],r,c),this.b=Ss([],a,c),this.center=c;const d=go([],this.a),m=go([],this.b);this.angle=Math.acos(Ds(d,m))}}function dy(s,r){if(0===s.angle)return null;let a;return a=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(c,d,m,_){const x=Math.sin(m);return c*(Math.sin((1-_)*m)/x)+d*(Math.sin(_*m)/x)}(s.a[r],s.b[r],s.angle,Ve(a,0,1))+s.center[r]}function Ta(s){if(s.z<=1)return Jx[s.z+2*s.y+s.x];const[r,a]=fy(s),c=[Mi(r[0],r[1]),Mi(r[0],a[1]),Mi(a[0],r[1]),Mi(a[0],a[1])],d=[vo,vo,vo],m=[yo,yo,yo];for(const _ of c)d[0]=Math.min(d[0],_[0]),d[1]=Math.min(d[1],_[1]),d[2]=Math.min(d[2],_[2]),m[0]=Math.max(m[0],_[0]),m[1]=Math.max(m[1],_[1]),m[2]=Math.max(m[2],_[2]);return new Yo(d,m)}function fy(s){const r=1<<s.z,a=s.x/r,c=(s.x+1)/r,d=(s.y+1)/r;return[[fi(s.y/r),mo(a)],[fi(d),mo(c)]]}function my(s,r,a,c=ic){return a=Xe(a),[s*Math.sin(a)*c,-r*c,s*Math.cos(a)*c]}function Mi(s,r,a){return my(Math.cos(Xe(s)),Math.sin(Xe(s)),r,a)}function gy(s,r,a){const c=Math.pow(2,a.z),d=(s/nn+a.x)/c;return Mi(fi((r/nn+a.y)/c),mo(d))}function tp(s){return 16383/Math.max(...Ss([],s.max,s.min))}function oc(s){const r=Ro(new Float64Array(16)),a=tp(s);var c,d;return ol(r,r,[a,a,a]),Kl(r,r,((c=[])[0]=-(d=s.min)[0],c[1]=-d[1],c[2]=-d[2],c)),r}function _y(s){const r=Ro(new Float64Array(16)),a=1/tp(s);return Kl(r,r,s.min),ol(r,r,[a,a,a]),r}function tg(s,r,a,c,d){const m=function(C){const E=nn/(2*Math.PI);return C/(2*Math.PI)/E}(a),_=[s,r,-a/(2*Math.PI)],x=Ro(new Float64Array(16));return Kl(x,x,_),ol(x,x,[m,m,m]),Yc(x,x,Xe(-d)),Ch(x,x,Xe(-c)),x}function ng(s){return Oe(5,6,s)}function yy(s,r){const a=Mi(r.lat,r.lng);return m=(c=Gp([],function(L){const N=Mi(L._center.lat,L._center.lng);let U=Lo([],Ql(0,1,0),N);const Y=Kc([],-L.angle,N);U=Nr(U,U,Y),Kc(Y,-L._pitch,U);const ne=go([],N);return Ca(ne,ne,L.cameraToCenterDistance/L.pixelsPerMeter*qi),Nr(ne,ne,Y),sl([],N,ne)}(s),a))[0],_=c[1],x=c[2],C=(d=a)[0],E=d[1],S=d[2],k=(P=Math.sqrt(m*m+_*_+x*x)*Math.sqrt(C*C+E*E+S*S))&&Ds(c,d)/P,Math.acos(Math.min(Math.max(k,-1),1));var c,d,m,_,x,C,E,S,P,k}const vy=Xe(85),e0=Math.cos(vy),t0=Math.sin(vy);function rg(s,r){const a=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,d=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),m=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01)),_=Math.sin(s._pitch)*m+d;return Math.min(1.01*_,d*(1/s._horizonShift))}function cu(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const a=Math.pow(2,-s.z),c=s.x*a,d=(s.x+1)*a,m=s.y*a,_=(s.y+1)*a,x=mo(c),C=mo(d),E=fi(m),S=fi(_),P=r.project(x,E),k=r.project(C,E),L=r.project(C,S),N=r.project(x,S);let U=Math.min(P.x,k.x,L.x,N.x),Y=Math.min(P.y,k.y,L.y,N.y),ne=Math.max(P.x,k.x,L.x,N.x),de=Math.max(P.y,k.y,L.y,N.y);const he=a/16;function fe(ye,Re,Le,We,it,Ae){const $e=(Le+it)/2,ot=(We+Ae)/2,st=r.project(mo($e),fi(ot)),Tt=Math.max(0,U-st.x,Y-st.y,st.x-ne,st.y-de);U=Math.min(U,st.x),ne=Math.max(ne,st.x),Y=Math.min(Y,st.y),de=Math.max(de,st.y),Tt>he&&(fe(ye,st,Le,We,$e,ot),fe(st,Re,$e,ot,it,Ae))}fe(P,k,c,m,d,m),fe(k,L,d,m,d,_),fe(L,N,d,_,c,_),fe(N,P,c,_,c,m),U-=he,Y-=he,ne+=he,de+=he;const ge=1/Math.max(ne-U,de-Y);return{scale:ge,x:U*ge,y:Y*ge,x2:ne*ge,y2:de*ge,projection:r}}const xy=Ro(new Float32Array(16));class dl{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new or(0,0)}projectTilePoint(r,a,c){return{x:r,y:a,z:0}}locationPoint(r,a,c=!0){return r._coordinatePoint(r.locationCoordinate(a),c)}pixelsPerMeter(r,a){return Ms(1,r)*a}pixelSpaceConversion(r,a,c){return 1}farthestPixelDistance(r){return rg(r,r.pixelsPerMeter)}pointCoordinate(r,a,c,d){const m=r.horizonLineFromTop(!1),_=new ce(a,Math.max(m,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(_,d))}pointCoordinate3D(r,a,c){const d=new ce(a,c);if(r.elevation)return r.elevation.pointCoordinate(d);{const m=this.pointCoordinate(r,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,a){if(r.elevation)return!this.pointCoordinate3D(r,a.x,a.y);const c=r.horizonLineFromTop();return a.y<c}createInversionMatrix(r,a){return xy}createTileMatrix(r,a,c){let d,m,_;const x=c.canonical,C=Ro(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=cu(x,this);d=1,m=E.x+c.wrap*E.scale,_=E.y,ol(C,C,[d/E.scale,d/E.scale,r.pixelsPerMeter/a])}else d=a/r.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*c.wrap)*d,_=x.y*d;return Kl(C,C,[m,_,0]),ol(C,C,[d/nn,d/nn,1]),C}upVector(r,a,c){return[0,0,1]}upVectorScale(r,a,c){return{metersToTile:1}}}class ig extends dl{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,c]=this.parallels=r.parallels||[29.5,45.5],d=Math.sin(Xe(a));this.n=(d+Math.sin(Xe(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:c,c:d,r0:m}=this,_=Xe(r-this.center[0]),x=Xe(a),C=Math.sqrt(d-2*c*Math.sin(x))/c;return{x:C*Math.sin(_*c),y:C*Math.cos(_*c)-m,z:0}}unproject(r,a){const{n:c,c:d,r0:m}=this,_=m+a;let x=Math.atan2(r,Math.abs(_))*Math.sign(_);_*c<0&&(x-=Math.PI*Math.sign(r)*Math.sign(_));const C=Xe(this.center[0])*c;x=ve(x,-Math.PI-C,Math.PI-C);const E=yt(x/c)+this.center[0],S=Math.asin(Ve((d-(r*r+_*_)*c*c)/(2*c),-1,1)),P=Ve(yt(S),-85.051129,Xo);return new or(E,P)}}const df=1.340264,uu=-.081106,np=893e-6,pf=.003796,tt=Math.sqrt(3)/2;class og extends dl{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const c=Math.asin(tt*Math.sin(a)),d=c*c,m=d*d*d;return{x:.5*(r*Math.cos(c)/(tt*(df+3*uu*d+m*(7*np+9*pf*d)))/Math.PI+.5),y:1-.5*(c*(df+uu*d+m*(np+pf*d))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,d=c*c,m=d*d*d;for(let S,P,k,L=0;L<12&&(P=c*(df+uu*d+m*(np+pf*d))-a,k=df+3*uu*d+m*(7*np+9*pf*d),S=P/k,c=Ve(c-S,-Math.PI/3,Math.PI/3),d=c*c,m=d*d*d,!(Math.abs(S)<1e-12));++L);const _=tt*r*(df+3*uu*d+m*(7*np+9*pf*d))/Math.cos(c),x=Math.asin(Math.sin(c)/tt),C=Ve(180*_/Math.PI,-180,180),E=Ve(180*x/Math.PI,-85.051129,Xo);return new or(C,E)}}class n0 extends dl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const c=360*(r-.5),d=Ve(360*(.5-a),-85.051129,Xo);return new or(c,d)}}const Lh=Math.PI/2;function Fh(s){return Math.tan((Lh+s)/2)}class rw extends dl{constructor(r){super(r),this.center=r.center||[0,30];const[a,c]=this.parallels=r.parallels||[30,30],d=Xe(a),m=Xe(c),_=Math.cos(d);this.n=d===m?Math.sin(d):Math.log(_/Math.cos(m))/Math.log(Fh(m)/Fh(d)),this.f=_*Math.pow(Fh(d),this.n)/this.n}project(r,a){a=Xe(a),r=Xe(r-this.center[0]);const c=1e-6,{n:d,f:m}=this;m>0?a<-Lh+c&&(a=-Lh+c):a>Lh-c&&(a=Lh-c);const _=m/Math.pow(Fh(a),d),x=_*Math.sin(d*r),C=m-_*Math.cos(d*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+.5),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:c,f:d}=this,m=d-a,_=Math.sign(m),x=Math.sign(c)*Math.sqrt(r*r+m*m);let C=Math.atan2(r,Math.abs(m))*_;m*c<0&&(C-=Math.PI*Math.sign(r)*_);const E=Ve(yt(C/c)+this.center[0],-180,180),S=Ve(yt(2*Math.atan(Math.pow(d/x,1/c))-Lh),-85.051129,Xo);return new or(E,S)}}class r0 extends dl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:nl(r),y:ba(a),z:0}}unproject(r,a){const c=mo(r),d=fi(a);return new or(c,d)}}const ff=Xe(Xo);class iw extends dl{project(r,a){const c=(a=Xe(a))*a,d=c*c;return{x:.5*((r=Xe(r))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,d=25,m=0,_=c*c;do{_=c*c;const E=_*_;m=(c*(1.007226+_*(.015085+E*(.028874*_-.044475-.005916*E)))-a)/(1.007226+_*(.045255+E*(.259866*_-.311325-.005916*11*E))),c=Ve(c-m,-ff,ff)}while(Math.abs(m)>1e-6&&--d>0);_=c*c;const x=Ve(yt(r/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),C=yt(c);return new or(x,C)}}const o0=Xe(Xo);class ow extends dl{project(r,a){a=Xe(a),r=Xe(r);const c=Math.cos(a),d=2/Math.PI,m=Math.acos(c*Math.cos(r/2)),_=Math.sin(m)/m,x=.5*(r*d+2*c*Math.sin(r/2)/_)||0,C=.5*(a+Math.sin(a)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(r,a){let c=r=(2*r-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,m=25;const _=1e-6;let x=0,C=0;do{const E=Math.cos(d),S=Math.sin(d),P=2*S*E,k=S*S,L=E*E,N=Math.cos(c/2),U=Math.sin(c/2),Y=2*N*U,ne=U*U,de=1-L*N*N,he=de?1/de:0,fe=de?Math.acos(E*N)*Math.sqrt(1/de):0,ge=.5*(2*fe*E*U+2*c/Math.PI)-r,ye=.5*(fe*S+d)-a,Re=.5*he*(L*ne+fe*E*N*k)+1/Math.PI,Le=he*(Y*P/4-fe*S*U),We=.125*he*(P*U-fe*S*L*Y),it=.5*he*(k*N+fe*ne*E)+.5,Ae=Le*We-it*Re;x=(ye*Le-ge*it)/Ae,C=(ge*We-ye*Re)/Ae,c=Ve(c-x,-Math.PI,Math.PI),d=Ve(d-C,-o0,o0)}while((Math.abs(x)>_||Math.abs(C)>_)&&--m>0);return new or(yt(c),yt(d))}}class s0 extends dl{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:c,cosPhi:d}=this;return{x:Xe(r)*d*c+.5,y:-Math.sin(Xe(a))/d*c+.5,z:0}}unproject(r,a){const{scale:c,cosPhi:d}=this,m=-(a-.5)/c,_=Ve(yt((r-.5)/c)/d,-180,180),x=Math.asin(Ve(m*d,-1,1)),C=Ve(yt(x),-85.051129,Xo);return new or(_,C)}}class sw extends r0{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(r,a,c){const d=Math.pow(2,c.z),m=(r/nn+c.x)/d,_=Mi(fi((a/nn+c.y)/d),mo(m));return Nr(_,_,oc(Ta(c))),{x:_[0],y:_[1],z:_[2]}}locationPoint(r,a){const c=Mi(a.lat,a.lng),d=go([],c),m=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;qp(c,c,d,Ms(1,0)*nn*m);const _=Ro(new Float64Array(16));return Xc(_,r.pixelMatrix,r.globeMatrix),Nr(c,c,_),new ce(c[0],c[1])}pixelsPerMeter(r,a){return Ms(1,0)*a}pixelSpaceConversion(r,a,c){const d=In(Ms(1,45)*a,Ms(1,r)*a,c);return this.pixelsPerMeter(r,a)/d}createTileMatrix(r,a,c){const d=_y(Ta(c.canonical));return Xc(new Float64Array(16),r.globeMatrix,d)}createInversionMatrix(r,a){const{center:c}=r,d=Ro(new Float64Array(16));return Xc(d,d,oc(Ta(a))),Ch(d,d,Xe(c.lng)),Yc(d,d,Xe(c.lat)),ol(d,d,[r._projectionScaler,r._projectionScaler,1]),Float32Array.from(d)}pointCoordinate(r,a,c,d){return Qx(r,a,c,!0)||new rl(0,0)}pointCoordinate3D(r,a,c){const d=this.pointCoordinate(r,a,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(r,a){return!Qx(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(d,m){const _=d.cameraToCenterDistance,x=d._centerAltitude*m,C=d._camera,E=d._camera.forward(),S=sl([],Ca([],E,-_),[0,0,x]),P=d.worldSize/(2*Math.PI),k=[0,0,-P],L=d.width/d.height,N=Math.tan(d.fovAboveCenter),U=Ca([],C.up(),N),Y=Ca([],C.right(),N*L),ne=go([],sl([],sl([],E,U),Y)),de=[];let he;if(new E_(S,ne).closestPointOnSphere(k,P,de)){const fe=sl([],de,k),ge=Ss([],fe,S);he=Math.cos(d.fovAboveCenter)*Jl(ge)}else{const fe=Ss([],S,k),ge=Ss([],k,S);go(ge,ge);const ye=Jl(fe)-P;he=Math.sqrt(ye*(ye+2*P));const Re=Math.acos(he/(P+ye))-Math.acos(Ds(E,ge));he*=Math.cos(Re)}return 1.01*he}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),c=ng(r.zoom);if(c>0){const d=rg(r,Ms(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),_=Math.max(r.width,r.height)/r.worldSize*Math.PI;return In(a,d+m*(1-Math.cos(_)),Math.pow(c,10))}return a}upVector(r,a,c){const d=1<<r.z,m=(a/nn+r.x)/d;return Mi(fi((c/nn+r.y)/d),mo(m),1)}upVectorScale(r){return{metersToTile:qi*tp(Ta(r))}}}function sg(s){const r=s.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new r0(s);case"equirectangular":return new n0(s);case"naturalEarth":return new iw(s);case"equalEarth":return new og(s);case"winkelTripel":return new ow(s);case"albers":return a?new s0(s):new ig(s);case"lambertConformalConic":return a?new s0(s):new rw(s);case"globe":return new sw(s)}throw new Error(`Invalid projection name: ${s.name}`)}const ag=nu.VectorTileFeature.types,by=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mf(s,r,a,c,d,m,_,x,C,E,S,P,k){const L=x?Math.min(rc,Math.round(x[0])):0,N=x?Math.min(rc,Math.round(x[1])):0;s.emplaceBack(r,a,Math.round(32*c),Math.round(32*d),m,_,(L<<1)+(C?1:0),N,16*E,16*S,256*P,256*k)}function rp(s,r,a,c,d,m,_){s.emplaceBack(r,a,c,d,m,_)}function ip(s,r,a,c,d){s.emplaceBack(r,a,c,d),s.emplaceBack(r,a,c,d),s.emplaceBack(r,a,c,d),s.emplaceBack(r,a,c,d)}function gf(s){for(const r of s.sections)if(T(r.text))return!0;return!1}class ps{constructor(r){this.layoutVertexArray=new Ci,this.indexArray=new zr,this.programConfigurations=r,this.segments=new ii,this.dynamicLayoutVertexArray=new Mr,this.opacityVertexArray=new gr,this.placedSymbolArray=new lm,this.globeExtVertexArray=new Xs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zx.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Nx.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,by,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Bx.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ot(ps,"SymbolBuffers");class _f{constructor(r,a,c){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new c,this.segments=new ii,this.collisionVertexArray=new Ei,this.collisionVertexArrayExt=new wr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Vx.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,Ux.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot(_f,"CollisionBuffers");class sc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ro([]),this.placementViewportMatrix=Ro([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yd(this.zoom,a["text-size"]),this.iconSizeData=Yd(this.zoom,a["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>ds[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new ps(new yh(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new ps(new yh(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Nc,this.lineVertexArray=new Vc,this.symbolInstances=new Bc}calculateGlyphDependencies(r,a,c,d,m){for(let _=0;_<r.length;_++)if(a[r.charCodeAt(_)]=!0,d&&m){const x=na[r.charAt(_)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,c,d){const m=this.layers[0],_=m.layout,x="globe"===this.projection.name,C=_.get("text-font"),E=_.get("text-field"),S=_.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof vi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==C.value.kind||C.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const N=a.iconDependencies,U=a.glyphDependencies,Y=a.availableImages,ne=new q(this.zoom);for(const{feature:de,id:he,index:fe,sourceLayerIndex:ge}of r){const ye=m._featureFilter.needGeometry,Re=Gc(de,ye);if(!m._featureFilter.filter(ne,Re,c))continue;if(ye||(Re.geometry=il(de,c,d)),x&&1!==de.type&&c.z<=5){const Ae=Re.geometry,$e=1<<c.z,ot=c.x,st=c.y,Tt=.98078528056;for(let et=0;et<Ae.length;et++)Ae[et]=ox(Ae[et],pt=>pt,(pt,gn)=>Ds(Mi(fi((pt.y/nn+st)/$e),mo((pt.x/nn+ot)/$e),1),Mi(fi((gn.y/nn+st)/$e),mo((gn.x/nn+ot)/$e),1))<Tt)}let Le,We;if(P){const Ae=m.getValueAndResolveTokens("text-field",Re,c,Y),$e=vi.factory(Ae);gf($e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ie()||this.hasRTLText&&J.isParsed())&&(Le=G_($e,m,Re))}if(k){const Ae=m.getValueAndResolveTokens("icon-image",Re,c,Y);We=Ae instanceof jr?Ae:jr.fromString(Ae)}if(!Le&&!We)continue;const it=this.sortFeaturesByKey?L.evaluate(Re,{},c):void 0;if(this.features.push({id:he,text:Le,icon:We,index:fe,sourceLayerIndex:ge,geometry:Re.geometry,properties:de.properties,type:ag[de.type],sortKey:it}),We&&(N[We.name]=!0),Le){const Ae=C.evaluate(Re,{},c).join(","),$e="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ds.vertical)>=0;for(const ot of Le.sections)if(ot.image)N[ot.image.name]=!0;else{const st=Ja(Le.toString()),Tt=ot.fontStack||Ae,et=U[Tt]=U[Tt]||{};this.calculateGlyphDependencies(ot.text,et,$e,this.allowVerticalPlacement,st)}}}"line"===_.get("symbol-placement")&&(this.features=function(de){const he={},fe={},ge=[];let ye=0;function Re(Ae){ge.push(de[Ae]),ye++}function Le(Ae,$e,ot){const st=fe[Ae];return delete fe[Ae],fe[$e]=st,ge[st].geometry[0].pop(),ge[st].geometry[0]=ge[st].geometry[0].concat(ot[0]),st}function We(Ae,$e,ot){const st=he[$e];return delete he[$e],he[Ae]=st,ge[st].geometry[0].shift(),ge[st].geometry[0]=ot[0].concat(ge[st].geometry[0]),st}function it(Ae,$e,ot){const st=ot?$e[0][$e[0].length-1]:$e[0][0];return`${Ae}:${st.x}:${st.y}`}for(let Ae=0;Ae<de.length;Ae++){const $e=de[Ae],ot=$e.geometry,st=$e.text?$e.text.toString():null;if(!st){Re(Ae);continue}const Tt=it(st,ot),et=it(st,ot,!0);if(Tt in fe&&et in he&&fe[Tt]!==he[et]){const pt=We(Tt,et,ot),gn=Le(Tt,et,ge[pt].geometry);delete he[Tt],delete fe[et],fe[it(st,ge[gn].geometry,!0)]=gn,ge[pt].geometry=null}else Tt in fe?Le(Tt,et,ot):et in he?We(Tt,et,ot):(Re(Ae),he[Tt]=ye-1,fe[et]=ye-1)}return ge.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,he)=>de.sortKey-he.sortKey)}update(r,a,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,c,d),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,c,d))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const c=this.lineVertexArray.length,d=r.segment;if(void 0!==d){let m=r.dist(a[d+1]),_=r.dist(a[d]);const x={};for(let C=d+1;C<a.length;C++)x[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:m},C<a.length-1&&(m+=a[C+1].dist(a[C]));for(let C=d||0;C>=0;C--)x[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=a[C-1].dist(a[C]));for(let C=0;C<a.length;C++){const E=x[C];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,a,c,d,m,_,x,C,E,S,P,k,L,N){const U=r.indexArray,Y=r.layoutVertexArray,ne=r.globeExtVertexArray,de=r.segments.prepareSegment(4*a.length,Y,U,this.canOverlap?_.sortKey:void 0),he=this.glyphOffsetArray.length,fe=de.vertexLength,ge=this.allowVerticalPlacement&&x===ds.vertical?Math.PI/2:0,ye=_.text&&_.text.sections;for(let Le=0;Le<a.length;Le++){const{tl:We,tr:it,bl:Ae,br:$e,tex:ot,pixelOffsetTL:st,pixelOffsetBR:Tt,minFontScaleX:et,minFontScaleY:pt,glyphOffset:gn,isSDF:Pn,sectionIndex:Wt}=a[Le],Lt=de.vertexLength,zn=gn[1];if(mf(Y,E.x,E.y,We.x,zn+We.y,ot.x,ot.y,c,Pn,st.x,st.y,et,pt),mf(Y,E.x,E.y,it.x,zn+it.y,ot.x+ot.w,ot.y,c,Pn,Tt.x,st.y,et,pt),mf(Y,E.x,E.y,Ae.x,zn+Ae.y,ot.x,ot.y+ot.h,c,Pn,st.x,Tt.y,et,pt),mf(Y,E.x,E.y,$e.x,zn+$e.y,ot.x+ot.w,ot.y+ot.h,c,Pn,Tt.x,Tt.y,et,pt),C){const Dn=C.anchor,$t=C.up;rp(ne,Dn.x,Dn.y,Dn.z,$t[0],$t[1],$t[2]),rp(ne,Dn.x,Dn.y,Dn.z,$t[0],$t[1],$t[2]),rp(ne,Dn.x,Dn.y,Dn.z,$t[0],$t[1],$t[2]),rp(ne,Dn.x,Dn.y,Dn.z,$t[0],$t[1],$t[2]),ip(r.dynamicLayoutVertexArray,Dn.x,Dn.y,Dn.z,ge)}else ip(r.dynamicLayoutVertexArray,E.x,E.y,E.z,ge);U.emplaceBack(Lt,Lt+1,Lt+2),U.emplaceBack(Lt+1,Lt+2,Lt+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gn[0]),Le!==a.length-1&&Wt===a[Le+1].sectionIndex||r.programConfigurations.populatePaintArrays(Y.length,_,_.index,{},L,N,ye&&ye[Wt])}const Re=C?C.anchor:E;r.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,E.x,E.y,he,this.glyphOffsetArray.length-he,fe,S,P,E.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],x,0,!1,0,k,0)}_commitLayoutVertex(r,a,c,d,m,_,x){r.emplaceBack(a,c,d,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,c,d,m,_,x){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=C.vertexLength,S=x.tileAnchorX,P=x.tileAnchorY;for(let L=0;L<4;L++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,P,new ce(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,P,new ce(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,P,new ce(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,S,P,new ce(r.x1,r.y2)),C.vertexLength+=4;const k=c.indexArray;k.emplaceBack(E,E+1),k.emplaceBack(E+1,E+2),k.emplaceBack(E+2,E+3),k.emplaceBack(E+3,E),C.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,c,d,m,_){for(let x=d;x<m;x++){const C=c.get(x),E=this.getSymbolInstanceTextSize(r,_,a,x);this._addCollisionDebugVertices(C,E,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,a,c,d,m,_){for(let x=d;x<m;x++){const C=c.get(x),E=this.getSymbolInstanceIconSize(r,a,x);this._addCollisionDebugVertices(C,E,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _f(Zn,U_.members,ko),this.iconCollisionBox=new _f(Zn,U_.members,ko);const c=Ah(this.iconSizeData,r),d=Ah(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,a,c,d){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),_=Kp(this.textSizeData,r,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,a,c){const d=this.icon.placedSymbolArray.get(c),m=Kp(this.iconSizeData,r,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,a,c){r.emplaceBack(a,-c,-c),r.emplaceBack(a,c,-c),r.emplaceBack(a,c,c),r.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(r,a,c,d,m,_){for(let x=d;x<m;x++){const C=c.get(x),E=this.getSymbolInstanceTextSize(r,_,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,C.padding)}}_updateIconDebugCollisionBoxes(r,a,c,d,m){for(let _=d;_<m;_++){const x=c.get(_),C=this.getSymbolInstanceIconSize(r,a,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,x.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Ah(this.iconSizeData,r),d=Ah(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(d,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,c,d,m,_,x,C,E){const S={};for(let P=a;P<c;P++){const k=r.get(P);S.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.textFeatureIndex=k.featureIndex;break}for(let P=d;P<m;P++){const k=r.get(P);S.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalTextFeatureIndex=k.featureIndex;break}for(let P=_;P<x;P++){const k=r.get(P);S.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.iconFeatureIndex=k.featureIndex;break}for(let P=C;P<E;P++){const k=r.get(P);S.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalIconFeatureIndex=k.featureIndex;break}return S}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const c=r.placedSymbolArray.get(a),d=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<d;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),c=Math.cos(r),d=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const C=this.symbolInstances.get(x);d.push(0|Math.round(a*C.tileAnchorX+c*C.tileAnchorY)),m.push(C.featureIndex)}return _.sort((x,C)=>d[x]-d[C]||m[C]-m[x]),_}addToSortKeyRanges(r,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,m,_)=>{d>=0&&_.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ot(sc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sc.MAX_GLYPHS=65535,sc.addDynamicAttributes=ip;const lg=new Rt({"symbol-placement":new ae(be.layout_symbol["symbol-placement"]),"symbol-spacing":new ae(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ae(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ie(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ae(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ae(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ae(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new ae(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ae(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ie(be.layout_symbol["icon-size"]),"icon-text-fit":new ae(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ae(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ie(be.layout_symbol["icon-image"]),"icon-rotate":new Ie(be.layout_symbol["icon-rotate"]),"icon-padding":new ae(be.layout_symbol["icon-padding"]),"icon-keep-upright":new ae(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Ie(be.layout_symbol["icon-offset"]),"icon-anchor":new Ie(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ae(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ae(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ae(be.layout_symbol["text-rotation-alignment"]),"text-field":new Ie(be.layout_symbol["text-field"]),"text-font":new Ie(be.layout_symbol["text-font"]),"text-size":new Ie(be.layout_symbol["text-size"]),"text-max-width":new Ie(be.layout_symbol["text-max-width"]),"text-line-height":new Ie(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Ie(be.layout_symbol["text-letter-spacing"]),"text-justify":new Ie(be.layout_symbol["text-justify"]),"text-radial-offset":new Ie(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ae(be.layout_symbol["text-variable-anchor"]),"text-anchor":new Ie(be.layout_symbol["text-anchor"]),"text-max-angle":new ae(be.layout_symbol["text-max-angle"]),"text-writing-mode":new ae(be.layout_symbol["text-writing-mode"]),"text-rotate":new Ie(be.layout_symbol["text-rotate"]),"text-padding":new ae(be.layout_symbol["text-padding"]),"text-keep-upright":new ae(be.layout_symbol["text-keep-upright"]),"text-transform":new Ie(be.layout_symbol["text-transform"]),"text-offset":new Ie(be.layout_symbol["text-offset"]),"text-allow-overlap":new ae(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ae(be.layout_symbol["text-ignore-placement"]),"text-optional":new ae(be.layout_symbol["text-optional"])});var ia={paint:new Rt({"icon-opacity":new Ie(be.paint_symbol["icon-opacity"]),"icon-color":new Ie(be.paint_symbol["icon-color"]),"icon-halo-color":new Ie(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ie(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ie(be.paint_symbol["icon-halo-blur"]),"icon-translate":new ae(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new ae(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ie(be.paint_symbol["text-opacity"]),"text-color":new Ie(be.paint_symbol["text-color"],{runtimeType:rs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ie(be.paint_symbol["text-halo-color"]),"text-halo-width":new Ie(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Ie(be.paint_symbol["text-halo-blur"]),"text-translate":new ae(be.paint_symbol["text-translate"]),"text-translate-anchor":new ae(be.paint_symbol["text-translate-anchor"])}),layout:lg};class yf{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:bc,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(yf,"FormatSectionOverride",{omit:["defaultValue"]});class op extends Ks{constructor(r){super(r,ia)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const m of c)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,c,d){const m=this.layout.get(r).evaluate(a,{},c,d),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||yd(_.value)||!m?m:(x=a.properties,m.replace(/{([^{}]+)}/g,(E,S)=>S in x?String(x[S]):""));var x}createBucket(r){return new sc(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of ia.paint.overridableProperties){if(!op.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),c=new yf(a),d=new _d(c,a.property.specification);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new vd("source",d):new Ul("composite",d,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new ke(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&op.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const c=r.get("text-field"),d=ia.paint.properties[a];let m=!1;const _=x=>{for(const C of x)if(d.overrides&&d.overrides.hasOverride(C))return void(m=!0)};if("constant"===c.value.kind&&c.value.value instanceof vi)_(c.value.value.sections);else if("source"===c.value.kind){const x=E=>{m||(E instanceof Hu&&Xr(E.value)===ur?_(E.value.sections):E instanceof pa?_(E.sections):E.eachChild(x))},C=c.value;C._styleExpression&&x(C._styleExpression.expression)}return m}getProgramConfiguration(r){return new jc(this,r)}}var cg={paint:new Rt({"background-color":new ae(be.paint_background["background-color"]),"background-pattern":new bt(be.paint_background["background-pattern"]),"background-opacity":new ae(be.paint_background["background-opacity"])})},aw={paint:new Rt({"raster-opacity":new ae(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new ae(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ae(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ae(be.paint_raster["raster-brightness-max"]),"raster-saturation":new ae(be.paint_raster["raster-saturation"]),"raster-contrast":new ae(be.paint_raster["raster-contrast"]),"raster-resampling":new ae(be.paint_raster["raster-resampling"]),"raster-fade-duration":new ae(be.paint_raster["raster-fade-duration"])})};class wy extends Ks{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var lw={paint:new Rt({"sky-type":new ae(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new ae(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ae(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ae(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ae(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new qe(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ae(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ae(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ae(be.paint_sky["sky-opacity"])})};function zh(s,r,a){const c=[0,0,1],d=b_([]);return C_(d,d,a?-Xe(s)+Math.PI:Xe(s)),w_(d,d,-Xe(r)),vm(c,c,d),go(c,c)}const vf={circle:class extends Ks{constructor(s){super(s,ux)}createBucket(s){return new jp(s)}queryRadius(s){const r=s;return Zc("circle-radius",this,r)+Zc("circle-stroke-width",this,r)+$p(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,c,d,m,_,x){const C=__(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return Qs(s,c,m,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,E)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new jc(this,s)}},heatmap:class extends Ks{createBucket(s){return new mx(s)}constructor(s){super(s,J1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Zc("heatmap-radius",this,s)}queryIntersectsFeature(s,r,a,c,d,m,_,x){const C=this.paint.get("heatmap-radius").evaluate(r,a);return Qs(s,c,m,_,x,!0,!0,new ce(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new jc(this,s)}},hillshade:class extends Ks{constructor(s){super(s,S_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ks{constructor(s){super(s,Ax)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new jc(this,s)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new $d(s)}queryRadius(){return $p(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,c,d,m){return!s.queryGeometry.isAboveHorizon&&mm(lx(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ks{constructor(s){super(s,Q1)}createBucket(s){return new Zd(s)}queryRadius(){return $p(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new jc(this,s)}queryIntersectsFeature(s,r,a,c,d,m,_,x,C){const E=__(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(r,a),P=this.paint.get("fill-extrusion-base").evaluate(r,a),k=[0,0],L=x&&m.elevation,N=m.elevation?m.elevation.exaggeration():1,U=s.tile.getBucket(this);if(L&&U instanceof Zd){const de=U.centroidVertexArray,he=C+1;if(he<de.length){const fe=de.get(he);k[0]=fe.a_centroid_pos0,k[1]=fe.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===m.projection.name&&(c=L_([c],[new ce(0,0),new ce(nn,nn)],s.tileID.canonical).map(de=>de.polygon).flat());const Y=(he=c,fe=P,ge=S,ye=E,Re=_,Le=L?x:null,We=k,it=N,Ae=m.center.lat,"globe"===(de=m).projection.name?function(ot,st,Tt,et,pt,gn,Pn,Wt,Lt,zn,Dn){const $t=[],gi=[],Hr=ot.projection.upVectorScale(Dn,ot.center.lat,ot.worldSize).metersToTile,Qr=[0,0,0,1],Nn=[0,0,0,1],Un=(vr,ar,Er,Or)=>{vr[0]=ar,vr[1]=Er,vr[2]=Or,vr[3]=1},_r=Ma();Tt>0&&(Tt+=_r),et+=_r;for(const vr of st){const ar=[],Er=[];for(const Or of vr){const Zi=Or.x+pt.x,Ko=Or.y+pt.y,Vn=ot.projection.projectTilePoint(Zi,Ko,Dn),oi=ot.projection.upVector(Dn,Or.x,Or.y);let lo=Tt,tr=et;if(Pn){const Rr=Ih(Zi,Ko,Tt,et,Pn,Wt,Lt,zn);lo+=Rr.base,tr+=Rr.top}0!==Tt?Un(Qr,Vn.x+oi[0]*Hr*lo,Vn.y+oi[1]*Hr*lo,Vn.z+oi[2]*Hr*lo):Un(Qr,Vn.x,Vn.y,Vn.z),Un(Nn,Vn.x+oi[0]*Hr*tr,Vn.y+oi[1]*Hr*tr,Vn.z+oi[2]*Hr*tr),Nr(Qr,Qr,gn),Nr(Nn,Nn,gn),ar.push(Xd(Qr)),Er.push(Xd(Nn))}$t.push(ar),gi.push(Er)}return[$t,gi]}(de,he,fe,ge,ye,Re,Le,We,it,Ae,s.tileID.canonical):Le?function(ot,st,Tt,et,pt,gn,Pn,Wt,Lt){const zn=[],Dn=[],$t=[0,0,0,1];for(const gi of ot){const Hr=[],Qr=[];for(const Nn of gi){const Un=Nn.x+et.x,_r=Nn.y+et.y,vr=Ih(Un,_r,st,Tt,gn,Pn,Wt,Lt);$t[0]=Un,$t[1]=_r,$t[2]=vr.base,$t[3]=1,ec($t,$t,pt),$t[3]=Math.max($t[3],1e-5);const ar=Xd([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);$t[0]=Un,$t[1]=_r,$t[2]=vr.top,$t[3]=1,ec($t,$t,pt),$t[3]=Math.max($t[3],1e-5);const Er=Xd([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);Hr.push(ar),Qr.push(Er)}zn.push(Hr),Dn.push(Qr)}return[zn,Dn]}(he,fe,ge,ye,Re,Le,We,it,Ae):function(ot,st,Tt,et,pt){const gn=[],Pn=[],Wt=pt[8]*st,Lt=pt[9]*st,zn=pt[10]*st,Dn=pt[11]*st,$t=pt[8]*Tt,gi=pt[9]*Tt,Hr=pt[10]*Tt,Qr=pt[11]*Tt;for(const Nn of ot){const Un=[],_r=[];for(const vr of Nn){const ar=vr.x+et.x,Er=vr.y+et.y,Or=pt[0]*ar+pt[4]*Er+pt[12],Zi=pt[1]*ar+pt[5]*Er+pt[13],Ko=pt[2]*ar+pt[6]*Er+pt[14],Vn=pt[3]*ar+pt[7]*Er+pt[15],oi=Or+Wt,lo=Zi+Lt,tr=Ko+zn,Rr=Math.max(Vn+Dn,1e-5),co=Or+$t,Ar=Zi+gi,ei=Ko+Hr,Vr=Math.max(Vn+Qr,1e-5),ci=new ce(oi/Rr,lo/Rr);ci.z=tr/Rr,Un.push(ci);const Wi=new ce(co/Vr,Ar/Vr);Wi.z=ei/Vr,_r.push(Wi)}gn.push(Un),Pn.push(_r)}return[gn,Pn]}(he,fe,ge,ye,Re)),ne=s.queryGeometry;var de,he,fe,ge,ye,Re,Le,We,it,Ae;return function(de,he,fe){let ge=1/0;mm(fe,he)&&(ge=F_(fe,he[0]));for(let ye=0;ye<he.length;ye++){const Re=he[ye],Le=de[ye];for(let We=0;We<Re.length-1;We++){const it=Re[We],Ae=[it,Re[We+1],Le[We+1],Le[We],it];bh(fe,Ae)&&(ge=Math.min(ge,F_(fe,Ae)))}}return ge!==1/0&&ge}(Y[0],Y[1],ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Ks{constructor(s){super(s,Lm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Tc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=V_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new ll(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new jc(this,s)}queryRadius(s){const r=s,a=Yp(Zc("line-width",this,r),Zc("line-gap-width",this,r)),c=Zc("line-offset",this,r);return a/2+Math.abs(c)+$p(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,c,d,m){if(s.queryGeometry.isAboveHorizon)return!1;const _=lx(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),x=s.pixelToTileUnitsFactor/2*Yp(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(c=function(E,S){const P=[],k=new ce(0,0);for(let L=0;L<E.length;L++){const N=E[L],U=[];for(let Y=0;Y<N.length;Y++){const ne=N[Y-1],de=N[Y],he=N[Y+1],fe=0===Y?k:de.sub(ne)._unit()._perp(),ge=Y===N.length-1?k:he.sub(de)._unit()._perp(),ye=fe._add(ge)._unit();ye._mult(1/(ye.x*ge.x+ye.y*ge.y)),U.push(ye._mult(S)._add(de))}P.push(U)}return P}(c,C*s.pixelToTileUnitsFactor)),function(E,S,P){for(let k=0;k<S.length;k++){const L=S[k];if(E.length>=3)for(let N=0;N<L.length;N++)if(Js(E,L[N]))return!0;if(Od(E,L,P))return!0}return!1}(_,c,x)}isTileClipped(){return!0}},symbol:op,background:class extends Ks{constructor(s){super(s,cg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ks{constructor(s){super(s,aw)}getProgramIds(){return["raster"]}},sky:class extends Ks{constructor(s){super(s,lw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),d=!c,m=s.style.light,_=m.properties.get("position");return d&&"viewport"===m.properties.get("anchor")&&vn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?zh(_.azimuthal,90-_.polar,r):zh(c[0],90-c[1],r)}const a=this.paint.get("sky-gradient-center");return zh(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class hu{constructor(r,a,c,d){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(a,d)}update(r,a,c){const{width:d,height:m}=r,{context:_}=this,{gl:x}=_,{HTMLImageElement:C,HTMLCanvasElement:E,HTMLVideoElement:S,ImageData:P,ImageBitmap:k}=H;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||!1!==a.premultiply)),c||this.size&&this.size[0]===d&&this.size[1]===m){const{x:L,y:N}=c||{x:0,y:0};r instanceof C||r instanceof E||r instanceof S||r instanceof P||k&&r instanceof k?x.texSubImage2D(x.TEXTURE_2D,0,L,N,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,L,N,d,m,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[d,m],r instanceof C||r instanceof E||r instanceof S||r instanceof P||k&&r instanceof k?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,d,m,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?r===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class sp{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new ea({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const c=this.getKey(r,a);return this.positions[c]}trim(){const r=this.width,a=this.height=wt(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,c){const d=[];let m=r.length%2==1?-r[r.length-1]*c:0,_=r[0]*c,x=!0;d.push({left:m,right:_,isDash:x,zeroLength:0===r[0]});let C=r[0];for(let E=1;E<r.length;E++){x=!x;const S=r[E];m=C*c,C+=S,_=C*c,d.push({left:m,right:_,isDash:x,zeroLength:0===S})}return d}addRoundDash(r,a,c){const d=a/2;for(let m=-c;m<=c;m++){const _=this.width*(this.nextRow+c+m);let x=0,C=r[x];for(let E=0;E<this.width;E++){E/C.right>1&&(C=r[++x]);const S=Math.abs(E-C.left),P=Math.abs(E-C.right),k=Math.min(S,P);let L;const N=m/c*(d+1);if(C.isDash){const U=d-Math.abs(N);L=Math.sqrt(k*k+U*U)}else L=d-Math.sqrt(k*k+N*N);this.image.data[_+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(r,a){for(let C=r.length-1;C>=0;--C){const E=r[C],S=r[C+1];E.zeroLength?r.splice(C,1):S&&S.isDash===E.isDash&&(S.left=E.left,r.splice(C,1))}const c=r[0],d=r[r.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const m=this.width*this.nextRow;let _=0,x=r[_];for(let C=0;C<this.width;C++){C/x.right>1&&(x=r[++_]);const E=Math.abs(C-x.left),S=Math.abs(C-x.right),P=Math.min(E,S);this.image.data[m+C]=Math.max(0,Math.min(255,(x.isDash?P:-P)+a+128))}}addDash(r,a){const c=this.getKey(r,a);if(this.positions[c])return this.positions[c];const d="round"===a,m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return vn("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let S=0;S<r.length;S++)r[S]<0&&(vn("Negative value is found in line dasharray, replacing values with 0"),r[S]=0),x+=r[S];if(0!==x){const S=this.width/x,P=this.getDashRanges(r,this.width,S);d?this.addRoundDash(P,S,m):this.addRegularDash(P,"square"===a?.5*S:0)}const C=this.nextRow+m;this.nextRow+=_;const E={tl:[C,m],br:[x,0]};return this.positions[c]=E,E}}Ot(sp,"LineAtlas");class ug{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cw{constructor(){this.tasks={},this.taskQueue=[],Yt(["process"],this),this.invoker=new ug(this.process),this.nextId=0}add(r,a){const c=this.nextId++,d=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-x:"maybePrepare"===m&&_?400-x:500:200-x:100-x}(a);if(0===d){$n();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:a,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){$n();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<a&&(a=m.priority,r=d)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}class Cy{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const c=r[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const a0=["tile","layer","source","sourceLayer","state"];class Ey{constructor(r,a,c,d,m){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=c,this._y=d,this.properties=r.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of a0)void 0!==this[a]&&(r[a]=this[a]);return r}}const du=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,a=0,c=0,d=0,m=0,_=0,x=0;for(1&r?d=m=_=32:a=c=x=32;(r>>=1)>1;){const E=a+d>>1,S=c+m>>1;1&r?(d=a,m=c,a=_,c=x):(a=d,c=m,d=_,m=x),_=E,x=S}const C=4*s;du[C+0]=a,du[C+1]=c,du[C+2]=d,du[C+3]=m}const Da=new Uint16Array(2178),pu=new Uint8Array(1089),ap=new Uint16Array(1089);function hg(s){return 0===s?-.03125:32===s?.03125:0}var My=It([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const xf={type:2,extent:nn,loadGeometry:()=>[[new ce(0,0),new ce(8193,0),new ce(8193,8193),new ce(0,8193),new ce(0,0)]]};class Ty{constructor(r,a,c,d,m){this.tileID=r,this.uid=Xt(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<ns.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=cu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(d,m){const _={};if(!m)return _;for(const x of d){const C=x.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(0!==C.length){x.layers=C,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>C.filter(S=>S.id===E)[0]));for(const E of C)_[E.id]=x}}return _}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof sc){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof sc&&m.hasRTLText){this.hasRTLText=!0,J.isLoading()||J.isLoaded()||"deferred"!==ie()||W();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Id}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hu(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hu(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hu(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,c,d,m,_,x,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},r,a,c):{}}querySourceFeatures(r,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),m=a?a.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const x=Ha(a&&a.filter),{z:C,x:E,y:S}=this.tileID.canonical,P={z:C,x:E,y:S};for(let k=0;k<_.length;k++){const L=_.feature(k);if(x.needGeometry){const Y=Gc(L,!0);if(!x.filter(new q(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!x.filter(new q(this.tileID.overscaledZ),L))continue;const N=c.getId(L,m),U=new Ey(L,C,E,S,N);U.tile=P,r.push(U)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const c=Di(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const m=this.expirationTime-a;m?this.expirationTime=c+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),d=a.style.listImages();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",C=c[x],E=r[x];if(!C||!E||0===Object.keys(E).length)continue;if(_.update(E,C,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof ll||_ instanceof $d){const P=a.style._getSourceCache(_.layers[0].source);a._terrain&&a._terrain.enabled&&P&&_.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(P.id,this.tileID)}const S=a&&a.style&&a.style.getLayer(m);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ns.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=ns.now()+r}setTexture(r,a){const c=a.context,d=c.gl;this.texture=a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new hu(c,r,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(r,a){const c={};for(const d of a)c[d]=!0;this.dependencies[r]=c}hasDependency(r,a){for(const c of r){const d=this.dependencies[c];if(d)for(const m of a)if(d[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const c=il(xf,this.tileID.canonical,this.tileTransform)[0],d=new mn,m=new cs;for(let _=0;_<c.length;_++){const{x,y:C}=c[_];d.emplaceBack(x,C),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(d,Oh.members),this._tileDebugSegments=ii.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const c=il(xf,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const _=function(x,C){const E=cu(x,C),S=Math.pow(2,x.z);for(let Y=0;Y<33;Y++)for(let ne=0;ne<33;ne++){const de=mo((x.x+(ne+hg(ne))/32)/S),he=fi((x.y+(Y+hg(Y))/32)/S),fe=C.project(de,he),ge=33*Y+ne;Da[2*ge+0]=Math.round((fe.x*E.scale-E.x)*nn),Da[2*ge+1]=Math.round((fe.y*E.scale-E.y)*nn)}pu.fill(0),ap.fill(0);for(let Y=2045;Y>=0;Y--){const ne=4*Y,de=du[ne+0],he=du[ne+1],fe=du[ne+2],ge=du[ne+3],ye=de+fe>>1,Re=he+ge>>1,Le=ye+Re-he,We=Re+de-ye,it=33*he+de,Ae=33*ge+fe,$e=33*Re+ye,ot=Math.hypot((Da[2*it+0]+Da[2*Ae+0])/2-Da[2*$e+0],(Da[2*it+1]+Da[2*Ae+1])/2-Da[2*$e+1])>=16;if(pu[$e]=pu[$e]||(ot?1:0),Y<1022){const st=33*(he+We>>1)+(de+Le>>1),Tt=33*(ge+We>>1)+(fe+Le>>1);pu[$e]=pu[$e]||pu[st]||pu[Tt]}}const P=new ln,k=new zr;let L=0;function N(Y,ne){const de=33*ne+Y;return 0===ap[de]&&(P.emplaceBack(Da[2*de+0],Da[2*de+1],Y*nn/32,ne*nn/32),ap[de]=++L),ap[de]-1}function U(Y,ne,de,he,fe,ge){const ye=Y+de>>1,Re=ne+he>>1;if(Math.abs(Y-fe)+Math.abs(ne-ge)>1&&pu[33*Re+ye])U(fe,ge,Y,ne,ye,Re),U(de,he,fe,ge,ye,Re);else{const Le=N(Y,ne),We=N(de,he),it=N(fe,ge);k.emplaceBack(Le,We,it)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:P,indices:k}}(this.tileID.canonical,a);d=_.vertices,m=_.indices}else{d=new ln,m=new zr;for(const{x,y:C}of c)d.emplaceBack(x,C,0,0);const _=Zp(d.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(d,My.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=ii.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(r,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||"globe"!==a.name)return;const c=this.tileID.canonical,d=oc(Ta(c));this._makeGlobeTileDebugBorderBuffer(r,c,d),this._makeGlobeTileDebugTextBuffer(r,c,d)}_makeGlobeTileDebugBorderBuffer(r,a,c){const d=new mn,m=new cs,_=new Nt,x=(E,S,P,k,L)=>{const N=(P-E)/(L-1),U=(k-S)/(L-1),Y=d.length;for(let ne=0;ne<L;ne++){const de=E+ne*N,he=S+ne*U;d.emplaceBack(de,he);const fe=gy(de,he,a),ge=Nr(fe,fe,c);_.emplaceBack(ge[0],ge[1],ge[2]),m.emplaceBack(Y+ne)}},C=nn;x(0,0,C,0,16),x(C,0,C,C,16),x(C,C,0,C,16),x(0,C,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(d,Oh.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(_,hf.members),this._tileDebugSegments=ii.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugTextBuffer(r,a,c){const d=new mn,m=new zr,_=new Nt,x=25;m.reserve(32),d.reserve(x),_.reserve(x);const C=(E,S)=>x*E+S;for(let E=0;E<x;E++){const S=2048*E;for(let P=0;P<x;P++){const k=2048*P;d.emplaceBack(k,S);const L=gy(k,S,a),N=Nr(L,L,c);_.emplaceBack(N[0],N[1],N[2])}}for(let E=0;E<4;E++)for(let S=0;S<4;S++){const P=C(E,S),k=C(E,S+1),L=C(E+1,S),N=C(E+1,S+1);m.emplaceBack(P,k,L),m.emplaceBack(L,k,N)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(m),this._tileDebugTextBuffer=r.createVertexBuffer(d,Oh.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(_,hf.members),this._tileDebugTextSegments=ii.simpleSegment(0,0,x,32)}}class uw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,c){const d=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][d]=this.stateChanges[r][d]||{},je(this.stateChanges[r][d],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const m in this.state[r])m!==d&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][d]){this.deletedStates[r][d]={};for(const m in this.state[r][d])c[m]||(this.deletedStates[r][d][m]=null)}else for(const m in c)this.deletedStates[r]&&this.deletedStates[r][d]&&null===this.deletedStates[r][d][m]&&delete this.deletedStates[r][d][m]}removeFeatureState(r,a,c){if(null===this.deletedStates[r])return;const d=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==a)null!==this.deletedStates[r][d]&&(this.deletedStates[r][d]=this.deletedStates[r][d]||{},this.deletedStates[r][d][c]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][d])for(c in this.deletedStates[r][d]={},this.stateChanges[r][d])this.deletedStates[r][d][c]=null;else this.deletedStates[r][d]=null;else this.deletedStates[r]=null}getState(r,a){const c=String(a),d=je({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const m=this.deletedStates[r][a];if(null===m)return{};for(const _ in m)delete d[_]}return d}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),je(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];c[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(null===this.deletedStates[d])for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(null===this.deletedStates[d][_])this.state[d][_]={};else for(const x of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][x];m[_]=this.state[d][_]}c[d]=c[d]||{},je(c[d],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const d in r)r[d].setFeatureState(c,a)}}class l0{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const c=this.toIdx(r,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function c0(s,r,a,c){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(a[_]<s[_]||a[_]>r[_])return null}else{const x=1/c[_];let C=(s[_]-a[_])*x,E=(r[_]-a[_])*x;if(C>E){const S=C;C=E,E=S}if(C>d&&(d=C),E<m&&(m=E),d>m)return null}return d}function u0(s,r,a,c,d,m,_,x,C,E,S){const P=c-s,k=d-r,L=m-a,N=_-s,U=x-r,Y=C-a,ne=S[1]*Y-S[2]*U,de=S[2]*N-S[0]*Y,he=S[0]*U-S[1]*N,fe=P*ne+k*de+L*he;if(Math.abs(fe)<1e-15)return null;const ge=1/fe,ye=E[0]-s,Re=E[1]-r,Le=E[2]-a,We=(ye*ne+Re*de+Le*he)*ge;if(We<0||We>1)return null;const it=Re*L-Le*k,Ae=Le*P-ye*L,$e=ye*k-Re*P,ot=(S[0]*it+S[1]*Ae+S[2]*$e)*ge;return ot<0||We+ot>1?null:(N*it+U*Ae+Y*$e)*ge}function h0(s,r,a){return(s-r)/(a-r)}function d0(s,r,a,c,d,m,_,x,C){const E=1<<a,S=m-c,P=_-d,k=(s+1)/E*S+c,L=(r+0)/E*P+d,N=(r+1)/E*P+d;x[0]=(s+0)/E*S+c,x[1]=L,C[0]=k,C[1]=N}class p0{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let C=Math.ceil(Math.pow(2,_));const E=1/C,S=(L,N,U,Y,ne)=>{const de=Y?1:0,he=(L+1)*U-de,fe=N*U,ge=(N+1)*U-de;ne[0]=L*U,ne[1]=fe,ne[2]=he,ne[3]=ge};let P=new l0(C);const k=[];for(let L=0;L<C*C;L++){S(L%C,Math.floor(L/C),E,!1,k);const N=fu(k[0],k[1],m),U=fu(k[2],k[1],m),Y=fu(k[2],k[3],m),ne=fu(k[0],k[3],m);P.minimums.push(Math.min(N,U,Y,ne)),P.maximums.push(Math.max(N,U,Y,ne)),P.leaves.push(1)}for(x.push(P),C/=2;C>=1;C/=2){const L=x[x.length-1];P=new l0(C);for(let N=0;N<C*C;N++){S(N%C,Math.floor(N/C),2,!0,k);const U=L.getElevation(k[0],k[1]),Y=L.getElevation(k[2],k[1]),ne=L.getElevation(k[2],k[3]),de=L.getElevation(k[0],k[3]),he=L.isLeaf(k[0],k[1]),fe=L.isLeaf(k[2],k[1]),ge=L.isLeaf(k[2],k[3]),ye=L.isLeaf(k[0],k[3]),Re=Math.min(U.min,Y.min,ne.min,de.min),Le=Math.max(U.max,Y.max,ne.max,de.max),We=he&&fe&&ge&&ye;P.maximums.push(Le),P.minimums.push(Re),P.leaves.push(Le-Re<=5&&We?1:0)}x.push(P)}return x}(this.dem),c=a.length-1,d=a[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(r,a,c,d,m,_,x=1){return c0([r,a,-100],[c,d,this.maximums[0]*x],m,_)}raycast(r,a,c,d,m,_,x=1){if(!this.nodeCount)return null;const C=this.raycastRoot(r,a,c,d,m,_,x);if(null==C)return null;const E=[],S=[],P=[],k=[],L=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:N,t:U,nodex:Y,nodey:ne,depth:de}=L.pop();if(this.leaves[N]){d0(Y,ne,de,r,a,c,d,P,k);const fe=1<<de,ge=(Y+0)/fe,ye=(Y+1)/fe,Re=(ne+0)/fe,Le=(ne+1)/fe,We=fu(ge,Re,this.dem)*x,it=fu(ye,Re,this.dem)*x,Ae=fu(ye,Le,this.dem)*x,$e=fu(ge,Le,this.dem)*x,ot=u0(P[0],P[1],We,k[0],P[1],it,k[0],k[1],Ae,m,_),st=u0(k[0],k[1],Ae,P[0],k[1],$e,P[0],P[1],We,m,_),Tt=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==st?st:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const et=qp([],m,_,U);if(f0(We,it,$e,Ae,h0(et[0],P[0],k[0]),h0(et[1],P[1],k[1]))>=et[2])return U}continue}let he=0;for(let fe=0;fe<this._siblingOffset.length;fe++){d0((Y<<1)+this._siblingOffset[fe][0],(ne<<1)+this._siblingOffset[fe][1],de+1,r,a,c,d,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[N]+fe]*x;const ge=c0(P,k,m,_);if(null!=ge){const ye=ge;E[fe]=ye;let Re=!1;for(let Le=0;Le<he&&!Re;Le++)ye>=E[S[Le]]&&(S.splice(Le,0,fe),Re=!0);Re||(S[he]=fe),he++}}for(let fe=0;fe<he;fe++){const ge=S[fe];L.push({idx:this.childOffsets[N]+ge,t:E[ge],nodex:(Y<<1)+this._siblingOffset[ge][0],nodey:(ne<<1)+this._siblingOffset[ge][1],depth:de+1})}}return null}_addNode(r,a,c){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,c,d,m){if(1===r[d].isLeaf(a,c))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,x=r[_];let C=0,E=0;for(let S=0;S<this._siblingOffset.length;S++){const P=2*a+this._siblingOffset[S][0],k=2*c+this._siblingOffset[S][1],L=x.getElevation(P,k),N=x.isLeaf(P,k),U=this._addNode(L.min,L.max,N);N&&(C|=1<<S),E||(E=U)}for(let S=0;S<this._siblingOffset.length;S++)C&1<<S||this._construct(r,2*a+this._siblingOffset[S][0],2*c+this._siblingOffset[S][1],_,E+S)}}function f0(s,r,a,c,d,m){return In(In(s,a,m),In(r,c,m),d)}function fu(s,r,a){const c=a.dim,d=Ve(s*c-.5,0,c-1),m=Ve(r*c-.5,0,c-1),_=Math.floor(d),x=Math.floor(m),C=Math.min(_+1,c-1),E=Math.min(x+1,c-1);return f0(a.get(_,x),a.get(C,x),a.get(_,E),a.get(C,E),d-_,m-x)}const pl={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Bh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,c,d=!1,m=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return vn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let C=0;C<_;C++)x[this._idx(-1,C)]=x[this._idx(0,C)],x[this._idx(_,C)]=x[this._idx(_-1,C)],x[this._idx(C,-1)]=x[this._idx(C,0)],x[this._idx(C,_)]=x[this._idx(C,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new p0(this)}get(r,a,c=!1){c&&(r=Ve(r,-1,this.dim),a=Ve(a,-1,this.dim));const d=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(r){return pl[r]}get unpackVector(){return pl[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,c){return(256*r*256+256*a+c)/10-1e4}_unpackTerrarium(r,a,c){return 256*r+a+c/256-32768}static pack(r,a){const c=[0,0,0,0],d=Bh.getUnpackVector(a);let m=Math.floor((r+d[3])/d[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new _o({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,m=a*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(a){case-1:d=m-1;break;case 1:m=d+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}const C=-a*this.dim,E=-c*this.dim;for(let S=_;S<x;S++)for(let P=d;P<m;P++){const k=4*this._idx(P,S),L=4*this._idx(P+C,S+E);this.pixels[k+0]=r.pixels[L+0],this.pixels[k+1]=r.pixels[L+1],this.pixels[k+2]=r.pixels[L+2],this.pixels[k+3]=r.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ot(Bh,"DEMData"),Ot(p0,"DemMinMaxQuadTree",{omit:["dem"]});class m0{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,c){const d=r.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const m={value:a,timeout:void 0};if(void 0!==c&&(m.timeout=setTimeout(()=>{this.remove(r,m)},c)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const c=r.wrapped().key,d=void 0===a?0:this.data[c].indexOf(a),m=this.data[c][d];return this.data[c].splice(d,1),m.timeout&&clearTimeout(m.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const c in this.data)for(const d of this.data[c])r(d.value)||a.push(d);for(const c of a)this.remove(c.value.tileID,c)}}class mu{constructor(r,a,c){this.func=r,this.mask=a,this.range=c}}mu.ReadOnly=!1,mu.ReadWrite=!0,mu.disabled=new mu(519,mu.ReadOnly,[0,1]);class bf{constructor(r,a,c,d,m,_){this.test=r,this.ref=a,this.mask=c,this.fail=d,this.depthFail=m,this.pass=_}}bf.disabled=new bf({func:519,mask:0},0,0,7680,7680,7680);class As{constructor(r,a,c){this.blendFunction=r,this.blendColor=a,this.mask=c}}As.Replace=[1,0],As.disabled=new As(As.Replace,Wr.transparent,[!1,!1,!1,!1]),As.unblended=new As(As.Replace,Wr.transparent,[!0,!0,!0,!0]),As.alphaBlended=new As([1,771],Wr.transparent,[!0,!0,!0,!0]);class Ps{constructor(r,a,c){this.enable=r,this.mode=a,this.frontFace=c}}Ps.disabled=new Ps(!1,1029,2305),Ps.backCCW=new Ps(!0,1029,2305),Ps.backCW=new Ps(!0,1029,2304),Ps.frontCW=new Ps(!0,1028,2304),Ps.frontCCW=new Ps(!0,1028,2305);class gu extends sr{constructor(r,a,c){super(),this.id=r,this._onlySymbols=c,a.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new m0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new uw,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const c=this._tiles[a];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(r),c.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const c=this._tiles[a];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return Je(this._tiles).map(r=>r.tileID).sort(wf).map(r=>r.key)}getRenderableIds(r){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&a.push(this._tiles[c]);return r?a.sort((c,d)=>{const m=c.tileID,_=d.tileID,x=new ce(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),C=new ce(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||C.y-x.y||C.x-x.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(wf).map(c=>c.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,r,a)))}_tileLoaded(r,a,c,d){if(d)if(r.state="errored",404!==d.status)this._source.fire(new cr(d,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=ns.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Kn("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const m=a[d];if(r.neighboringTiles&&r.neighboringTiles[m]){const _=this.getTileByID(m);c(r,_),c(_,r)}}function c(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const x=m.tileID.canonical.y-d.tileID.canonical.y,C=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+C)?_+=C:1===Math.abs(_-C)&&(_-=C)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,x),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,c,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(x=E)}let C=x;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),r[C.key]){d[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=r.overscaledZ-1;c>=a;c--){const d=r.scaledTo(c),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const c=Math.ceil(r.width/a)+1,d=Math.ceil(r.height/a)+1,m=Math.floor(c*d*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const c={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),c[m.tileID.key]=m}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(r,a,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new kr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(d=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(x=>this._source.hasTile(x)))):d=[];const m=this._updateRetainedTiles(d);if(Dy(this._source.type)&&0!==d.length){const x={},C={},E=Object.keys(m);for(const P of E){const k=m[P],L=this._tiles[P];if(!L||L.fadeEndTime&&L.fadeEndTime<=ns.now())continue;const N=this.findLoadedParent(k,Math.max(k.overscaledZ-gu.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),C[P]=k}const S=d[d.length-1].overscaledZ;for(const P in this._tiles){const k=this._tiles[P];if(m[P]||!k.hasData())continue;let L=k.tileID;for(;L.overscaledZ>S;){L=L.scaledTo(L.overscaledZ-1);const N=this._tiles[L.key];if(N&&N.hasData()&&C[L.key]){m[P]=k.tileID;break}}}for(const P in x)m[P]||(this._coveredTiles[P]=!0,m[P]=x[P])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,C){const E=[];for(const S in x)S in C||E.push(S);return E}(this._tiles,m);for(const x of _){const C=this._tiles[x];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const c={},d=r.reduce((E,S)=>Math.min(E,S.overscaledZ),1/0),m=r[0].overscaledZ,_=Math.max(m-gu.maxOverzooming,this._source.minzoom),x=Math.max(m+gu.maxUnderzooming,this._source.minzoom),C={};for(const E of r){const S=this._addTile(E);a[E.key]=E,S.hasData()||d<this._source.maxzoom&&(C[E.key]=E)}this._retainLoadedChildren(C,d,x,a);for(const E of r){let S=this._tiles[E.key];if(S.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const k=E.children(this._source.maxzoom)[0],L=this.getTile(k);if(L&&L.hasData()){a[k.key]=k;continue}}else{const k=E.children(this._source.maxzoom);if(a[k[0].key]&&a[k[1].key]&&a[k[2].key]&&a[k[3].key])continue}let P=S.wasRequested();for(let k=E.overscaledZ-1;k>=_;--k){const L=E.scaledTo(k);if(c[L.key]||(c[L.key]=!0,S=this.getTile(L),!S&&P&&(S=this._addTile(L)),S&&(a[L.key]=L,P=S.wasRequested(),S.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let c,d=this._tiles[r].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}a.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;d=m}for(const m of a)this._loadedParentTiles[m]=c}}_addTile(r){let a=this._tiles[r.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const c=Boolean(a);if(!c){const d=this.map?this.map.painter:null;a=new Ty(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,c||this._source.fire(new Kn("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=a.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,c){const d=[],m=this.transform;if(!m)return d;const _="globe"===m.projection.name,x=nl(m.center.lng);for(const C in this._tiles){const E=this._tiles[C];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let S;if(_){const P=E.tileID.canonical;if(0===P.z){const k=[Math.abs(Ve(x,...Nh(P,-1))-x),Math.abs(Ve(x,...Nh(P,1))-x)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(Ve(x,...Nh(P,-1))-x),Math.abs(Ve(x,...Nh(P,0))-x),Math.abs(Ve(x,...Nh(P,1))-x)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const P of S){const k=r.containsTile(E,m,a,P);k&&d.push(k)}}return d}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Dy(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=ns.now())return!0}return!1}setFeatureState(r,a,c){this._state.updateState(r=r||"_geojsonTileLayer",a,c)}removeFeatureState(r,a,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,c)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,c){const d=this._tiles[r];d&&d.setDependencies(a,c)}reloadTilesForDependencies(r,a){for(const c in this._tiles)this._tiles[c].hasDependency(r,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,a))}_preloadTiles(r,a){const c=new Map,d=Array.isArray(r)?r:[r],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of d){const C=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of C)c.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}He(Array.from(c.values()),(x,C)=>{const E=new Ty(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,S=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),C(S,E)})},a)}}function wf(s,r){const a=Math.abs(2*s.wrap)-+(s.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||c-a||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function Dy(s){return"raster"===s||"image"===s||"video"===s}function Nh(s,r){const a=1<<s.z;return[s.x/a+r,(s.x+1)/a+r]}gu.maxOverzooming=10,gu.maxUnderzooming=3;class Cf{constructor(r,a,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(r,a,c){const d=c||r.findDEMTileFor(a);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,x=1<<a.canonical.z-_.canonical.z;return new Cf(d,d.tileSize/nn/x,[(a.canonical.x/x-_.canonical.x)*m.dim,(a.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(r,a){const c=a*this._scale+this._offset[1],d=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(c);return new ce(d,m)}getElevationAt(r,a,c,d){const m=r*this._scale+this._offset[0],_=a*this._scale+this._offset[1],x=Math.floor(m),C=Math.floor(_),E=this._dem;return d=!!d,c?In(In(E.get(x,C,d),E.get(x,C+1,d),_-C),In(E.get(x+1,C,d),E.get(x+1,C+1,d),_-C),m-x):E.get(x,C,d)}getElevationAtPixel(r,a,c){return this._dem.get(r,a,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Ms(1,r)*this._dem.stride}}class Sy{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Ka(nn,16,0),this.featureIndexArray=new Bp,this.promoteId=a}insert(r,a,c,d,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,m,_);const C=this.grid;for(let E=0;E<a.length;E++){const S=a[E],P=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const L=S[k];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<nn&&P[1]<nn&&P[2]>=0&&P[3]>=0&&C.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new nu.VectorTile(new tc(this.rawTileData)).layers,this.sourceLayerCoder=new Cy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,c,d){this.loadVTLayers();const m=r.params||{},_=Ha(m.filter),x=r.tileResult,C=r.transform,E=x.bufferedTilespaceBounds,S=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(N,U,Y,ne)=>g_(x.bufferedTilespaceGeometry,N,U,Y,ne));S.sort(Uh);let P=null;C.elevation&&S.length>0&&(P=Cf.create(C.elevation,this.tileID));const k={};let L;for(let N=0;N<S.length;N++){const U=S[N];if(U===L)continue;L=U;const Y=this.featureIndexArray.get(U);let ne=null;this.loadMatchingFeature(k,Y,_,m.layers,m.availableImages,a,c,d,(de,he,fe,ge=0)=>(ne||(ne=il(de,this.tileID.canonical,r.tileTransform)),he.queryIntersectsFeature(x,de,fe,ne,this.z,r.transform,r.pixelPosMatrix,P,ge)))}return k}loadMatchingFeature(r,a,c,d,m,_,x,C,E){const{featureIndex:S,bucketIndex:P,sourceLayerIndex:k,layoutVertexArrayOffset:L}=a,N=this.bucketLayerIDs[P];if(d&&!function(de,he){for(let fe=0;fe<de.length;fe++)if(he.indexOf(de[fe])>=0)return!0;return!1}(d,N))return;const U=this.sourceLayerCoder.decode(k),Y=this.vtLayers[U].feature(S);if(c.needGeometry){const de=Gc(Y,!0);if(!c.filter(new q(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!c.filter(new q(this.tileID.overscaledZ),Y))return;const ne=this.getId(Y,U);for(let de=0;de<N.length;de++){const he=N[de];if(d&&d.indexOf(he)<0)continue;const fe=_[he];if(!fe)continue;let ge={};void 0!==ne&&C&&(ge=C.getState(fe.sourceLayer||"_geojsonTileLayer",ne));const ye=je({},x[he]);ye.paint=Vh(ye.paint,fe.paint,Y,ge,m),ye.layout=Vh(ye.layout,fe.layout,Y,ge,m);const Re=!E||E(Y,fe,ge,L);if(!Re)continue;const Le=new Ey(Y,this.z,this.x,this.y,ne);Le.layer=ye;let We=r[he];void 0===We&&(We=r[he]=[]),We.push({featureIndex:S,feature:Le,intersectionZ:Re})}}lookupSymbolFeatures(r,a,c,d,m,_,x,C){const E={};this.loadVTLayers();const S=Ha(m);for(const P of r)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:d,featureIndex:P,layoutVertexArrayOffset:0},S,_,x,C,a);return E}loadFeature(r){const{featureIndex:a,sourceLayerIndex:c}=r;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),m=this.vtFeatures[d];if(m[a])return m[a];const _=this.vtLayers[d].feature(a);return m[a]=_,_}hasLayer(r){for(const a of this.bucketLayerIDs)for(const c of a)if(r===c)return!0;return!1}getId(r,a){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof c&&(c=Number(c))),c}}function Vh(s,r,a,c,d){return on(s,(m,_)=>{const x=r instanceof at?r.get(_):null;return x&&x.evaluate?x.evaluate(a,c,d):x})}function Uh(s,r){return r-s}Ot(Sy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ef{constructor(r){const a={},c=[];for(const x in r){const C=r[x],E=a[x]={};for(const S in C.glyphs){const P=C.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const k=P.metrics.localGlyph?2:1,L={x:0,y:0,w:P.bitmap.width+2*k,h:P.bitmap.height+2*k};c.push(L),E[S]=L}}const{w:d,h:m}=Um(c),_=new ea({width:d||1,height:m||1});for(const x in r){const C=r[x];for(const E in C.glyphs){const S=C.glyphs[+E];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const P=a[x][E],k=S.metrics.localGlyph?2:1;ea.copy(S.bitmap,_,{x:0,y:0},{x:P.x+k,y:P.y+k},S.bitmap)}}this.image=_,this.positions=a}}Ot(Ef,"GlyphAtlas");class jh{constructor(r){this.tileID=new kr(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=cu(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,c,d,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Id;const _=new Cy(Object.keys(r.layers).sort()),x=new Sy(this.tileID,this.promoteId);x.bucketLayerIDs=[];const C={},E=new sp(256,256),S={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},P=a.familiesBySource[this.source];for(const ge in P){const ye=r.layers[ge];if(!ye)continue;let Re=!1,Le=!1;for(const Ae of P[ge])"symbol"===Ae[0].type?Re=!0:Le=!0;if(!0===this.isSymbolTile&&!Re||!1===this.isSymbolTile&&!Le)continue;1===ye.version&&vn(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const We=_.encode(ge),it=[];for(let Ae=0;Ae<ye.length;Ae++){const $e=ye.feature(Ae),ot=x.getId($e,ge);it.push({feature:$e,id:ot,index:Ae,sourceLayerIndex:We})}for(const Ae of P[ge]){const $e=Ae[0];void 0!==this.isSymbolTile&&"symbol"===$e.type!==this.isSymbolTile||$e.minzoom&&this.zoom<Math.floor($e.minzoom)||$e.maxzoom&&this.zoom>=$e.maxzoom||"none"!==$e.visibility&&(_u(Ae,this.zoom,c),(C[$e.id]=$e.createBucket({index:x.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:We,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(it,S,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ae.map(ot=>ot.id)))}}let k,L,N,U;E.trim();const Y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=on(S.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(ne).length?d.send("getGlyphs",{uid:this.uid,stacks:ne},(ge,ye)=>{k||(k=ge,L=ye,fe.call(this))},void 0,!1,Y):L={};const de=Object.keys(S.iconDependencies);de.length?d.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(ge,ye)=>{k||(k=ge,N=ye,fe.call(this))},void 0,!1,Y):N={};const he=Object.keys(S.patternDependencies);function fe(){if(k)return m(k);if(L&&N&&U){const ge=new Ef(L),ye=new Q_(N,U);for(const Re in C){const Le=C[Re];Le instanceof sc?(_u(Le.layers,this.zoom,c),lu(Le,L,ge.positions,N,ye.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Le.hasPattern&&(Le instanceof ll||Le instanceof $d||Le instanceof Zd)&&(_u(Le.layers,this.zoom,c),Le.addFeatures(S,this.tileID.canonical,ye.patternPositions,c,this.tileTransform))}this.status="done",m(null,{buckets:Je(C).filter(Re=>!Re.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:E,imageAtlas:ye,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?ge.positions:null})}}he.length?d.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(ge,ye)=>{k||(k=ge,U=ye,fe.call(this))},void 0,!1,Y):U={},fe.call(this)}}function _u(s,r,a){const c=new q(r);for(const d of s)d.recalculate(c,a)}class yu{constructor(r){this.entries={},this.scheduler=r}request(r,a,c,d){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{d(_,x)},a):d(_,x),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=c((_,x)=>{m.result=[_,x];for(const C of m.callbacks)this.scheduler?this.scheduler.add(()=>{C(_,x)},a):C(_,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==d),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function Iy(s,r,a){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},d=>{const m=_e(s.request,(_,x,C,E)=>{_?d(_):x&&d(null,{vectorTile:a?void 0:new nu.VectorTile(new tc(x)),rawData:x,cacheControl:C,expires:E})});return()=>{m.cancel(),d()}},r)}h.ARRAY_TYPE=Oo,h.AUTH_ERR_MSG=yi,h.Aabb=Yo,h.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$n()?s:H,this.scheduler=new cw}send(s,r,a,c,d=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[_]=a);const x=Yn(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:s,hasCallback:!!a,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:Rc(r,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(r.mustQueue||$n()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),c&&c.metadata||{type:"message"})}else this.processTask(a,r)}processTask(s,r){if("<response>"===r.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(Lc(r.error)):a(null,Lc(r.data)))}else{const a=Yn(this.globalScope)?void 0:[],c=r.hasCallback?(m,_)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:m?Rc(m):null,data:Rc(_,a)},a)}:m=>{},d=Lc(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=Wd,h.Color=Wr,h.ColorMode=As,h.CullFaceMode=Ps,h.DEMData=Bh,h.DataConstantProperty=ae,h.DedupedRequest=yu,h.DepthMode=mu,h.EXTENT=nn,h.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(!r||s.y<0||s.y>1)return!1;const a=r.getSource().maxzoom,c=1<<a,d=Math.floor(s.x),m=Math.floor((s.x-d)*c),_=Math.floor(s.y*c),x=this.findDEMTileFor(new kr(a,d,a,m,_));return!(!x||!x.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,a=!0){null==r&&(r=null);const c=this._source();if(!c||s.y<0||s.y>1)return r;const d=c.getSource().maxzoom,m=1<<d,_=Math.floor(s.x),x=s.x-_,C=new kr(d,_,d,Math.floor(x*m),Math.floor(s.y*m)),E=this.findDEMTileFor(C);if(!E||!E.dem)return r;const S=E.dem,P=1<<E.tileID.canonical.z,k=(x*P-E.tileID.canonical.x)*S.dim,L=(s.y*P-E.tileID.canonical.y)*S.dim,N=Math.floor(k),U=Math.floor(L);return(a?this.exaggeration():1)*In(In(S.get(N,U),S.get(N,U+1),L-U),In(S.get(N+1,U),S.get(N+1,U+1),L-U),k-N)}getAtTileOffset(s,r,a){const c=1<<s.canonical.z;return this.getAtPointOrZero(new rl(s.wrap+(s.canonical.x+r/nn)/c,(s.canonical.y+a/nn)/c))}getAtTileOffsetFunc(s,r,a,c){return d=>{const m=this.getAtTileOffset(s,d.x,d.y),_=c.upVector(s.canonical,d.x,d.y);return Ca(_,_,m*c.upVectorScale(s.canonical,r,a).metersToTile),_}}getForTilePoints(s,r,a,c){const d=Cf.create(this,s,c);return!!d&&(r.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(s){const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const a=r.dem.tree,c=r.tileID,d=1<<s.canonical.z-c.canonical.z;let m=s.canonical.x/d-c.canonical.x,_=s.canonical.y/d-c.canonical.y,x=0;for(let C=0;C<s.canonical.z-c.canonical.z&&!a.leaves[x];C++){m*=2,_*=2;const E=2*Math.floor(_)+Math.floor(m);x=a.childOffsets[x]+E,m%=1,_%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=cr,h.EvaluationParameters=q,h.Event=Kn,h.Evented=sr,h.FillExtrusionBucket=Zd,h.Frustum=Jc,h.FrustumCorners=xm,h.GLOBE_METERS_TO_ECEF=qi,h.GLOBE_RADIUS=ic,h.GLOBE_SCALE_MATCH_LATITUDE=45,h.GLOBE_ZOOM_THRESHOLD_MAX=6,h.GLOBE_ZOOM_THRESHOLD_MIN=5,h.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const r=new mn,a=new zr,c=65;for(let d=0;d<c;d++)for(let m=0;m<c;m++)r.emplaceBack(m,d);this._gridSegments=[];for(let d=0,m=0;d<Rh.length;d++){const _=Rh[d];for(let C=0;C<_;C++)for(let E=0;E<64;E++){const S=C*c+E;a.emplaceBack(S+1,S,S+c),a.emplaceBack(S+c,S+c+1,S+1)}const x=64*_*2;this._gridSegments.push(ii.simpleSegment(0,m,(_+1)*c,x)),m+=x}this._gridBuffer=s.createVertexBuffer(r,Oh.members),this._gridIndexBuffer=s.createIndexBuffer(a,!0)}_createPoles(s){const r=new zr;for(let d=0;d<=64;d++)r.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const a=new el,c=new el;this._poleSegments=[];for(let d=0,m=0;d<5;d++){const _=1<<d,x=512*_/Math.PI/2,C=360/_;a.emplaceBack(0,-x,0,0,0,.5,0),c.emplaceBack(0,-x,0,0,0,.5,1);for(let E=0;E<=64;E++){const S=E/64,P=In(0,C,S),[k,L,N]=my(e0,t0,P,x);a.emplaceBack(k,L,N,0,0,S,0),c.emplaceBack(k,L,N,0,0,S,1)}this._poleSegments.push(ii.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,hy,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,hy,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const a=new ko,c=64,d=c+1;this._wireframeSegments=[];for(let m=0,_=0;m<Rh.length;m++){const x=Rh[m];for(let E=0;E<x;E++)for(let S=0;S<c;S++){const P=E*d+S;a.emplaceBack(P,P+1),a.emplaceBack(P,P+d),a.emplaceBack(P,P+d+1)}const C=x*c*3;this._wireframeSegments.push(ii.simpleSegment(0,_,(x+1)*d,C)),_+=C}this._wireframeIndexBuffer=s.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},h.GlyphManager=nc,h.ImagePosition=nf,h.LineAtlas=sp,h.LngLat=or,h.LngLatBounds=Yl,h.LocalGlyphMode=sf,h.MAX_MERCATOR_LATITUDE=Xo,h.MercatorCoordinate=rl,h.ONE_EM=24,h.OverscaledTileID=kr,h.Properties=Rt,h.RGBAImage=_o,h.Ray=E_,h.RequestManager=class{constructor(s,r,a){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bu,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!ys(s))return s;const a=jo(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!ys(s))return s;const a=jo(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(s,r,a,c){if(!ys(s))return s;const d=jo(s);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),a&&d.params.push(`language=${a}`),c&&d.params.push(`worldview=${c}`),this._makeAPIURL(d,this._customAccessToken||r)}normalizeSpriteURL(s,r,a,c){const d=jo(s);return ys(s)?(d.path=`/styles/v1${d.path}/sprite${r}${a}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${r}${a}`,zs(d))}normalizeTileURL(s,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!ys(s))return s;const c=jo(s);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==c.authority&&512===a?"@2x":""}${Fs.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${qn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${qn.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||qn.ACCESS_TOKEN;return qn.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(s,r){const a=jo(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${qn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${qn.TILE_URL_VERSION}/`,"")}`;let d=a.params;return r&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(s,r){const a=!!r&&ys(r),c=[];for(const d of s.tiles||[])Ml(d)?c.push(this.canonicalizeTileURL(d,a)):c.push(d);return c}_makeAPIURL(s,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=jo(qn.API_URL);if(s.protocol=c.protocol,s.authority=c.authority,"http"===s.protocol){const d=s.params.indexOf("secure");d>=0&&s.params.splice(d,1)}if("/"!==c.path&&(s.path=`${c.path}${s.path}`),!qn.REQUIRE_ACCESS_TOKEN)return zs(s);if(r=r||qn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(d=>-1===d.indexOf("access_token")),s.params.push(`access_token=${r||""}`),zs(s)}},h.ResourceType=se,h.SegmentVector=ii,h.SourceCache=gu,h.StencilMode=bf,h.StructArrayLayout1ui2=cs,h.StructArrayLayout2f1f2i16=$r,h.StructArrayLayout2i4=mn,h.StructArrayLayout2ui4=ko,h.StructArrayLayout3f12=wr,h.StructArrayLayout3ui6=zr,h.StructArrayLayout4i8=ln,h.StructArrayLayout5f20=ls,h.Texture=hu,h.Tile=Ty,h.Transitionable=oe,h.Uniform1f=gh,h.Uniform1i=class extends Br{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},h.Uniform2f=class extends Br{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},h.Uniform3f=class extends Br{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},h.Uniform4f=_h,h.UniformColor=Qv,h.UniformMatrix2f=class extends Br{constructor(s,r){super(s,r),this.current=tl}set(s){for(let r=0;r<4;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},h.UniformMatrix3f=class extends Br{constructor(s,r){super(s,r),this.current=us}set(s){for(let r=0;r<9;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},h.UniformMatrix4f=class extends Br{constructor(s,r){super(s,r),this.current=ex}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},h.UnwrappedTileID=Fx,h.ValidationError=kt,h.VectorTileWorkerSource=class extends sr{constructor(s,r,a,c,d){super(),this.actor=s,this.layerIndex=r,this.availableImages=a,this.loadVectorData=d||Iy,this.loading={},this.loaded={},this.deduped=new yu(s.scheduler),this.isSpriteLoaded=c,this.scheduler=s.scheduler}loadTile(s,r){const a=s.uid,c=s&&s.request,d=c&&c.collectResourceTiming,m=this.loading[a]=new jh(s);m.abort=this.loadVectorData(s,(_,x)=>{const C=!this.loading[a];if(delete this.loading[a],C||_||!x)return m.status="done",C||(this.loaded[a]=m),r(_);const E=x.rawData,S={};x.expires&&(S.expires=x.expires),x.cacheControl&&(S.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new nu.VectorTile(new tc(E));const P=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,L)=>{if(k||!L)return r(k);const N={};if(d){const U=Ri(c);U.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(U)))}r(null,je({rawTileData:E.slice(0)},L,S,N))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[a]=m})}reloadTile(s,r){const a=this.loaded,c=s.uid,d=this;if(a&&a[c]){const m=a[c];m.showCollisionBoxes=s.showCollisionBoxes,m.enableTerrain=!!s.enableTerrain,m.projection=s.projection,m.tileTransform=cu(s.tileID.canonical,s.projection);const _=(x,C)=>{const E=m.reloadCallback;E&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,E)),r(x,C)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(s,r){const a=s.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),r()}removeTile(s,r){const a=this.loaded,c=s.uid;a&&a[c]&&delete a[c],r()}},h.WritingMode=ds,h.ZoomHistory=lt,h.add=sl,h.addDynamicAttributes=ip,h.adjoint=function(s,r){var a=r[0],c=r[1],d=r[2],m=r[3],_=r[4],x=r[5],C=r[6],E=r[7],S=r[8];return s[0]=_*S-x*E,s[1]=d*E-c*S,s[2]=c*x-d*_,s[3]=x*C-m*S,s[4]=a*S-d*C,s[5]=d*m-a*x,s[6]=m*E-_*C,s[7]=c*C-a*E,s[8]=a*_-c*m,s},h.asyncAll=He,h.bezier=le,h.bindAll=Yt,h.boundsAttributes=My,h.bufferConvexPolygon=function(s,r){const a=[];for(let c=0;c<s.length;c++){const d=ve(c-1,-1,s.length-1),m=ve(c+1,-1,s.length-1),_=s[c],x=s[m],C=s[d].sub(_).unit(),E=x.sub(_).unit(),S=E.angleWithSep(C.x,C.y),P=C.add(E).unit().mult(-1*r/Math.sin(S/2));a.push(_.add(P))}return a},h.cacheEntryPossiblyAdded=function(s){Q++,Q>vc&&(s.getActor().send("enforceCacheSizeLimit",Dl),Q=0)},h.calculateGlobeLabelMatrix=function(s,r){const{x:a,y:c}=s.point,d=tg(a,c,s.worldSize/s._projectionScaler,0,0);return Xc(d,d,_y(Ta(r)))},h.calculateGlobeMatrix=function(s){const{x:r,y:a}=s.point,{lng:c,lat:d}=s._center;return tg(r,a,s.worldSize,c,d)},h.calculateGlobeMercatorMatrix=function(s){const r=s.worldSize,a=s.point,c=Ms(1,s.center.lat)*r,d=s.pixelsPerMeter,m=r/(c/s.pixelsPerMeter),_=Ro(new Float64Array(16));return Kl(_,_,[a.x,a.y,0]),ol(_,_,[m,m,d]),Float32Array.from(_)},h.circumferenceAtLatitude=$c,h.clamp=Ve,h.clearTileCache=function(s){const r=[];for(const a in eo)r.push(H.caches.delete(a)),delete eo[a];s&&Promise.all(r).catch(s).then(()=>s())},h.clipLine=qm,h.clone=function(s){var r=new Oo(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},h.clone$1=qt,h.collisionCircleLayout=j_,h.config=qn,h.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},h.create=function(){var s=new Oo(16);return Oo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},h.create$1=y_,h.createExpression=Vl,h.createLayout=It,h.createStyleLayer=function(s){return"custom"===s.type?new wy(s):new vf[s.type](s)},h.cross=Lo,h.degToRad=Xe,h.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},h.div=function(s,r,a){return s[0]=r[0]/a[0],s[1]=r[1]/a[1],s[2]=r[2]/a[2],s},h.dot=Ds,h.ease=ze,h.easeCubicInOut=dt,h.emitValidationErrors=Mn,h.endsWith=St,h.enforceCacheSizeLimit=function(s){for(const r in eo)ee(r),eo[r].then(a=>{a.keys().then(c=>{for(let d=0;d<c.length-s;d++)a.delete(c[d])})})},h.evaluateSizeForFeature=Kp,h.evaluateSizeForZoom=Ah,h.evaluateVariableOffset=cf,h.evented=G,h.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},h.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},h.exported=ns,h.exported$1=Fs,h.extend=je,h.extend$1=po,h.fillExtrusionHeightLift=Ma,h.filterObject=an,h.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},h.fromQuat=function(s,r){var a=r[0],c=r[1],d=r[2],m=r[3],_=a+a,x=c+c,C=d+d,E=a*_,S=c*_,P=c*x,k=d*_,L=d*x,N=d*C,U=m*_,Y=m*x,ne=m*C;return s[0]=1-P-N,s[1]=S+ne,s[2]=k-Y,s[3]=0,s[4]=S-ne,s[5]=1-E-N,s[6]=L+U,s[7]=0,s[8]=k+Y,s[9]=L-U,s[10]=1-E-P,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.fromRotation=function(s,r){var a=Math.sin(r),c=Math.cos(r);return s[0]=c,s[1]=a,s[2]=0,s[3]=-a,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},h.fromScaling=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return ft[r]},h.getAABBPointSquareDist=function(s,r,a){let c=0;for(let d=0;d<2;++d){const m=a?a[d]:0;s[d]>m&&(c+=(s[d]-m)*(s[d]-m)),r[d]<m&&(c+=(m-r[d])*(m-r[d]))}return c},h.getAnchorAlignment=On,h.getAnchorJustification=uf,h.getBounds=function(s){let r=1/0,a=1/0,c=-1/0,d=-1/0;for(const m of s)r=Math.min(r,m.x),a=Math.min(a,m.y),c=Math.max(c,m.x),d=Math.max(d,m.y);return{min:new ce(r,a),max:new ce(c,d)}},h.getColumn=Tr,h.getGridMatrix=function(s,r,a){const[c,d]=r,m=.015625;return[0,(d[1]-c[1])*m,1<<s.z,(d[0]-c[0])/Rh[a],0,s.y,c[0],c[1],m]},h.getImage=Kt,h.getJSON=function(s,r){return we(je(s,{type:"json"}),r)},h.getLatitudinalLod=function(s){const r=80.051129;s=Ve(s,-80.051129,r)/r*90;const a=Math.pow(Math.abs(Math.sin(Xe(s))),3);return Math.round(a*(Rh.length-1))},h.getMapSessionAPI=Gu,h.getPerformanceMeasurement=Ri,h.getProjection=sg,h.getRTLTextPluginStatus=ie,h.getReferrer=Ee,h.getTilePoint=function(s,{x:r,y:a},c=0){return new ce(((r-c)*s.scale-s.x)*nn,(a*s.scale-s.y)*nn)},h.getTileVec3=function(s,r,a=0){return Ql(((r.x-a)*s.scale-s.x)*nn,(r.y*s.scale-s.y)*nn,pm(r.z,r.y))},h.getVideo=function(s,r){const a=H.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let c=0;c<s.length;c++){const d=H.document.createElement("source");ht(s[c])||(a.crossOrigin="Anonymous"),d.src=s[c],a.appendChild(d)}return{cancel:()=>{}}},h.globeCenterToScreenPoint=function(s){const r=[0,0,0],a=Ro(new Float64Array(16));return Xc(a,s.pixelMatrix,s.globeMatrix),Nr(r,r,a),new ce(r[0],r[1])},h.globeECEFOrigin=function(s,r){const a=[0,0,0];return Nr(a,a,oc(Ta(r.canonical))),Nr(a,a,s),a},h.globeNormalizeECEF=oc,h.globePixelsToTileUnits=function(s,r){return nn/(512*Math.pow(2,s))*tp(Ta(r))},h.globePoleMatrixForTile=function(s,r,a){const c=Ro(new Float64Array(16)),d=1<<s,m=360*(r/d-.5),_=a.point,x=a.worldSize/(a.tileSize*d);return Kl(c,c,[_.x,_.y,-a.worldSize/Math.PI/2]),ol(c,c,[x,x,x]),Yc(c,c,Xe(-a._center.lat)),Ch(c,c,Xe(-a._center.lng+m)),Float32Array.from(c)},h.globeTileBounds=Ta,h.globeTileLatLngCorners=fy,h.globeTiltAtLngLat=yy,h.globeToMercatorTransition=ng,h.globeUseCustomAntiAliasing=function(s,r,a){const c=ng(a.zoom),d=s.style.map._antialias,m=!!r.extStandardDerivatives,_=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===c&&!d&&!_&&m},h.identity=Ro,h.identity$1=b_,h.invert=function(s,r){var a=r[0],c=r[1],d=r[2],m=r[3],_=r[4],x=r[5],C=r[6],E=r[7],S=r[8],P=r[9],k=r[10],L=r[11],N=r[12],U=r[13],Y=r[14],ne=r[15],de=a*x-c*_,he=a*C-d*_,fe=a*E-m*_,ge=c*C-d*x,ye=c*E-m*x,Re=d*E-m*C,Le=S*U-P*N,We=S*Y-k*N,it=S*ne-L*N,Ae=P*Y-k*U,$e=P*ne-L*U,ot=k*ne-L*Y,st=de*ot-he*$e+fe*Ae+ge*it-ye*We+Re*Le;return st?(s[0]=(x*ot-C*$e+E*Ae)*(st=1/st),s[1]=(d*$e-c*ot-m*Ae)*st,s[2]=(U*Re-Y*ye+ne*ge)*st,s[3]=(k*ye-P*Re-L*ge)*st,s[4]=(C*it-_*ot-E*We)*st,s[5]=(a*ot-d*it+m*We)*st,s[6]=(Y*fe-N*Re-ne*he)*st,s[7]=(S*Re-k*fe+L*he)*st,s[8]=(_*$e-x*it+E*Le)*st,s[9]=(c*it-a*$e-m*Le)*st,s[10]=(N*ye-U*fe+ne*de)*st,s[11]=(P*fe-S*ye-L*de)*st,s[12]=(x*We-_*Ae-C*Le)*st,s[13]=(a*Ae-c*We+d*Le)*st,s[14]=(U*he-N*ge-Y*de)*st,s[15]=(S*ge-P*he+k*de)*st,s):null},h.isLngLatBehindGlobe=function(s,r){return yy(s,r)>Math.PI/2*1.01},h.isMapAuthenticated=function(s){return Bs.has(s)},h.isMapboxURL=ys,h.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Yn(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.latFromMercatorY=fi,h.len=fx,h.length=Jl,h.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},h.loadVectorTile=Iy,h.makeRequest=we,h.mapValue=function(s,r,a,c,d){return Ve((s-r)/(a-r)*(d-c)+c,c,d)},h.mercatorXfromLng=nl,h.mercatorYfromLat=ba,h.mercatorZfromAltitude=Ms,h.mul=hx,h.mul$1=px,h.multiply=Xc,h.multiply$1=function(s,r,a){var c=r[0],d=r[1],m=r[2],_=r[3],x=r[4],C=r[5],E=r[6],S=r[7],P=r[8],k=a[0],L=a[1],N=a[2],U=a[3],Y=a[4],ne=a[5],de=a[6],he=a[7],fe=a[8];return s[0]=k*c+L*_+N*E,s[1]=k*d+L*x+N*S,s[2]=k*m+L*C+N*P,s[3]=U*c+Y*_+ne*E,s[4]=U*d+Y*x+ne*S,s[5]=U*m+Y*C+ne*P,s[6]=de*c+he*_+fe*E,s[7]=de*d+he*x+fe*S,s[8]=de*m+he*C+fe*P,s},h.multiply$2=ym,h.nextPowerOfTwo=wt,h.normalize=go,h.normalize$1=function(s,r){var a=r[0],c=r[1],d=r[2],m=r[3],_=a*a+c*c+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),s[0]=a*_,s[1]=c*_,s[2]=d*_,s[3]=m*_,s},h.number=In,h.ortho=function(s,r,a,c,d,m,_){var x=1/(r-a),C=1/(c-d),E=1/(m-_);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(r+a)*x,s[13]=(d+c)*C,s[14]=(_+m)*E,s[15]=1,s},h.pbf=tc,h.perspective=function(s,r,a,c,d){var m,_=1/Math.tan(r/2);return s[0]=_/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=d&&d!==1/0?(s[10]=(d+c)*(m=1/(c-d)),s[14]=2*d*c*m):(s[10]=-1,s[14]=-2*c),s},h.pick=function(s,r){const a={};for(let c=0;c<r.length;c++){const d=r[c];d in s&&(a[d]=s[d])}return a},h.plugin=J,h.pointGeometry=ce,h.polygonContainsPoint=Js,h.polygonIntersectsBox=g_,h.polygonIntersectsPolygon=bh,h.polygonizeBounds=function(s,r,a=0,c=!0){const d=new ce(a,a),m=s.sub(d),_=r.add(d),x=[m,new ce(_.x,m.y),_,new ce(m.x,_.y)];return c&&x.push(m.clone()),x},h.posAttributes=Oh,h.postMapLoadEvent=Tl,h.postTurnstileEvent=ju,h.potpack=Um,h.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},h.radToDeg=yt,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(s){return s({pluginStatus:B,pluginURL:$}),G.on("pluginStateChange",s),s},h.removeAuthState=function(s){Bs.delete(s)},h.renderColorRamp=D_,h.resample=Gt,h.rotateX=Yc,h.rotateX$1=w_,h.rotateY=Ch,h.rotateY$1=C_,h.rotateZ=function(s,r,a){var c=Math.sin(a),d=Math.cos(a),m=r[0],_=r[1],x=r[2],C=r[3],E=r[4],S=r[5],P=r[6],k=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*d+E*c,s[1]=_*d+S*c,s[2]=x*d+P*c,s[3]=C*d+k*c,s[4]=E*d-m*c,s[5]=S*d-_*c,s[6]=P*d-x*c,s[7]=k*d-C*c,s},h.rotateZ$1=function(s,r,a){a*=.5;var c=r[0],d=r[1],m=r[2],_=r[3],x=Math.sin(a),C=Math.cos(a);return s[0]=c*C+d*x,s[1]=d*C-c*x,s[2]=m*C+_*x,s[3]=_*C-m*x,s},h.scale=ol,h.scale$1=v_,h.scale$2=Ca,h.scaleAndAdd=qp,h.setCacheLimits=function(s,r){Dl=s,vc=r},h.setColumn=function(s,r,a){s[4*r+0]=a[0],s[4*r+1]=a[1],s[4*r+2]=a[2],s[4*r+3]=a[3]},h.setRTLTextPlugin=function(s,r,a=!1){if(B===D||B===I||B===O)throw new Error("setRTLTextPlugin cannot be called multiple times.");$=ns.resolveURL(s),B=D,R=r,X(),a||W()},h.smoothstep=Oe,h.spec=be,h.storeAuthState=function(s,r){r?Bs.add(s):Bs.delete(s)},h.sub=Ss,h.subtract=Gp,h.symbolSize=$_,h.tileAABB=function(s,r,a,c,d,m,_,x,C){if("globe"===C.name)return function py(s,r,a){const c=r/s.worldSize,d=Number.MAX_VALUE,m=[-d,-d,-d],_=[d,d,d],x=Ro(new Float64Array(16));if(ol(x,x,[c,c,c]),Xc(x,x,s.globeMatrix),a.z<=1){const Ae=Ta(a).getCorners();for(let $e=0;$e<Ae.length;$e++)Nr(Ae[$e],Ae[$e],x),wa(_,_,Ae[$e]),Hp(m,m,Ae[$e]);return new Yo(_,m)}const[C,E]=fy(a),S=new Yl;S.setSouthWest([C[1],E[0]]),S.setNorthEast([E[1],C[0]]);const P=[Mi(S.getSouth(),S.getWest()),Mi(S.getSouth(),S.getEast()),Mi(S.getNorth(),S.getEast()),Mi(S.getNorth(),S.getWest())];for(let Ae=0;Ae<P.length;Ae++)Nr(P[Ae],P[Ae],x),wa(_,_,P[Ae]),Hp(m,m,P[Ae]);if(S.contains(s.center)){m[2]=0;const Ae=s.point,$e=[Ae.x*c,Ae.y*c,0];return wa(_,_,$e),Hp(m,m,$e),new Yo(_,m)}const k=[x[12],x[13],x[14]],L=s.center.lng,N=Ve(s.center.lat,-85.051129,Xo),U=[nl(L),ba(N)],Y=S.getCenter().lng,ne=Ve(S.getCenter().lat,-85.051129,Xo),de=[nl(Y),ba(ne)];let he=new Array(3),fe=0,ge=U[0]-de[0];const ye=U[1]-de[1];if(ge>.5?ge-=1:ge<-.5&&(ge+=1),Math.abs(ge)>Math.abs(ye))fe=ge>=0?1:3,he=k;else{fe=ye>=0?0:2;const Ae=[x[4],x[5],x[6]];let $e;$e=ye>=0?-Math.sin(Xe(S.getSouth()))*ic:-Math.sin(Xe(S.getNorth()))*ic,he=qp(he,k,Ae,$e)}const Re=P[fe],Le=P[(fe+1)%4],We=new nw(Re,Le,he),it=[dy(We,0)||Re[0],dy(We,1)||Re[1],dy(We,2)||Re[2]];return _[2]=Math.min(Re[2],Le[2]),wa(_,_,it),Hp(m,m,it),new Yo(_,m)}(s,r,new Wd(a,c,d));const E=cu({z:a,x:c,y:d},C);return new Yo([(m+E.x/E.scale)*r,r*(E.y/E.scale),_],[(m+E.x2/E.scale)*r,r*(E.y2/E.scale),x])},h.tileTransform=cu,h.transformMat3=function(s,r,a){var c=r[0],d=r[1],m=r[2];return s[0]=c*a[0]+d*a[3]+m*a[6],s[1]=c*a[1]+d*a[4]+m*a[7],s[2]=c*a[2]+d*a[5]+m*a[8],s},h.transformMat4=Nr,h.transformMat4$1=ec,h.transformQuat=vm,h.translate=Kl,h.transpose=function(s,r){if(s===r){var a=r[1],c=r[2],d=r[5];s[1]=r[3],s[2]=r[6],s[3]=a,s[5]=r[7],s[6]=c,s[7]=d}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},h.triggerPluginCompletionEvent=Z,h.uniqueId=Xt,h.updateGlobeVertexNormal=function(s,r,a,c,d){const m=5*r+2;s.float32[m+0]=a,s.float32[m+1]=c,s.float32[m+2]=d},h.validateCustomStyleLayer=function(s){const r=[],a=s.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},h.validateFilter=s=>Ao(Ip(s)),h.validateFog=s=>Ao(Ya(s)),h.validateLayer=s=>Ao(Pp(s)),h.validateLight=s=>Ao(bd(s)),h.validateSource=s=>Ao(Io(s)),h.validateStyle=kp,h.validateTerrain=s=>Ao(Oc(s)),h.values=Je,h.vectorTile=nu,h.version="2.9.1",h.warnOnce=vn,h.window=H,h.wrap=ve}),Ne(0,function(h){function H(ee){if("number"==typeof ee||"boolean"==typeof ee||"string"==typeof ee||null==ee)return JSON.stringify(ee);if(Array.isArray(ee)){let j="[";for(const Q of ee)j+=`${H(Q)},`;return`${j}]`}let z="{";for(const j of Object.keys(ee).sort())z+=`${j}:${H(ee[j])},`;return`${z}}`}function Me(ee){let z="";for(const j of h.refProperties)z+=`/${H(ee[j])}`;return z}class Ce{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,j){for(const se of z)this._layerConfigs[se.id]=se,(this._layers[se.id]=h.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of j)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const Q=function(se,me){const Ee={};for(let _e=0;_e<se.length;_e++){const De=me&&me[se[_e].id]||Me(se[_e]);me&&(me[se[_e].id]=De);let Ke=Ee[De];Ke||(Ke=Ee[De]=[]),Ke.push(se[_e])}const we=[];for(const _e in Ee)we.push(Ee[_e]);return we}(h.values(this._layerConfigs),this.keyCache);for(const se of Q){const me=se.map(ht=>this._layers[ht.id]),Ee=me[0];if("none"===Ee.visibility)continue;const we=Ee.source||"";let _e=this.familiesBySource[we];_e||(_e=this.familiesBySource[we]={});const De=Ee.sourceLayer||"_geojsonTileLayer";let Ke=_e[De];Ke||(Ke=_e[De]=[]),Ke.push(me)}}}class ce{loadTile(z,j){const{uid:Q,encoding:se,rawImageData:me,padding:Ee,buildQuadTree:we}=z,_e=h.window.ImageBitmap&&me instanceof h.window.ImageBitmap?this.getImageData(me,Ee):me;j(null,new h.DEMData(Q,_e,se,Ee<1,we))}getImageData(z,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const Q=this.offscreenCanvasContext.getImageData(-j,-j,z.width+2*j,z.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}var Te=function ee(z,j){var Q,se=z&&z.type;if("FeatureCollection"===se)for(Q=0;Q<z.features.length;Q++)ee(z.features[Q],j);else if("GeometryCollection"===se)for(Q=0;Q<z.geometries.length;Q++)ee(z.geometries[Q],j);else if("Feature"===se)ee(z.geometry,j);else if("Polygon"===se)rt(z.coordinates,j);else if("MultiPolygon"===se)for(Q=0;Q<z.coordinates.length;Q++)rt(z.coordinates[Q],j);return z};function rt(ee,z){if(0!==ee.length){Ft(ee[0],z);for(var j=1;j<ee.length;j++)Ft(ee[j],!z)}}function Ft(ee,z){for(var j=0,Q=0,se=0,me=ee.length,Ee=me-1;se<me;Ee=se++){var we=(ee[se][0]-ee[Ee][0])*(ee[Ee][1]+ee[se][1]),_e=j+we;Q+=Math.abs(j)>=Math.abs(we)?j-_e+we:we-_e+j,j=_e}j+Q>=0!=!!z&&ee.reverse()}const Xe=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class yt{constructor(z){this._feature=z,this.extent=h.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const j of this._feature.geometry)z.push([new h.pointGeometry(j[0],j[1])]);return z}{const z=[];for(const j of this._feature.geometry){const Q=[];for(const se of j)Q.push(new h.pointGeometry(se[0],se[1]));z.push(Q)}return z}}toGeoJSON(z,j,Q){return Xe.call(this,z,j,Q)}}class ft{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=z.length,this._features=z}feature(z){return new yt(this._features[z])}}var dt=h.vectorTile.VectorTileFeature,le=ze;function ze(ee,z){this.options=z||{},this.features=ee,this.length=ee.length}function Ve(ee,z){this.id="number"==typeof ee.id?ee.id:void 0,this.type=ee.type,this.rawGeometry=1===ee.type?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=z||4096}ze.prototype.feature=function(ee){return new Ve(this.features[ee],this.options.extent)},Ve.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var z=0;z<ee.length;z++){for(var j=ee[z],Q=[],se=0;se<j.length;se++)Q.push(new h.pointGeometry(j[se][0],j[se][1]));this.geometry.push(Q)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,z=1/0,j=-1/0,Q=1/0,se=-1/0,me=0;me<ee.length;me++)for(var Ee=ee[me],we=0;we<Ee.length;we++){var _e=Ee[we];z=Math.min(z,_e.x),j=Math.max(j,_e.x),Q=Math.min(Q,_e.y),se=Math.max(se,_e.y)}return[z,Q,j,se]},Ve.prototype.toGeoJSON=dt.prototype.toGeoJSON;var Oe=He,ve=le;function He(ee){var z=new h.pbf;return function(j,Q){for(var se in j.layers)Q.writeMessage(3,Je,j.layers[se])}(ee,z),z.finish()}function Je(ee,z){var j;z.writeVarintField(15,ee.version||1),z.writeStringField(1,ee.name||""),z.writeVarintField(5,ee.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ee.length;j++)Q.feature=ee.feature(j),z.writeMessage(2,je,Q);var se=Q.keys;for(j=0;j<se.length;j++)z.writeStringField(3,se[j]);var me=Q.values;for(j=0;j<me.length;j++)z.writeMessage(4,Mt,me[j])}function je(ee,z){var j=ee.feature;void 0!==j.id&&z.writeVarintField(1,j.id),z.writeMessage(2,Pt,ee),z.writeVarintField(3,j.type),z.writeMessage(4,wt,j)}function Pt(ee,z){var j=ee.feature,Q=ee.keys,se=ee.values,me=ee.keycache,Ee=ee.valuecache;for(var we in j.properties){var _e=j.properties[we],De=me[we];if(null!==_e){void 0===De&&(Q.push(we),me[we]=De=Q.length-1),z.writeVarint(De);var Ke=typeof _e;"string"!==Ke&&"boolean"!==Ke&&"number"!==Ke&&(_e=JSON.stringify(_e));var ht=Ke+":"+_e,Qe=Ee[ht];void 0===Qe&&(se.push(_e),Ee[ht]=Qe=se.length-1),z.writeVarint(Qe)}}}function Xt(ee,z){return(z<<3)+(7&ee)}function jt(ee){return ee<<1^ee>>31}function wt(ee,z){for(var j=ee.loadGeometry(),Q=ee.type,se=0,me=0,Ee=j.length,we=0;we<Ee;we++){var _e=j[we],De=1;1===Q&&(De=_e.length),z.writeVarint(Xt(1,De));for(var Ke=3===Q?_e.length-1:_e.length,ht=0;ht<Ke;ht++){1===ht&&1!==Q&&z.writeVarint(Xt(2,Ke-1));var Qe=_e[ht].x-se,Ut=_e[ht].y-me;z.writeVarint(jt(Qe)),z.writeVarint(jt(Ut)),se+=Qe,me+=Ut}3===Q&&z.writeVarint(Xt(7,1))}}function Mt(ee,z){var j=typeof ee;"string"===j?z.writeStringField(1,ee):"boolean"===j?z.writeBooleanField(7,ee):"number"===j&&(ee%1!=0?z.writeDoubleField(3,ee):ee<0?z.writeSVarintField(6,ee):z.writeVarintField(5,ee))}function Yt(ee,z,j,Q,se,me){if(se-Q<=j)return;const Ee=Q+se>>1;St(ee,z,Ee,Q,se,me%2),Yt(ee,z,j,Q,Ee-1,me+1),Yt(ee,z,j,Ee+1,se,me+1)}function St(ee,z,j,Q,se,me){for(;se>Q;){if(se-Q>600){const De=se-Q+1,Ke=j-Q+1,ht=Math.log(De),Qe=.5*Math.exp(2*ht/3),Ut=.5*Math.sqrt(ht*Qe*(De-Qe)/De)*(Ke-De/2<0?-1:1);St(ee,z,j,Math.max(Q,Math.floor(j-Ke*Qe/De+Ut)),Math.min(se,Math.floor(j+(De-Ke)*Qe/De+Ut)),me)}const Ee=z[2*j+me];let we=Q,_e=se;for(on(ee,z,Q,j),z[2*se+me]>Ee&&on(ee,z,Q,se);we<_e;){for(on(ee,z,we,_e),we++,_e--;z[2*we+me]<Ee;)we++;for(;z[2*_e+me]>Ee;)_e--}z[2*Q+me]===Ee?on(ee,z,Q,_e):(_e++,on(ee,z,_e,se)),_e<=j&&(Q=_e+1),j<=_e&&(se=_e-1)}}function on(ee,z,j,Q){an(ee,j,Q),an(z,2*j,2*Q),an(z,2*j+1,2*Q+1)}function an(ee,z,j){const Q=ee[z];ee[z]=ee[j],ee[j]=Q}function qt(ee,z,j,Q){const se=ee-j,me=z-Q;return se*se+me*me}Oe.fromVectorTileJs=He,Oe.fromGeojsonVt=function(ee,z){z=z||{};var j={};for(var Q in ee)j[Q]=new le(ee[Q].features,z),j[Q].name=Q,j[Q].version=z.version,j[Q].extent=z.extent;return He({layers:j})},Oe.GeoJSONWrapper=ve;const xr=ee=>ee[0],vn=ee=>ee[1];class Xn{constructor(z,j=xr,Q=vn,se=64,me=Float64Array){this.nodeSize=se,this.points=z;const Ee=z.length<65536?Uint16Array:Uint32Array,we=this.ids=new Ee(z.length),_e=this.coords=new me(2*z.length);for(let De=0;De<z.length;De++)we[De]=De,_e[2*De]=j(z[De]),_e[2*De+1]=Q(z[De]);Yt(we,_e,se,0,we.length-1,0)}range(z,j,Q,se){return function(me,Ee,we,_e,De,Ke,ht){const Qe=[0,me.length-1,0],Ut=[];let tn,Kt;for(;Qe.length;){const rn=Qe.pop(),bn=Qe.pop(),Kn=Qe.pop();if(bn-Kn<=ht){for(let be=Kn;be<=bn;be++)tn=Ee[2*be],Kt=Ee[2*be+1],tn>=we&&tn<=De&&Kt>=_e&&Kt<=Ke&&Ut.push(me[be]);continue}const cr=Math.floor((Kn+bn)/2);tn=Ee[2*cr],Kt=Ee[2*cr+1],tn>=we&&tn<=De&&Kt>=_e&&Kt<=Ke&&Ut.push(me[cr]);const sr=(rn+1)%2;(0===rn?we<=tn:_e<=Kt)&&(Qe.push(Kn),Qe.push(cr-1),Qe.push(sr)),(0===rn?De>=tn:Ke>=Kt)&&(Qe.push(cr+1),Qe.push(bn),Qe.push(sr))}return Ut}(this.ids,this.coords,z,j,Q,se,this.nodeSize)}within(z,j,Q){return function(se,me,Ee,we,_e,De){const Ke=[0,se.length-1,0],ht=[],Qe=_e*_e;for(;Ke.length;){const Ut=Ke.pop(),tn=Ke.pop(),Kt=Ke.pop();if(tn-Kt<=De){for(let sr=Kt;sr<=tn;sr++)qt(me[2*sr],me[2*sr+1],Ee,we)<=Qe&&ht.push(se[sr]);continue}const rn=Math.floor((Kt+tn)/2),bn=me[2*rn],Kn=me[2*rn+1];qt(bn,Kn,Ee,we)<=Qe&&ht.push(se[rn]);const cr=(Ut+1)%2;(0===Ut?Ee-_e<=bn:we-_e<=Kn)&&(Ke.push(Kt),Ke.push(rn-1),Ke.push(cr)),(0===Ut?Ee+_e>=bn:we+_e>=Kn)&&(Ke.push(rn+1),Ke.push(tn),Ke.push(cr))}return ht}(this.ids,this.coords,z,j,Q,this.nodeSize)}}const Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},$n=Math.fround||(Di=new Float32Array(1),ee=>(Di[0]=+ee,Di[0]));var Di;class Si{constructor(z){this.options=ca(Object.create(Zr),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:j,minZoom:Q,maxZoom:se,nodeSize:me}=this.options;j&&console.time("total time");const Ee=`prepare ${z.length} points`;j&&console.time(Ee),this.points=z;let we=[];for(let _e=0;_e<z.length;_e++)z[_e].geometry&&we.push(en(z[_e],_e));this.trees[se+1]=new Xn(we,Cl,Ls,me,Float32Array),j&&console.timeEnd(Ee);for(let _e=se;_e>=Q;_e--){const De=+Date.now();we=this._cluster(we,_e),this.trees[_e]=new Xn(we,Cl,Ls,me,Float32Array),j&&console.log("z%d: %d clusters in %dms",_e,we.length,+Date.now()-De)}return j&&console.timeEnd("total time"),this}getClusters(z,j){let Q=((z[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,z[1]));let me=180===z[2]?180:((z[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)Q=-180,me=180;else if(Q>me){const Ke=this.getClusters([Q,se,180,Ee],j),ht=this.getClusters([-180,se,me,Ee],j);return Ke.concat(ht)}const we=this.trees[this._limitZoom(j)],_e=we.range(Ri(Q),wl(Ee),Ri(me),wl(se)),De=[];for(const Ke of _e){const ht=we.points[Ke];De.push(ht.numPoints?Tr(ht):this.points[ht.index])}return De}getChildren(z){const j=this._getOriginId(z),Q=this._getOriginZoom(z),se="No cluster with the specified id.",me=this.trees[Q];if(!me)throw new Error(se);const Ee=me.points[j];if(!Ee)throw new Error(se);const we=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),_e=me.within(Ee.x,Ee.y,we),De=[];for(const Ke of _e){const ht=me.points[Ke];ht.parentId===z&&De.push(ht.numPoints?Tr(ht):this.points[ht.index])}if(0===De.length)throw new Error(se);return De}getLeaves(z,j,Q){const se=[];return this._appendLeaves(se,z,j=j||10,Q=Q||0,0),se}getTile(z,j,Q){const se=this.trees[this._limitZoom(z)],me=Math.pow(2,z),{extent:Ee,radius:we}=this.options,_e=we/Ee,De=(Q-_e)/me,Ke=(Q+1+_e)/me,ht={features:[]};return this._addTileFeatures(se.range((j-_e)/me,De,(j+1+_e)/me,Ke),se.points,j,Q,me,ht),0===j&&this._addTileFeatures(se.range(1-_e/me,De,1,Ke),se.points,me,Q,me,ht),j===me-1&&this._addTileFeatures(se.range(0,De,_e/me,Ke),se.points,-1,Q,me,ht),ht.features.length?ht:null}getClusterExpansionZoom(z){let j=this._getOriginZoom(z)-1;for(;j<=this.options.maxZoom;){const Q=this.getChildren(z);if(j++,1!==Q.length)break;z=Q[0].properties.cluster_id}return j}_appendLeaves(z,j,Q,se,me){const Ee=this.getChildren(j);for(const we of Ee){const _e=we.properties;if(_e&&_e.cluster?me+_e.point_count<=se?me+=_e.point_count:me=this._appendLeaves(z,_e.cluster_id,Q,se,me):me<se?me++:z.push(we),z.length===Q)break}return me}_addTileFeatures(z,j,Q,se,me,Ee){for(const we of z){const _e=j[we],De=_e.numPoints;let Ke,ht,Qe;if(De)Ke=hn(_e),ht=_e.x,Qe=_e.y;else{const Kt=this.points[_e.index];Ke=Kt.properties,ht=Ri(Kt.geometry.coordinates[0]),Qe=wl(Kt.geometry.coordinates[1])}const Ut={type:1,geometry:[[Math.round(this.options.extent*(ht*me-Q)),Math.round(this.options.extent*(Qe*me-se))]],tags:Ke};let tn;De?tn=_e.id:this.options.generateId?tn=_e.index:this.points[_e.index].id&&(tn=this.points[_e.index].id),void 0!==tn&&(Ut.id=tn),Ee.features.push(Ut)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,j){const Q=[],{radius:se,extent:me,reduce:Ee,minPoints:we}=this.options,_e=se/(me*Math.pow(2,j));for(let De=0;De<z.length;De++){const Ke=z[De];if(Ke.zoom<=j)continue;Ke.zoom=j;const ht=this.trees[j+1],Qe=ht.within(Ke.x,Ke.y,_e),Ut=Ke.numPoints||1;let tn=Ut;for(const Kt of Qe){const rn=ht.points[Kt];rn.zoom>j&&(tn+=rn.numPoints||1)}if(tn>Ut&&tn>=we){let Kt=Ke.x*Ut,rn=Ke.y*Ut,bn=Ee&&Ut>1?this._map(Ke,!0):null;const Kn=(De<<5)+(j+1)+this.points.length;for(const cr of Qe){const sr=ht.points[cr];if(sr.zoom<=j)continue;sr.zoom=j;const be=sr.numPoints||1;Kt+=sr.x*be,rn+=sr.y*be,sr.parentId=Kn,Ee&&(bn||(bn=this._map(Ke,!0)),Ee(bn,this._map(sr)))}Ke.parentId=Kn,Q.push(Yn(Kt/tn,rn/tn,Kn,tn,bn))}else if(Q.push(Ke),tn>1)for(const Kt of Qe){const rn=ht.points[Kt];rn.zoom<=j||(rn.zoom=j,Q.push(rn))}}return Q}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,j){if(z.numPoints)return j?ca({},z.properties):z.properties;const Q=this.points[z.index].properties,se=this.options.map(Q);return j&&se===Q?ca({},se):se}}function Yn(ee,z,j,Q,se){return{x:$n(ee),y:$n(z),zoom:1/0,id:j,parentId:-1,numPoints:Q,properties:se}}function en(ee,z){const[j,Q]=ee.geometry.coordinates;return{x:$n(Ri(j)),y:$n(wl(Q)),zoom:1/0,index:z,parentId:-1}}function Tr(ee){return{type:"Feature",id:ee.id,properties:hn(ee),geometry:{type:"Point",coordinates:[(z=ee.x,360*(z-.5)),Hn(ee.y)]}};var z}function hn(ee){const z=ee.numPoints,j=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return ca(ca({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:z,point_count_abbreviated:j})}function Ri(ee){return ee/360+.5}function wl(ee){const z=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return j<0?0:j>1?1:j}function Hn(ee){const z=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function ca(ee,z){for(const j in z)ee[j]=z[j];return ee}function Cl(ee){return ee.x}function Ls(ee){return ee.y}function ns(ee,z,j,Q){for(var se,me=Q,Ee=j-z>>1,we=j-z,_e=ee[z],De=ee[z+1],Ke=ee[j],ht=ee[j+1],Qe=z+3;Qe<j;Qe+=3){var Ut=El(ee[Qe],ee[Qe+1],_e,De,Ke,ht);if(Ut>me)se=Qe,me=Ut;else if(Ut===me){var tn=Math.abs(Qe-Ee);tn<we&&(se=Qe,we=tn)}}me>Q&&(se-z>3&&ns(ee,z,se,Q),ee[se+2]=me,j-se>3&&ns(ee,se,j,Q))}function El(ee,z,j,Q,se,me){var Ee=se-j,we=me-Q;if(0!==Ee||0!==we){var _e=((ee-j)*Ee+(z-Q)*we)/(Ee*Ee+we*we);_e>1?(j=se,Q=me):_e>0&&(j+=Ee*_e,Q+=we*_e)}return(Ee=ee-j)*Ee+(we=z-Q)*we}function qn(ee,z,j,Q){var se={id:void 0===ee?null:ee,type:z,geometry:j,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Ee=me.geometry,we=me.type;if("Point"===we||"MultiPoint"===we||"LineString"===we)Fs(me,Ee);else if("Polygon"===we||"MultiLineString"===we)for(var _e=0;_e<Ee.length;_e++)Fs(me,Ee[_e]);else if("MultiPolygon"===we)for(_e=0;_e<Ee.length;_e++)for(var De=0;De<Ee[_e].length;De++)Fs(me,Ee[_e][De])}(se),se}function Fs(ee,z){for(var j=0;j<z.length;j+=3)ee.minX=Math.min(ee.minX,z[j]),ee.minY=Math.min(ee.minY,z[j+1]),ee.maxX=Math.max(ee.maxX,z[j]),ee.maxY=Math.max(ee.maxY,z[j+1])}function ua(ee,z,j,Q){if(z.geometry){var se=z.geometry.coordinates,me=z.geometry.type,Ee=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),we=[],_e=z.id;if(j.promoteId?_e=z.properties[j.promoteId]:j.generateId&&(_e=Q||0),"Point"===me)_s(se,we);else if("MultiPoint"===me)for(var De=0;De<se.length;De++)_s(se[De],we);else if("LineString"===me)Ra(se,we,Ee,!1);else if("MultiLineString"===me){if(j.lineMetrics){for(De=0;De<se.length;De++)Ra(se[De],we=[],Ee,!1),ee.push(qn(_e,"LineString",we,z.properties));return}_c(se,we,Ee,!1)}else if("Polygon"===me)_c(se,we,Ee,!0);else{if("MultiPolygon"!==me){if("GeometryCollection"===me){for(De=0;De<z.geometry.geometries.length;De++)ua(ee,{id:_e,geometry:z.geometry.geometries[De],properties:z.properties},j,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(De=0;De<se.length;De++){var Ke=[];_c(se[De],Ke,Ee,!0),we.push(Ke)}}ee.push(qn(_e,me,we,z.properties))}}function _s(ee,z){z.push(zu(ee[0])),z.push(Bu(ee[1])),z.push(0)}function Ra(ee,z,j,Q){for(var se,me,Ee=0,we=0;we<ee.length;we++){var _e=zu(ee[we][0]),De=Bu(ee[we][1]);z.push(_e),z.push(De),z.push(0),we>0&&(Ee+=Q?(se*De-_e*me)/2:Math.sqrt(Math.pow(_e-se,2)+Math.pow(De-me,2))),se=_e,me=De}var Ke=z.length-3;z[2]=1,ns(z,0,Ke,j),z[Ke+2]=1,z.size=Math.abs(Ee),z.start=0,z.end=z.size}function _c(ee,z,j,Q){for(var se=0;se<ee.length;se++){var me=[];Ra(ee[se],me,j,Q),z.push(me)}}function zu(ee){return ee/360+.5}function Bu(ee){var z=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return j<0?0:j>1?1:j}function yi(ee,z,j,Q,se,me,Ee,we){if(Q/=z,me>=(j/=z)&&Ee<Q)return ee;if(Ee<j||me>=Q)return null;for(var _e=[],De=0;De<ee.length;De++){var Ke=ee[De],ht=Ke.geometry,Qe=Ke.type,Ut=0===se?Ke.minX:Ke.minY,tn=0===se?Ke.maxX:Ke.maxY;if(Ut>=j&&tn<Q)_e.push(Ke);else if(!(tn<j||Ut>=Q)){var Kt=[];if("Point"===Qe||"MultiPoint"===Qe)ys(ht,Kt,j,Q,se);else if("LineString"===Qe)Ml(ht,Kt,j,Q,se,!1,we.lineMetrics);else if("MultiLineString"===Qe)jo(ht,Kt,j,Q,se,!1);else if("Polygon"===Qe)jo(ht,Kt,j,Q,se,!0);else if("MultiPolygon"===Qe)for(var rn=0;rn<ht.length;rn++){var bn=[];jo(ht[rn],bn,j,Q,se,!0),bn.length&&Kt.push(bn)}if(Kt.length){if(we.lineMetrics&&"LineString"===Qe){for(rn=0;rn<Kt.length;rn++)_e.push(qn(Ke.id,Qe,Kt[rn],Ke.tags));continue}"LineString"!==Qe&&"MultiLineString"!==Qe||(1===Kt.length?(Qe="LineString",Kt=Kt[0]):Qe="MultiLineString"),"Point"!==Qe&&"MultiPoint"!==Qe||(Qe=3===Kt.length?"Point":"MultiPoint"),_e.push(qn(Ke.id,Qe,Kt,Ke.tags))}}}return _e.length?_e:null}function ys(ee,z,j,Q,se){for(var me=0;me<ee.length;me+=3){var Ee=ee[me+se];Ee>=j&&Ee<=Q&&(z.push(ee[me]),z.push(ee[me+1]),z.push(ee[me+2]))}}function Ml(ee,z,j,Q,se,me,Ee){for(var we,_e,De=Nu(ee),Ke=0===se?id:Vu,ht=ee.start,Qe=0;Qe<ee.length-3;Qe+=3){var Ut=ee[Qe],tn=ee[Qe+1],Kt=ee[Qe+2],rn=ee[Qe+3],bn=ee[Qe+4],Kn=0===se?Ut:tn,cr=0===se?rn:bn,sr=!1;Ee&&(we=Math.sqrt(Math.pow(Ut-rn,2)+Math.pow(tn-bn,2))),Kn<j?cr>j&&(_e=Ke(De,Ut,tn,rn,bn,j),Ee&&(De.start=ht+we*_e)):Kn>Q?cr<Q&&(_e=Ke(De,Ut,tn,rn,bn,Q),Ee&&(De.start=ht+we*_e)):zs(De,Ut,tn,Kt),cr<j&&Kn>=j&&(_e=Ke(De,Ut,tn,rn,bn,j),sr=!0),cr>Q&&Kn<=Q&&(_e=Ke(De,Ut,tn,rn,bn,Q),sr=!0),!me&&sr&&(Ee&&(De.end=ht+we*_e),z.push(De),De=Nu(ee)),Ee&&(ht+=we)}var be=ee.length-3;Ut=ee[be],tn=ee[be+1],Kt=ee[be+2],(Kn=0===se?Ut:tn)>=j&&Kn<=Q&&zs(De,Ut,tn,Kt),be=De.length-3,me&&be>=3&&(De[be]!==De[0]||De[be+1]!==De[1])&&zs(De,De[0],De[1],De[2]),De.length&&z.push(De)}function Nu(ee){var z=[];return z.size=ee.size,z.start=ee.start,z.end=ee.end,z}function jo(ee,z,j,Q,se,me){for(var Ee=0;Ee<ee.length;Ee++)Ml(ee[Ee],z,j,Q,se,me,!1)}function zs(ee,z,j,Q){ee.push(z),ee.push(j),ee.push(Q)}function id(ee,z,j,Q,se,me){var Ee=(me-z)/(Q-z);return ee.push(me),ee.push(j+(se-j)*Ee),ee.push(1),Ee}function Vu(ee,z,j,Q,se,me){var Ee=(me-j)/(se-j);return ee.push(z+(Q-z)*Ee),ee.push(me),ee.push(1),Ee}function Uu(ee,z){for(var j=[],Q=0;Q<ee.length;Q++){var se,me=ee[Q],Ee=me.type;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)se=ju(me.geometry,z);else if("MultiLineString"===Ee||"Polygon"===Ee){se=[];for(var we=0;we<me.geometry.length;we++)se.push(ju(me.geometry[we],z))}else if("MultiPolygon"===Ee)for(se=[],we=0;we<me.geometry.length;we++){for(var _e=[],De=0;De<me.geometry[we].length;De++)_e.push(ju(me.geometry[we][De],z));se.push(_e)}j.push(qn(me.id,Ee,se,me.tags))}return j}function ju(ee,z){var j=[];j.size=ee.size,void 0!==ee.start&&(j.start=ee.start,j.end=ee.end);for(var Q=0;Q<ee.length;Q+=3)j.push(ee[Q]+z,ee[Q+1],ee[Q+2]);return j}function $u(ee,z){if(ee.transformed)return ee;var j,Q,se,me=1<<ee.z,Ee=ee.x,we=ee.y;for(j=0;j<ee.features.length;j++){var _e=ee.features[j],De=_e.geometry,Ke=_e.type;if(_e.geometry=[],1===Ke)for(Q=0;Q<De.length;Q+=2)_e.geometry.push(Tl(De[Q],De[Q+1],z,me,Ee,we));else for(Q=0;Q<De.length;Q++){var ht=[];for(se=0;se<De[Q].length;se+=2)ht.push(Tl(De[Q][se],De[Q][se+1],z,me,Ee,we));_e.geometry.push(ht)}}return ee.transformed=!0,ee}function Tl(ee,z,j,Q,se,me){return[Math.round(j*(ee*Q-se)),Math.round(j*(z*Q-me))]}function yc(ee,z,j,Q,se){for(var me=z===se.maxZoom?0:se.tolerance/((1<<z)*se.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Q,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ee.length;we++){Ee.numFeatures++,Gu(Ee,ee[we],me,se);var _e=ee[we].minX,De=ee[we].minY,Ke=ee[we].maxX,ht=ee[we].maxY;_e<Ee.minX&&(Ee.minX=_e),De<Ee.minY&&(Ee.minY=De),Ke>Ee.maxX&&(Ee.maxX=Ke),ht>Ee.maxY&&(Ee.maxY=ht)}return Ee}function Gu(ee,z,j,Q){var se=z.geometry,me=z.type,Ee=[];if("Point"===me||"MultiPoint"===me)for(var we=0;we<se.length;we+=3)Ee.push(se[we]),Ee.push(se[we+1]),ee.numPoints++,ee.numSimplified++;else if("LineString"===me)Bs(Ee,se,ee,j,!1,!1);else if("MultiLineString"===me||"Polygon"===me)for(we=0;we<se.length;we++)Bs(Ee,se[we],ee,j,"Polygon"===me,0===we);else if("MultiPolygon"===me)for(var _e=0;_e<se.length;_e++){var De=se[_e];for(we=0;we<De.length;we++)Bs(Ee,De[we],ee,j,!0,0===we)}if(Ee.length){var Ke=z.tags||null;if("LineString"===me&&Q.lineMetrics){for(var ht in Ke={},z.tags)Ke[ht]=z.tags[ht];Ke.mapbox_clip_start=se.start/se.size,Ke.mapbox_clip_end=se.end/se.size}var Qe={geometry:Ee,type:"Polygon"===me||"MultiPolygon"===me?3:"LineString"===me||"MultiLineString"===me?2:1,tags:Ke};null!==z.id&&(Qe.id=z.id),ee.features.push(Qe)}}function Bs(ee,z,j,Q,se,me){var Ee=Q*Q;if(Q>0&&z.size<(se?Ee:Q))j.numPoints+=z.length/3;else{for(var we=[],_e=0;_e<z.length;_e+=3)(0===Q||z[_e+2]>Ee)&&(j.numSimplified++,we.push(z[_e]),we.push(z[_e+1])),j.numPoints++;se&&function(De,Ke){for(var ht=0,Qe=0,Ut=De.length,tn=Ut-2;Qe<Ut;tn=Qe,Qe+=2)ht+=(De[Qe]-De[tn])*(De[Qe+1]+De[tn+1]);if(ht>0===Ke)for(Qe=0,Ut=De.length;Qe<Ut/2;Qe+=2){var Kt=De[Qe],rn=De[Qe+1];De[Qe]=De[Ut-2-Qe],De[Qe+1]=De[Ut-1-Qe],De[Ut-2-Qe]=Kt,De[Ut-1-Qe]=rn}}(we,me),ee.push(we)}}function vs(ee,z){var j=(z=this.options=function(se,me){for(var Ee in me)se[Ee]=me[Ee];return se}(Object.create(this.options),z)).debug;if(j&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var se,me,Ee,we,_e,De,Q=function(se,me){var Ee=[];if("FeatureCollection"===se.type)for(var we=0;we<se.features.length;we++)ua(Ee,se.features[we],me,we);else ua(Ee,"Feature"===se.type?se:{geometry:se},me);return Ee}(ee,z);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=Q,me=z,Ee=me.buffer/me.extent,we=se,_e=yi(se,1,-1-Ee,Ee,0,-1,2,me),De=yi(se,1,1-Ee,2+Ee,0,-1,2,me),(_e||De)&&(we=yi(se,1,-Ee,1+Ee,0,-1,2,me)||[],_e&&(we=Uu(_e,1).concat(we)),De&&(we=we.concat(Uu(De,-1)))),Q=we).length&&this.splitTile(Q,0,0,0),j&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Dl(ee,z,j){return 32*((1<<ee)*j+z)+ee}function vc(ee,z){const j=ee.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const Q=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Q)return z(null,null);const se=new ft(Q.features);let me=Oe(se);0===me.byteOffset&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),z(null,{vectorTile:se,rawData:me.buffer})}vs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vs.prototype.splitTile=function(ee,z,j,Q,se,me,Ee){for(var we=[ee,z,j,Q],_e=this.options,De=_e.debug;we.length;){Q=we.pop(),j=we.pop(),z=we.pop(),ee=we.pop();var Ke=1<<z,ht=Dl(z,j,Q),Qe=this.tiles[ht];if(!Qe&&(De>1&&console.time("creation"),Qe=this.tiles[ht]=yc(ee,z,j,Q,_e),this.tileCoords.push({z,x:j,y:Q}),De)){De>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,j,Q,Qe.numFeatures,Qe.numPoints,Qe.numSimplified),console.timeEnd("creation"));var Ut="z"+z;this.stats[Ut]=(this.stats[Ut]||0)+1,this.total++}if(Qe.source=ee,se){if(z===_e.maxZoom||z===se)continue;var tn=1<<se-z;if(j!==Math.floor(me/tn)||Q!==Math.floor(Ee/tn))continue}else if(z===_e.indexMaxZoom||Qe.numPoints<=_e.indexMaxPoints)continue;if(Qe.source=null,0!==ee.length){De>1&&console.time("clipping");var Kt,rn,bn,Kn,cr,sr,be=.5*_e.buffer/_e.extent,po=.5-be,Lr=.5+be,$o=1+be;Kt=rn=bn=Kn=null,cr=yi(ee,Ke,j-be,j+Lr,0,Qe.minX,Qe.maxX,_e),sr=yi(ee,Ke,j+po,j+$o,0,Qe.minX,Qe.maxX,_e),ee=null,cr&&(Kt=yi(cr,Ke,Q-be,Q+Lr,1,Qe.minY,Qe.maxY,_e),rn=yi(cr,Ke,Q+po,Q+$o,1,Qe.minY,Qe.maxY,_e),cr=null),sr&&(bn=yi(sr,Ke,Q-be,Q+Lr,1,Qe.minY,Qe.maxY,_e),Kn=yi(sr,Ke,Q+po,Q+$o,1,Qe.minY,Qe.maxY,_e),sr=null),De>1&&console.timeEnd("clipping"),we.push(Kt||[],z+1,2*j,2*Q),we.push(rn||[],z+1,2*j,2*Q+1),we.push(bn||[],z+1,2*j+1,2*Q),we.push(Kn||[],z+1,2*j+1,2*Q+1)}}},vs.prototype.getTile=function(ee,z,j){var Q=this.options,se=Q.extent,me=Q.debug;if(ee<0||ee>24)return null;var Ee=1<<ee,we=Dl(ee,z=(z%Ee+Ee)%Ee,j);if(this.tiles[we])return $u(this.tiles[we],se);me>1&&console.log("drilling down to z%d-%d-%d",ee,z,j);for(var _e,De=ee,Ke=z,ht=j;!_e&&De>0;)De--,Ke=Math.floor(Ke/2),ht=Math.floor(ht/2),_e=this.tiles[Dl(De,Ke,ht)];return _e&&_e.source?(me>1&&console.log("found parent tile z%d-%d-%d",De,Ke,ht),me>1&&console.time("drilling down"),this.splitTile(_e.source,De,Ke,ht,ee,z,j),me>1&&console.timeEnd("drilling down"),this.tiles[we]?$u(this.tiles[we],se):null):null};class eo extends h.VectorTileWorkerSource{constructor(z,j,Q,se,me){super(z,j,Q,se,vc),me&&(this.loadGeoJSON=me)}loadData(z,j){const Q=z&&z.request,se=Q&&Q.collectResourceTiming;this.loadGeoJSON(z,(me,Ee)=>{if(me||!Ee)return j(me);if("object"!=typeof Ee)return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Te(Ee,!0);try{if(z.filter){const _e=h.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===_e.result)throw new Error(_e.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));const De=Ee.features.filter(Ke=>_e.value.evaluate({zoom:0},Ke));Ee={type:"FeatureCollection",features:De}}this._geoJSONIndex=z.cluster?new Si(function({superclusterOptions:_e,clusterProperties:De}){if(!De||!_e)return _e;const Ke={},ht={},Qe={accumulated:null,zoom:0},Ut={properties:null},tn=Object.keys(De);for(const Kt of tn){const[rn,bn]=De[Kt],Kn=h.createExpression(bn),cr=h.createExpression("string"==typeof rn?[rn,["accumulated"],["get",Kt]]:rn);Ke[Kt]=Kn.value,ht[Kt]=cr.value}return _e.map=Kt=>{Ut.properties=Kt;const rn={};for(const bn of tn)rn[bn]=Ke[bn].evaluate(Qe,Ut);return rn},_e.reduce=(Kt,rn)=>{Ut.properties=rn;for(const bn of tn)Qe.accumulated=Kt[bn],Kt[bn]=ht[bn].evaluate(Qe,Ut)},_e}(z)).load(Ee.features):new vs(_e=Ee,z.geojsonVtOptions)}catch(_e){return j(_e)}this.loaded={};const we={};if(se){const _e=h.getPerformanceMeasurement(Q);_e&&(we.resourceTiming={},we.resourceTiming[z.source]=JSON.parse(JSON.stringify(_e)))}j(null,we)}var _e})}reloadTile(z,j){const Q=this.loaded;return Q&&Q[z.uid]?super.reloadTile(z,j):this.loadTile(z,j)}loadGeoJSON(z,j){if(z.request)h.getJSON(z.request,j);else{if("string"!=typeof z.data)return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(z.data))}catch{return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(Q){j(Q)}}getClusterChildren(z,j){try{j(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(Q){j(Q)}}getClusterLeaves(z,j){try{j(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(Q){j(Q)}}}class Sl{constructor(z){this.self=z,this.actor=new h.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:eo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,Q)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=Q},this.self.registerRTLTextPlugin=j=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=j.applyArabicShaping,h.plugin.processBidirectionalText=j.processBidirectionalText,h.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(z,j,Q){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],Q()}checkIfReady(z,j,Q){Q()}setReferrer(z,j){this.referrer=j}spriteLoaded(z,j){this.isSpriteLoaded[z]=j;for(const Q in this.workerSources[z]){const se=this.workerSources[z][Q];for(const me in se)se[me]instanceof h.VectorTileWorkerSource&&(se[me].isSpriteLoaded=j,se[me].fire(new h.Event("isSpriteLoaded")))}}setImages(z,j,Q){this.availableImages[z]=j;for(const se in this.workerSources[z]){const me=this.workerSources[z][se];for(const Ee in me)me[Ee].availableImages=j}Q()}enableTerrain(z,j,Q){this.terrain=j,Q()}setProjection(z,j){this.projections[z]=h.getProjection(j)}setLayers(z,j,Q){this.getLayerIndex(z).replace(j),Q()}updateLayers(z,j,Q){this.getLayerIndex(z).update(j.layers,j.removedIds),Q()}loadTile(z,j,Q){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;se.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,j.type,j.source).loadTile(se,Q)}loadDEMTile(z,j,Q){const se=this.enableTerrain?h.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(z,j.source).loadTile(se,Q)}reloadTile(z,j,Q){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;se.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,j.type,j.source).reloadTile(se,Q)}abortTile(z,j,Q){this.getWorkerSource(z,j.type,j.source).abortTile(j,Q)}removeTile(z,j,Q){this.getWorkerSource(z,j.type,j.source).removeTile(j,Q)}removeSource(z,j,Q){if(!this.workerSources[z]||!this.workerSources[z][j.type]||!this.workerSources[z][j.type][j.source])return;const se=this.workerSources[z][j.type][j.source];delete this.workerSources[z][j.type][j.source],void 0!==se.removeSource?se.removeSource(j,Q):Q()}loadWorkerSource(z,j,Q){try{this.self.importScripts(j.url),Q()}catch(se){Q(se.toString())}}syncRTLPluginState(z,j,Q){try{h.plugin.setState(j);const se=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=se){this.self.importScripts(se);const me=h.plugin.isParsed();Q(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),me)}}catch(se){Q(se.toString())}}getAvailableImages(z){let j=this.availableImages[z];return j||(j=[]),j}getLayerIndex(z){let j=this.layerIndexes[z];return j||(j=this.layerIndexes[z]=new Ce),j}getWorkerSource(z,j,Q){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][j]||(this.workerSources[z][j]={}),this.workerSources[z][j][Q]||(this.workerSources[z][j][Q]=new this.workerSourceTypes[j]({send:(se,me,Ee,we,_e,De)=>{this.actor.send(se,me,Ee,z,_e,De)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][j][Q]}getDEMWorkerSource(z,j){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][j]||(this.demWorkerSources[z][j]=new ce),this.demWorkerSources[z][j]}enforceCacheSizeLimit(z,j){h.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(z,j,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sl(self)),Sl}),Ne(0,function(h){function H(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let u=0;u<f.length;u++)if(!H(f[u],o[u]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==o){if("object"!=typeof o||Object.keys(f).length!==Object.keys(o).length)return!1;for(const u in f)if(!H(f[u],o[u]))return!1;return!0}return f===o}var Me=Ce;function Ce(f){return o=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{v=new Worker(T),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(T),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===ce[u=o&&o.failIfMajorPerformanceCaveat]&&(ce[u]=function(g){var v,T,D,I,b=(T=g,D=document.createElement("canvas"),(I=Object.create(Ce.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,D.getContext("webgl",I)||D.getContext("experimental-webgl",I));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!ce[u]||document.documentMode));var o,u}var ce={};function Te(f,o,u){const g=h.window.document.createElement(f);return void 0!==o&&(g.className=o),u&&u.appendChild(g),g}function rt(f,o,u){const g=h.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(o))g.setAttributeNS(null,v,o[v]);return u&&u.appendChild(g),g}Ce.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ft=h.window.document&&h.window.document.documentElement.style,Xe=Ft&&void 0!==Ft.userSelect?"userSelect":"WebkitUserSelect";let yt;function ft(){Ft&&Xe&&(yt=Ft[Xe],Ft[Xe]="none")}function dt(){Ft&&Xe&&(Ft[Xe]=yt)}function le(f){f.preventDefault(),f.stopPropagation(),h.window.removeEventListener("click",le,!0)}function ze(){h.window.addEventListener("click",le,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",le,!0)},0)}function Ve(f,o){const u=f.getBoundingClientRect();return He(f,u,o)}function Oe(f,o){const u=f.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(He(f,u,o[v]));return g}function ve(f){return void 0!==h.window.InstallTrigger&&2===f.button&&f.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function He(f,o,u){const g=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new h.pointGeometry((u.clientX-o.left)*g,(u.clientY-o.top)*g)}function Je(f,o){var u=o[0],g=o[1],v=o[2],b=o[3],T=u*b-v*g;return T?(f[0]=b*(T=1/T),f[1]=-g*T,f[2]=-v*T,f[3]=u*T,f):null}function je(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Pt extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const v of o){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(o,u){return!(o&&(4!==o.length||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let g=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const g={};for(const v of o){this.images[v]||this.fire(new h.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:h.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],g=this.getImage(o);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new h.ImagePosition(v,g);this.patterns[o]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:g}=h.potpack(o),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],D=T.x+1,I=T.y+1,O=this.images[b].data,R=O.width,B=O.height;h.RGBAImage.copy(O,v,{x:0,y:0},{x:D,y:I},{width:R,height:B}),h.RGBAImage.copy(O,v,{x:0,y:B-1},{x:D,y:I-1},{width:R,height:1}),h.RGBAImage.copy(O,v,{x:0,y:0},{x:D,y:I+B},{width:R,height:1}),h.RGBAImage.copy(O,v,{x:R-1,y:0},{x:D-1,y:I},{width:1,height:B}),h.RGBAImage.copy(O,v,{x:0,y:0},{x:D+R,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];je(g)&&this.updateImage(u,g)}}}const Xt=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(f,o){return function([u,g,v]){const b=h.degToRad(g+90),T=h.degToRad(v);return{x:u*Math.cos(b)*Math.sin(T),y:u*Math.sin(b)*Math.sin(T),z:u*Math.cos(T),azimuthal:g,polar:v}}(f.expression.evaluate(o))}interpolate(f,o,u){return{x:h.number(f.x,o.x,u),y:h.number(f.y,o.y,u),z:h.number(f.z,o.z,u),azimuthal:h.number(f.azimuthal,o.azimuthal,u),polar:h.number(f.polar,o.polar,u)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),jt="-transition";class wt extends h.Evented{constructor(o){super(),this._transitionable=new h.Transitionable(Xt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(h.validateLight,o,u))for(const g in o){const v=o[g];h.endsWith(g,jt)?this._transitionable.setTransition(g.slice(0,-jt.length),v):this._transitionable.setValue(g,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&h.emitValidationErrors(this,o.call(h.validateStyle,h.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Mt=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),Yt="-transition";class St extends h.Evented{constructor(o,u){super(),this._transitionable=new h.Transitionable(Mt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(o){for(const u in o){const g=o[u];h.endsWith(u,Yt)?this._transitionable.setTransition(u.slice(0,-Yt.length),g):this._transitionable.setValue(u,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function on(f,o,u,g){const v=h.smoothstep(45,65,u),[b,T]=an(f,g),D=h.length(o);let I=1-Math.min(1,Math.exp((D-b)/(T-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*f.alpha}function an(f,o){const u=.5/Math.tan(.5*o);return[f.range[0]+u,f.range[1]+u]}const qt=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"high-color":new h.DataConstantProperty(h.spec.fog["high-color"]),"space-color":new h.DataConstantProperty(h.spec.fog["space-color"]),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"]),"star-intensity":new h.DataConstantProperty(h.spec.fog["star-intensity"])}),xr="-transition";class vn extends h.Evented{constructor(o,u){super(),this._transitionable=new h.Transitionable(qt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const o=this._transform,u="globe"===o.projection.name,g=h.globeToMercatorTransition(o.zoom),v=this.properties.get("range"),b=[.5,3];return{range:u?[h.number(b[0],v[0],g),h.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u={}){if(!this._validate(h.validateFog,o,u)){for(const g of Object.keys(h.spec.fog))o&&void 0===o[g]&&(o[g]=h.spec.fog[g].default);for(const g in o){const v=o[g];h.endsWith(g,xr)?this._transitionable.setTransition(g.slice(0,-xr.length),v):this._transitionable.setValue(g,v)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:h.smoothstep(45,65,o))*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(g,v,b){const T=h.MercatorCoordinate.fromLngLat(v),D=b.elevation?b.elevation.getAtPointOrZero(T):0,I=[T.x,T.y,D];return h.transformMat4(I,I,b.mercatorFogMatrix),on(g,I,b.pitch,b._fov)}(this.state,o,u):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?an(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&h.emitValidationErrors(this,o.call(h.validateStyle,h.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class Xn{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new Xn.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,u,g){h.asyncAll(this.actors,(v,b)=>{v.send(o,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zr(f,o,u){return o*(h.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}Xn.Actor=h.Actor;class $n{constructor(o,u,g,v){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(o,u){let g,v;if(o instanceof h.pointGeometry||"number"==typeof o[0]){const b=h.pointGeometry.convert(o);g=[h.pointGeometry.convert(o)],v=u.isPointAboveHorizon(b)}else{const b=h.pointGeometry.convert(o[0]),T=h.pointGeometry.convert(o[1]);g=[b,T],v=h.polygonizeBounds(b,T).every(D=>u.isPointAboveHorizon(D))}return new $n(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],v=h.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),h.bufferConvexPolygon(v,o)}bufferedCameraGeometryGlobe(o){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],v=h.polygonizeBounds(u,g,o),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(o,u,g,v=0){const b=o.queryPadding/u._projectionScaler+1,T=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let D=o.tileID.wrap+(T.unwrapped?v:0);const I=T.polygon.map(ie=>h.getTilePoint(o.tileTransform,ie,D));if(!h.polygonIntersectsBox(I,0,0,h.EXTENT,h.EXTENT))return;D=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const O=this.screenGeometryMercator.polygon.map(ie=>h.getTileVec3(o.tileTransform,ie,D)),R=O.map(ie=>new h.pointGeometry(ie[0],ie[1])),B=u.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),$=h.getTileVec3(o.tileTransform,B,D),Z=O.map(ie=>{const W=h.sub(ie,ie,$);return h.normalize(W,W),new h.Ray($,W)}),X=Zr(o,1,u.zoom)*u._projectionScaler;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:Z,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=h.getBounds(I),G.min.x=h.clamp(G.min.x,0,h.EXTENT),G.min.y=h.clamp(G.min.y,0,h.EXTENT),G.max.x=h.clamp(G.max.x,0,h.EXTENT),G.max.y=h.clamp(G.max.y,0,h.EXTENT),G),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:X};var G}_bufferedScreenMercator(o,u){const g=Yn(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(o),u):{polygon:this.bufferedScreenGeometry(o).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,u){const g=Yn(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),u):{polygon:this.bufferedCameraGeometry(o).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(o,u){const g=function(b,T){const D=h.multiply([],T.pixelMatrix,T.globeMatrix),I=[0,-h.GLOBE_RADIUS,0,1],O=[0,h.GLOBE_RADIUS,0,1],R=[0,0,0,1];h.transformMat4$1(I,I,D),h.transformMat4$1(O,O,D),h.transformMat4$1(R,R,D);const B=new h.pointGeometry(I[0]/I[3],I[1]/I[3]),$=new h.pointGeometry(O[0]/O[3],O[1]/O[3]),Z=h.polygonContainsPoint(b,B)&&I[3]<R[3],X=h.polygonContainsPoint(b,$)&&O[3]<R[3];if(!Z&&!X)return null;const G=function(pe,Pe,Be){for(let ke=1;ke<pe.length;ke++){const at=Si(Pe.pointCoordinate3D(pe[ke-1]).x),ae=Si(Pe.pointCoordinate3D(pe[ke]).x);if(Be<0){if(at<ae)return{idx:ke,t:-at/(ae-1-at)}}else if(ae<at)return{idx:ke,t:(1-at)/(ae+1-at)}}return null}(b,T,Z?-1:1);if(!G)return null;const{idx:ie,t:W}=G;let J=ie>1?Di(b.slice(0,ie),T):[],q=ie<b.length?Di(b.slice(ie),T):[];J=J.map(pe=>new h.pointGeometry(Si(pe.x),pe.y)),q=q.map(pe=>new h.pointGeometry(Si(pe.x),pe.y));const ue=[...J];0===ue.length&&ue.push(q[q.length-1]);const te=h.number(ue[ue.length-1].y,(0===q.length?J[0]:q[0]).y,W);let oe;return oe=Z?[new h.pointGeometry(0,te),new h.pointGeometry(0,0),new h.pointGeometry(1,0),new h.pointGeometry(1,te)]:[new h.pointGeometry(1,te),new h.pointGeometry(1,1),new h.pointGeometry(0,1),new h.pointGeometry(0,te)],ue.push(...oe),0===q.length?ue.push(J[0]):ue.push(...q),{polygon:ue.map(pe=>new h.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(o,u);if(g)return g;const v=function(b,T){let D=!1,I=-1/0,O=0;for(let B=0;B<b.length-1;B++)b[B].x>I&&(I=b[B].x,O=B);for(let B=0;B<b.length-1;B++){const $=(O+B)%(b.length-1),Z=b[$],X=b[$+1];Math.abs(Z.x-X.x)>.5&&(Z.x<X.x?(Z.x+=1,0===$&&(b[b.length-1].x+=1)):(X.x+=1,$+1===b.length-1&&(b[0].x+=1)),D=!0)}const R=h.mercatorXfromLng(T.center.lng);return D&&R<Math.abs(R-1)&&b.forEach(B=>{B.x-=1}),{polygon:b,unwrapped:D}}(Di(o,u).map(b=>new h.pointGeometry(Si(b.x),b.y)),u);return{polygon:v.polygon.map(b=>new h.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function Di(f,o){return h.resample(f,u=>{const g=o.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Si(f){return f<0?1+f%1:f%1}function Yn(f){return 100*f|0}function en(f,o,u,g,v){const b=function(T,D){if(T)return v(T);if(D){const I=h.pick(h.extend(D,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(I.vectorLayers=D.vector_layers,I.vectorLayerIds=I.vectorLayers.map(O=>O.id)),D.language_options&&(I.languageOptions=D.language_options),D.language&&D.language[D.id]&&(I.language=D.language[D.id]),D.worldview_options&&(I.worldviewOptions=D.worldview_options),D.worldview?I.worldview=D.worldview[D.id]:D.worldview_default&&(I.worldview=D.worldview_default),I.tiles=o.canonicalizeTileset(I,f.url),v(null,I)}};return f.url?h.getJSON(o.transformRequest(o.normalizeSourceURL(f.url,null,u,g),h.ResourceType.Source),b):h.exported.frame(()=>b(null,f))}class Tr{constructor(o,u,g){this.bounds=h.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),g=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*u),T=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=g&&o.x<b&&o.y>=v&&o.y<T}}class hn{constructor(o,u,g){this.context=o;const v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ri={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wl{constructor(o,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],T=u.attributes[b.name];void 0!==T&&o.vertexAttribPointer(T,b.components,o[Ri[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ca extends Hn{getDefault(){return h.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Cl extends Hn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ls extends Hn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class ns extends Hn{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class El extends Hn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class qn extends Hn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Fs extends Hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ua extends Hn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class _s extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ra extends Hn{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class _c extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class zu extends Hn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Bu extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class yi extends Hn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ys extends Hn{getDefault(){return h.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Ml extends Hn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Nu extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class jo extends Hn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class zs extends Hn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class id extends Hn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Vu extends Hn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Uu extends Hn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ju extends Hn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $u extends Hn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Tl extends Hn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class yc extends Hn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Gu extends Hn{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Bs extends Hn{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class vs extends Hn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Dl extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class vc extends Hn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class eo extends Hn{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class Sl extends eo{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ee extends eo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class z extends ee{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class j{constructor(o,u,g,v){this.context=o,this.width=u,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Sl(o,b),v&&(this.depthAttachment=new ee(o,b))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class Q{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ca(this),this.clearDepth=new Cl(this),this.clearStencil=new Ls(this),this.colorMask=new ns(this),this.depthMask=new El(this),this.stencilMask=new qn(this),this.stencilFunc=new Fs(this),this.stencilOp=new ua(this),this.stencilTest=new _s(this),this.depthRange=new Ra(this),this.depthTest=new _c(this),this.depthFunc=new zu(this),this.blend=new Bu(this),this.blendFunc=new yi(this),this.blendColor=new ys(this),this.blendEquation=new Ml(this),this.cullFace=new Nu(this),this.cullFaceSide=new jo(this),this.frontFace=new zs(this),this.program=new id(this),this.activeTexture=new Vu(this),this.viewport=new Uu(this),this.bindFramebuffer=new ju(this),this.bindRenderbuffer=new $u(this),this.bindTexture=new Tl(this),this.bindVertexBuffer=new yc(this),this.bindElementBuffer=new Gu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Bs(this),this.pixelStoreUnpack=new vs(this),this.pixelStoreUnpackPremultiplyAlpha=new Dl(this),this.pixelStoreUnpackFlipY=new vc(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new hn(this,o,u)}createVertexBuffer(o,u,g){return new wl(this,o,u,g)}createRenderbuffer(o,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,g){return new j(this,o,u,g)}clear({color:o,depth:u,stencil:g}){const v=this.gl;let b=0;o&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){H(o.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class se extends h.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},u),h.extend(this,h.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=en(this._options,this.map._requestManager,null,null,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new h.ErrorEvent(o)):u&&(h.extend(this,u),u.bounds&&(this.tileBounds=new Tr(u.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(u.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const g=h.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=h.getImage(this.map._requestManager.transformRequest(v,h.ResourceType.Tile),(b,T,D,I)=>(delete o.request,o.aborted?(o.state="unloaded",u(null)):b?(o.state="errored",u(b)):T?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:D,expires:I}),o.setTexture(T,this.map.painter),o.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(o,u,g){o.setTexture(u,g)}static unloadTileData(o,u){o.texture&&u.saveTileTexture(o.texture)}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}}let me;function Ee(f,o,u,g,v,b,T,D){const I=[f,u,v,o,g,b,1,1,1],O=[T,D,1],R=h.adjoint([],I),[B,$,Z]=h.transformMat3(O,O,h.transpose(R,R));return h.multiply$1(I,[B,0,0,0,$,0,0,0,Z],I)}class we extends h.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o,u){this._loaded=u||!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(g,v)=>{if(this._loaded=!0,g)this.fire(new h.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=h.window;this.image=v instanceof b?h.exported.getImageData(v):v,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const u=o.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,T=-1/0,D=-1/0;for(const B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),T=Math.max(T,B.x),D=Math.max(D,B.y);const I=Math.max(T-v,D-b),O=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),R=Math.pow(2,O);return new h.CanonicalTileID(O,Math.floor((v+T)/2*R),Math.floor((b+D)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const I in this.tiles){const O=this.tiles[I];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const u=h.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,T]=this.coordinates.map(I=>{const O=u.projection.project(I[0],I[1]);return h.getTilePoint(u,O)._round()});this.perspectiveTransform=function(I,O,R,B,$,Z,X,G,ie,W){const J=Ee(0,0,I,0,0,O,I,O),q=Ee(R,B,$,Z,X,G,ie,W);return h.multiply$1(q,h.adjoint(J,J),q),[q[6]/q[8]*I/h.EXTENT,q[7]/q[8]*O/h.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,T.x,T.y,b.x,b.y);const D=this._boundsArray=new h.StructArrayLayout4i8;D.emplaceBack(g.x,g.y,0,0),D.emplaceBack(v.x,v.y,h.EXTENT,0),D.emplaceBack(T.x,T.y,0,h.EXTENT),D.emplaceBack(b.x,b.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(D,h.boundsAttributes.members),this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this.texture?this.texture.update(this.image):(this.texture=new h.Texture(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const _e={vector:class extends h.Evented{constructor(f,o,u,g){if(super(),this.id=f,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(o,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(f){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"}));const o=this.language||this.map._language,u=this.worldview||this.map._worldview;this._tileJSONRequest=en(this._options,this.map._requestManager,o,u,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${o}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new h.ErrorEvent(g))):v&&(h.extend(this,v),v.bounds&&(this.tileBounds=new Tr(v.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(g)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.load(()=>{const o=this.map.style._getSourceCaches(this.id);for(const u of o)u.clearTiles()})}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}_setLanguage(f){return f===this.language||this.setSourceProperty(()=>{this.language=f}),this}_setWorldview(f){return f===this.worldview?this:this.worldviewOptions&&f&&!this.worldviewOptions[f]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${f}".`),this):(this.setSourceProperty(()=>{this.worldview=f}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(f,o){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,h.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=o:f.request=f.actor.send("reloadTile",g,v.bind(this));else if(f.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=h.loadVectorTile.call({deduped:this._deduped},g,(T,D)=>{T||!D?v.call(this,T):(g.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},f.actor&&f.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);f.request={cancel:b}}function v(b,T){return delete f.request,f.aborted?o(null):b&&404!==b.status?o(b):(T&&T.resourceTiming&&(f.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadVectorData(T,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:se,"raster-dem":class extends se{constructor(f,o,u,g){super(f,o,u,g),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(f.state="errored",o(v)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=h.getImage(this.map._requestManager.transformRequest(u,h.ResourceType.Tile),function(v,b,T,D){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(v)f.state="errored",o(v);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:D});const I=h.window.ImageBitmap&&b instanceof h.window.ImageBitmap&&(null==me&&(me=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),me),O=1-(b.width-h.prevPowerOfTwo(b.width))/2;O<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=I?b:h.exported.getImageData(b,O),B={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:O};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const o=f.canonical,u=Math.pow(2,o.z),g=(o.x-1+u)%u,v=0===o.x?f.wrap-1:f.wrap,b=(o.x+1+u)%u,T=o.x+1===u?f.wrap+1:f.wrap,D={};return D[new h.OverscaledTileID(f.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},D[new h.OverscaledTileID(f.overscaledZ,T,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(D[new h.OverscaledTileID(f.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},D[new h.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},D[new h.OverscaledTileID(f.overscaledZ,T,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<u&&(D[new h.OverscaledTileID(f.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},D[new h.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},D[new h.OverscaledTileID(f.overscaledZ,T,o.z,b,o.y+1).key]={backfilled:!1}),D}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends h.Evented{constructor(f,o,u,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=o.data,this._options=h.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*v,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*v,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},o),this}getClusterLeaves(f,o,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:o,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=h.extend({},this.workerOptions),o=this._data;"string"==typeof o?(f.request=this.map._requestManager.transformRequest(h.exported.resolveURL(o),h.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new h.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new h.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?o(null):g?o(g):(f.loadVectorData(v,this.map.painter,"reloadTile"===u),o(null))),void 0,"loadTile"===u)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends we{constructor(f,o,u,g){super(f,o,u,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,h.ResourceType.Source).url);h.getVideo(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new h.ErrorEvent(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:we,canvas:class extends we{constructor(f,o,u,g){super(f,o,u,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends h.Evented{constructor(f,o,u,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Tr(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),h.extend(this,h.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:o,y:u,z:g}=f.canonical;return this._implementation.hasTile({x:o,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){const{x:u,y:g,z:v}=f.tileID.canonical,b=new h.window.AbortController,T=this._implementation.loadTile({x:u,y:g,z:v},{signal:b.signal});if(!T)return this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null);T.cancel=()=>b.abort(),f.request=T.then(function(D){return delete f.request,f.aborted?(f.state="unloaded",o(null)):D?(I=D)instanceof h.window.ImageData||I instanceof h.window.ImageBitmap||I instanceof h.window.HTMLCanvasElement?(this.loadTileData(f,D),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null));var I}.bind(this)).catch(D=>{20!==D.code&&(f.state="errored",o(D))})}loadTileData(f,o){se.loadTileData(f,o,this._map.painter)}unloadTileData(f){se.unloadTileData(f,this._map.painter)}prepareTile(f){if(!this._implementation.prepareTile)return null;const{x:o,y:u,z:g}=f.tileID.canonical,v=this._implementation.prepareTile({x:o,y:u,z:g});return v?(this.loadTileData(f,v),f.state="loaded",v):null}unloadTile(f,o){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_update(){this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}}},De=function(f,o,u,g){const v=new _e[o.type](f,o,u,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],v),v};function Ke(f,o){const u=h.identity([]);return h.scale(u,u,[.5*f.width,.5*-f.height,1]),h.translate(u,u,[1,-1,0]),h.multiply(u,u,f.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(u)}function ht(f,o,u,g,v,b,T,D=!1){const I=f.tilesIn(g,T,D);I.sort(Ut);const O=[];for(const B of I)O.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,f._state,B,v,b,Ke(f.transform,B.tile.tileID),D)});const R=function(B){const $={},Z={};for(const X of B){const G=X.queryResults,ie=X.wrappedTileID,W=Z[ie]=Z[ie]||{};for(const J in G){const q=G[J],ue=W[J]=W[J]||{},te=$[J]=$[J]||[];for(const oe of q)ue[oe.featureIndex]||(ue[oe.featureIndex]=!0,te.push(oe))}}return $}(O);for(const B in R)R[B].forEach($=>{const Z=$.feature,X=Z.layer;X&&"background"!==X.type&&"sky"!==X.type&&(Z.source=X.source,X["source-layer"]&&(Z.sourceLayer=X["source-layer"]),Z.state=void 0!==Z.id?f.getFeatureState(X["source-layer"],Z.id):{})});return R}function Qe(f,o){const u=f.getRenderableIds().map(b=>f.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const T=u[b],D=T.tileID.canonical.key;v[D]||(v[D]=!0,T.querySourceFeatures(g,o))}return g}function Ut(f,o){const u=f.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function tn(){return null!=Ja.workerClass?new Ja.workerClass:new h.window.Worker(Ja.workerUrl)}const Kt="mapboxgl_preloaded_worker_pool";class rn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<rn.workerCount;)this.workers.push(new tn);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kt]}numActive(){return Object.keys(this.active).length}}let bn;function Kn(){return bn||(bn=new rn),bn}function cr(f,o){const u={};for(const g in f)"ref"!==g&&(u[g]=f[g]);return h.refProperties.forEach(g=>{g in o&&(u[g]=o[g])}),u}function sr(f){f=f.slice();const o=Object.create(null);for(let u=0;u<f.length;u++)o[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=cr(f[u],o[f[u].ref]));return f}rn.workerCount=2;const be={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function po(f,o,u){u.push({command:be.addSource,args:[f,o[f]]})}function Lr(f,o,u){o.push({command:be.removeSource,args:[f]}),u[f]=!0}function $o(f,o,u,g){Lr(f,u,g),po(f,o,u)}function Kf(f,o,u){let g;for(g in f[u])if(f[u].hasOwnProperty(g)&&"data"!==g&&!H(f[u][g],o[u][g]))return!1;for(g in o[u])if(o[u].hasOwnProperty(g)&&"data"!==g&&!H(f[u][g],o[u][g]))return!1;return!0}function To(f,o,u,g,v,b){let T;for(T in o=o||{},f=f||{})f.hasOwnProperty(T)&&(H(f[T],o[T])||u.push({command:b,args:[g,T,o[T],v]}));for(T in o)o.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(H(f[T],o[T])||u.push({command:b,args:[g,T,o[T],v]}))}function xc(f){return f.id}function bp(f,o){return f[o.id]=o,f}class bc{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=h.clamp(o,0,1);let u=1,g=this._distances[u];const v=o*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,T=this._distances[b],D=g-T,I=D>0?(v-T)/D:0;return this.points[b].mult(1-I).add(this.points[u].mult(I))}}class ct{constructor(o,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(o,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,u,g,v,b,T){this.boxCells[b].push(T)}_insertCircleCell(o,u,g,v,b,T){this.circleCells[b].push(T)}_query(o,u,g,v,b,T){if(g<0||o>this.width||v<0||u>this.height)return!b&&[];const D=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)D.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const O=this.circles[3*I],R=this.circles[3*I+1],B=this.circles[3*I+2];D.push({key:this.circleKeys[I],x1:O-B,y1:R-B,x2:O+B,y2:R+B})}return T?D.filter(T):D}return this._forEachCell(o,u,g,v,this._queryCell,D,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?D.length>0:D}_queryCircle(o,u,g,v,b){const T=o-g,D=o+g,I=u-g,O=u+g;if(D<0||T>this.width||O<0||I>this.height)return!v&&[];const R=[];return this._forEachCell(T,I,D,O,this._queryCellCircle,R,{hitTest:v,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?R.length>0:R}query(o,u,g,v,b){return this._query(o,u,g,v,!1,b)}hitTest(o,u,g,v,b){return this._query(o,u,g,v,!0,b)}hitTestCircle(o,u,g,v){return this._queryCircle(o,u,g,!0,v)}_queryCell(o,u,g,v,b,T,D,I){const O=D.seenUids,R=this.boxCells[b];if(null!==R){const $=this.bboxes;for(const Z of R)if(!O.box[Z]){O.box[Z]=!0;const X=4*Z;if(o<=$[X+2]&&u<=$[X+3]&&g>=$[X+0]&&v>=$[X+1]&&(!I||I(this.boxKeys[Z]))){if(D.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:$[X],y1:$[X+1],x2:$[X+2],y2:$[X+3]})}}}const B=this.circleCells[b];if(null!==B){const $=this.circles;for(const Z of B)if(!O.circle[Z]){O.circle[Z]=!0;const X=3*Z;if(this._circleAndRectCollide($[X],$[X+1],$[X+2],o,u,g,v)&&(!I||I(this.circleKeys[Z]))){if(D.hitTest)return T.push(!0),!0;{const G=$[X],ie=$[X+1],W=$[X+2];T.push({key:this.circleKeys[Z],x1:G-W,y1:ie-W,x2:G+W,y2:ie+W})}}}}}_queryCellCircle(o,u,g,v,b,T,D,I){const O=D.circle,R=D.seenUids,B=this.boxCells[b];if(null!==B){const Z=this.bboxes;for(const X of B)if(!R.box[X]){R.box[X]=!0;const G=4*X;if(this._circleAndRectCollide(O.x,O.y,O.radius,Z[G+0],Z[G+1],Z[G+2],Z[G+3])&&(!I||I(this.boxKeys[X])))return T.push(!0),!0}}const $=this.circleCells[b];if(null!==$){const Z=this.circles;for(const X of $)if(!R.circle[X]){R.circle[X]=!0;const G=3*X;if(this._circlesCollide(Z[G],Z[G+1],Z[G+2],O.x,O.y,O.radius)&&(!I||I(this.circleKeys[X])))return T.push(!0),!0}}}_forEachCell(o,u,g,v,b,T,D,I){const O=this._convertToXCellCoord(o),R=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),$=this._convertToYCellCoord(v);for(let Z=O;Z<=B;Z++)for(let X=R;X<=$;X++)if(b.call(this,o,u,g,v,this.xCellCount*X+Z,T,D,I))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,v,b,T){const D=v-o,I=b-u,O=g+T;return O*O>D*D+I*I}_circleAndRectCollide(o,u,g,v,b,T,D){const I=(T-v)/2,O=Math.abs(o-(v+I));if(O>I+g)return!1;const R=(D-b)/2,B=Math.abs(u-(b+R));if(B>R+g)return!1;if(O<=I||B<=R)return!0;const $=O-I,Z=B-R;return $*$+Z*Z<=g*g}}const Gn=Math.tan(85*Math.PI/180);function cn(f,o,u,g,v,b,T){const D=h.create();if(u)if("globe"===b.name){const I=h.calculateGlobeLabelMatrix(v,o);h.multiply(D,D,I)}else{const I=Je([],T);D[0]=I[0],D[1]=I[1],D[4]=I[2],D[5]=I[3],g||h.rotateZ(D,D,v.angle)}else h.multiply(D,v.labelPlaneMatrix,f);return D}function rs(f,o,u,g,v,b,T){const D=cn(f,o,u,g,v,b,T);return"globe"===b.name&&u||(D[2]=D[6]=D[10]=D[14]=0),D}function Ns(f,o,u,g,v,b,T){if(u){if("globe"===b.name){const D=cn(f,o,u,g,v,b,T);return h.invert(D,D),h.multiply(D,f,D),D}{const D=h.clone(f),I=h.identity([]);return I[0]=T[0],I[1]=T[1],I[4]=T[2],I[5]=T[3],h.multiply(D,D,I),g||h.rotateZ(D,D,-v.angle),D}}return v.glCoordMatrix}function Bt(f,o,u=0){const g=[f.x,f.y,u,1];u?h.transformMat4$1(g,g,o):Wr(g,g,o);const v=g[3];return{point:[g[0]/v,g[1]/v,g[2]/v],signedDistanceFromCamera:v}}function is(f,o){const u=[f[0],f[1],f[2],1];h.transformMat4$1(u,u,o);const g=u[3];return{point:[u[0]/g,u[1]/g,u[2]/g],signedDistanceFromCamera:g}}function ur(f,o){return Math.min(.5+f/o*.5,1.5)}function La(f,o){const u=f[0]/f[3],g=f[1]/f[3];return u>=-o[0]&&u<=o[0]&&g>=-o[1]&&g<=o[1]}function Go(f,o,u,g,v,b,T,D,I,O){const R=u.transform,B=g?f.textSizeData:f.iconSizeData,$=h.evaluateSizeForZoom(B,u.transform.zoom),Z="globe"===R.projection.name,X=[256/u.width*2+1,256/u.height*2+1],G=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;G.clear();let ie=null;Z&&(ie=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const W=f.lineVertexArray,J=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,q=u.transform.width/u.transform.height;let ue=!1;for(let te=0;te<J.length;te++){const oe=J.get(te);if(oe.writingMode!==h.WritingMode.vertical||ue||0!==te&&J.get(te-1).writingMode===h.WritingMode.horizontal||(ue=!0),(oe.hidden||oe.writingMode===h.WritingMode.vertical)&&!ue){pn(oe.numGlyphs,G);continue}ue=!1;const pe=new h.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),Pe=I?I(pe):[0,0,0],Be=R.projection.projectTilePoint(pe.x,pe.y,O.canonical),ke=[Be.x+Pe[0],Be.y+Pe[1],Be.z+Pe[2]],at=[...ke,1];if(h.transformMat4$1(at,at,o),!La(at,X)){pn(oe.numGlyphs,G);continue}const ae=ur(u.transform.cameraToCenterDistance,at[3]),Ie=h.evaluateSizeForFeature(B,$,oe),Ze=T?Ie/ae:Ie*ae,bt=Bt(new h.pointGeometry(ke[0],ke[1]),v,ke[2]);if(bt.signedDistanceFromCamera<=0){pn(oe.numGlyphs,G);continue}let qe={};const Rt=T?null:I,mt=ha(oe,Ze,!1,D,o,v,b,f.glyphOffsetArray,W,G,ie,bt.point,pe,qe,q,Rt,R.projection,O,T);ue=mt.useVertical,Rt&&mt.needsFlipping&&(qe={}),(mt.notEnoughRoom||ue||mt.needsFlipping&&ha(oe,Ze,!0,D,o,v,b,f.glyphOffsetArray,W,G,ie,bt.point,pe,qe,q,Rt,R.projection,O,T).notEnoughRoom)&&pn(oe.numGlyphs,G)}g?(f.text.dynamicLayoutVertexBuffer.updateData(G),ie&&f.text.globeExtVertexBuffer.updateData(ie)):(f.icon.dynamicLayoutVertexBuffer.updateData(G),ie&&f.icon.globeExtVertexBuffer.updateData(ie))}function dn(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G){const ie=D.glyphStartIndex+D.numGlyphs,W=D.lineStartIndex,J=D.lineStartIndex+D.lineLength,q=o.getoffsetX(D.glyphStartIndex),ue=o.getoffsetX(ie-1),te=Vs(f*q,u,g,v,b,T,D.segment,W,J,I,O,R,B,$,!0,Z,X,G);if(!te)return null;const oe=Vs(f*ue,u,g,v,b,T,D.segment,W,J,I,O,R,B,$,!0,Z,X,G);return oe?{first:te,last:oe}:null}function yn(f,o,u,g){return f.writingMode===h.WritingMode.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*g?{useVertical:!0}:f.writingMode===h.WritingMode.vertical?o.y<u.y?{needsFlipping:!0}:null:0!==f.flipState&&function(v,b,T){const D=(b.x-v.x)*T;return 0===D||Math.abs((b.y-v.y)/D)>Gn}(o,u,g)?1===f.flipState?{needsFlipping:!0}:null:o.x>u.x?{needsFlipping:!0}:null}function ha(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G,ie,W,J){const q=o/24,ue=f.lineOffsetX*q,te=f.lineOffsetY*q;let oe;if(f.numGlyphs>1){const pe=f.glyphStartIndex+f.numGlyphs,Pe=f.lineStartIndex,Be=f.lineStartIndex+f.lineLength,ke=dn(q,D,ue,te,u,B,$,f,I,b,Z,G,!1,ie,W,J);if(!ke)return{notEnoughRoom:!0};const at=is(ke.first.point,T).point,ae=is(ke.last.point,T).point,Ie=new h.pointGeometry(at[0],at[1]),Ze=new h.pointGeometry(ae[0],ae[1]);if(g&&!u){const bt=yn(f,Ie,Ze,X);if(f.flipState=bt&&bt.needsFlipping?1:2,bt)return bt}oe=[ke.first];for(let bt=f.glyphStartIndex+1;bt<pe-1;bt++)oe.push(Vs(q*D.getoffsetX(bt),ue,te,u,B,$,f.segment,Pe,Be,I,b,Z,G,!1,!1,ie,W,J));oe.push(ke.last)}else{if(g&&!u){const Pe=Bt($,v).point,Be=f.lineStartIndex+f.segment+1,ke=new h.pointGeometry(I.getx(Be),I.gety(Be)),at=Bt(ke,v),ae=at.signedDistanceFromCamera>0?at.point:En($,ke,Pe,1,v,void 0,ie,W.canonical),Ie=yn(f,new h.pointGeometry(Pe[0],Pe[1]),new h.pointGeometry(ae[0],ae[1]),X);if(f.flipState=Ie&&Ie.needsFlipping?1:2,Ie)return Ie}const pe=Vs(q*D.getoffsetX(f.glyphStartIndex),ue,te,u,B,$,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,I,b,Z,G,!1,!1,ie,W,J);if(!pe)return{notEnoughRoom:!0};oe=[pe]}if(R)for(const pe of oe)h.updateGlobeVertexNormal(R,O.length+0,pe.up[0],pe.up[1],pe.up[2]),h.updateGlobeVertexNormal(R,O.length+1,pe.up[0],pe.up[1],pe.up[2]),h.updateGlobeVertexNormal(R,O.length+2,pe.up[0],pe.up[1],pe.up[2]),h.updateGlobeVertexNormal(R,O.length+3,pe.up[0],pe.up[1],pe.up[2]),h.addDynamicAttributes(O,pe.point[0],pe.point[1],pe.point[2],pe.angle);else for(const pe of oe)h.addDynamicAttributes(O,pe.point[0],pe.point[1],pe.point[2],pe.angle);return{}}function od(f,o,u,g,v){const b=g.projectTilePoint(f.x,f.y,o);if(!v)return Bt(b,u,b.z);const T=v(f);return Bt(new h.pointGeometry(b.x+T[0],b.y+T[1]),u,b.z+T[2])}function En(f,o,u,g,v,b,T,D){const I=od(f.add(f.sub(o)._unit()),D,v,T,b).point,O=h.sub([],u,I);return h.scaleAndAdd([],u,O,g/h.length(O))}function Vs(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G,ie,W){const J=g?f-o:f+o;let q=J>0?1:-1,ue=0;g&&(q*=-1,ue=Math.PI),q<0&&(ue+=Math.PI);let te=q>0?D+T:D+T+1,oe=v,pe=v,Pe=0,Be=0;const ke=Math.abs(J),at=[],ae=[];let Ie=b;const Ze=()=>{const Nt=te-q;return 0===Pe?b:new h.pointGeometry(O.getx(Nt),O.gety(Nt))},bt=()=>En(Ze(),Ie,pe,ke-Pe+1,R,$,G,ie.canonical);for(;Pe+Be<=ke;){if(te+=q,te<D||te>=I)return null;if(pe=oe,at.push(oe),Z&&ae.push(Ie||Ze()),oe=B[te],void 0===oe){Ie=new h.pointGeometry(O.getx(te),O.gety(te));const Nt=od(Ie,ie.canonical,R,G,$);oe=Nt.signedDistanceFromCamera>0?B[te]=Nt.point:bt()}else Ie=null;Pe+=Be,Be=h.distance(pe,oe)}Ie=Ie||new h.pointGeometry(O.getx(te),O.gety(te));const qe=Ze();X&&$&&(B[te]=oe=void 0===B[te]?oe:bt(),Be=h.distance(pe,oe));const Rt=(ke-Pe)/Be,mt=Ie.sub(qe).mult(Rt)._add(qe),vt=h.sub([],oe,pe),_t=h.scaleAndAdd([],pe,vt,Rt);let gt=[0,0,1],It=vt[0],Jt=vt[1];if(W&&(gt=G.upVector(ie.canonical,mt.x,mt.y),0!==gt[0]||0!==gt[1]||1!==gt[2])){const Nt=[1,0,0],ln=[0,1,0];Nt[0]=gt[2],Nt[1]=0,Nt[2]=-gt[0],h.cross(ln,gt,Nt),h.normalize(Nt,Nt),h.normalize(ln,ln),It=h.dot(vt,Nt),Jt=h.dot(vt,ln)}if(u){const Nt=h.cross([],gt,vt);h.normalize(Nt,Nt),h.scaleAndAdd(_t,_t,Nt,u*q)}const mn=ue+Math.atan2(Jt,It);return at.push(_t),Z&&ae.push(mt),{point:_t,angle:mn,path:at,tilePath:ae,up:gt}}const Sn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pn(f,o){for(let u=0;u<f;u++){const g=o.length;o.resize(g+4),o.float32.set(Sn,4*g)}}function Wr(f,o,u){const g=o[0],v=o[1];return f[0]=u[0]*g+u[4]*v+u[12],f[1]=u[1]*g+u[5]*v+u[13],f[3]=u[3]*g+u[7]*v+u[15],f}const os=100;class sd{constructor(o,u,g=new ct(o.width+200,o.height+200,25),v=new ct(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+os,this.screenBottomBoundary=o.height+os,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,g,v,b,T,D,I){let O=g.projectedAnchorX,R=g.projectedAnchorY,B=g.projectedAnchorZ;const $=g.elevation,Z=g.tileID;if($&&Z){const te=o.getProjection().upVector(Z.canonical,g.tileAnchorX,g.tileAnchorY),oe=o.getProjection().upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=te[0]*$*oe,R+=te[1]*$*oe,B+=te[2]*$*oe}const X=this.projectAndGetPerspectiveRatio(D,[O,R,B],g.tileID,"globe"===o.projection.name||!!$||this.transform.pitch>0,o.getProjection()),G=T*X.perspectiveRatio,ie=(g.x1*u+v.x-g.padding)*G+X.point.x,W=(g.y1*u+v.y-g.padding)*G+X.point.y,J=(g.x2*u+v.x+g.padding)*G+X.point.x,q=(g.y2*u+v.y+g.padding)*G+X.point.y,ue=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(ie,W,J,q)||!b&&this.grid.hitTest(ie,W,J,q,I)||ue?{box:[],offscreen:!1,occluded:X.occluded}:{box:[ie,W,J,q],offscreen:this.isOffscreen(ie,W,J,q),occluded:!1}}placeCollisionCircles(o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G){const ie=[],W=this.transform.elevation,J=W?W.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,o.getProjection()):qe=>[0,0,0],q=new h.pointGeometry(g.tileAnchorX,g.tileAnchorY),ue=o.getProjection().projectTilePoint(g.tileAnchorX,g.tileAnchorY,G.canonical),te=J(q),oe=[ue.x+te[0],ue.y+te[1],ue.z+te[2]],pe="globe"===o.projection.name,Pe=this.projectAndGetPerspectiveRatio(D,[oe[0],oe[1],oe[2]],G,pe||!!W||this.transform.pitch>0,o.getProjection()),{perspectiveRatio:Be}=Pe,ke=(B?T/Be:T*Be)/h.ONE_EM,at=Bt(new h.pointGeometry(oe[0],oe[1]),I,oe[2]).point,ae=Pe.signedDistanceFromCamera>0?dn(ke,b,g.lineOffsetX*ke,g.lineOffsetY*ke,!1,at,q,g,v,I,{},W&&!B?J:null,B&&!!W,o.getProjection(),G,B):null;let Ie=!1,Ze=!1,bt=!0;if(ae&&!Pe.occluded){const qe=.5*Z*Be+X,Rt=new h.pointGeometry(-100,-100),mt=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),vt=new bc,_t=ae.first,gt=ae.last;let It=[];for(let Nt=_t.path.length-1;Nt>=1;Nt--)It.push(_t.path[Nt]);for(let Nt=1;Nt<gt.path.length;Nt++)It.push(gt.path[Nt]);const Jt=2.5*qe;if(O){const Nt=It.map(W&&!pe?(ln,Qn)=>{const Mr=J(Qn<_t.path.length-1?_t.tilePath[_t.path.length-1-Qn]:gt.tilePath[Qn-_t.path.length+2]);return ln[2]=Mr[2],is(ln,O)}:ln=>is(ln,O));It=Nt.some(ln=>ln.signedDistanceFromCamera<=0)?[]:Nt.map(ln=>ln.point)}let mn=[];if(It.length>0){const Nt=It.map(mr=>new h.pointGeometry(mr[0],mr[1]));let ln=1/0,Qn=-1/0,Mr=1/0,Sr=-1/0;for(let mr=0;mr<Nt.length;mr++)ln=Math.min(ln,Nt[mr].x),Mr=Math.min(Mr,Nt[mr].y),Qn=Math.max(Qn,Nt[mr].x),Sr=Math.max(Sr,Nt[mr].y);mn=ln>=Rt.x&&Qn<=mt.x&&Mr>=Rt.y&&Sr<=mt.y?[Nt]:Qn<Rt.x||ln>mt.x||Sr<Rt.y||Mr>mt.y?[]:h.clipLine([Nt],Rt.x,Rt.y,mt.x,mt.y)}for(const Nt of mn){vt.reset(Nt,.25*qe);let ln=0;ln=vt.length<=.5*qe?1:Math.ceil(vt.paddedLength/Jt)+1;for(let Qn=0;Qn<ln;Qn++){const Mr=Qn/Math.max(ln-1,1),Sr=vt.lerp(Mr),mr=Sr.x+os,fo=Sr.y+os;ie.push(mr,fo,qe,0);const Ci=mr-qe,Xs=fo-qe,gr=mr+qe,Ir=fo+qe;if(bt=bt&&this.isOffscreen(Ci,Xs,gr,Ir),Ze=Ze||this.isInsideGrid(Ci,Xs,gr,Ir),!u&&this.grid.hitTestCircle(mr,fo,qe,$)&&(Ie=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!R&&Ie||!Ze?[]:ie,offscreen:bt,collisionDetected:Ie,occluded:Pe.occluded}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,T=-1/0;for(const R of o){const B=new h.pointGeometry(R.x+os,R.y+os);g=Math.min(g,B.x),v=Math.min(v,B.y),b=Math.max(b,B.x),T=Math.max(T,B.y),u.push(B)}const D=this.grid.query(g,v,b,T).concat(this.ignoredGrid.query(g,v,b,T)),I={},O={};for(const R of D){const B=R.key;if(void 0===I[B.bucketInstanceId]&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const $=[new h.pointGeometry(R.x1,R.y1),new h.pointGeometry(R.x2,R.y1),new h.pointGeometry(R.x2,R.y2),new h.pointGeometry(R.x1,R.y2)];h.polygonIntersectsPolygon(u,$)&&(I[B.bucketInstanceId][B.featureIndex]=!0,void 0===O[B.bucketInstanceId]&&(O[B.bucketInstanceId]=[]),O[B.bucketInstanceId].push(B.featureIndex))}return O}insertCollisionBox(o,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,v,b){const T=u?this.ignoredGrid:this.grid,D={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let I=0;I<o.length;I+=4)T.insertCircle(D,o[I],o[I+1],o[I+2])}projectAndGetPerspectiveRatio(o,u,g,v,b){const T=[u[0],u[1],u[2],1];let D=!1;if(u[2]||this.transform.pitch>0){h.transformMat4$1(T,T,o);const I="globe"===b.name;this.fogState&&g&&!I&&(D=function(O,R,B,$,Z,X){const G=X.calculateFogTileMatrix(Z),ie=[R,B,$];return h.transformMat4(ie,ie,G),on(O,ie,X.pitch,X._fov)}(this.fogState,u[0],u[1],u[2],g.toUnwrapped(),this.transform)>.9)}else Wr(T,T,o);return{point:new h.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+os,(-T[1]/T[3]+1)/2*this.transform.height+os),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:v&&T[2]>T[3]||D}}isOffscreen(o,u,g,v){return g<os||o>=this.screenRightBoundary||v<os||u>this.screenBottomBoundary}isInsideGrid(o,u,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=h.identity([]);return h.translate(o,o,[-100,-100,0]),o}}function vi(f,o,u){const g=o.createTileMatrix(f,f.worldSize,u.toUnwrapped());return h.multiply(new Float32Array(16),f.projMatrix,g)}function jr(f,o,u){if(o.projection.name===u.projection.name)return f.projMatrix;const g=u.clone();return g.setProjection(o.projection),vi(g,o.getProjection(),f)}function ad(f,o,u){return o.name===u.projection.name?f.projMatrix:vi(u,o,f)}class wc{constructor(o,u,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Xr{constructor(o,u,g,v,b,T=!1){this.text=new wc(o?o.text:null,u,g,b),this.icon=new wc(o?o.icon:null,u,v,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class to{constructor(o,u,g,v=!1){this.text=o,this.icon=u,this.skipFade=g,this.clipped=v}}class wp{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Hu{constructor(o,u,g,v,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Vi{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function ld(f,o,u,g,v){const{horizontalAlign:b,verticalAlign:T}=h.getAnchorAlignment(f),D=-(b-.5)*o,I=-(T-.5)*u,O=h.evaluateVariableOffset(f,g);return new h.pointGeometry(D+O[0]*v,I+O[1]*v)}function Cc(f,o,u,g,v){const b=new h.pointGeometry(f,o);return u&&b._rotate(g?v:-v),b}class da{constructor(o,u,g,v,b){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new sd(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Vi(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,g,v){const b=g.getBucket(u),T=g.latestFeatureIndex;if(!b||!T||u.id!==b.layerIds[0])return;const D=b.layers[0].layout,I=g.collisionBoxArray,O=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),R=g.tileSize/h.EXTENT,B=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const $=(Z=g.tileID,X=b.getProjection(),G=this.transform,X.name===this.projection?G.calculateProjMatrix(Z.toUnwrapped()):vi(G,X,Z));var Z,X,G;const ie="map"===D.get("text-pitch-alignment"),W="map"===D.get("text-rotation-alignment");u.compileFilter();const J=u.dynamicFilter(),q=u.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(g),te=rs($,g.tileID.canonical,ie,W,this.transform,b.getProjection(),ue);let oe=null;if(ie){const Be=Ns($,g.tileID.canonical,ie,W,this.transform,b.getProjection(),ue);oe=h.multiply([],this.transform.labelPlaneMatrix,Be)}let pe=null;J&&g.latestFeatureIndex&&(pe={unwrappedTileID:B,dynamicFilter:J,dynamicFilterNeedsFeature:q,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Hu(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,g.tileID);const Pe={bucket:b,layout:D,posMatrix:$,textLabelPlaneMatrix:te,labelToScreenMatrix:oe,clippingData:pe,scale:O,textPixelRatio:R,holdingForFade:g.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Be of b.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:at,symbolInstanceEnd:ae}=Be;o.push({sortKey:ke,symbolInstanceStart:at,symbolInstanceEnd:ae,parameters:Pe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G,ie,W,J){const q=[$.textOffset0,$.textOffset1],ue=ld(o,g,v,q,b),te=this.collisionIndex.placeCollisionBox(X,b,u,Cc(ue.x,ue.y,T,D,this.transform.angle),B,I,O,R.predicate);if((!ie||0!==this.collisionIndex.placeCollisionBox(X,X.getSymbolInstanceIconSize(J,this.transform.zoom,Z),ie,Cc(ue.x,ue.y,T,D,this.transform.angle),B,I,O,R.predicate).box.length)&&te.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:q,width:g,height:v,anchor:o,textScale:b,prevAnchor:oe},this.markUsedJustification(X,o,$,G),X.allowVerticalPlacement&&(this.markUsedOrientation(X,G,$),this.placedOrientations[$.crossTileID]=G),{shift:ue,placedGlyphBoxes:te}}}placeLayerBucketPart(o,u,g,v){const{bucket:b,layout:T,posMatrix:D,textLabelPlaneMatrix:I,labelToScreenMatrix:O,clippingData:R,textPixelRatio:B,holdingForFade:$,collisionBoxArray:Z,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:G,collisionGroup:ie}=o.parameters,W=T.get("text-optional"),J=T.get("icon-optional"),q=T.get("text-allow-overlap"),ue=T.get("icon-allow-overlap"),te="map"===T.get("text-rotation-alignment"),oe="map"===T.get("text-pitch-alignment"),pe="none"!==T.get("icon-text-fit"),Pe="viewport-y"===T.get("symbol-z-order");this.transform.setProjection(b.projection);let Be=q&&(ue||!b.hasIconData()||J),ke=ue&&(q||!b.hasTextData()||W);!b.collisionArrays&&Z&&b.deserializeCollisionBoxes(Z),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Z);const at=(ae,Ie,Ze)=>{if(R){const gr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ir=null;if(R.dynamicFilterNeedsFeature){const Zn=this.retainedQueryData[b.bucketInstanceId];Ir=R.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Zn.bucketIndex,sourceLayerIndex:Zn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(gr,Ir,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new h.pointGeometry(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[ae.crossTileID]=new to(!1,!1,!1,!0),void(u[ae.crossTileID]=!0)}if(u[ae.crossTileID])return;if($)return void(this.placements[ae.crossTileID]=new to(!1,!1,!1));let bt=!1,qe=!1,Rt=!0,mt=!1,vt=!1,_t=null,gt={box:null,offscreen:null,occluded:null},It={box:null,offscreen:null,occluded:null},Jt=null,mn=null,Nt=null,ln=0,Qn=0,Mr=0;Ze.textFeatureIndex?ln=Ze.textFeatureIndex:ae.useRuntimeCollisionCircles&&(ln=ae.featureIndex),Ze.verticalTextFeatureIndex&&(Qn=Ze.verticalTextFeatureIndex);const Sr=gr=>{gr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||gr.elevation)&&(gr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,gr.tileAnchorX,gr.tileAnchorY):0)},mr=Ze.textBox;if(mr){Sr(mr);const gr=Zn=>{let $r=h.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Zn&&this.prevPlacement){const Ei=this.prevPlacement.placedOrientations[ae.crossTileID];Ei&&(this.placedOrientations[ae.crossTileID]=Ei,$r=Ei,this.markUsedOrientation(b,$r,ae))}return $r},Ir=(Zn,$r)=>{if(b.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&Ze.verticalTextBox){for(const Ei of b.writingModes)if(Ei===h.WritingMode.vertical?(gt=$r(),It=gt):gt=Zn(),gt&&gt.box&&gt.box.length)break}else gt=Zn()};if(T.get("text-variable-anchor")){let Zn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ae.crossTileID]){const wr=this.prevPlacement.variableOffsets[ae.crossTileID];Zn.indexOf(wr.anchor)>0&&(Zn=Zn.filter(zr=>zr!==wr.anchor),Zn.unshift(wr.anchor))}const $r=(wr,zr,_a)=>{const as=b.getSymbolInstanceTextSize(X,ae,this.transform.zoom,Ie),Qa=(wr.x2-wr.x1)*as+2*wr.padding,el=(wr.y2-wr.y1)*as+2*wr.padding,ls=pe&&!ue?zr:null;ls&&Sr(ls);let pi={box:[],offscreen:!1,occluded:!1};const ko=q?2*Zn.length:Zn.length;for(let cs=0;cs<ko;++cs){const ya=this.attemptAnchorPlacement(Zn[cs%Zn.length],wr,Qa,el,as,te,oe,B,D,ie,cs>=Zn.length,ae,Ie,b,_a,ls,X,G);if(ya&&(pi=ya.placedGlyphBoxes,pi&&pi.box&&pi.box.length)){bt=!0,_t=ya.shift;break}}return pi};Ir(()=>$r(mr,Ze.iconBox,h.WritingMode.horizontal),()=>{const wr=Ze.verticalTextBox;return wr&&Sr(wr),b.allowVerticalPlacement&&!(gt&&gt.box&&gt.box.length)&&ae.numVerticalGlyphVertices>0&&wr?$r(wr,Ze.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),gt&&(bt=gt.box,Rt=gt.offscreen,mt=gt.occluded);const Ei=gr(gt&&gt.box);if(!bt&&this.prevPlacement){const wr=this.prevPlacement.variableOffsets[ae.crossTileID];wr&&(this.variableOffsets[ae.crossTileID]=wr,this.markUsedJustification(b,wr.anchor,ae,Ei))}}else{const Zn=($r,Ei)=>{const wr=b.getSymbolInstanceTextSize(X,ae,this.transform.zoom,Ie),zr=this.collisionIndex.placeCollisionBox(b,wr,$r,new h.pointGeometry(0,0),q,B,D,ie.predicate);return zr&&zr.box&&zr.box.length&&(this.markUsedOrientation(b,Ei,ae),this.placedOrientations[ae.crossTileID]=Ei),zr};Ir(()=>Zn(mr,h.WritingMode.horizontal),()=>{const $r=Ze.verticalTextBox;return b.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&$r?(Sr($r),Zn($r,h.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),gr(gt&&gt.box&&gt.box.length)}}if(Jt=gt,bt=Jt&&Jt.box&&Jt.box.length>0,Rt=Jt&&Jt.offscreen,mt=Jt&&Jt.occluded,ae.useRuntimeCollisionCircles){const gr=b.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),Ir=h.evaluateSizeForFeature(b.textSizeData,X,gr),Zn=T.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(b,q,gr,b.lineVertexArray,b.glyphOffsetArray,Ir,D,I,O,g,oe,ie.predicate,ae.collisionCircleDiameter*Ir/h.ONE_EM,Zn,this.retainedQueryData[b.bucketInstanceId].tileID),bt=q||mn.circles.length>0&&!mn.collisionDetected,Rt=Rt&&mn.offscreen,mt=mn.occluded}if(Ze.iconFeatureIndex&&(Mr=Ze.iconFeatureIndex),Ze.iconBox){const gr=Ir=>{Sr(Ir);const Zn=pe&&_t?Cc(_t.x,_t.y,te,oe,this.transform.angle):new h.pointGeometry(0,0),$r=b.getSymbolInstanceIconSize(G,this.transform.zoom,Ie);return this.collisionIndex.placeCollisionBox(b,$r,Ir,Zn,ue,B,D,ie.predicate)};It&&It.box&&It.box.length&&Ze.verticalIconBox?(Nt=gr(Ze.verticalIconBox),qe=Nt.box.length>0):(Nt=gr(Ze.iconBox),qe=Nt.box.length>0),Rt=Rt&&Nt.offscreen,vt=Nt.occluded}const fo=W||0===ae.numHorizontalGlyphVertices&&0===ae.numVerticalGlyphVertices,Ci=J||0===ae.numIconVertices;if(fo||Ci?Ci?fo||(qe=qe&&bt):bt=qe&&bt:qe=bt=qe&&bt,bt&&Jt&&Jt.box&&this.collisionIndex.insertCollisionBox(Jt.box,T.get("text-ignore-placement"),b.bucketInstanceId,It&&It.box&&Qn?Qn:ln,ie.ID),qe&&Nt&&this.collisionIndex.insertCollisionBox(Nt.box,T.get("icon-ignore-placement"),b.bucketInstanceId,Mr,ie.ID),mn&&(bt&&this.collisionIndex.insertCollisionCircles(mn.circles,T.get("text-ignore-placement"),b.bucketInstanceId,ln,ie.ID),g)){const gr=b.bucketInstanceId;let Ir=this.collisionCircleArrays[gr];void 0===Ir&&(Ir=this.collisionCircleArrays[gr]=new wp);for(let Zn=0;Zn<mn.circles.length;Zn+=4)Ir.circles.push(mn.circles[Zn+0]),Ir.circles.push(mn.circles[Zn+1]),Ir.circles.push(mn.circles[Zn+2]),Ir.circles.push(mn.collisionDetected?1:0)}const Xs="globe"!==b.projection.name;Be=Be&&(Xs||!mt),ke=ke&&(Xs||!vt),this.placements[ae.crossTileID]=new to(bt||Be,qe||ke,Rt||b.justReloaded),u[ae.crossTileID]=!0};if(Pe){const ae=b.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ae.length-1;Ie>=0;--Ie){const Ze=ae[Ie];at(b.symbolInstances.get(Ze),Ze,b.collisionArrays[Ze])}}else for(let ae=o.symbolInstanceStart;ae<o.symbolInstanceEnd;ae++)at(b.symbolInstances.get(ae),ae,b.collisionArrays[ae]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[b.bucketInstanceId];h.invert(ae.invProjMatrix,D),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,u,g,v){let b;b=v===h.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(u)];const T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const D of T)D>=0&&(o.text.placedSymbolArray.get(D).crossTileID=b>=0&&D!==b?0:g.crossTileID)}markUsedOrientation(o,u,g){const v=u===h.WritingMode.horizontal||u===h.WritingMode.horizontalOnly?u:0,b=u===h.WritingMode.vertical?u:0,T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const D of T)o.text.placedSymbolArray.get(D).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},T=u?u.variableOffsets:{},D=u?u.placedOrientations:{};for(const I in this.placements){const O=this.placements[I],R=b[I];R?(this.opacities[I]=new Xr(R,v,O.text,O.icon,null,O.clipped),g=g||O.text!==R.text.placed||O.icon!==R.icon.placed):(this.opacities[I]=new Xr(null,v,O.text,O.icon,O.skipFade,O.clipped),g=g||O.text||O.icon)}for(const I in b){const O=b[I];if(!this.opacities[I]){const R=new Xr(O,v,!1,!1);R.isHidden()||(this.opacities[I]=R,g=g||O.text.placed||O.icon.placed)}}for(const I in T)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=T[I]);for(const I in D)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=D[I]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const g={};for(const v of u){const b=v.getBucket(o);b&&v.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(o,u,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),T=new Xr(null,0,!1,!1,!0),D=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),O=v.get("text-variable-anchor"),R="map"===v.get("text-rotation-alignment"),B="map"===v.get("text-pitch-alignment"),$="none"!==v.get("icon-text-fit"),Z=new Xr(null,0,D&&(I||!o.hasIconData()||v.get("icon-optional")),I&&(D||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const X=(ie,W,J)=>{for(let q=0;q<W/4;q++)ie.opacityVertexArray.emplaceBack(J)};let G=0;for(let ie=0;ie<o.symbolInstances.length;ie++){const W=o.symbolInstances.get(ie),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:q,crossTileID:ue}=W;let te=this.opacities[ue];u[ue]?te=T:te||(te=Z,this.opacities[ue]=te),u[ue]=!0;const oe=J>0||q>0,pe=W.numIconVertices>0,Pe=this.placedOrientations[W.crossTileID],Be=Pe===h.WritingMode.vertical,ke=Pe===h.WritingMode.horizontal||Pe===h.WritingMode.horizontalOnly;if(!oe&&!pe||te.isHidden()||G++,oe){const at=fa(te.text);X(o.text,J,Be?xi:at),X(o.text,q,ke?xi:at);const ae=te.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(bt=>{bt>=0&&(o.text.placedSymbolArray.get(bt).hidden=ae||Be?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=ae||ke?1:0);const Ie=this.variableOffsets[W.crossTileID];Ie&&this.markUsedJustification(o,Ie.anchor,W,Pe);const Ze=this.placedOrientations[W.crossTileID];Ze&&(this.markUsedJustification(o,"left",W,Ze),this.markUsedOrientation(o,Ze,W))}if(pe){const at=fa(te.icon);W.placedIconSymbolIndex>=0&&(X(o.icon,W.numIconVertices,Be?xi:at),o.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=te.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(o.icon,W.numVerticalIconVertices,ke?xi:at),o.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const at=o.collisionArrays[ie];if(at){let ae=new h.pointGeometry(0,0),Ie=!0;if(at.textBox||at.verticalTextBox){if(O){const bt=this.variableOffsets[ue];bt?(ae=ld(bt.anchor,bt.width,bt.height,bt.textOffset,bt.textScale),R&&ae._rotate(B?this.transform.angle:-this.transform.angle)):Ie=!1}b&&(Ie=!te.clipped),at.textBox&&pa(o.textCollisionBox.collisionVertexArray,te.text.placed,!Ie||Be,ae.x,ae.y),at.verticalTextBox&&pa(o.textCollisionBox.collisionVertexArray,te.text.placed,!Ie||ke,ae.x,ae.y)}const Ze=Ie&&Boolean(!ke&&at.verticalIconBox);at.iconBox&&pa(o.iconCollisionBox.collisionVertexArray,te.icon.placed,Ze,$?ae.x:0,$?ae.y:0),at.verticalIconBox&&pa(o.iconCollisionBox.collisionVertexArray,te.icon.placed,!Ze,$?ae.x:0,$?ae.y:0)}}}if(o.fullyClipped=0===G,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ie.invProjMatrix,o.placementViewportMatrix=ie.viewportMatrix,o.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function pa(f,o,u,g,v){f.emplaceBack(o?1:0,u?1:0,g||0,v||0),f.emplaceBack(o?1:0,u?1:0,g||0,v||0),f.emplaceBack(o?1:0,u?1:0,g||0,v||0),f.emplaceBack(o?1:0,u?1:0,g||0,v||0)}const cd=Math.pow(2,25),Do=Math.pow(2,24),hr=Math.pow(2,17),Ec=Math.pow(2,16),s_=Math.pow(2,9),Jf=Math.pow(2,8),sn=Math.pow(2,1);function fa(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const o=f.placed?1:0,u=Math.floor(127*f.opacity);return u*cd+o*Do+u*hr+o*Ec+u*s_+o*Jf+u*sn+o}const xi=0;class xs{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,g,v,b){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(T,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((D,I)=>D.sortKey-I.sortKey));this._currentPartIndex<T.length;){const D=T[this._currentPartIndex];if(u.placeLayerBucketPart(D,this._seenCrossTileIDs,g,0===D.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class qu{constructor(o,u,g,v,b,T,D,I){this.placement=new da(o,b,T,D,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g){const v=h.exported.now(),b=()=>{const T=h.exported.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=u[o[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=D)&&(!T.maxzoom||T.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new xs(T)),this._inProgressLayer.continuePlacement(g[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Zu=512/h.EXTENT/2;class Qf{constructor(o,u,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const b=u.get(v),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,u){const g=Zu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*h.EXTENT+o.tileAnchorX)*g),y:Math.floor((u.canonical.y*h.EXTENT+o.tileAnchorY)*g)}}findMatches(o,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const T=o.get(b);if(T.crossTileID)continue;const D=this.indexedSymbolInstances[T.key];if(!D)continue;const I=this.getScaledCoordinates(T,u);for(const O of D)if(Math.abs(O.coord.x-I.x)<=v&&Math.abs(O.coord.y-I.y)<=v&&!g[O.crossTileID]){g[O.crossTileID]=!0,T.crossTileID=O.crossTileID;break}}}}class Cp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const T in v){const D=v[T];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+u),b[D.tileID.key]=D}this.indexes[g]=b}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const v=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>o.overscaledZ)for(const D in T){const I=T[D];I.tileID.isChildOf(o)&&I.findMatches(u.symbolInstances,o,v)}else{const D=T[o.scaledTo(Number(b)).key];D&&D.findMatches(u.symbolInstances,o,v)}}for(let b=0;b<u.symbolInstances.length;b++){const T=u.symbolInstances.get(b);T.crossTileID||(T.crossTileID=g.generate(),v[T.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Qf(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][v.crossTileID]}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)o[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class Wu{constructor(){this.layerIndexes={},this.crossTileIDs=new Cp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g,v){let b=this.layerIndexes[o.id];void 0===b&&(b=this.layerIndexes[o.id]=new Il);let T=!1;const D={};"globe"!==v.name&&b.handleWrapJump(g);for(const I of u){const O=I.getBucket(o);O&&o.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,O,this.crossTileIDs)&&(T=!0),D[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(D)&&(T=!0),T}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Al=(f,o)=>h.emitValidationErrors(f,o&&o.filter(u=>"source.canvas"!==u.identifier)),em=h.pick(be,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),fn=h.pick(be,["setCenter","setZoom","setBearing","setPitch"]),ud={version:8,layers:[],sources:{}},hd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ui extends h.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new Xn(Kn(),this),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(o._requestManager,u.localFontFamily?h.LocalGlyphMode.all:u.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new Wu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const g=this;this._rtlTextPluginCallback=ui.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,T)=>{if(h.triggerPluginCompletionEvent(b),T&&T.every(D=>D))for(const D in g._sourceCaches){const I=g._sourceCaches[D],O=I.getSource().type;"vector"!==O&&"geojson"!==O||I.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const D=this._layers[T];D.source===b.id&&this._validateLayer(D)}})}loadURL(o,u={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!h.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,u.accessToken);const v=this.map._requestManager.transformRequest(o,h.ResourceType.Style);this._request=h.getJSON(v,(b,T)=>{this._request=null,b?this.fire(new h.ErrorEvent(b)):T&&this._load(T,g)})}loadJSON(o,u={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(o,!1!==u.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(ud,!1)}_updateLayerCount(o,u){const g=u?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,u){if(u&&Al(this,h.validateStyle(o)))return;this._loaded=!0,this.stylesheet=h.clone$1(o),this._updateMapProjection();for(const v in o.sources)this.addSource(v,o.sources[v],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=sr(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=h.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(u,g,v){let b,T,D;const I=h.exported.devicePixelRatio>1?"@2x":"";let O=h.getJSON(g.transformRequest(g.normalizeSpriteURL(u,I,".json"),h.ResourceType.SpriteJSON),($,Z)=>{O=null,D||(D=$,b=Z,B())}),R=h.getImage(g.transformRequest(g.normalizeSpriteURL(u,I,".png"),h.ResourceType.SpriteImage),($,Z)=>{R=null,D||(D=$,T=Z,B())});function B(){if(D)v(D);else if(b&&T){const $=h.exported.getImageData(T),Z={};for(const X in b){const{width:G,height:ie,x:W,y:J,sdf:q,pixelRatio:ue,stretchX:te,stretchY:oe,content:pe}=b[X],Pe=new h.RGBAImage({width:G,height:ie});h.RGBAImage.copy($,Pe,{x:W,y:J},{x:0,y:0},{width:G,height:ie}),Z[X]={data:Pe,pixelRatio:ue,sdf:q,stretchX:te,stretchY:oe,content:pe}}v(null,Z)}}return{cancel(){O&&(O.cancel(),O=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new h.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.getSource(o.source);if(!u)return;const g=o.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const g of o){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&hd[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const T in this._updatedSources){const D=this._updatedSources[T];"reload"===D?this._reloadSource(T):"clear"===D&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const D=this._getLayerSourceCache(b);D&&(D.used=!0)}const T=this.map.painter;if(T){const D=b.getProgramIds();if(!D)continue;const I=b.getProgramConfiguration(o.zoom);for(const O of D)T.useProgram(O,I)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Al(this,h.validateStyle(o)))return!1;(o=h.clone$1(o)).layers=sr(o.layers);const u=function(v,b){if(!v)return[{command:be.setStyle,args:[b]}];let T=[];try{if(!H(v.version,b.version))return[{command:be.setStyle,args:[b]}];H(v.center,b.center)||T.push({command:be.setCenter,args:[b.center]}),H(v.zoom,b.zoom)||T.push({command:be.setZoom,args:[b.zoom]}),H(v.bearing,b.bearing)||T.push({command:be.setBearing,args:[b.bearing]}),H(v.pitch,b.pitch)||T.push({command:be.setPitch,args:[b.pitch]}),H(v.sprite,b.sprite)||T.push({command:be.setSprite,args:[b.sprite]}),H(v.glyphs,b.glyphs)||T.push({command:be.setGlyphs,args:[b.glyphs]}),H(v.transition,b.transition)||T.push({command:be.setTransition,args:[b.transition]}),H(v.light,b.light)||T.push({command:be.setLight,args:[b.light]}),H(v.fog,b.fog)||T.push({command:be.setFog,args:[b.fog]}),H(v.projection,b.projection)||T.push({command:be.setProjection,args:[b.projection]});const D={},I=[];!function(B,$,Z,X){let G;for(G in $=$||{},B=B||{})B.hasOwnProperty(G)&&($.hasOwnProperty(G)||Lr(G,Z,X));for(G in $)$.hasOwnProperty(G)&&(B.hasOwnProperty(G)?H(B[G],$[G])||("geojson"===B[G].type&&"geojson"===$[G].type&&Kf(B,$,G)?Z.push({command:be.setGeoJSONSourceData,args:[G,$[G].data]}):$o(G,$,Z,X)):po(G,$,Z))}(v.sources,b.sources,I,D);const O=[];v.layers&&v.layers.forEach(B=>{B.source&&D[B.source]?T.push({command:be.removeLayer,args:[B.id]}):O.push(B)});let R=v.terrain;R&&D[R.source]&&(T.push({command:be.setTerrain,args:[void 0]}),R=void 0),T=T.concat(I),H(R,b.terrain)||T.push({command:be.setTerrain,args:[b.terrain]}),function(B,$,Z){$=$||[];const X=(B=B||[]).map(xc),G=$.map(xc),ie=B.reduce(bp,{}),W=$.reduce(bp,{}),J=X.slice(),q=Object.create(null);let ue,te,oe,pe,Pe,Be,ke;for(ue=0,te=0;ue<X.length;ue++)oe=X[ue],W.hasOwnProperty(oe)?te++:(Z.push({command:be.removeLayer,args:[oe]}),J.splice(J.indexOf(oe,te),1));for(ue=0,te=0;ue<G.length;ue++)oe=G[G.length-1-ue],J[J.length-1-ue]!==oe&&(ie.hasOwnProperty(oe)?(Z.push({command:be.removeLayer,args:[oe]}),J.splice(J.lastIndexOf(oe,J.length-te),1)):te++,Be=J[J.length-ue],Z.push({command:be.addLayer,args:[W[oe],Be]}),J.splice(J.length-ue,0,oe),q[oe]=!0);for(ue=0;ue<G.length;ue++)if(oe=G[ue],pe=ie[oe],Pe=W[oe],!q[oe]&&!H(pe,Pe))if(H(pe.source,Pe.source)&&H(pe["source-layer"],Pe["source-layer"])&&H(pe.type,Pe.type)){for(ke in To(pe.layout,Pe.layout,Z,oe,null,be.setLayoutProperty),To(pe.paint,Pe.paint,Z,oe,null,be.setPaintProperty),H(pe.filter,Pe.filter)||Z.push({command:be.setFilter,args:[oe,Pe.filter]}),H(pe.minzoom,Pe.minzoom)&&H(pe.maxzoom,Pe.maxzoom)||Z.push({command:be.setLayerZoomRange,args:[oe,Pe.minzoom,Pe.maxzoom]}),pe)pe.hasOwnProperty(ke)&&"layout"!==ke&&"paint"!==ke&&"filter"!==ke&&"metadata"!==ke&&"minzoom"!==ke&&"maxzoom"!==ke&&(0===ke.indexOf("paint.")?To(pe[ke],Pe[ke],Z,oe,ke.slice(6),be.setPaintProperty):H(pe[ke],Pe[ke])||Z.push({command:be.setLayerProperty,args:[oe,ke,Pe[ke]]}));for(ke in Pe)Pe.hasOwnProperty(ke)&&!pe.hasOwnProperty(ke)&&"layout"!==ke&&"paint"!==ke&&"filter"!==ke&&"metadata"!==ke&&"minzoom"!==ke&&"maxzoom"!==ke&&(0===ke.indexOf("paint.")?To(pe[ke],Pe[ke],Z,oe,ke.slice(6),be.setPaintProperty):H(pe[ke],Pe[ke])||Z.push({command:be.setLayerProperty,args:[oe,ke,Pe[ke]]}))}else Z.push({command:be.removeLayer,args:[oe]}),Be=J[J.lastIndexOf(oe)+1],Z.push({command:be.addLayer,args:[Pe,Be]})}(O,b.layers,T)}catch(D){console.warn("Unable to compute style diff:",D),T=[{command:be.setStyle,args:[b]}]}return T}(this.serialize(),o).filter(v=>!(v.command in fn));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in em));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,u){return this.getImage(o)?this.fire(new h.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,u),this._afterImageUpdated(o),this)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new h.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(h.validateSource,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=De(o,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:v.serialize(),sourceId:o}));const b=T=>{const D=(T?"symbol:":"other:")+o,I=this._sourceCaches[D]=new h.SourceCache(D,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=I,I.style=this,I.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const u=this.getSource(o);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new h.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new h.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getSource(o).setData(u),this._changed=!0}getSource(o){const u=this._getSourceCache(o);return u&&u.getSource()}addLayer(o,u,g={}){this._checkLoaded();const v=o.id;if(this.getLayer(v))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===o.type){if(Al(this,h.validateCustomStyleLayer(o)))return;b=h.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(v,o.source),o=h.clone$1(o),o=h.extend(o,{source:v})),this._validate(h.validateLayer,`layers.${v}`,o,{arrayIndex:-1},g))return;b=h.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=u?this._order.indexOf(u):this._order.length;if(u&&-1===T)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const D=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&D&&"custom"!==b.type){const I=this._removedLayers[v];delete this._removedLayers[v],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const g=this._order.indexOf(o);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new h.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,g){this._checkLoaded();const v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,u,g={}){this._checkLoaded();const v=this.getLayer(o);if(v){if(!H(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(h.validateFilter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=h.clone$1(u),this._updateLayer(v)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const u=this.getLayer(o);return u&&h.clone$1(u.filter)}setLayoutProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?H(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,u){const g=this.getLayer(o);if(g)return g.getLayoutProperty(u);this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?H(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,u){const g=this.getLayer(o);return g&&g.getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const g=o.source,v=o.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new h.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const T=b.type;if("geojson"===T&&v)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!v)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const D=this._getSourceCaches(g);for(const I of D)I.setFeatureState(v,o.id,u)}removeFeatureState(o,u){this._checkLoaded();const g=o.source,v=this.getSource(g);if(!v)return void this.fire(new h.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,T="vector"===b?o.sourceLayer:void 0;if("vector"===b&&!T)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const D=this._getSourceCaches(g);for(const I of D)I.removeFeatureState(T,o.id,u)}getFeatureState(o){this._checkLoaded();const u=o.source,g=o.sourceLayer,v=this.getSource(u);if(v){if("vector"!==v.type||g)return void 0===o.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,o.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();o[g.id]||(o[g.id]=g.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(o){this._updatedLayers[o.id]=!0;const u=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[o.source]="reload",u.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=T=>"fill-extrusion"===this._layers[T].type,g={},v=[];for(let T=this._order.length-1;T>=0;T--){const D=this._order[T];if(u(D)){g[D]=T;for(const I of o){const O=I[D];if(O)for(const R of O)v.push(R)}}}v.sort((T,D)=>D.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const D=this._order[T];if(u(D))for(let I=v.length-1;I>=0;I--){const O=v[I].feature;if(g[O.layer.id]<T)break;b.push(O),v.pop()}else for(const I of o){const O=I[D];if(O)for(const R of O)b.push(R.feature)}}return b}queryRenderedFeatures(o,u,g){u&&u.filter&&this._validate(h.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of u.layers){const O=this._layers[I];if(!O)return this.fire(new h.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}const b=[];u.availableImages=this._availableImages;const T=u&&u.layers?u.layers.some(I=>{const O=this.getLayer(I);return O&&O.is3D()}):this.has3DLayers(),D=$n.createFromScreenPoints(o,g);for(const I in this._sourceCaches){const O=this._sourceCaches[I].getSource().id;u.layers&&!v[O]||b.push(ht(this._sourceCaches[I],this._layers,this._serializedLayers,D,u,g,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(I,O,R,B,$,Z,X){const G={},ie=Z.queryRenderedSymbols(B),W=[];for(const J of Object.keys(ie).map(Number))W.push(X[J]);W.sort(Ut);for(const J of W){const q=J.featureIndex.lookupSymbolFeatures(ie[J.bucketInstanceId],O,J.bucketIndex,J.sourceLayerIndex,$.filter,$.layers,$.availableImages,I);for(const ue in q){const te=G[ue]=G[ue]||[],oe=q[ue];oe.sort((pe,Pe)=>{const Be=J.featureSortOrder;if(Be){const ke=Be.indexOf(pe.featureIndex);return Be.indexOf(Pe.featureIndex)-ke}return Pe.featureIndex-pe.featureIndex});for(const pe of oe)te.push(pe)}}for(const J in G)G[J].forEach(q=>{const ue=q.feature,te=R(I[J]).getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=te});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),D.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(h.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(o);let v=[];for(const b of g)v=v.concat(Qe(b,u));return v}addSourceType(o,u,g){return ui.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(ui.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const T in o)if(!H(o[T],g[T])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,u=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof o.source){const g="terrain-dem-src";this.addSource(g,o.source),o=h.clone$1(o),o=h.extend(o,{source:g})}if(this._validate(h.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(o,u);else{const g=this.terrain,v=g.get();for(const b of Object.keys(h.spec.terrain))!o.hasOwnProperty(b)&&h.spec.terrain[b].default&&(o[b]=h.spec.terrain[b].default);for(const b in o)if(!H(o[b],v[b])){g.set(o),this.stylesheet.terrain=o;const T=this._setTransitionParameters({duration:0});g.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new vn(o,this.map.transform);this.stylesheet.fog=o;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();0===Object.keys(o).length&&u.set(o);for(const v in o)if(!H(o[v],g[v])){u.set(o),this.stylesheet.fog=o;const b=this._setTransitionParameters({duration:0});u.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:h.exported.now(),transition:h.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const g=this.terrain=new St(o,u);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"symbol"===u.type&&this._updateLayer(u)}}_validate(o,u,g,v,b={}){return(!b||!1!==b.validate)&&Al(this,o.call(h.validateStyle,h.extend({key:u,style:this.serialize(),value:g,styleSpec:h.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const u=this._getSourceCaches(o);for(const g of u)g.clearTiles()}_reloadSource(o){const u=this._getSourceCaches(o);for(const g of u)g.resume(),g.reload()}_updateSources(o){for(const u in this._sourceCaches)this._sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,g,v,b=!1){let T=!1,D=!1;const I={};for(const O of this._order){const R=this._layers[O];if("symbol"!==R.type)continue;if(!I[R.source]){const $=this._getLayerSourceCache(R);if(!$)continue;I[R.source]=$.getRenderableIds(!0).map(Z=>$.getTileByID(Z)).sort((Z,X)=>X.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(X.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(R,I[R.source],o.center.lng,o.projection);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),o.zoom))&&(this.pauseablePlacement=new qu(o,this._order,b,u,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),D=!0),T&&this.pauseablePlacement.placement.setStale()),D||T)for(const O of this._order){const R=this._layers[O];"symbol"===R.type&&this.placement.updateLayerOpacities(R,I[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(o,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(o,u,g){return h.makeRequest(u,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}_isSourceCacheLoaded(o){const u=this._getSourceCaches(o);return 0===u.length?(this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ui.getSourceType=function(f){return _e[f]},ui.setSourceType=function(f,o){_e[f]=o},ui.registerForPluginStateChange=h.registerForPluginStateChange;var Xu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ep="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ho={},bi={};Ho=ir("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),bi=ir("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const dd=ir("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Mc=Xu,no="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var fr={background:ir("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ir("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ir("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ir("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ir("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ir("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ir("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ir("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ir("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ir("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ir("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ir("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ir("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ir("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ir("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ir("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ir("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ir("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ir("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ir("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ir("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ir("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ir("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ir("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ir("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ir("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ep),skyboxGradient:ir("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ep),skyboxCapture:ir("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ir("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ir("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ir(f,o,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=f.match(v),D=o.match(v),I=Xu.match(v);let O=D?D.concat(T):T;u||(Ho.staticUniforms&&(O=Ho.staticUniforms.concat(O)),bi.staticUniforms&&(O=bi.staticUniforms.concat(O))),O&&(O=O.concat(I));const R={};return{fragmentSource:f=f.replace(g,(B,$,Z,X,G)=>(R[G]=!0,"define"===$?`\n#ifndef HAS_UNIFORM_u_${G}\nvarying ${Z} ${X} ${G};\n#else\nuniform ${Z} ${X} u_${G};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${G}\n    ${Z} ${X} ${G} = u_${G};\n#endif\n`)),vertexSource:o=o.replace(g,(B,$,Z,X,G)=>{const ie="float"===X?"vec2":"vec4",W=G.match(/color/)?"color":ie;return R[G]?"define"===$?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${Z} ${ie} a_${G};\nvarying ${Z} ${X} ${G};\n#else\nuniform ${Z} ${X} u_${G};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${Z} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);\n#else\n    ${Z} ${X} ${G} = u_${G};\n#endif\n`:"define"===$?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${Z} ${ie} a_${G};\n#else\nuniform ${Z} ${X} u_${G};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${Z} ${X} ${G} = a_${G};\n#else\n    ${Z} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${Z} ${X} ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);\n#else\n    ${Z} ${X} ${G} = u_${G};\n#endif\n`}),staticAttributes:b,staticUniforms:O}}class tm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,g,v,b,T,D,I,O){this.context=o;let R=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!R&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(R=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===D&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===O?(o.bindVertexArrayOES.set(this.vao),D&&D.bind(),b&&b.dynamicDraw&&b.bind(),I&&I.bind(),O&&O.bind()):this.freshBind(u,g,v,b,T,D,I,O)}freshBind(o,u,g,v,b,T,D,I){let O;const R=o.numAttributes,B=this.context,$=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=I;else{O=B.currentNumAttributes||0;for(let Z=R;Z<O;Z++)$.disableVertexAttribArray(Z)}u.enableAttributes($,o);for(const Z of g)Z.enableAttributes($,o);T&&T.enableAttributes($,o),D&&D.enableAttributes($,o),I&&I.enableAttributes($,o),u.bind(),u.setVertexAttribPointers($,o,b);for(const Z of g)Z.bind(),Z.setVertexAttribPointers($,o,b);T&&(T.bind(),T.setVertexAttribPointers($,o,b)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers($,o,b)),I&&(I.bind(),I.setVertexAttribPointers($,o,b)),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ma(f,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new h.MercatorCoordinate(0,g/u).toLngLat().lat,new h.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function dr(f,o,u,g,v,b,T){const D=f.context,I=D.gl,O=u.fbo;if(!O)return;f.prepareDrawTile();const R=f.useProgram("hillshade");D.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get());const B=((G,ie,W,J)=>{const q=W.paint.get("hillshade-shadow-color"),ue=W.paint.get("hillshade-highlight-color"),te=W.paint.get("hillshade-accent-color");let oe=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(oe-=G.transform.angle);const pe=!G.options.moving;return{u_matrix:J||G.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),pe),u_image:0,u_latrange:ma(0,ie.tileID),u_light:[W.paint.get("hillshade-exaggeration"),oe],u_shadow:q,u_highlight:ue,u_accent:te}})(f,u,g,f.terrain?o.projMatrix:null);f.prepareDrawProgram(D,R,o.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:X}=f.getTileBoundsBuffers(u);R.draw(D,I.TRIANGLES,v,b,T,h.CullFaceMode.disabled,B,g.id,$,Z,X)}function Fa(f,o,u){if(!o.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(u.stride);const b=u.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new h.Texture(g,b,v.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Pl(f,o,u,g,v,b){const T=f.context,D=T.gl;if(!o.dem)return;const I=o.dem;if(T.activeTexture.set(D.TEXTURE1),Fa(f,o,I),!o.demTexture)return;o.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);const O=I.dim;T.activeTexture.set(D.TEXTURE0);let R=o.fbo;if(!R){const X=new h.Texture(T,{width:O,height:O,data:null},D.RGBA);X.bind(D.LINEAR,D.CLAMP_TO_EDGE),R=o.fbo=T.createFramebuffer(O,O,!0),R.colorAttachment.set(X.texture)}T.bindFramebuffer.set(R.framebuffer),T.viewport.set([0,0,O,O]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(T,D.TRIANGLES,g,v,b,h.CullFaceMode.disabled,((X,G)=>{const ie=G.stride,W=h.create();return h.ortho(W,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(W,W,[0,-h.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ie,ie],u_zoom:X.overscaledZ,u_unpack:G.unpackVector}})(o.tileID,I),u.id,B,$,Z),o.needsHillshadePrepare=!1}const kl=(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_image0:new h.Uniform1i(f,o.u_image0),u_skirt_height:new h.Uniform1f(f,o.u_skirt_height)}),Tc=(f,o)=>({u_matrix:f,u_image0:0,u_skirt_height:o}),In=(f,o,u,g,v,b,T,D,I,O,R,B,$,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:D,u_frustum_br:I,u_frustum_bl:O,u_globe_pos:R,u_globe_radius:B,u_viewport:$,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9)});function Us(f,o){return null!=f&&null!=o&&!(!f.hasData()||!o.hasData())&&null!=f.demTexture&&null!=o.demTexture&&f.tileID.key!==o.tileID.key}const za=new class{constructor(){this.operations={}}newMorphing(f,o,u,g,v){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[f]={startTime:g,phase:0,duration:v,from:o,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(const o in this.operations){const u=this.operations[o];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Yr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Mp(f,o){const u=1<<f.z;return!o&&(0===f.x||f.x===u-1)||0===f.y||f.y===u-1}const Ol=f=>({u_matrix:f});function Yu(f,o,u,g,v){if(v>0){const b=h.exported.now(),T=(b-f.timeAdded)/v,D=o?(b-o.timeAdded)/v:-1,I=u.getSource(),O=g.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(f.tileID.overscaledZ-O),B=R&&f.refreshedUponExpiration?1:h.clamp(R?T:1-D,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class nm extends h.SourceCache{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new Xn(Kn(),null),v=De("mock-dem",u,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class qo extends h.SourceCache{constructor(o){const u=De("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Xn(Kn(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,g){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const D=new h.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);D.state="loaded",this._tiles[T.key]=D}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const u=this.proxyCachedFBO[o];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ku extends h.OverscaledTileID{constructor(o,u,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class Ju extends h.Elevation{constructor(o,u){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(I){const O=new h.StructArrayLayout4i8,R=new h.StructArrayLayout3ui6,B=131;O.reserve(17161),R.reserve(33800);const $=h.EXTENT/128,Z=h.EXTENT+$/2,X=Z+$;for(let ie=-$;ie<X;ie+=$)for(let W=-$;W<X;W+=$){const J=W<0||W>Z||ie<0||ie>Z?24575:0,q=h.clamp(Math.round(W),0,h.EXTENT),ue=h.clamp(Math.round(ie),0,h.EXTENT);O.emplaceBack(q+J,ue,q,ue)}const G=(ie,W)=>{const J=W*B+ie;R.emplaceBack(J+1,J,J+B),R.emplaceBack(J+B,J+B+1,J+1)};for(let ie=1;ie<129;ie++)for(let W=1;W<129;W++)G(W,ie);return[0,129].forEach(ie=>{for(let W=0;W<130;W++)G(W,ie),G(ie,W)}),[O,R,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(g,h.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=h.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qo(u.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const D=T.gl;this._overlapStencilMode=new h.StencilMode({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new nm(u.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,u,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const v=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(u,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(I=>{const O=u.getTileByID(I).tileID;return O.projMatrix=g.calculateProjMatrix(O.toUnwrapped()),O});(function(I,O){const R=O.transform.pointCoordinate(O.transform.getCameraPoint()),B=new h.pointGeometry(R.x,R.y);I.sort(($,Z)=>{if(Z.overscaledZ-$.overscaledZ)return Z.overscaledZ-$.overscaledZ;const X=new h.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),G=new h.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ie=B.mult(1<<$.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(X)-ie.distSqr(G)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const I in T){const O=T[I];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,o[I],b),O.usedForTerrain))continue;const R=o[I];O.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[u.id]=v.map(I=>new Ku(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const D={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const O=this.terrainTileForTile[I.key];if(!O)continue;const R=O.tileID.key;R in D||(this._visibleDemTiles.push(O),D[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),Fa(this.painter,v,b))}}_prepareDemTileUniforms(o,u,g,v){if(!u||null==u.demTexture)return!1;const b=o.tileID.canonical,T=Math.pow(2,u.tileID.canonical.z-b.z),D=v||"";return g[`u_dem_tl${D}`]=[b.x*T%1,b.y*T%1],g[`u_dem_scale${D}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,u=o.gl;if(!this._emptyDepthBufferTexture){const g=new h.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new h.Texture(o,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new h.RGBAImage({width:1,height:1},new Uint8Array(h.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new h.Texture(o,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(o,u,g){const v=this.painter.context,b=v.gl,T=(D=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(D),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var D;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const I=this.painter.transform,O=I.projection,R=o.tileID.canonical;T.u_tile_tl_up=O.upVector(R,0,0),T.u_tile_tr_up=O.upVector(R,h.EXTENT,0),T.u_tile_br_up=O.upVector(R,h.EXTENT,h.EXTENT),T.u_tile_bl_up=O.upVector(R,0,h.EXTENT),T.u_tile_up_scale=g&&g.useDenormalizedUpVectorScale?h.GLOBE_METERS_TO_ECEF:O.upVectorScale(R,I.center.lat,I.worldSize).metersToTile;let B=null,$=null,Z=1;if(g&&g.morphing&&this._useVertexMorphing){const X=g.morphing.srcDemTile,G=g.morphing.dstDemTile;Z=g.morphing.phase,X&&G&&(this._prepareDemTileUniforms(o,X,T,"_prev")&&($=X),this._prepareDemTileUniforms(o,G,T)&&(B=G))}if($&&B?(v.activeTexture.set(b.TEXTURE2),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),$.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=Z):(B=this.terrainTileForTile[o.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,B,T)?B.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const X=(1<<B.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=X}g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,T)}renderToBackBuffer(o){const u=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,T,D,I){if("globe"===v.transform.projection.name)!function(O,R,B,$,Z){const X=O.context,G=X.gl;let ie,W;const J=O.options.showTerrainWireframe?2:0,q=O.transform,ue=h.globeUseCustomAntiAliasing(O,X,q),te=(ae,Ie)=>{if(W===ae)return;const Ze=[Yr[ae],"PROJECTION_GLOBE_VIEW"];ue&&Ze.push("CUSTOM_ANTIALIASING"),Ie&&Ze.push(Yr[J]),ie=O.useProgram("globeRaster",null,Ze),W=ae},oe=O.colorModeForRenderPass(),pe=new h.DepthMode(G.LEQUAL,h.DepthMode.ReadWrite,O.depthRangeFor3D);za.update(Z);const Pe=h.calculateGlobeMercatorMatrix(q),Be=[h.mercatorXfromLng(q.center.lng),h.mercatorYfromLat(q.center.lat)],ke=O.globeSharedBuffers,at=[q.width*h.exported.devicePixelRatio,q.height*h.exported.devicePixelRatio];if((J?[!1,!0]:[!1]).forEach(ae=>{W=-1;const Ie=ae?G.LINES:G.TRIANGLES;for(const Ze of $){const bt=B.getTile(Ze),qe=h.StencilMode.disabled,Rt=R.prevTerrainTileForTile[Ze.key],mt=R.terrainTileForTile[Ze.key];Us(Rt,mt)&&za.newMorphing(Ze.key,Rt,mt,Z,250),X.activeTexture.set(G.TEXTURE0),bt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const vt=za.getMorphValuesForProxy(Ze.key),_t=vt?1:0,gt={useDenormalizedUpVectorScale:!0};vt&&h.extend$1(gt,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:h.easeCubicInOut(vt.phase)}});const It=Float32Array.from(q.globeMatrix),Jt=h.globeTileLatLngCorners(Ze.canonical),mn=h.getLatitudinalLod((Jt[0][0]+Jt[1][0])/2),Nt=h.getGridMatrix(Ze.canonical,Jt,mn),ln=h.globeNormalizeECEF(h.globeTileBounds(Ze.canonical)),Qn=In(q.projMatrix,It,Pe,ln,h.globeToMercatorTransition(q.zoom),Be,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,at,Nt);if(te(_t,ae),R.setupElevationDraw(bt,ie,gt),O.prepareDrawProgram(X,ie,Ze.toUnwrapped()),ke){const[Mr,Sr,mr]=ae?ke.getWirefameBuffers(O.context,mn):ke.getGridBuffers(mn);ie.draw(X,Ie,pe,qe,oe,h.CullFaceMode.backCCW,Qn,"globe_raster",Mr,Sr,mr)}}}),ke){const ae=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&ae.push("CUSTOM_ANTIALIASING"),ie=O.useProgram("globeRaster",null,ae);for(const Ie of $){const{x:Ze,y:bt,z:qe}=Ie.canonical,Rt=0===bt,mt=bt===(1<<qe)-1,[vt,_t,gt,It]=ke.getPoleBuffers(qe);if(It&&(Rt||mt)){const Jt=B.getTile(Ie);X.activeTexture.set(G.TEXTURE0),Jt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let mn=h.globePoleMatrixForTile(qe,Ze,q);const Nt=h.globeNormalizeECEF(h.globeTileBounds(Ie.canonical)),ln=(Qn,Mr)=>Qn.draw(X,G.TRIANGLES,pe,h.StencilMode.disabled,oe,h.CullFaceMode.disabled,In(q.projMatrix,mn,mn,Nt,0,Be,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,at),"globe_pole_raster",Mr,gt,It);R.setupElevationDraw(Jt,ie,{}),O.prepareDrawProgram(X,ie,Ie.toUnwrapped()),Rt&&ln(ie,vt),mt&&(mn=h.scale(h.create(),mn,[1,-1,1]),ln(ie,_t))}}}}(v,b,T,D,I);else{const O=v.context,R=O.gl;let B,$;const Z=v.options.showTerrainWireframe?2:0,X=(q,ue)=>{if($===q)return;const te=[Yr[q]];ue&&te.push(Yr[Z]),B=v.useProgram("terrainRaster",null,te),$=q},G=v.colorModeForRenderPass(),ie=new h.DepthMode(R.LEQUAL,h.DepthMode.ReadWrite,v.depthRangeFor3D);za.update(I);const W=v.transform,J=6*Math.pow(1.5,22-W.zoom)*b.exaggeration();(Z?[!1,!0]:[!1]).forEach(q=>{$=-1;const ue=q?R.LINES:R.TRIANGLES,[te,oe]=q?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const pe of D){const Pe=T.getTile(pe),Be=h.StencilMode.disabled,ke=b.prevTerrainTileForTile[pe.key],at=b.terrainTileForTile[pe.key];Us(ke,at)&&za.newMorphing(pe.key,ke,at,I,250),O.activeTexture.set(R.TEXTURE0),Pe.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const ae=za.getMorphValuesForProxy(pe.key),Ie=ae?1:0;let Ze;ae&&(Ze={morphing:{srcDemTile:ae.from,dstDemTile:ae.to,phase:h.easeCubicInOut(ae.phase)}});const bt=Tc(pe.projMatrix,Mp(pe.canonical,W.renderWorldCopies)?J/10:J);X(Ie,q),b.setupElevationDraw(Pe,B,Ze),v.prepareDrawProgram(O,B,pe.toUnwrapped()),B.draw(O,ue,ie,Be,G,h.CullFaceMode.backCCW,bt,"terrain_raster",b.gridBuffer,te,oe)}})}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),D=[],I=u.style.order;let O=0;for(const R of b){const B=v.getTileByID(R.proxyTileKey),$=v.proxyCachedFBO[R.key]?v.proxyCachedFBO[R.key][o]:void 0,Z=void 0!==$?v.renderCache[$]:this.pool[O++],X=void 0!==$;if(B.texture=Z.tex,X&&!Z.dirty){D.push(B.tileID);continue}let G;g.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(g.clear({color:h.Color.transparent,stencil:0}),Z.dirty=!1);for(let ie=T.start;ie<=T.end;++ie){const W=u.style._layers[I[ie]];if(W.isHidden(u.transform.zoom))continue;const J=u.style._getLayerSourceCache(W),q=J?this.proxyToSource[R.key][J.id]:[R];if(!q)continue;const ue=q;g.viewport.set([0,0,Z.fb.width,Z.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(Z,q,W,J),G=J?J.id:null),u.renderLayer(u,J,W,ue)}this.renderedToTile?(Z.dirty=!0,D.push(B.tileID)):X||--O,5===O&&(O=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const u=o.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,T=!1;for(let D=0;D<u;++D){const I=o._layers[o.order[D]];this._style.isLayerDraped(I)?(T&&++v,++b):T||(T=!0,g=I.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,D=Math.pow(2,T.overscaledZ),{x:I,y:O}=T.canonical,R=I/D,B=(I+1)/D,$=O/D,Z=(O+1)/D;return{minx:R,miny:$,maxx:B,maxy:Z,t:b.dem.tree.raycastRoot(R,$,B,Z,o,u,g),tile:b}});v.sort((b,T)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,u,g);if(null!=T)return T}return null}_createFBO(){const o=this.painter.context,u=o.gl,g=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const v=new h.Texture(o,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new z(o,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._layers[o],g=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),b=!!v&&1!==v.t,T=u.hasTransition();return"custom"!==u.type&&!g&&(b||T)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof se){o=!0;break}if(o)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!b)continue;const T=g.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const I=this.proxyToSource[D.key][b.id];if(I)for(const O of I){const R=Yu(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,T);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){const o=this._style.order,u=o.length;if(0===u)return;const g=[];let v,b=0,T=this._style._layers[o[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<u;)T=this._style._layers[o[b]];for(;b<u;++b){const D=this._style._layers[o[b]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const T=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let D=0;D<T.length;++D){const I=Object.values(T[D]);u.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const D=g[T];if(u.getTileByID(D.key),void 0!==u.proxyCachedFBO[D.key]){const I=o[D.key],O=this.proxyToSource[D.key];let R=0;for(const B in O){const $=O[B],Z=I[B];if(!Z||Z.length!==$.length||$.some((X,G)=>X!==Z[G]||v[B]&&v[B].hasOwnProperty(X.key))){R=-1;break}++R}for(const B in u.proxyCachedFBO[D.key])u.renderCache[u.proxyCachedFBO[D.key][B]].dirty=R<0||R!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((T,D)=>D.end-D.start-(T.end-T.start));for(const T of b)for(const D of g){if(u.proxyCachedFBO[D.key])continue;let I=u.renderCachePool.pop();void 0===I&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==I&&(u.proxyCachedFBO[D.key]={},u.proxyCachedFBO[D.key][T.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let D;if(g.isTileClipped())D=u.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(o,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(h.ColorMode.disabled),v.setDepthMode(h.DepthMode.disabled);const T=g.useProgram("clippingMask");for(const D of o){const I=g._tileClippingMaskIDs[D.key]=--u;T.draw(v,b.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,Ol(D.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const g=[o.x,o.y,1,1];h.transformMat4$1(g,g,u.pixelMatrixInverse),h.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=h.mercatorZfromAltitude(1,u.center.lat),T=[v[0],v[1],v[2]/b,0],D=h.subtract([],g.slice(0,3),T);h.normalize(D,D);const I=this.raycast(T,D,this._exaggeration);return null!==I&&I?(h.scaleAndAdd(T,T,D,I),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const o=this.painter,u=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=u.gl,D=u.createFramebuffer(v,b,!0);u.activeTexture.set(T.TEXTURE0);const I=new h.Texture(u,{width:v,height:b,data:null},T.RGBA);I.bind(T.NEAREST,T.CLAMP_TO_EDGE),D.colorAttachment.set(I.texture);const O=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);D.depthAttachment.set(O),this._depthFBO=D,this._depthTexture=I}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(T,D,I,O){if("globe"===T.transform.projection.name)return;const R=T.context,B=R.gl;R.clear({depth:1});const $=T.useProgram("terrainDepth"),Z=new h.DepthMode(B.LESS,h.DepthMode.ReadWrite,T.depthRangeFor3D);for(const X of O){const G=I.getTile(X),ie=Tc(X.projMatrix,0);D.setupElevationDraw(G,$),$.draw(R,B.TRIANGLES,Z,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,ie,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,u,g){if(o.getSource()instanceof we)return this._setupProxiedCoordsForImageSource(o,u,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const I=b[D],O=this._findTileCoveringTileID(I,o);if(O){const R=this._createProxiedId(I,O,g[I.key]&&g[I.key][o.id]);v.push(R),this.proxyToSource[I.key][o.id]=[R]}}let T=!1;for(let D=0;D<u.length;D++){const I=o.getTile(u[D]);if(!I||!I.hasData())continue;const O=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==I.tileID.canonical.z){const R=this.proxyToSource[O.tileID.key][o.id],B=this._createProxiedId(O.tileID,I,g[O.tileID.key]&&g[O.tileID.key][o.id]);R?R.splice(R.length-1,0,B):this.proxyToSource[O.tileID.key][o.id]=[B],v.push(B),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,u,g){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords,T=o.getSource(),D=new h.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),I=T.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((R,B)=>(R.min.x=Math.min(R.min.x,B.x-D.x),R.min.y=Math.min(R.min.y,B.y-D.y),R.max.x=Math.max(R.max.x,B.x-D.x),R.max.y=Math.max(R.max.y,B.y-D.y),R),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(R,B)=>{const $=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),X=h.EXTENT/(1<<R.canonical.z),G=B.wrap+B.canonical.x/(1<<B.canonical.z),ie=B.canonical.y/(1<<B.canonical.z);return $+X<G+I.min.x||$>G+I.max.x||Z+X<ie+I.min.y||Z>ie+I.max.y};for(let R=0;R<b.length;R++){const B=b[R];for(let $=0;$<u.length;$++){const Z=o.getTile(u[$]);if(!Z||!Z.hasData()||O(B,Z.tileID))continue;const X=this._createProxiedId(B,Z,g[B.key]&&g[B.key][o.id]),G=this.proxyToSource[B.key][o.id];G?G.push(X):this.proxyToSource[B.key][o.id]=[X],v.push(X)}}}_createProxiedId(o,u,g){let v=this.orthoMatrix;if(g){const b=g.find(T=>T.key===u.tileID.key);if(b)return b}if(u.tileID.key!==o.key){const b=o.canonical.z-u.tileID.canonical.z;let T,D,I;v=h.create();const O=u.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(T=h.EXTENT>>b,D=T*((u.tileID.canonical.x<<b)-o.canonical.x+O),I=T*((u.tileID.canonical.y<<b)-o.canonical.y)):(T=h.EXTENT<<-b,D=h.EXTENT*(u.tileID.canonical.x-(o.canonical.x+O<<-b)),I=h.EXTENT*(u.tileID.canonical.y-(o.canonical.y<<-b))),h.ortho(v,0,T,0,T,0,1),h.translate(v,v,[D,I,0])}return new Ku(u.tileID,o.key,v)}_findTileCoveringTileID(o,u){let g=u.getTile(o);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[o.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let T=g?g.tileID:o,D=T.overscaledZ;const I=u.getSource().minzoom,O=[];if(!b){const B=u.getSource().maxzoom;if(o.canonical.z>=B){const $=o.canonical.z-B;u.getSource().reparseOverscaled?(D=Math.max(o.canonical.z+2,u.transform.tileZoom),T=new h.OverscaledTileID(D,o.wrap,B,o.canonical.x>>$,o.canonical.y>>$)):0!==$&&(D=B,T=new h.OverscaledTileID(D,o.wrap,B,o.canonical.x>>$,o.canonical.y>>$))}T.key!==o.key&&(O.push(T.key),g=u.getTile(T))}const R=B=>{O.forEach($=>{v[$]=B}),O.length=0};for(D-=1;D>=I&&(!g||!g.hasData());D--){g&&R(g.tileID.key);const B=T.calculateScaledKey(D);if(g=u.getTileByID(B),g&&g.hasData())break;const $=v[B];if(null===$)break;void 0===$?O.push(B):g=u.getTileByID($)}return R(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(u){let g=0;const v=new h.StructArrayLayout2ui4,b=131;for(let T=1;T<129;T++){for(let D=1;D<129;D++)g=T*b+D,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),128===T&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function un(f){const o=[];for(let u=0;u<f.length;u++){if(null===f[u])continue;const g=f[u].split(" ");o.push(g.pop())}return o}class Li{static cacheKey(o,u,g){let v=`${o}${g?g.cacheKey:""}`;for(const b of u)v+=`/${b}`;return v}constructor(o,u,g,v,b,T){const D=o.gl;this.program=D.createProgram();const I=un(g.staticAttributes),O=v?v.getBinderAttributes():[],R=I.concat(O),B=g.staticUniforms?un(g.staticUniforms):[],$=v?v.getBinderUniforms():[],Z=B.concat($),X=[];for(const te of Z)X.indexOf(te)<0&&X.push(te);let G=v?v.defines():[];G=G.concat(T.map(te=>`#define ${te}`));const ie=G.concat(o.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(no):no,no,Mc,dd.fragmentSource,bi.fragmentSource,g.fragmentSource).join("\n"),W=G.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Mc,dd.vertexSource,bi.vertexSource,Ho.vertexSource,g.vertexSource).join("\n"),J=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(J,ie),D.compileShader(J),D.attachShader(this.program,J);const q=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(q,W),D.compileShader(q),D.attachShader(this.program,q),this.attributes={};const ue={};this.numAttributes=R.length;for(let te=0;te<this.numAttributes;te++)R[te]&&(D.bindAttribLocation(this.program,te,R[te]),this.attributes[R[te]]=te);D.linkProgram(this.program),D.deleteShader(q),D.deleteShader(J);for(let te=0;te<X.length;te++){const oe=X[te];if(oe&&!ue[oe]){const pe=D.getUniformLocation(this.program,oe);pe&&(ue[oe]=pe)}}var te,oe;this.fixedUniforms=b(o,ue),this.binderUniforms=v?v.getUniforms(o,ue):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(te=o,(oe=ue).u_dem),u_dem_prev:new h.Uniform1i(te,oe.u_dem_prev),u_dem_unpack:new h.Uniform4f(te,oe.u_dem_unpack),u_dem_tl:new h.Uniform2f(te,oe.u_dem_tl),u_dem_scale:new h.Uniform1f(te,oe.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(te,oe.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(te,oe.u_dem_scale_prev),u_dem_size:new h.Uniform1f(te,oe.u_dem_size),u_dem_lerp:new h.Uniform1f(te,oe.u_dem_lerp),u_exaggeration:new h.Uniform1f(te,oe.u_exaggeration),u_depth:new h.Uniform1i(te,oe.u_depth),u_depth_size_inv:new h.Uniform2f(te,oe.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(te,oe.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(te,oe.u_label_plane_matrix_inv),u_tile_tl_up:new h.Uniform3f(te,oe.u_tile_tl_up),u_tile_tr_up:new h.Uniform3f(te,oe.u_tile_tr_up),u_tile_br_up:new h.Uniform3f(te,oe.u_tile_br_up),u_tile_bl_up:new h.Uniform3f(te,oe.u_tile_bl_up),u_tile_up_scale:new h.Uniform1f(te,oe.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((te,oe)=>({u_fog_matrix:new h.UniformMatrix4f(te,oe.u_fog_matrix),u_fog_range:new h.Uniform2f(te,oe.u_fog_range),u_fog_color:new h.Uniform4f(te,oe.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(te,oe.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(te,oe.u_fog_temporal_offset),u_frustum_tl:new h.Uniform3f(te,oe.u_frustum_tl),u_frustum_tr:new h.Uniform3f(te,oe.u_frustum_tr),u_frustum_br:new h.Uniform3f(te,oe.u_frustum_br),u_frustum_bl:new h.Uniform3f(te,oe.u_frustum_bl),u_globe_pos:new h.Uniform3f(te,oe.u_globe_pos),u_globe_radius:new h.Uniform1f(te,oe.u_globe_radius),u_globe_transition:new h.Uniform1f(te,oe.u_globe_transition),u_is_globe:new h.Uniform1i(te,oe.u_is_globe),u_viewport:new h.Uniform2f(te,oe.u_viewport)}))(o,ue))}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].set(u[v])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].location&&g[v].set(u[v])}}draw(o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G,ie,W){const J=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(v),o.setColorMode(b),o.setCullFace(T);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(D[ue]);X&&X.setUniforms(o,this.binderUniforms,$,{zoom:Z});const q={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[u];for(const ue of B.get()){const te=ue.vaos||(ue.vaos={});(te[I]||(te[I]=new tm)).bind(o,this,O,X?X.getPaintVertexBuffers():[],R,ue.vertexOffset,G,ie,W),J.drawElements(u,ue.primitiveLength*q,J.UNSIGNED_SHORT,ue.primitiveOffset*q*2)}}}function br(f,o,u){const g=1/Zr(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,T=b*(u.tileID.canonical.x+u.tileID.wrap*v),D=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,D>>16],u_pixel_coord_lower:[65535&T,65535&D]}}const Ui=h.create(),ji=(f,o,u,g,v,b,T,D,I)=>{const O=o.style.light,R=O.properties.get("position"),B=[R.x,R.y,R.z],$=h.create$1();"viewport"===O.properties.get("anchor")&&(h.fromRotation($,-o.transform.angle),h.transformMat3(B,B,$));const Z=O.properties.get("color"),X=o.transform,G={u_matrix:f,u_lightpos:B,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ui,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===X.projection.name&&(G.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],G.u_zoom_transition=T,G.u_inv_rot_matrix=I,G.u_merc_center=D,G.u_up_dir=X.projection.upVector(new h.CanonicalTileID(0,0,0),D[0]*h.EXTENT,D[1]*h.EXTENT),G.u_height_lift=b),G},Fi=(f,o,u,g,v,b,T,D,I,O,R)=>{const B=ji(f,o,u,g,v,D,I,O,R),$={u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8};return h.extend(B,br(b,o,T),$)},zi=f=>({u_matrix:f}),zt=(f,o,u,g)=>h.extend(zi(f),br(u,o,g)),An=(f,o)=>({u_matrix:f,u_world:o}),Pr=(f,o,u,g,v)=>h.extend(zt(f,o,u,g),{u_world:v}),ri=h.create(),js=(f,o,u,g,v,b)=>{const T=f.transform,D="globe"===T.projection.name;let I;if("map"===b.paint.get("circle-pitch-alignment"))if(D){const R=h.globePixelsToTileUnits(T.zoom,o.canonical)*T._projectionScaler;I=Float32Array.from([R,0,0,R])}else I=T.calculatePixelsToTileUnitsMatrix(u);else I=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:f.translatePosMatrix(o.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:ri,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=h.globeToMercatorTransition(T.zoom);const R=v[0]*h.EXTENT,B=v[1]*h.EXTENT;O.u_up_dir=T.projection.upVector(new h.CanonicalTileID(0,0,0),R,B)}return O},wi=f=>{const o=[];return"map"===f.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},$s=(f,o,u,g)=>{const v=h.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},Fr=(f,o,u=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:u}),Ba=h.create(),Rl=(f,o,u,g,v,b,T)=>{const D=f.transform,I="globe"===D.projection.name,O=I?h.globePixelsToTileUnits(D.zoom,o.canonical)*D._projectionScaler:Zr(u,1,b),R={u_matrix:o.projMatrix,u_extrude_scale:O,u_intensity:T,u_inv_rot_matrix:Ba,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){R.u_inv_rot_matrix=g,R.u_merc_center=v,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=h.globeToMercatorTransition(D.zoom);const B=v[0]*h.EXTENT,$=v[1]*h.EXTENT;R.u_up_dir=D.projection.upVector(new h.CanonicalTileID(0,0,0),B,$)}return R},Fn=(f,o,u,g,v,b,T,D)=>{const I=f.transform,O=I.calculatePixelsToTileUnitsMatrix(o),R={u_matrix:eh(f,o,u,v),u_pixels_to_tile_units:O,u_device_pixel_ratio:T,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:D};if(ws(u)){const B=bs(o,f.transform);R.u_texsize=o.lineAtlasTexture.size,R.u_scale=[B,g.fromScale,g.toScale],R.u_mix=g.t}return R},Qu=(f,o,u,g,v,b)=>{const T=f.transform,D=bs(o,T);return{u_matrix:eh(f,o,u,v),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:b,u_image:0,u_scale:[D,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function bs(f,o){return 1/Zr(f,1,o.tileZoom)}function eh(f,o,u,g){return f.translatePosMatrix(g||o.tileID.projMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function ws(f){const o=f.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const $i=(f,o,u,g,v,b)=>{return{u_matrix:f,u_tl_parent:o,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(D=v.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(T=v.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Na(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var T,D};function Na(f){f*=Math.PI/180;const o=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Va=h.create(),ro=(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G)=>{const ie=v.transform,W={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:ie.width/ie.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:D,u_is_text:+I,u_pitch_with_map:+g,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Va,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Va,u_up_vector:[0,-1,0]};return"globe"===G.name&&(W.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],W.u_zoom_transition=B,W.u_inv_rot_matrix=Z,W.u_merc_center=$,W.u_camera_forward=ie._camera.forward(),W.u_ecef_origin=h.globeECEFOrigin(ie.globeMatrix,R.toUnwrapped()),W.u_tile_matrix=Float32Array.from(ie.globeMatrix),W.u_up_vector=X),W},Ua=(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G,ie)=>h.extend(ro(f,o,u,g,v,b,T,D,I,O,B,$,Z,X,G,ie),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+R}),pd=(f,o,u,g,v,b,T,D,I,O,R,B,$,Z,X,G)=>h.extend(Ua(f,o,u,g,v,b,T,D,!0,I,!0,R,B,$,Z,X,G),{u_texsize_icon:O,u_texture_icon:1}),Dr=(f,o,u)=>({u_matrix:f,u_opacity:o,u_color:u}),Ll=(f,o,u,g,v,b)=>h.extend(function(T,D,I,O){const R=I.imageManager.getPattern(T.from.toString()),B=I.imageManager.getPattern(T.to.toString()),{width:$,height:Z}=I.imageManager.getPixelSize(),X=Math.pow(2,O.tileID.overscaledZ),G=O.tileSize*Math.pow(2,I.transform.tileZoom)/X,ie=G*(O.tileID.canonical.x+O.tileID.wrap*X),W=G*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[$,Z],u_mix:D.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Zr(O,1,I.transform.tileZoom),u_pixel_coord_upper:[ie>>16,W>>16],u_pixel_coord_lower:[65535&ie,65535&W]}}(g,b,u,v),{u_matrix:f,u_opacity:o}),rm={fillExtrusion:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_lightpos:new h.Uniform3f(f,o.u_lightpos),u_lightintensity:new h.Uniform1f(f,o.u_lightintensity),u_lightcolor:new h.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new h.Uniform1f(f,o.u_vertical_gradient),u_opacity:new h.Uniform1f(f,o.u_opacity),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_up_dir:new h.Uniform3f(f,o.u_up_dir),u_height_lift:new h.Uniform1f(f,o.u_height_lift)}),fillExtrusionPattern:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_lightpos:new h.Uniform3f(f,o.u_lightpos),u_lightintensity:new h.Uniform1f(f,o.u_lightintensity),u_lightcolor:new h.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new h.Uniform1f(f,o.u_vertical_gradient),u_height_factor:new h.Uniform1f(f,o.u_height_factor),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_up_dir:new h.Uniform3f(f,o.u_up_dir),u_height_lift:new h.Uniform1f(f,o.u_height_lift),u_image:new h.Uniform1i(f,o.u_image),u_texsize:new h.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,o.u_scale),u_fade:new h.Uniform1f(f,o.u_fade),u_opacity:new h.Uniform1f(f,o.u_opacity)}),fill:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix)}),fillPattern:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_image:new h.Uniform1i(f,o.u_image),u_texsize:new h.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,o.u_scale),u_fade:new h.Uniform1f(f,o.u_fade)}),fillOutline:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_world:new h.Uniform2f(f,o.u_world)}),fillOutlinePattern:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_world:new h.Uniform2f(f,o.u_world),u_image:new h.Uniform1i(f,o.u_image),u_texsize:new h.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,o.u_scale),u_fade:new h.Uniform1f(f,o.u_fade)}),circle:(f,o)=>({u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new h.UniformMatrix2f(f,o.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(f,o.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_up_dir:new h.Uniform3f(f,o.u_up_dir)}),collisionBox:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(f,o.u_extrude_scale)}),collisionCircle:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_inv_matrix:new h.UniformMatrix4f(f,o.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(f,o.u_viewport_size)}),debug:(f,o)=>({u_color:new h.UniformColor(f,o.u_color),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_overlay:new h.Uniform1i(f,o.u_overlay),u_overlay_scale:new h.Uniform1f(f,o.u_overlay_scale)}),clippingMask:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix)}),heatmap:(f,o)=>({u_extrude_scale:new h.Uniform1f(f,o.u_extrude_scale),u_intensity:new h.Uniform1f(f,o.u_intensity),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_up_dir:new h.Uniform3f(f,o.u_up_dir)}),heatmapTexture:(f,o)=>({u_image:new h.Uniform1i(f,o.u_image),u_color_ramp:new h.Uniform1i(f,o.u_color_ramp),u_opacity:new h.Uniform1f(f,o.u_opacity)}),hillshade:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_image:new h.Uniform1i(f,o.u_image),u_latrange:new h.Uniform2f(f,o.u_latrange),u_light:new h.Uniform2f(f,o.u_light),u_shadow:new h.UniformColor(f,o.u_shadow),u_highlight:new h.UniformColor(f,o.u_highlight),u_accent:new h.UniformColor(f,o.u_accent)}),hillshadePrepare:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_image:new h.Uniform1i(f,o.u_image),u_dimension:new h.Uniform2f(f,o.u_dimension),u_zoom:new h.Uniform1f(f,o.u_zoom),u_unpack:new h.Uniform4f(f,o.u_unpack)}),line:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_pixels_to_tile_units:new h.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(f,o.u_units_to_pixels),u_dash_image:new h.Uniform1i(f,o.u_dash_image),u_gradient_image:new h.Uniform1i(f,o.u_gradient_image),u_image_height:new h.Uniform1f(f,o.u_image_height),u_texsize:new h.Uniform2f(f,o.u_texsize),u_scale:new h.Uniform3f(f,o.u_scale),u_mix:new h.Uniform1f(f,o.u_mix),u_alpha_discard_threshold:new h.Uniform1f(f,o.u_alpha_discard_threshold),u_trim_offset:new h.Uniform2f(f,o.u_trim_offset)}),linePattern:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_texsize:new h.Uniform2f(f,o.u_texsize),u_pixels_to_tile_units:new h.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(f,o.u_device_pixel_ratio),u_image:new h.Uniform1i(f,o.u_image),u_units_to_pixels:new h.Uniform2f(f,o.u_units_to_pixels),u_scale:new h.Uniform3f(f,o.u_scale),u_fade:new h.Uniform1f(f,o.u_fade),u_alpha_discard_threshold:new h.Uniform1f(f,o.u_alpha_discard_threshold)}),raster:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_tl_parent:new h.Uniform2f(f,o.u_tl_parent),u_scale_parent:new h.Uniform1f(f,o.u_scale_parent),u_fade_t:new h.Uniform1f(f,o.u_fade_t),u_opacity:new h.Uniform1f(f,o.u_opacity),u_image0:new h.Uniform1i(f,o.u_image0),u_image1:new h.Uniform1i(f,o.u_image1),u_brightness_low:new h.Uniform1f(f,o.u_brightness_low),u_brightness_high:new h.Uniform1f(f,o.u_brightness_high),u_saturation_factor:new h.Uniform1f(f,o.u_saturation_factor),u_contrast_factor:new h.Uniform1f(f,o.u_contrast_factor),u_spin_weights:new h.Uniform3f(f,o.u_spin_weights),u_perspective_transform:new h.Uniform2f(f,o.u_perspective_transform)}),symbolIcon:(f,o)=>({u_is_size_zoom_constant:new h.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,o.u_size_t),u_size:new h.Uniform1f(f,o.u_size),u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,o.u_fade_change),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new h.Uniform1i(f,o.u_is_text),u_pitch_with_map:new h.Uniform1i(f,o.u_pitch_with_map),u_texsize:new h.Uniform2f(f,o.u_texsize),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_camera_forward:new h.Uniform3f(f,o.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(f,o.u_tile_matrix),u_up_vector:new h.Uniform3f(f,o.u_up_vector),u_ecef_origin:new h.Uniform3f(f,o.u_ecef_origin),u_texture:new h.Uniform1i(f,o.u_texture)}),symbolSDF:(f,o)=>({u_is_size_zoom_constant:new h.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,o.u_size_t),u_size:new h.Uniform1f(f,o.u_size),u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,o.u_fade_change),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new h.Uniform1i(f,o.u_is_text),u_pitch_with_map:new h.Uniform1i(f,o.u_pitch_with_map),u_texsize:new h.Uniform2f(f,o.u_texsize),u_texture:new h.Uniform1i(f,o.u_texture),u_gamma_scale:new h.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(f,o.u_device_pixel_ratio),u_tile_id:new h.Uniform3f(f,o.u_tile_id),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_camera_forward:new h.Uniform3f(f,o.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(f,o.u_tile_matrix),u_up_vector:new h.Uniform3f(f,o.u_up_vector),u_ecef_origin:new h.Uniform3f(f,o.u_ecef_origin),u_is_halo:new h.Uniform1i(f,o.u_is_halo)}),symbolTextAndIcon:(f,o)=>({u_is_size_zoom_constant:new h.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,o.u_size_t),u_size:new h.Uniform1f(f,o.u_size),u_camera_to_center_distance:new h.Uniform1f(f,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,o.u_fade_change),u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new h.Uniform1i(f,o.u_is_text),u_pitch_with_map:new h.Uniform1i(f,o.u_pitch_with_map),u_texsize:new h.Uniform2f(f,o.u_texsize),u_texsize_icon:new h.Uniform2f(f,o.u_texsize_icon),u_texture:new h.Uniform1i(f,o.u_texture),u_texture_icon:new h.Uniform1i(f,o.u_texture_icon),u_gamma_scale:new h.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(f,o.u_is_halo)}),background:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_opacity:new h.Uniform1f(f,o.u_opacity),u_color:new h.UniformColor(f,o.u_color)}),backgroundPattern:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_opacity:new h.Uniform1f(f,o.u_opacity),u_image:new h.Uniform1i(f,o.u_image),u_pattern_tl_a:new h.Uniform2f(f,o.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(f,o.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(f,o.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(f,o.u_pattern_br_b),u_texsize:new h.Uniform2f(f,o.u_texsize),u_mix:new h.Uniform1f(f,o.u_mix),u_pattern_size_a:new h.Uniform2f(f,o.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(f,o.u_pattern_size_b),u_scale_a:new h.Uniform1f(f,o.u_scale_a),u_scale_b:new h.Uniform1f(f,o.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,o.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(f,o.u_tile_units_to_pixels)}),terrainRaster:kl,terrainDepth:kl,skybox:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_sun_direction:new h.Uniform3f(f,o.u_sun_direction),u_cubemap:new h.Uniform1i(f,o.u_cubemap),u_opacity:new h.Uniform1f(f,o.u_opacity),u_temporal_offset:new h.Uniform1f(f,o.u_temporal_offset)}),skyboxGradient:(f,o)=>({u_matrix:new h.UniformMatrix4f(f,o.u_matrix),u_color_ramp:new h.Uniform1i(f,o.u_color_ramp),u_center_direction:new h.Uniform3f(f,o.u_center_direction),u_radius:new h.Uniform1f(f,o.u_radius),u_opacity:new h.Uniform1f(f,o.u_opacity),u_temporal_offset:new h.Uniform1f(f,o.u_temporal_offset)}),skyboxCapture:(f,o)=>({u_matrix_3f:new h.UniformMatrix3f(f,o.u_matrix_3f),u_sun_direction:new h.Uniform3f(f,o.u_sun_direction),u_sun_intensity:new h.Uniform1f(f,o.u_sun_intensity),u_color_tint_r:new h.Uniform4f(f,o.u_color_tint_r),u_color_tint_m:new h.Uniform4f(f,o.u_color_tint_m),u_luminance:new h.Uniform1f(f,o.u_luminance)}),globeRaster:(f,o)=>({u_proj_matrix:new h.UniformMatrix4f(f,o.u_proj_matrix),u_globe_matrix:new h.UniformMatrix4f(f,o.u_globe_matrix),u_normalize_matrix:new h.UniformMatrix4f(f,o.u_normalize_matrix),u_merc_matrix:new h.UniformMatrix4f(f,o.u_merc_matrix),u_zoom_transition:new h.Uniform1f(f,o.u_zoom_transition),u_merc_center:new h.Uniform2f(f,o.u_merc_center),u_image0:new h.Uniform1i(f,o.u_image0),u_grid_matrix:new h.UniformMatrix3f(f,o.u_grid_matrix),u_frustum_tl:new h.Uniform3f(f,o.u_frustum_tl),u_frustum_tr:new h.Uniform3f(f,o.u_frustum_tr),u_frustum_br:new h.Uniform3f(f,o.u_frustum_br),u_frustum_bl:new h.Uniform3f(f,o.u_frustum_bl),u_globe_pos:new h.Uniform3f(f,o.u_globe_pos),u_globe_radius:new h.Uniform1f(f,o.u_globe_radius),u_viewport:new h.Uniform2f(f,o.u_viewport)}),globeAtmosphere:(f,o)=>({u_frustum_tl:new h.Uniform3f(f,o.u_frustum_tl),u_frustum_tr:new h.Uniform3f(f,o.u_frustum_tr),u_frustum_br:new h.Uniform3f(f,o.u_frustum_br),u_frustum_bl:new h.Uniform3f(f,o.u_frustum_bl),u_horizon:new h.Uniform1f(f,o.u_horizon),u_transition:new h.Uniform1f(f,o.u_transition),u_fadeout_range:new h.Uniform1f(f,o.u_fadeout_range),u_color:new h.Uniform4f(f,o.u_color),u_high_color:new h.Uniform4f(f,o.u_high_color),u_space_color:new h.Uniform4f(f,o.u_space_color),u_star_intensity:new h.Uniform1f(f,o.u_star_intensity),u_star_density:new h.Uniform1f(f,o.u_star_density),u_star_size:new h.Uniform1f(f,o.u_star_size),u_temporal_offset:new h.Uniform1f(f,o.u_temporal_offset),u_horizon_angle:new h.Uniform1f(f,o.u_horizon_angle),u_rotation_matrix:new h.UniformMatrix4f(f,o.u_rotation_matrix)})};let ja;function th(f,o,u,g,v,b,T){const D=f.context,I=D.gl,O=f.transform,R=f.useProgram("collisionBox"),B=[];let $=0,Z=0;for(let ue=0;ue<g.length;ue++){const te=g[ue],oe=o.getTile(te),pe=oe.getBucket(u);if(!pe)continue;const Pe=jr(te,pe,O);let Be=Pe;0===v[0]&&0===v[1]||(Be=f.translatePosMatrix(Pe,oe,v,b));const ke=T?pe.textCollisionBox:pe.iconCollisionBox,at=pe.collisionCircleArray;if(at.length>0){const ae=h.create(),Ie=Be;h.mul(ae,pe.placementInvProjMatrix,O.glCoordMatrix),h.mul(ae,ae,pe.placementViewportMatrix),B.push({circleArray:at,circleOffset:Z,transform:Ie,invTransform:ae,projection:pe.getProjection()}),$+=at.length/4,Z=$}ke&&(f.terrain&&f.terrain.setupElevationDraw(oe,R),R.draw(D,I.LINES,h.DepthMode.disabled,h.StencilMode.disabled,f.colorModeForRenderPass(),h.CullFaceMode.disabled,$s(Be,O,oe,pe.getProjection()),u.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,O.zoom,null,ke.collisionVertexBuffer,ke.collisionVertexBufferExt))}if(!T||!B.length)return;const X=f.useProgram("collisionCircle"),G=new h.StructArrayLayout2f1f2i16;G.resize(4*$),G._trim();let ie=0;for(const ue of B)for(let te=0;te<ue.circleArray.length/4;te++){const oe=4*te,pe=ue.circleArray[oe+0],Pe=ue.circleArray[oe+1],Be=ue.circleArray[oe+2],ke=ue.circleArray[oe+3];G.emplace(ie++,pe,Pe,Be,ke,0),G.emplace(ie++,pe,Pe,Be,ke,1),G.emplace(ie++,pe,Pe,Be,ke,2),G.emplace(ie++,pe,Pe,Be,ke,3)}(!ja||ja.length<2*$)&&(ja=function(ue){const te=2*ue,oe=new h.StructArrayLayout3ui6;oe.resize(te),oe._trim();for(let pe=0;pe<te;pe++){const Pe=6*pe;oe.uint16[Pe+0]=4*pe+0,oe.uint16[Pe+1]=4*pe+1,oe.uint16[Pe+2]=4*pe+2,oe.uint16[Pe+3]=4*pe+2,oe.uint16[Pe+4]=4*pe+3,oe.uint16[Pe+5]=4*pe+0}return oe}($));const W=D.createIndexBuffer(ja,!0),J=D.createVertexBuffer(G,h.collisionCircleLayout.members,!0);for(const ue of B){const te={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(q=O).getCameraToCenterDistance(ue.projection),u_viewport_size:[q.width,q.height]};X.draw(D,I.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,f.colorModeForRenderPass(),h.CullFaceMode.disabled,te,u.id,J,W,h.SegmentVector.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,O.zoom)}var q;J.destroy(),W.destroy()}const Fl=h.create();function nh(f,o,u,g,v,b){const{horizontalAlign:T,verticalAlign:D}=h.getAnchorAlignment(f),I=-(T-.5)*o,O=-(D-.5)*u,R=h.evaluateVariableOffset(f,g);return new h.pointGeometry((I/v+R[0])*b,(O/v+R[1])*b)}function $a(f,o,u,g,v,b,T,D,I,O,R){const B=f.text.placedSymbolArray,$=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,X={},G=ad(D,f.getProjection(),b),ie=b.elevation,W=f.getProjection().upVectorScale(D.canonical,b.center.lat,b.worldSize);$.clear();for(let J=0;J<B.length;J++){const q=B.get(J),ue=f.allowVerticalPlacement&&!q.placedOrientation,te=q.hidden||!q.crossTileID||ue?null:g[q.crossTileID];if(te){const oe=new h.pointGeometry(q.tileAnchorX,q.tileAnchorY),pe=f.getProjection().upVector(D.canonical,oe.x,oe.y),Pe=ie?ie.getAtTileOffset(D,oe.x,oe.y):0,Be=is([q.projectedAnchorX+Pe*pe[0]*W.metersToTile,q.projectedAnchorY+Pe*pe[1]*W.metersToTile,q.projectedAnchorZ+Pe*pe[2]*W.metersToTile],u?G:T),ke=ur(b.getCameraToCenterDistance(f.getProjection()),Be.signedDistanceFromCamera);let at=v.evaluateSizeForFeature(f.textSizeData,O,q)*ke/h.ONE_EM;u&&(at*=f.tilePixelRatio/I);const{width:ae,height:Ie,anchor:Ze,textOffset:bt,textScale:qe}=te,Rt=nh(Ze,ae,Ie,bt,qe,at);let mt;if(u){const _t=oe.add(Rt),{x:gt,y:It,z:Jt}=f.getProjection().projectTilePoint(_t.x,_t.y,D.canonical);mt=is([gt+Pe*pe[0]*W.metersToTile,It+Pe*pe[1]*W.metersToTile,Jt+Pe*pe[2]*W.metersToTile],T).point}else{const _t=o?Rt.rotate(-b.angle):Rt;mt=[Be.point[0]+_t.x,Be.point[1]+_t.y,0]}const vt=f.allowVerticalPlacement&&q.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<q.numGlyphs;_t++)h.addDynamicAttributes($,mt[0],mt[1],mt[2],vt);R&&q.associatedIconIndex>=0&&(X[q.associatedIconIndex]={shiftedAnchor:mt,angle:vt})}else pn(q.numGlyphs,$)}if(R){Z.clear();const J=f.icon.placedSymbolArray;for(let q=0;q<J.length;q++){const ue=J.get(q);if(ue.hidden)pn(ue.numGlyphs,Z);else{const te=X[q];if(te)for(let oe=0;oe<ue.numGlyphs;oe++)h.addDynamicAttributes(Z,te.shiftedAnchor[0],te.shiftedAnchor[1],te.shiftedAnchor[2],te.angle);else pn(ue.numGlyphs,Z)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData($)}function Ii(f,o,u){return u.iconsInText&&o?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function rh(f,o,u,g,v,b,T,D,I,O,R,B){const $=f.context,Z=$.gl,X=f.transform,G="map"===D,ie="map"===I,W=G&&"point"!==u.layout.get("symbol-placement"),J=G&&!ie&&!W,q=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let ue=!1;const te=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),oe=[h.mercatorXfromLng(X.center.lng),h.mercatorYfromLat(X.center.lat)],pe=u.layout.get("text-variable-anchor"),Pe="globe"===X.projection.name,Be=[],ke=[0,-1,0];let at=ke;!Pe&&!X.mercatorFromTransition||G||(at=function(ae){const Ie=ae._camera.getWorldToCamera(ae.worldSize,1),Ze=h.multiply([],Ie,ae.globeMatrix);h.invert(Ze,Ze);const bt=[0,0,0],qe=[0,1,0,0];return h.transformMat4$1(qe,qe,Ze),bt[0]=qe[0],bt[1]=qe[1],bt[2]=qe[2],h.normalize(bt,bt),bt}(X));for(const ae of g){const Ie=o.getTile(ae),Ze=Ie.getBucket(u);if(!Ze||"mercator"===Ze.projection.name&&Pe)continue;const bt=v?Ze.text:Ze.icon;if(!bt||Ze.fullyClipped||!bt.segments.get().length)continue;const qe=bt.programConfigurations.get(u.id),Rt=v||Ze.sdfIcons,mt=v?Ze.textSizeData:Ze.iconSizeData,vt=ie||0!==X.pitch,_t=h.evaluateSizeForZoom(mt,X.zoom);let gt,It,Jt,mn,Nt=[0,0],ln=null;if(v){if(It=Ie.glyphAtlasTexture,Jt=Z.LINEAR,gt=Ie.glyphAtlasTexture.size,Ze.iconsInText){Nt=Ie.imageAtlasTexture.size,ln=Ie.imageAtlasTexture;const pi="composite"===mt.kind||"camera"===mt.kind;mn=vt||f.options.rotating||f.options.zooming||pi?Z.LINEAR:Z.NEAREST}}else{const pi=1!==u.layout.get("icon-size").constantOr(0)||Ze.iconsNeedLinear;It=Ie.imageAtlasTexture,Jt=Rt||f.options.rotating||f.options.zooming||pi||vt?Z.LINEAR:Z.NEAREST,gt=Ie.imageAtlasTexture.size}const Qn="globe"===Ze.projection.name,Mr=Qn?at:ke,Sr=Qn?h.globeToMercatorTransition(X.zoom):0,mr=ad(ae,Ze.getProjection(),X),fo=X.calculatePixelsToTileUnitsMatrix(Ie),Ci=cn(mr,Ie.tileID.canonical,ie,G,X,Ze.getProjection(),fo),Xs=f.terrain&&ie&&W?h.invert(h.create(),Ci):Fl,gr=Ns(mr,Ie.tileID.canonical,ie,G,X,Ze.getProjection(),fo),Ir=pe&&Ze.hasTextData(),Zn="none"!==u.layout.get("icon-text-fit")&&Ir&&Ze.hasIconData();if(W){const pi=X.elevation,ko=pi?pi.getAtTileOffsetFunc(ae,X.center.lat,X.worldSize,Ze.getProjection()):ya=>[0,0,0],cs=rs(mr,Ie.tileID.canonical,ie,G,X,Ze.getProjection(),fo);Go(Ze,mr,f,v,cs,gr,ie,O,ko,ae)}const $r=W||v&&pe||Zn,Ei=f.translatePosMatrix(mr,Ie,b,T),wr=$r?Fl:Ci,zr=f.translatePosMatrix(gr,Ie,b,T,!0),_a=Ze.getProjection().createInversionMatrix(X,ae.canonical),as=[];f.terrain&&ie&&as.push("PITCH_WITH_MAP_TERRAIN"),Qn&&as.push("PROJECTION_GLOBE_VIEW"),$r&&as.push("PROJECTED_POS_ON_VIEWPORT");const Qa=Rt&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let el;el=Rt?Ze.iconsInText?pd(mt.kind,_t,J,ie,f,Ei,wr,zr,gt,Nt,ae,Sr,oe,_a,Mr,Ze.getProjection()):Ua(mt.kind,_t,J,ie,f,Ei,wr,zr,v,gt,!0,ae,Sr,oe,_a,Mr,Ze.getProjection()):ro(mt.kind,_t,J,ie,f,Ei,wr,zr,v,gt,ae,Sr,oe,_a,Mr,Ze.getProjection());const ls={program:f.useProgram(Ii(Rt,v,Ze),qe,as),buffers:bt,uniformValues:el,atlasTexture:It,atlasTextureIcon:ln,atlasInterpolation:Jt,atlasInterpolationIcon:mn,isSDF:Rt,hasHalo:Qa,tile:Ie,labelPlaneMatrixInv:Xs};if(q&&Ze.canOverlap){ue=!0;const pi=bt.segments.get();for(const ko of pi)Be.push({segments:new h.SegmentVector([ko]),sortKey:ko.sortKey,state:ls})}else Be.push({segments:bt.segments,sortKey:0,state:ls})}ue&&Be.sort((ae,Ie)=>ae.sortKey-Ie.sortKey);for(const ae of Be){const Ie=ae.state;if(f.terrain&&f.terrain.setupElevationDraw(Ie.tile,Ie.program,{useDepthForOcclusion:!Pe,labelPlaneMatrixInv:Ie.labelPlaneMatrixInv}),$.activeTexture.set(Z.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,Z.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&($.activeTexture.set(Z.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ie.isSDF){const Ze=Ie.uniformValues;Ie.hasHalo&&(Ze.u_is_halo=1,Gi(Ie.buffers,ae.segments,u,f,Ie.program,te,R,B,Ze)),Ze.u_is_halo=0}Gi(Ie.buffers,ae.segments,u,f,Ie.program,te,R,B,Ie.uniformValues)}}function Gi(f,o,u,g,v,b,T,D,I){const O=g.context;v.draw(O,O.gl.TRIANGLES,b,T,D,h.CullFaceMode.disabled,I,u.id,f.layoutVertexBuffer,f.indexBuffer,o,u.paint,g.transform.zoom,f.programConfigurations.get(u.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer)}function So(f,o,u,g,v,b,T){const D=f.context.gl,I=u.paint.get("fill-pattern"),O=I&&I.constantOr(1),R=u.getCrossfadeParameters();let B,$,Z,X,G;T?($=O&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=D.LINES):($=O?"fillPattern":"fill",B=D.TRIANGLES);for(const ie of g){const W=o.getTile(ie);if(O&&!W.patternsLoaded())continue;const J=W.getBucket(u);if(!J)continue;f.prepareDrawTile();const q=J.programConfigurations.get(u.id),ue=f.useProgram($,q);O&&(f.context.activeTexture.set(D.TEXTURE0),W.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),q.updatePaintBuffers(R));const te=I.constantOr(null);if(te&&W.imageAtlas){const pe=W.imageAtlas,Pe=pe.patternPositions[te.to.toString()],Be=pe.patternPositions[te.from.toString()];Pe&&Be&&q.setConstantPatternPositions(Pe,Be)}const oe=f.translatePosMatrix(ie.projMatrix,W,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(T){X=J.indexBuffer2,G=J.segments2;const pe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];Z="fillOutlinePattern"===$&&O?Pr(oe,f,R,W,pe):An(oe,pe)}else X=J.indexBuffer,G=J.segments,Z=O?zt(oe,f,R,W):zi(oe);f.prepareDrawProgram(f.context,ue,ie.toUnwrapped()),ue.draw(f.context,B,v,f.stencilModeForClipping(ie),b,h.CullFaceMode.disabled,Z,u.id,J.layoutVertexBuffer,X,G,u.paint,f.transform.zoom,q)}}function zl(f,o,u,g,v,b,T){const D=f.context,I=D.gl,O=f.transform,R=u.paint.get("fill-extrusion-pattern"),B=R.constantOr(1),$=u.getCrossfadeParameters(),Z=u.paint.get("fill-extrusion-opacity"),X="globe"===O.projection.name?h.fillExtrusionHeightLift():0,G="globe"===O.projection.name,ie=G?h.globeToMercatorTransition(O.zoom):0,W=[h.mercatorXfromLng(O.center.lng),h.mercatorYfromLat(O.center.lat)],J=[];G&&J.push("PROJECTION_GLOBE_VIEW");for(const q of g){const ue=o.getTile(q),te=ue.getBucket(u);if(!te||te.projection.name!==O.projection.name)continue;const oe=te.programConfigurations.get(u.id),pe=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",oe,J);if(f.terrain){const Ie=f.terrain;if(f.style.terrainSetForDrapingOnly())Ie.setupElevationDraw(ue,pe,{useMeterToDem:!0});else{if(!te.enableTerrain)continue;if(Ie.setupElevationDraw(ue,pe,{useMeterToDem:!0}),Bl(D,o,q,te,u,Ie),!te.centroidVertexBuffer){const Ze=pe.attributes.a_centroid_pos;void 0!==Ze&&I.vertexAttrib2f(Ze,0,0)}}}B&&(f.context.activeTexture.set(I.TEXTURE0),ue.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),oe.updatePaintBuffers($));const Pe=R.constantOr(null);if(Pe&&ue.imageAtlas){const Ie=ue.imageAtlas,Ze=Ie.patternPositions[Pe.to.toString()],bt=Ie.patternPositions[Pe.from.toString()];Ze&&bt&&oe.setConstantPatternPositions(Ze,bt)}const Be=f.translatePosMatrix(q.projMatrix,ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ke=O.projection.createInversionMatrix(O,q.canonical),at=u.paint.get("fill-extrusion-vertical-gradient"),ae=B?Fi(Be,f,at,Z,q,$,ue,X,ie,W,ke):ji(Be,f,at,Z,q,X,ie,W,ke);f.prepareDrawProgram(D,pe,q.toUnwrapped()),pe.draw(D,D.gl.TRIANGLES,v,b,T,h.CullFaceMode.backCCW,ae,u.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,u.paint,f.transform.zoom,oe,f.terrain?te.centroidVertexBuffer:null,G?te.layoutVertexExtBuffer:null)}}function Bl(f,o,u,g,v,b){const T=[W=>{let J=W.canonical.x-1,q=W.wrap;return J<0&&(J=(1<<W.canonical.z)-1,q--),new h.OverscaledTileID(W.overscaledZ,q,W.canonical.z,J,W.canonical.y)},W=>{let J=W.canonical.x+1,q=W.wrap;return J===1<<W.canonical.z&&(J=0,q++),new h.OverscaledTileID(W.overscaledZ,q,W.canonical.z,J,W.canonical.y)},W=>new h.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new h.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],D=W=>{const J=o.getSource().minzoom,q=te=>{const oe=o.getTileByID(te);if(oe&&oe.hasData())return oe.getBucket(v)},ue=[0,-1,1];for(const te of ue){if(W.overscaledZ+te<J)continue;const oe=q(W.calculateScaledKey(W.overscaledZ+te));if(oe)return oe}},I=[0,0,0],O=(W,J)=>(I[0]=Math.min(W.min.y,J.min.y),I[1]=Math.max(W.max.y,J.max.y),I[2]=h.EXTENT-J.min.x>W.max.x?J.min.x-h.EXTENT:W.max.x,I),R=(W,J)=>(I[0]=Math.min(W.min.x,J.min.x),I[1]=Math.max(W.max.x,J.max.x),I[2]=h.EXTENT-J.min.y>W.max.y?J.min.y-h.EXTENT:W.max.y,I),B=[(W,J)=>O(W,J),(W,J)=>O(J,W),(W,J)=>R(W,J),(W,J)=>R(J,W)],$=new h.pointGeometry(0,0);let Z,X,G;const ie=(W,J,q,ue,te)=>{const oe=[[ue?q:W,ue?W:q,0],[ue?q:J,ue?J:q,0]],pe=te<0?h.EXTENT+te:te,Pe=[ue?pe:(W+J)/2,ue?(W+J)/2:pe,0];return 0===q&&te<0||0!==q&&te>0?b.getForTilePoints(G,[Pe],!0,X):oe.push(Pe),b.getForTilePoints(u,oe,!0,Z),Math.max(oe[0][2],oe[1][2],Pe[2])/b.exaggeration()};for(let W=0;W<4;W++){const J=(W<2?1:5)-W,q=g.borders[W];if(0===q.length)continue;const ue=G=T[W](u),te=D(ue);if(!(te&&te instanceof h.FillExtrusionBucket&&te.enableTerrain)||g.borderDoneWithNeighborZ[W]===te.canonical.z&&te.borderDoneWithNeighborZ[J]===g.canonical.z||(X=b.findDEMTileFor(ue),!X||!X.dem))continue;if(!Z){const Be=b.findDEMTileFor(u);if(!Be||!Be.dem)return;Z=Be}const oe=te.borders[J];let pe=0;const Pe=te.borderDoneWithNeighborZ[J]!==g.canonical.z;if(g.canonical.z===te.canonical.z){for(let Be=0;Be<q.length;Be++){const ke=g.featuresOnBorder[q[Be]],at=ke.borders[W];let ae;for(;pe<oe.length&&(ae=te.featuresOnBorder[oe[pe]],!(ae.borders[J][1]>at[0]+3));)Pe&&te.encodeCentroid(void 0,ae,!1),pe++;if(ae&&pe<oe.length){const Ie=pe;let Ze=0;for(;!(ae.borders[J][0]>at[1]-3)&&(Ze++,++pe!==oe.length);)ae=te.featuresOnBorder[oe[pe]];if(ae=te.featuresOnBorder[oe[Ie]],ke.intersectsCount()>1||ae.intersectsCount()>1||1!==Ze){1!==Ze&&(pe=Ie),g.encodeCentroid(void 0,ke,!1),Pe&&te.encodeCentroid(void 0,ae,!1);continue}const bt=B[W](ke,ae),qe=W%2?h.EXTENT-1:0;$.x=ie(bt[0],Math.min(h.EXTENT-1,bt[1]),qe,W<2,bt[2]),$.y=0,g.encodeCentroid($,ke,!1),Pe&&te.encodeCentroid($,ae,!1)}else g.encodeCentroid(void 0,ke,!1)}g.borderDoneWithNeighborZ[W]=te.canonical.z,g.needsCentroidUpdate=!0,Pe&&(te.borderDoneWithNeighborZ[J]=g.canonical.z,te.needsCentroidUpdate=!0)}else{for(const Be of q)g.encodeCentroid(void 0,g.featuresOnBorder[Be],!1);if(Pe){for(const Be of oe)te.encodeCentroid(void 0,te.featuresOnBorder[Be],!1);te.borderDoneWithNeighborZ[J]=g.canonical.z,te.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[W]=te.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const Cs=new h.Color(1,0,0,1),io=new h.Color(0,1,0,1),Tp=new h.Color(0,0,1,1),Dc=new h.Color(1,0,1,1),Nl=new h.Color(0,1,1,1);function fd(f,o,u,g){Jn(f,0,o+u/2,f.transform.width,u,g)}function md(f,o,u,g){Jn(f,o-u/2,0,u,f.transform.height,g)}function Jn(f,o,u,g,v,b){const T=f.context,D=T.gl;D.enable(D.SCISSOR_TEST),D.scissor(o*h.exported.devicePixelRatio,u*h.exported.devicePixelRatio,g*h.exported.devicePixelRatio,v*h.exported.devicePixelRatio),T.clear({color:b}),D.disable(D.SCISSOR_TEST)}function gd(f,o,u){const g=f.context,v=g.gl,b="globe"===f.transform.projection.name,T=u.projMatrix,D=f.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),I=o.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(I,D);const O=h.DepthMode.disabled,R=h.StencilMode.disabled,B=f.colorModeForRenderPass(),$="$debug";g.activeTexture.set(v.TEXTURE0),f.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),b?I._makeGlobeTileDebugBuffers(f.context,f.transform.projection):I._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const Z=I._tileDebugBuffer||f.debugBuffer,X=I._tileDebugIndexBuffer||f.debugIndexBuffer,G=I._tileDebugSegments||f.debugSegments;D.draw(g,v.LINE_STRIP,O,R,B,h.CullFaceMode.disabled,Fr(T,h.Color.red),$,Z,X,G,null,null,null,I._globeTileDebugBorderBuffer);const ie=I.latestRawTileData,W=Math.floor((ie&&ie.byteLength||0)/1024),J=o.getTile(u).tileSize,q=512/Math.min(J,512)*(u.overscaledZ/f.transform.zoom)*.5;let ue=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ue+=` => ${u.overscaledZ}`),function(Pe,Be){Pe.initDebugOverlayCanvas();const ke=Pe.debugOverlayCanvas,at=Pe.context.gl,ae=Pe.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,ke.width,ke.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(Be,5,5),ae.strokeText(Be,5,5),Pe.debugOverlayTexture.update(ke),Pe.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(f,`${ue} ${W}kb`);const te=I._tileDebugTextBuffer||f.debugBuffer,oe=I._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,pe=I._tileDebugTextSegments||f.debugSegments;D.draw(g,v.TRIANGLES,O,R,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,Fr(T,h.Color.transparent,q),$,te,oe,pe,null,null,null,I._globeTileDebugTextBuffer)}const a_=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:im}=a_;function ss(f,o,u,g){f.emplaceBack(o,u,g)}class om{constructor(o){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,ss(this.vertexArray,-1,-1,1),ss(this.vertexArray,1,-1,1),ss(this.vertexArray,-1,1,1),ss(this.vertexArray,1,1,1),ss(this.vertexArray,-1,-1,-1),ss(this.vertexArray,1,-1,-1),ss(this.vertexArray,-1,1,-1),ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,im),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Sc(f,o,u,g,v,b){const T=f.gl,D=o.paint.get("sky-atmosphere-color"),I=o.paint.get("sky-atmosphere-halo-color"),O=o.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:h.fromMat4(h.create$1(),g),u_sun_direction:v,u_sun_intensity:O,u_color_tint_r:[(X=D).r,X.g,X.b,X.a],u_color_tint_m:[(G=I).r,G.g,G.b,G.a],u_luminance:5e-5};var X,G;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),u.draw(f,T.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const sm=h.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class l_{constructor(o){const u=new h.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new h.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(u,sm.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=h.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const _d={symbol:function(f,o,u,g,v){if("translucent"!==f.renderPass)return;const b=h.StencilMode.disabled,T=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(D,I,O,R,B,$,Z){const X=I.transform,G="map"===B,ie="map"===$;for(const W of D){const J=R.getTile(W),q=J.getBucket(O);if(!q||!q.text||!q.text.segments.get().length)continue;const ue=h.evaluateSizeForZoom(q.textSizeData,X.zoom),te=ad(W,q.getProjection(),X),oe=X.calculatePixelsToTileUnitsMatrix(J),pe=cn(te,J.tileID.canonical,ie,G,X,q.getProjection(),oe),Pe="none"!==O.layout.get("icon-text-fit")&&q.hasIconData();if(ue){const Be=Math.pow(2,X.zoom-J.tileID.overscaledZ);$a(q,G,ie,Z,h.symbolSize,X,pe,W,Be,ue,Pe)}}}(g,f,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&rh(f,o,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,T),0!==u.paint.get("text-opacity").constantOr(1)&&rh(f,o,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,T),o.map.showCollisionBoxes&&(th(f,o,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),th(f,o,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),T=u.paint.get("circle-stroke-opacity"),D=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===T.constantOr(1)))return;const I=f.context,O=I.gl,R=f.transform,B=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),$=h.StencilMode.disabled,Z=f.colorModeForRenderPass(),X="globe"===R.projection.name,G=[h.mercatorXfromLng(R.center.lng),h.mercatorYfromLat(R.center.lat)],ie=[];for(let J=0;J<g.length;J++){const q=g[J],ue=o.getTile(q),te=ue.getBucket(u);if(!te||te.projection.name!==R.projection.name)continue;const oe=te.programConfigurations.get(u.id),pe=wi(u);X&&pe.push("PROJECTION_GLOBE_VIEW");const Pe=f.useProgram("circle",oe,pe),Be=te.layoutVertexBuffer,ke=te.globeExtVertexBuffer,at=te.indexBuffer,ae=R.projection.createInversionMatrix(R,q.canonical),Ie={programConfiguration:oe,program:Pe,layoutVertexBuffer:Be,globeExtVertexBuffer:ke,indexBuffer:at,uniformValues:js(f,q,ue,ae,G,u),tile:ue};if(D){const Ze=te.segments.get();for(const bt of Ze)ie.push({segments:new h.SegmentVector([bt]),sortKey:bt.sortKey,state:Ie})}else ie.push({segments:te.segments,sortKey:0,state:Ie})}D&&ie.sort((J,q)=>J.sortKey-q.sortKey);const W={useDepthForOcclusion:!X};for(const J of ie){const{programConfiguration:q,program:ue,layoutVertexBuffer:te,globeExtVertexBuffer:oe,indexBuffer:pe,uniformValues:Pe,tile:Be}=J.state,ke=J.segments;f.terrain&&f.terrain.setupElevationDraw(Be,ue,W),f.prepareDrawProgram(I,ue,Be.tileID.toUnwrapped()),ue.draw(I,O.TRIANGLES,B,$,Z,h.CullFaceMode.disabled,Pe,u.id,te,pe,ke,u.paint,R.zoom,q,X?oe:null)}},heatmap:function(f,o,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,b=v.gl,T=h.StencilMode.disabled,D=new h.ColorMode([b.ONE,b.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(Z,X,G,ie){const W=Z.gl,J=X.width*ie,q=X.height*ie;Z.activeTexture.set(W.TEXTURE1),Z.viewport.set([0,0,J,q]);let ue=G.heatmapFbo;if(!ue||ue&&(ue.width!==J||ue.height!==q)){ue&&ue.destroy();const te=W.createTexture();W.bindTexture(W.TEXTURE_2D,te),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ue=G.heatmapFbo=Z.createFramebuffer(J,q,!1),function(oe,pe,Pe,Be,ke,at){const ae=oe.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,ke,at,0,ae.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),Be.colorAttachment.set(Pe)}(Z,0,te,ue,J,q)}else W.bindTexture(W.TEXTURE_2D,ue.colorAttachment.get()),Z.bindFramebuffer.set(ue.framebuffer)})(v,f,u,"globe"===f.transform.projection.name?.5:.25),v.clear({color:h.Color.transparent});const I=f.transform,O="globe"===I.projection.name,R=O?["PROJECTION_GLOBE_VIEW"]:null,B=O?h.CullFaceMode.frontCCW:h.CullFaceMode.disabled,$=[h.mercatorXfromLng(I.center.lng),h.mercatorYfromLat(I.center.lat)];for(let Z=0;Z<g.length;Z++){const X=g[Z];if(o.hasRenderableParent(X))continue;const G=o.getTile(X),ie=G.getBucket(u);if(!ie||ie.projection.name!==I.projection.name)continue;const W=ie.programConfigurations.get(u.id),J=f.useProgram("heatmap",W,R),{zoom:q}=f.transform;f.terrain&&f.terrain.setupElevationDraw(G,J),f.prepareDrawProgram(v,J,X.toUnwrapped());const ue=I.projection.createInversionMatrix(I,X.canonical);J.draw(v,b.TRIANGLES,h.DepthMode.disabled,T,D,B,Rl(f,X,G,ue,$,q,u.paint.get("heatmap-intensity")),u.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,u.paint,f.transform.zoom,W,O?ie.globeExtVertexBuffer:null)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,b){const T=v.context,D=T.gl,I=b.heatmapFbo;if(!I)return;T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,I.colorAttachment.get()),T.activeTexture.set(D.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new h.Texture(T,b.colorRamp,D.RGBA)),O.bind(D.LINEAR,D.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(T,D.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,v.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(f,u))},line:function(f,o,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const T=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),D=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture?1:h.exported.devicePixelRatio,O=u.paint.get("line-dasharray"),R=O.constantOr(1),B=u.layout.get("line-cap"),$=u.paint.get("line-pattern"),Z=$.constantOr(1),X=u.paint.get("line-gradient"),G=u.getCrossfadeParameters(),ie=Z?"linePattern":"line",W=f.context,J=W.gl,q=(te=>{const oe=[];ws(te)&&oe.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const pe=te.paint.get("line-trim-offset");0===pe[0]&&0===pe[1]||oe.push("RENDER_LINE_TRIM_OFFSET");const Pe=te.paint.get("line-pattern").constantOr(1),Be=1!==te.paint.get("line-opacity").constantOr(1);return!Pe&&Be&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(u);let ue=q.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ue=!1);for(const te of g){const oe=o.getTile(te);if(Z&&!oe.patternsLoaded())continue;const pe=oe.getBucket(u);if(!pe)continue;f.prepareDrawTile();const Pe=pe.programConfigurations.get(u.id),Be=f.useProgram(ie,Pe,q),ke=$.constantOr(null);if(ke&&oe.imageAtlas){const mt=oe.imageAtlas,vt=mt.patternPositions[ke.to.toString()],_t=mt.patternPositions[ke.from.toString()];vt&&_t&&Pe.setConstantPatternPositions(vt,_t)}const at=O.constantOr(null),ae=B.constantOr(null);if(!Z&&at&&ae&&oe.lineAtlas){const mt=oe.lineAtlas,vt=mt.getDash(at.to,ae),_t=mt.getDash(at.from,ae);vt&&_t&&Pe.setConstantPatternPositions(vt,_t)}let[Ie,Ze]=u.paint.get("line-trim-offset");("round"===ae||"square"===ae)&&Ie!==Ze&&(0===Ie&&(Ie-=1),1===Ze&&(Ze+=1));const bt=f.terrain?te.projMatrix:null,qe=Z?Qu(f,oe,u,G,bt,I):Fn(f,oe,u,G,bt,pe.lineClipsArray.length,I,[Ie,Ze]);if(X){const mt=pe.gradients[u.id];let vt=mt.texture;if(u.gradientVersion!==mt.version){let _t=256;if(u.stepInterpolant){const gt=o.getSource().maxzoom,It=te.canonical.z===gt?Math.ceil(1<<f.transform.maxZoom-te.canonical.z):1;_t=h.clamp(h.nextPowerOfTwo(pe.maxLineLength/h.EXTENT*1024*It),256,W.maxTextureSize)}mt.gradient=h.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:mt.gradient||void 0,clips:pe.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new h.Texture(W,mt.gradient,J.RGBA),mt.version=u.gradientVersion,vt=mt.texture}W.activeTexture.set(J.TEXTURE1),vt.bind(u.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}R&&(W.activeTexture.set(J.TEXTURE0),oe.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),Pe.updatePaintBuffers(G)),Z&&(W.activeTexture.set(J.TEXTURE0),oe.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Pe.updatePaintBuffers(G)),f.prepareDrawProgram(W,Be,te.toUnwrapped());const Rt=mt=>{Be.draw(W,J.TRIANGLES,T,mt,D,h.CullFaceMode.disabled,qe,u.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,u.paint,f.transform.zoom,Pe,pe.layoutVertexBuffer2)};if(ue){const mt=f.stencilModeForClipping(te).ref;0===mt&&f.terrain&&W.clear({stencil:0});const vt={func:J.EQUAL,mask:255};qe.u_alpha_discard_threshold=.8,Rt(new h.StencilMode(vt,mt,255,J.KEEP,J.KEEP,J.INVERT)),qe.u_alpha_discard_threshold=0,Rt(new h.StencilMode(vt,mt,255,J.KEEP,J.KEEP,J.KEEP))}else Rt(f.stencilModeForClipping(te))}ue&&(f.resetStencilClippingMasks(),f.terrain&&W.clear({stencil:0}))},fill:function(f,o,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const T=f.colorModeForRenderPass(),D=u.paint.get("fill-pattern"),I=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&1===v.constantOr(h.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(f.renderPass===I){const O=f.depthModeForSublayer(1,"opaque"===f.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);So(f,o,u,g,O,T,!1)}if("translucent"===f.renderPass&&u.paint.get("fill-antialias")){const O=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);So(f,o,u,g,O,T,!0)}},"fill-extrusion":function(f,o,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const b=new h.DepthMode(f.context.gl.LEQUAL,h.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))zl(f,o,u,g,b,h.StencilMode.disabled,h.ColorMode.disabled),zl(f,o,u,g,b,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const T=f.colorModeForRenderPass();zl(f,o,u,g,b,h.StencilMode.disabled,T)}}},hillshade:function(f,o,u,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,b=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),D=f.terrain&&f.terrain.renderingToTexture,[I,O]="translucent"!==f.renderPass||D?[{},g]:f.stencilConfigForOverlap(g);for(const R of O){const B=o.getTile(R);if(B.needsHillshadePrepare&&"offscreen"===f.renderPass)Pl(f,B,u,b,h.StencilMode.disabled,T);else if("translucent"===f.renderPass){const $=D&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):I[R.overscaledZ];dr(f,R,B,u,b,$,T)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,u,g,v,b){if("translucent"!==f.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const T=f.context,D=T.gl,I=o.getSource(),O=f.useProgram("raster"),R=f.colorModeForRenderPass(),B=f.terrain&&f.terrain.renderingToTexture,[$,Z]=I instanceof we||B?[{},g]:f.stencilConfigForOverlap(g),X=Z[Z.length-1].overscaledZ,G=!f.options.moving;for(const ie of Z){const W=B?h.DepthMode.disabled:f.depthModeForSublayer(ie.overscaledZ-X,1===u.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,D.LESS),J=ie.toUnwrapped(),q=o.getTile(ie);if(B&&(!q||!q.hasData()))continue;const ue=B?ie.projMatrix:f.transform.calculateProjMatrix(J,G),te=f.terrain&&B?f.terrain.stencilModeForRTTOverlap(ie):$[ie.overscaledZ],oe=b?0:u.paint.get("raster-fade-duration");q.registerFadeDuration(oe);const pe=o.findLoadedParent(ie,0),Pe=Yu(q,pe,o,f.transform,oe);let Be,ke;f.terrain&&f.terrain.prepareDrawTile();const at="nearest"===u.paint.get("raster-resampling")?D.NEAREST:D.LINEAR;T.activeTexture.set(D.TEXTURE0),q.texture.bind(at,D.CLAMP_TO_EDGE),T.activeTexture.set(D.TEXTURE1),pe?(pe.texture.bind(at,D.CLAMP_TO_EDGE),Be=Math.pow(2,pe.tileID.overscaledZ-q.tileID.overscaledZ),ke=[q.tileID.canonical.x*Be%1,q.tileID.canonical.y*Be%1]):q.texture.bind(at,D.CLAMP_TO_EDGE);const ae=$i(ue,ke||[0,0],Be||1,Pe,u,I instanceof we?I.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(T,O,J),I instanceof we)I.boundsBuffer&&I.boundsSegments&&O.draw(T,D.TRIANGLES,W,h.StencilMode.disabled,R,h.CullFaceMode.disabled,ae,u.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:Ze,tileBoundsSegments:bt}=f.getTileBoundsBuffers(q);O.draw(T,D.TRIANGLES,W,te,R,h.CullFaceMode.disabled,ae,u.id,Ie,Ze,bt)}}f.resetStencilClippingMasks()},background:function(f,o,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const T=f.context,D=T.gl,I=f.transform,O=I.tileSize,R=u.paint.get("background-pattern");if(f.isPatternMissing(R))return;const B=!R&&1===v.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==B)return;const $=h.StencilMode.disabled,Z=f.depthModeForSublayer(0,"opaque"===B?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),X=f.colorModeForRenderPass(),G=f.useProgram(R?"backgroundPattern":"background");let ie,W=g;W||(ie=f.getBackgroundTiles(),W=Object.values(ie).map(q=>q.tileID)),R&&(T.activeTexture.set(D.TEXTURE0),f.imageManager.bind(f.context));const J=u.getCrossfadeParameters();for(const q of W){const ue=q.toUnwrapped(),te=g?q.projMatrix:f.transform.calculateProjMatrix(ue);f.prepareDrawTile();const oe=o?o.getTile(q):ie?ie[q.key]:new h.Tile(q,O,I.zoom,f),pe=R?Ll(te,b,f,R,{tileID:q,tileSize:O},J):Dr(te,b,v);f.prepareDrawProgram(T,G,ue);const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:Be,tileBoundsSegments:ke}=f.getTileBoundsBuffers(oe);G.draw(T,D.TRIANGLES,Z,$,X,h.CullFaceMode.disabled,pe,u.id,Pe,Be,ke)}},sky:function(f,o,u){const g=f.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:h.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const T=f.context,D=u.paint.get("sky-type"),I=new h.DepthMode(T.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),O=f.frameCounter/1e3%1;"atmosphere"===D?"offscreen"===f.renderPass?u.needsSkyboxCapture(f)&&(function(R,B,$,Z){const X=R.context,G=X.gl;let ie=B.skyboxFbo;if(!ie){ie=B.skyboxFbo=X.createFramebuffer(32,32,!1),B.skyboxGeometry=new om(X),B.skyboxTexture=X.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,B.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let ue=0;ue<6;++ue)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(ie.framebuffer),X.viewport.set([0,0,32,32]);const W=B.getCenter(R,!0),J=R.useProgram("skyboxCapture"),q=new Float64Array(16);h.identity(q),h.rotateY(q,q,.5*-Math.PI),Sc(X,B,J,q,W,0),h.identity(q),h.rotateY(q,q,.5*Math.PI),Sc(X,B,J,q,W,1),h.identity(q),h.rotateX(q,q,.5*-Math.PI),Sc(X,B,J,q,W,2),h.identity(q),h.rotateX(q,q,.5*Math.PI),Sc(X,B,J,q,W,3),h.identity(q),Sc(X,B,J,q,W,4),h.identity(q),h.rotateY(q,q,Math.PI),Sc(X,B,J,q,W,5),X.viewport.set([0,0,R.width,R.height])}(f,u),u.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,B,$,Z,X){const G=R.context,ie=G.gl,W=R.transform,J=R.useProgram("skybox");G.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,B.skyboxTexture);const q={u_matrix:W.skyboxMatrix,u_sun_direction:B.getCenter(R,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:X};R.prepareDrawProgram(G,J),J.draw(G,ie.TRIANGLES,$,h.StencilMode.disabled,R.colorModeForRenderPass(),h.CullFaceMode.backCW,q,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,I,b,O):"gradient"===D&&"sky"===f.renderPass&&function(R,B,$,Z,X){const G=R.context,ie=G.gl,W=R.transform,J=R.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new om(G)),G.activeTexture.set(ie.TEXTURE0);let q=B.colorRampTexture;q||(q=B.colorRampTexture=new h.Texture(G,B.colorRamp,ie.RGBA)),q.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ue=(te=W.skyboxMatrix,oe=B.getCenter(R,!1),pe=B.paint.get("sky-gradient-radius"),Pe=Z,Be=X,{u_matrix:te,u_color_ramp:0,u_center_direction:oe,u_radius:h.degToRad(pe),u_opacity:Pe,u_temporal_offset:Be});var te,oe,pe,Pe,Be;R.prepareDrawProgram(G,J),J.draw(G,ie.TRIANGLES,$,h.StencilMode.disabled,R.colorModeForRenderPass(),h.CullFaceMode.backCW,ue,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,I,b,O)},debug:function(f,o,u){for(let g=0;g<u.length;g++)gd(f,o,u[g])},custom:function(f,o,u){const g=f.context,v=u.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const b=v.prerender;b&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),b.call(v,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(h.StencilMode.disabled);const b="3d"===v.renderingMode?new h.DepthMode(f.context.gl.LEQUAL,h.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,h.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}};class yd{constructor(o,u){this.context=new Q(o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wu,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,u){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ju(this,o));const v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,u)}_updateFog(o){const u=o.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,u){if(this.width=o*h.exported.devicePixelRatio,this.height=u*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,u=new h.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(h.EXTENT,0),u.emplaceBack(0,h.EXTENT),u.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const g=new h.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(h.EXTENT,0),g.emplaceBack(0,h.EXTENT),g.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=o.createVertexBuffer(g,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const v=new h.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const b=new h.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(h.EXTENT,0,h.EXTENT,0),b.emplaceBack(0,h.EXTENT,0,h.EXTENT),b.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const T=new h.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const D=new h.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])D.emplaceBack(O);this.debugIndexBuffer=o.createIndexBuffer(D),this.emptyTexture=new h.Texture(o,new h.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=h.create();const I=this.context.gl;this.stencilClearMode=new h.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(h.window.performance.now()),this.atmosphereBuffer=new l_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,u.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,Ol(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,g){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const I of g)if(void 0===this._tileClippingMaskIDs[I.key]){D=!0;break}if(!D)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(h.ColorMode.disabled),v.setDepthMode(h.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of g){const I=u.getTile(D),O=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:$}=this.getTileBoundsBuffers(I);T.draw(v,b.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,Ol(D.projMatrix),"$clipping",R,B,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new h.StencilMode({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new h.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,g=o.sort((T,D)=>D.overscaledZ-T.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let D=0;D<b;D++)T[D+v]=new h.StencilMode({func:u.GEQUAL,mask:255},D+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[T,g]}return[{[v]:h.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new h.ColorMode([o.CONSTANT_COLOR,o.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(o,u,g){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new h.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const I in v){const O=v[I];O.used&&O.prepare(this.context)}const b={},T={},D={};for(const I in v){const O=v[I];b[I]=O.getVisibleCoordinates(),T[I]=b[I].slice().reverse(),D[I]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<g.length;I++)if(this.style._layers[g[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(D),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),h.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of g){const O=this.style._layers[I],R=o._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const B=R?T[R.id]:void 0;("custom"===O.type||O.isSky()||B&&B.length)&&this.renderLayer(this,R,O,B)}if(this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(I);if(I.isSky())continue;const R=O?T[O.id]:void 0;this._renderTileClippingMasks(I,O,R),this.renderLayer(this,O,I,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,O){const R=I.context,B=R.gl,$=I.transform,Z=new h.DepthMode(B.LEQUAL,h.DepthMode.ReadOnly,[0,1]),X=I.useProgram("globeAtmosphere",null,"globe"===$.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),G=h.globeToMercatorTransition($.zoom),ie=O.properties.get("color").toArray01(),W=O.properties.get("high-color").toArray01(),J=O.properties.get("space-color").toArray01PremultipliedAlpha(),q=h.identity$1([]);h.rotateY$1(q,q,-h.degToRad($._center.lng)),h.rotateX$1(q,q,h.degToRad($._center.lat)),h.rotateZ$1(q,q,$.angle),h.rotateX$1(q,q,-$._pitch);const ue=h.fromQuat(new Float32Array(16),q),te=h.mapValue(O.properties.get("star-intensity"),0,1,0,.25),pe=h.mapValue(O.properties.get("horizon-blend"),0,1,5e-4,.25),Pe=h.globeUseCustomAntiAliasing(I,R,$)&&5e-4===pe?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Be=I.frameCounter/1e3%1,ke=h.length($.globeCenterInViewSpace),at=Math.sqrt(Math.pow(ke,2)-Math.pow(Pe,2)),ae=Math.acos(at/ke),Ie={u_frustum_tl:$.frustumCorners.TL,u_frustum_tr:$.frustumCorners.TR,u_frustum_br:$.frustumCorners.BR,u_frustum_bl:$.frustumCorners.BL,u_horizon:$.frustumCorners.horizon,u_transition:G,u_fadeout_range:pe,u_color:ie,u_high_color:W,u_space_color:J,u_star_intensity:te,u_star_size:5*h.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Be,u_horizon_angle:ae,u_rotation_matrix:ue};I.prepareDrawProgram(R,X);const Ze=I.atmosphereBuffer;Ze&&X.draw(R,B.TRIANGLES,Z,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,Ie,"skybox",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.fog),this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const I=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,O,I,O?T[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const I=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=O?("symbol"===I.type?D:T)[O.id]:void 0;this._renderTileClippingMasks(I,O,O?b[O.id]:void 0),this.renderLayer(this,O,I,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;h.values(this.style._layers).forEach(O=>{const R=o._getLayerSourceCache(O);R&&!O.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<R.getSource().maxzoom)&&(I=R)}),I&&this.options.showTileBoundaries&&_d.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const O=I.transform.padding;fd(I,I.transform.height-(O.top||0),3,Cs),fd(I,O.bottom||0,3,io),md(I,O.left||0,3,Tp),md(I,I.transform.width-(O.right||0),3,Dc);const R=I.transform.centerPoint;var B,$,Z,X;Jn(B=I,($=R.x)-1,(Z=I.transform.height-R.y)-10,2,20,X=Nl),Jn(B,$-10,Z-1,20,2,X)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}}renderLayer(o,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||_d[g.type](o,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,u=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),o.beginQueryEXT(o.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const u={};for(const g in o){const v=o[g],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=T}return u}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let g=0;for(const v of o)g+=u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(v);return g}translatePosMatrix(o,u,g,v,b){if(!g[0]&&!g[1])return o;const T=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(T){const O=Math.sin(T),R=Math.cos(T);g=[g[0]*R-g[1]*O,g[0]*O+g[1]*R]}const D=[b?g[0]:Zr(u,g[0],this.transform.zoom),b?g[1]:Zr(u,g[1],this.transform.zoom),0],I=new Float32Array(16);return h.translate(I,o,D),I}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!u||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!o&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),T=Li.cacheKey(o,b,u);return this.cache[T]||(this.cache[T]=new Li(this.context,o,fr[o],u,rm[o],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),T=((D,I,O,R,B,$,Z,X,G,ie,W)=>{const J=D.transform,q=I.properties.get("color").toArray01();q[3]=R;const ue=D.frameCounter/1e3%1;return{u_fog_matrix:O?J.calculateFogTileMatrix(O):D.identityMat,u_fog_range:I.getFovAdjustedRange(J._fov),u_fog_color:q,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:ue,u_frustum_tl:B,u_frustum_tr:$,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:G,u_globe_radius:ie,u_viewport:W,u_globe_transition:h.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.exported.devicePixelRatio,this.transform.height*h.exported.devicePixelRatio]);u.setFogUniformValues(o,T)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=o[v.key]||new h.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Vl{constructor(o=0,u=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=v}interpolate(o,u,g){return null!=u.top&&null!=o.top&&(this.top=h.number(o.top,u.top,g)),null!=u.bottom&&null!=o.bottom&&(this.bottom=h.number(o.bottom,u.bottom,g)),null!=u.left&&null!=o.left&&(this.left=h.number(o.left,u.left,g)),null!=u.right&&null!=o.right&&(this.right=h.number(o.right,u.right,g)),this}getCenter(o,u){const g=h.clamp((this.left+o-this.right)/2,0,o),v=h.clamp((this.top+u-this.bottom)/2,0,u);return new h.pointGeometry(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Vl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function vd(f,o){const u=h.getColumn(f,3);h.fromQuat(f,o),h.setColumn(f,3,u)}function Ul(f,o){const u=h.identity$1([]);return h.rotateZ$1(u,u,-o),h.rotateX$1(u,u,-f),u}function jl(f,o){const u=[f[0],f[1],0],g=[o[0],o[1],0];if(h.length(u)>=1e-15){const T=h.normalize([],u);h.scale$2(g,T,h.dot(g,T)),o[0]=g[0],o[1]=g[1]}const v=h.cross([],o,f);if(h.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return Ul(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class ih{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){if(o){const u=o instanceof h.MercatorCoordinate?o:new h.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(u.x=h.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(o)):0,v=this.position,b=h.MercatorCoordinate.fromLngLat(o,g),T=[b.x-v.x,b.y-v.y,b.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=jl(T,u)}setPitchBearing(o,u){this.orientation=Ul(h.degToRad(o),h.degToRad(-u))}}class Ic{constructor(o,u){this._transform=h.identity([]),this.orientation=u,this.position=o}get mercatorPosition(){const o=this.position;return new h.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=h.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var u;o&&h.setColumn(this._transform,3,[(u=o)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||h.identity$1([]),o&&vd(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=Ul(o,u),vd(this._transform,this._orientation)}forward(){const o=h.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=h.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=h.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const g=new Float64Array(16);return h.invert(g,this.getWorldToCamera(o,u)),g}getWorldToCameraPosition(o,u,g){const v=this.position;h.scale$2(v,v,-o);const b=new Float64Array(16);return h.fromScaling(b,[g,g,g]),h.translate(b,b,v),b[10]*=u,b}getWorldToCamera(o,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return h.conjugate(v,this._orientation),h.scale$2(b,b,-o),h.fromQuat(g,v),h.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(o,u,g,v){const b=new Float64Array(16);return h.perspective(b,o,u,g,v),b}getDistanceToElevation(o){const u=0===o?0:h.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new Ic([...this.position],[...this.orientation])}}function kt(f,o){const u=Ac(f.projection,f.zoom,f.width,f.height),g=function(b,T,D,I,O){const R=new h.LngLat(D.lng-180*li,D.lat),B=new h.LngLat(D.lng+180*li,D.lat),$=b.project(R.lng,R.lat),Z=b.project(B.lng,B.lat),X=-Math.atan2(Z.y-$.y,Z.x-$.x),G=h.MercatorCoordinate.fromLngLat(D);G.y=h.clamp(G.y,-.999975,.999975);const ie=G.toLngLat(),W=b.project(ie.lng,ie.lat),J=h.MercatorCoordinate.fromLngLat(ie);J.x+=li;const q=J.toLngLat(),ue=b.project(q.lng,q.lat),te=Ga(ue.x-W.x,ue.y-W.y,X),oe=h.MercatorCoordinate.fromLngLat(ie);oe.y+=li;const pe=oe.toLngLat(),Pe=b.project(pe.lng,pe.lat),Be=Ga(Pe.x-W.x,Pe.y-W.y,X),ke=Math.abs(te.x)/Math.abs(Be.y),at=h.identity([]);h.rotateZ(at,at,-X*(1-(O?0:I)));const ae=h.identity([]);return h.scale(ae,ae,[1,1-(1-ke)*I,1]),ae[4]=-Be.x/Be.y*I,h.rotateZ(ae,ae,X),h.multiply(ae,at,ae),ae}(f.projection,0,f.center,u,o),v=Ai(f);return h.scale(g,g,[v,v,1]),g}function Ai(f){const o=f.projection,u=Ac(f.projection,f.zoom,f.width,f.height),g=oh(o,f.center),v=oh(o,h.LngLat.convert(o.center));return Math.pow(2,g*u+(1-u)*v)}function Ac(f,o,u,g,v=1/0){const b=f.range;if(!b)return 0;const T=Math.min(v,Math.max(u,g)),D=Math.log(T/1024)/Math.LN2;return h.smoothstep(b[0]+D,b[1]+D,o)}const li=1/4e4;function oh(f,o){const u=h.clamp(o.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),g=new h.LngLat(o.lng-180*li,u),v=new h.LngLat(o.lng+180*li,u),b=f.project(g.lng,u),T=f.project(v.lng,u),D=h.MercatorCoordinate.fromLngLat(g),I=h.MercatorCoordinate.fromLngLat(v),O=T.x-b.x,R=T.y-b.y,B=I.x-D.x,$=I.y-D.y,Z=Math.sqrt((B*B+$*$)/(O*O+R*R));return Math.log(Z)/Math.LN2}function Ga(f,o,u){const g=Math.cos(u),v=Math.sin(u);return{x:f*g-o*v,y:f*v+o*g}}class sh{constructor(o,u,g,v,b,T,D){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ic,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new sh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(o||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=h.getProjection(this.projectionOptions);const g=!H(u,this.getProjection());return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;var g,v,b,T,D,I,O,R,B,$;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,T=this.angle,D=(b=this.rotationMatrix)[0],I=b[1],O=b[2],R=b[3],B=Math.sin(T),$=Math.cos(T),v[0]=D*$+O*B,v[1]=I*$+R*B,v[2]=D*-B+O*$,v[3]=I*-B+R*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=h.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let T=0;T<u.length;T++){const D=new h.pointGeometry(u[T][0]*this.width,g+u[T][1]*(this.height-g)),I=o.pointCoordinate(D);if(!I)continue;const O=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);v+=I[3]*O,b+=O}return 0===b?NaN:v/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const o=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const v=h.length(h.sub([],this._camera.position,g));return h.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!h.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];h.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new ih;return u.position=new h.MercatorCoordinate(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!h.length$1(o))return!1;h.normalize$1(o,o);const u=h.transformQuat([],[0,0,-1],o),g=h.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const v=jl(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=h.clamp(o[2],v/g,v/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new h.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new h.pointGeometry(0,0)),v=this.pointCoordinate(new h.pointGeometry(this.width,0)),b=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new h.pointGeometry(0,this.height)),D=Math.floor(Math.min(g.x,v.x,b.x,T.x)),I=Math.floor(Math.max(g.x,v.x,b.x,T.x)),O=1;for(let R=D-O;R<=I+O;R++)0!==R&&u.push(new h.UnwrappedTileID(R,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const g=u,v=this.elevation&&!o.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==o.minzoom&&u<o.minzoom)return[];void 0!==o.maxzoom&&u>o.maxzoom&&(u=o.maxzoom);const T=this.locationCoordinate(this.center),D=this.center.lat,I=1<<u,O=[I*T.x,I*T.y,0],R="globe"===this.projection.name,B=!R,$=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),Z=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=I*h.mercatorZfromAltitude(1,this.center.lat),G=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),ie=[I*Z.x,I*Z.y,G*(B?1:X)],W=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,q=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ue=o.isTerrainDEM?-q:this._elevation?this._elevation.getMinElevationBelowMSL():0,te=this.projection.isReprojectedInTileSpace?Ai(this):1,oe=qe=>{const mt=new h.MercatorCoordinate(qe.x+25e-6,qe.y,qe.z),vt=new h.MercatorCoordinate(qe.x,qe.y+25e-6,qe.z),_t=qe.toLngLat(),gt=mt.toLngLat(),It=vt.toLngLat(),Jt=this.locationCoordinate(_t),mn=this.locationCoordinate(gt),Nt=this.locationCoordinate(It),ln=Math.hypot(mn.x-Jt.x,mn.y-Jt.y),Qn=Math.hypot(Nt.x-Jt.x,Nt.y-Jt.y);return Math.sqrt(ln*Qn)*te/25e-6},pe=qe=>{const Rt=q,mt=ue;return{aabb:h.tileAABB(this,I,0,0,0,qe,mt,Rt,this.projection),zoom:0,x:0,y:0,minZ:mt,maxZ:Rt,wrap:qe,fullyVisible:!1}},Pe=[];let Be=[];const ke=u,at=o.reparseOverscaled?g:u,ae=qe=>qe*qe,Ie=ae((G-this._centerAltitude)*X),Ze=qe=>{if(!this._elevation||!qe.tileID||!b)return;const Rt=this._elevation.getMinMaxForTile(qe.tileID),mt=qe.aabb;Rt?(mt.min[2]=Rt.min,mt.max[2]=Rt.max,mt.center[2]=(mt.min[2]+mt.max[2])/2):(qe.shouldSplit=bt(qe),qe.shouldSplit||(mt.min[2]=mt.max[2]=mt.center[2]=this._centerAltitude))},bt=qe=>{if(qe.zoom<J)return!0;if(qe.zoom===ke)return!1;if(null!=qe.shouldSplit)return qe.shouldSplit;const Rt=qe.aabb.distanceX(ie),mt=qe.aabb.distanceY(ie);let vt=Ie,_t=1;if(R){vt=ae(qe.aabb.distanceZ(ie));const It=Math.pow(2,qe.zoom),Jt=h.latFromMercatorY((qe.y+1)/It),mn=h.latFromMercatorY(qe.y/It),Nt=Math.min(Math.max(D,Jt),mn),ln=h.circumferenceAtLatitude(Nt)/h.circumferenceAtLatitude(D);if(_t=Nt===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ln/this._mercatorScaleRatio),this.zoom<=h.GLOBE_ZOOM_THRESHOLD_MIN&&qe.zoom===ke-1&&ln>=.9)return!0}else if(v&&(vt=ae(qe.aabb.distanceZ(ie)*X)),this.projection.isReprojectedInTileSpace&&g<=5){const It=Math.pow(2,qe.zoom),Jt=oe(new h.MercatorCoordinate((qe.x+.5)/It,(qe.y+.5)/It));_t=Jt>.85?1:Jt}const gt=Rt*Rt+mt*mt+vt;return gt<ae((1<<ke-qe.zoom)*W*_t*((It,Jt)=>{if(Jt*ae(.707)<It)return 1;const mn=Math.sqrt(Jt/It);return mn/(1.4144271570014144+(Math.pow(1.1,mn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vt,Ie),gt))};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)Pe.push(pe(-qe)),Pe.push(pe(qe));for(Pe.push(pe(0));Pe.length>0;){const qe=Pe.pop(),Rt=qe.x,mt=qe.y;let vt=qe.fullyVisible;if(!vt){const _t=qe.aabb.intersects($);if(0===_t)continue;vt=2===_t}if(qe.zoom!==ke&&bt(qe))for(let _t=0;_t<4;_t++){const gt=(Rt<<1)+_t%2,It=(mt<<1)+(_t>>1),Jt={aabb:b?qe.aabb.quadrant(_t):h.tileAABB(this,I,qe.zoom+1,gt,It,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:gt,y:It,wrap:qe.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};v&&!R&&(Jt.tileID=new h.OverscaledTileID(qe.zoom+1===ke?at:qe.zoom+1,qe.wrap,qe.zoom+1,gt,It),Ze(Jt)),Pe.push(Jt)}else{const _t=qe.zoom===ke?at:qe.zoom;if(o.minzoom&&o.minzoom>_t)continue;const gt=O[0]-(.5+Rt+(qe.wrap<<qe.zoom))*(1<<u-qe.zoom),It=O[1]-.5-mt,Jt=qe.tileID?qe.tileID:new h.OverscaledTileID(_t,qe.wrap,qe.zoom,Rt,mt);Be.push({tileID:Jt,distanceSq:gt*gt+It*It})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,Rt=this.horizonLineFromTop();Be=Be.filter(mt=>{const vt=[0,0,0,1],_t=[h.EXTENT,h.EXTENT,0,1],gt=this.calculateFogTileMatrix(mt.tileID.toUnwrapped());h.transformMat4$1(vt,vt,gt),h.transformMat4$1(_t,_t,gt);const It=h.getAABBPointSquareDist(vt,_t);if(0===It)return!0;let Jt=!1;const mn=this._elevation;if(mn&&It>qe&&0!==Rt){const Nt=this.calculateProjMatrix(mt.tileID.toUnwrapped());let ln;o.isTerrainDEM||(ln=mn.getMinMaxForTile(mt.tileID)),ln||(ln={min:ue,max:q});const Qn=h.furthestTileCorner(this.rotation),Mr=[Qn[0]*h.EXTENT,Qn[1]*h.EXTENT,ln.max];h.transformMat4(Mr,Mr,Nt),Jt=(1-Mr[1])*this.height*.5<Rt}return It<qe||Jt})}return Be.sort((qe,Rt)=>qe.distanceSq-Rt.distanceSq).map(qe=>qe.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=h.clamp(o.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,u);return new h.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,u){let g,v;const b=this.centerPoint;if("globe"===this.projection.name){const D=this.worldSize;g=(u.x-b.x)/D,v=(u.y-b.y)/D}else{const D=this.pointCoordinate(u),I=this.pointCoordinate(b);g=D.x-I.x,v=D.y-I.y}const T=this.locationCoordinate(o);this.setLocation(new h.MercatorCoordinate(T.x-g,T.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,u){const g=u?h.mercatorZfromAltitude(u,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new h.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const g=u??this._centerAltitude,v=[o.x,o.y,0,1],b=[o.x,o.y,1,1];h.transformMat4$1(v,v,this.pixelMatrixInverse),h.transformMat4$1(b,b,this.pixelMatrixInverse);const T=b[3];h.scale$1(v,v,1/v[3]),h.scale$1(b,b,1/T);const D=v[2],I=b[2];return{p0:v,p1:b,t:D===I?0:(g-D)/(I-D)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return h.transformMat4$1(u,u,this.pixelMatrixInverse),h.transformMat4$1(g,g,this.pixelMatrixInverse),h.scale$1(u,u,1/u[3]),h.scale$1(g,g,1/g[3]),u[2]=h.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=h.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,h.scale$1(u,u,1/this.worldSize),h.scale$1(g,g,1/this.worldSize),new h.Ray([u[0],u[1],u[2]],h.normalize([],h.sub([],g,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:g,t:v}=o,b=h.mercatorZfromAltitude(u[2],this._center.lat),T=h.mercatorZfromAltitude(g[2],this._center.lat);return new h.MercatorCoordinate(h.number(u[0],g[0],v)/this.worldSize,h.number(u[1],g[1],v)/this.worldSize,h.number(b,T,v))}pointCoordinate(o,u=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,u)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let u=this.projection.pointCoordinate3D(this,o.x,o.y);if(u)return new h.MercatorCoordinate(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(o.y>v)return this.pointCoordinate(o);const b=.02*v,T=o.clone();for(let D=0;D<10&&v-g>b;D++){T.y=h.number(g,v,.66);const I=this.projection.pointCoordinate3D(this,T.x,T.y);I?(v=T.y,u=I):g=T.y}return u?new h.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}_coordinatePoint(o,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return h.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new h.pointGeometry(v[0]/v[3],v[1]/v[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,u){const g=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let D=this.pointCoordinate(g,o),I=this.pointCoordinate(v,o);const O=this.pointCoordinate(b,u),R=this.pointCoordinate(T,u),B=($,Z)=>(Z.y-$.y)/(Z.x-$.x);return D.y>1&&I.y>=0?D=new h.MercatorCoordinate((1-R.y)/B(R,D)+R.x,1):D.y<0&&I.y<=1&&(D=new h.MercatorCoordinate(-R.y/B(R,D)+R.x,0)),I.y>1&&D.y>=0?I=new h.MercatorCoordinate((1-O.y)/B(O,I)+O.x,1):I.y<0&&D.y<=1&&(I=new h.MercatorCoordinate(-O.y/B(O,I)+O.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(O))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const u=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileMatrix(this,u,o)}calculateDistanceTileData(o){const u=o.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=o.canonical,b=1/this.height,T=this.cameraWorldSize/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*o.wrap)*T,I=v.y*T,O=this.point,R=this.angle,B=Math.sin(-R),$=-Math.cos(-R);return g[u]={bearing:[B,$],center:[(O.x-D)*b,(O.y-I)*b],scale:T/h.EXTENT*b},g[u]}calculateFogTileMatrix(o){const u=o.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSize,o);return h.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(o,u=!1){const g=o.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(o,this.worldSize);return h.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,T){const{scale:D}=b.tileTransform,I=D*h.EXTENT/(b.tileSize*Math.pow(2,T.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return O=new Float32Array(4),$=(R=T.inverseAdjustmentMatrix)[1],Z=R[2],X=R[3],ie=(B=[I,I])[1],O[0]=R[0]*(G=B[0]),O[1]=$*G,O[2]=Z*ie,O[3]=X*ie,O;var O,R,B,$,Z,X,G,ie}(o,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const o=this._elevation;this._updateCameraState();const u=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=h.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,h.normalize(v,v);const T=o.raycast(g,v,o.exaggeration());if(T){const D=h.scaleAndAdd([],g,v,T),I=new h.MercatorCoordinate(D[0],D[1],h.mercatorZfromAltitude(D[2],h.latFromMercatorY(D[1]))),O=(I.z+h.length([I.x-g[0],I.y-g[1],I.z-g[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=o.getAtPointOrZero(new h.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(T<b){const D=this.locationCoordinate(this._center,this._centerAltitude),I=[D.x-g[0],D.y-g[1],D.z-g[2]],O=h.length(I);I[2]-=(b-T)/this._projectionScaler;const R=h.length(I);if(0===R)return;h.scale$2(I,I,O/R*this._projectionScaler),this._camera.position=[D.x-I[0],D.y-I[1],D.z*this._projectionScaler-I[2]],this._camera.orientation=jl(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=h.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=h.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:g}=this.point;let v=0,b=u,T=g;const D=this.width/2,I=this.height/2,O=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(g-I<O&&(T=O+I),g+I>R&&(T=R-I),R-O<this.height&&(v=Math.max(v,this.height/(R-O)),T=(R+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+$)/2;b=(u+Z+this.worldSize)%this.worldSize-Z,b-D<B&&(b=B+D),b+D>$&&(b=$-D),$-B<this.width&&(v=Math.max(v,this.width/($-B)),b=($+B)/2)}b===u&&T===g||(this.center=this.unproject(new h.pointGeometry(b,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,u=this.pixelsPerMeter;if("globe"===this.projection.name){const te=h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,oe=h.mercatorZfromAltitude(1,h.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=te/oe}const g=Ac(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-o.x/this.width,b[9]=2*o.y/this.height;let T=h.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),oe=h.identity([]);h.translate(oe,oe,[te.x*this.worldSize,te.y*this.worldSize,0]),h.multiply(oe,oe,kt(this)),h.translate(oe,oe,[-te.x*this.worldSize,-te.y*this.worldSize,0]),h.multiply(T,T,oe),this.inverseAdjustmentMatrix=function(pe){const Pe=kt(pe,!0);return Je([],[Pe[0],Pe[1],Pe[4],Pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],T,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=T,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const D=h.invert([],b);this.frustumCorners=h.FrustumCorners.fromInvProjectionMatrix(D,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);h.identity(I),h.scale(I,I,[1,-1,1]),h.rotateX(I,I,this._pitch),h.rotateZ(I,I,this.angle);const O=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-o.x/this.width,O[9]=2*(o.y+R)/this.height,this.skyboxMatrix=h.multiply(I,O,I);const B=this.point,$=B.x,Z=B.y,X=this.width%2/2,G=this.height%2/2,ie=Math.cos(this.angle),W=Math.sin(this.angle),J=$-Math.round($)+ie*X+W*G,q=Z-Math.round(Z)+ie*G+W*X,ue=new Float64Array(T);if(h.translate(ue,ue,[J>.5?J-1:J,q>.5?q-1:q,0]),this.alignedProjMatrix=ue,T=h.create(),h.scale(T,T,[this.width/2,-this.height/2,1]),h.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=h.create(),h.scale(T,T,[1,-1,1]),h.translate(T,T,[-1,-1,0]),h.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=h.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=h.calculateGlobeMatrix(this);const te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.transformMat4(te,te,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._projectionScaler,b=[o,o,u];h.scale$2(b,b,v),h.scale$2(g,g,-1),h.multiply$2(g,g,b);const T=h.create();h.translate(T,T,g),h.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,v)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let v=1;g>0&&(v=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),D=Math.max((o[2]-b)/Math.cos(g),T),I=this._zoomFromMercatorZ(D);h.scaleAndAdd(o,o,u,D),this._pitch=h.clamp(g,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(v,-Math.PI,Math.PI),this._setZoom(h.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,u){const g=Math.min(o.x,u.x),v=Math.max(o.x,u.x),b=Math.min(o.y,u.y),T=Math.max(o.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const D=[new h.pointGeometry(g,b),new h.pointGeometry(v,T),new h.pointGeometry(g,T),new h.pointGeometry(v,b)],I=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const R of D){const B=this.pointRayIntersection(R);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<I||$.y<0||$.x>O||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,u){const g=h.length(h.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const o=function(u,g){const v=[u[0],u[1],u[2],1];h.transformMat4$1(v,v,g);const b=Math.max(v[3],1e-6);return[v[0]/b,v[1]/b,v[2]/b,b]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.pointGeometry(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,o))}}getCameraToCenterDistance(o){const u=Ac(o,this.zoom,this.width,this.height,1024),g=o.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*g}}function $l(f,o){let u=!1,g=null;const v=()=>{g=null,u&&(f(),g=setTimeout(v,o),u=!1)};return()=>(u=!0,g||v(),g)}class ah{constructor(o){this._hashName=o&&encodeURIComponent(o),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$l(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,h.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),h.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const u=this._map;if(!u)return"";const g=u.getCenter(),v=Math.round(100*u.getZoom())/100,b=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),D=Math.round(g.lng*T)/T,I=Math.round(g.lat*T)/T,O=u.getBearing(),R=u.getPitch();let B="";if(B+=o?`/${D}/${I}/${v}`:`${v}/${I}/${D}`,(O||R)&&(B+="/"+Math.round(10*O)/10),R&&(B+=`/${Math.round(R)}`),this._hashName){const $=this._hashName;let Z=!1;const X=h.window.location.hash.slice(1).split("&").map(G=>{const ie=G.split("=")[0];return ie===$?(Z=!0,`${ie}=${B}`):G}).filter(G=>G);return Z||X.push(`${$}=${B}`),`#${X.join("&")}`}return`#${B}`}_getCurrentHash(){const o=h.window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(u[3]||0):o.getBearing();return o.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,o)}}const Ha={linearity:.3,easing:h.bezier(0,0,.3,1)},lh=h.extend({deceleration:2500,maxSpeed:1400},Ha),Dp=h.extend({deceleration:20,maxSpeed:1400},Ha),Bi=h.extend({deceleration:1e3,maxSpeed:360},Ha),xd=h.extend({deceleration:1e3,maxSpeed:90},Ha);class am{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=h.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=Za(u.pan.mag(),g,h.extend({},lh,o||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,qa(v,b)}if(u.zoom){const b=Za(u.zoom,g,Dp);v.zoom=this._map.transform.zoom+b.amount,qa(v,b)}if(u.bearing){const b=Za(u.bearing,g,Bi);v.bearing=this._map.transform.bearing+h.clamp(b.amount,-179,179),qa(v,b)}if(u.pitch){const b=Za(u.pitch,g,xd);v.pitch=this._map.transform.pitch+b.amount,qa(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function qa(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function Za(f,o,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,T=h.clamp(f*v/(o/1e3),-g,g),D=Math.abs(T)/(b*v);return{easing:u.easing,duration:1e3*D,amount:T*(D/2)}}class oo extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,v={}){const b=Ve(u.getCanvasContainer(),g),T=u.unproject(b);super(o,h.extend({point:b,lngLat:T,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Wa extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const v="touchend"===o?g.changedTouches:g.touches,b=Oe(u.getCanvasContainer(),v),T=b.map(I=>u.unproject(I)),D=b.reduce((I,O,R,B)=>I.add(O.div(B.length)),new h.pointGeometry(0,0));super(o,{points:b,point:D,lngLats:T,lngLat:u.unproject(D),originalEvent:g}),this._defaultPrevented=!1}}class Sp extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class Gl{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Sp(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new oo(o.type,this._map,o))}mouseup(o){this._map.fire(new oo(o.type,this._map,o))}preclick(o){const u=h.extend({},o);u.type="preclick",this._map.fire(new oo(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new oo(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new oo(o.type,this._map,o))}mouseover(o){this._map.fire(new oo(o.type,this._map,o))}mouseout(o){this._map.fire(new oo(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Wa(o.type,this._map,o))}touchmove(o){this._map.fire(new Wa(o.type,this._map,o))}touchend(o){this._map.fire(new Wa(o.type,this._map,o))}touchcancel(o){this._map.fire(new Wa(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ip{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new oo(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new oo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new oo(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kr{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(ft(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=Te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(v.x,g.x),T=Math.max(v.x,g.x),D=Math.min(v.y,g.y),I=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${D}px)`,this._box.style.width=T-b+"px",this._box.style.height=I-D+"px")})}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const g=this._startPos,v=u;if(this.reset(),ze(),g.x!==v.x||g.y!==v.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dt(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new h.Event(o,{originalEvent:u}))}}function Pc(f,o){const u={};for(let g=0;g<f.length;g++)u[f[g].identifier]=o[g];return u}class Ap{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new h.pointGeometry(0,0);for(const T of v)b._add(T);return b.div(v.length)}(u),this.touches=Pc(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const v=Pc(g,u);for(const b in this.touches){const T=this.touches[b],D=v[b];(!D||D.dist(T)>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Jr{constructor(o){this.singleTap=new Ap(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const v=this.singleTap.touchend(o,u,g);if(v){const b=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(b&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Pp{constructor(){this._zoomIn=new Jr({numTouches:1,numTaps:2}),this._zoomOut=new Jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const v=this._zoomIn.touchend(o,u,g),b=this._zoomOut.touchend(o,u,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kc={0:1,2:2};class Xa{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const g=ve(o);this._correctButton(o,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(o,u){const g=this._lastPoint;if(g)if(o.preventDefault(),null!=this._eventButton&&function(v,b){const T=kc[b];return void 0===v.buttons||(v.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(o){this._lastPoint&&ve(o)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Io extends Xa{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return 0===u&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class bd extends Xa{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=.8*(u.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Oc extends Xa{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=-.5*(u.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class Ya{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,u,g)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const v=Pc(g,u),b=new h.pointGeometry(0,0),T=new h.pointGeometry(0,0);let D=0;for(const O in v){const R=v[O],B=this._touches[O];B&&(b._add(R),T._add(R.sub(B)),D++,v[O]=R)}if(this._touches=v,D<this._minTouches||!T.mag())return;const I=T.div(D);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Hi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,u,g){return{}}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){const v=this._firstTwoTouches;if(!v)return;o.preventDefault();const[b,T]=v,D=hi(g,u,b),I=hi(g,u,T);if(!D||!I)return;const O=this._aroundCenter?null:D.add(I).div(2);return this._move([D,I],O,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,T=hi(g,u,v),D=hi(g,u,b);T&&D||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hi(f,o,u){for(let g=0;g<f.length;g++)if(f[g].identifier===u)return o[g]}function ch(f,o){return Math.log(f/o)/Math.LN2}class kp extends Hi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ch(this._distance,g),pinchAround:u}}}function Gs(f,o){return 180*f.angleWith(o)/Math.PI}class Op extends Hi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gs(this._vector,g),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=Gs(o,this._startVector);return Math.abs(g)<u}}function Ao(f){return Math.abs(f.y)>Math.abs(f.x)}class Mn extends Hi{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Ao(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){const v=this._lastPoints;if(!v)return;const b=o[0].sub(v[0]),T=o[1].sub(v[1]);return this._map._cooperativeGestures&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(o,u,g){if(void 0!==this._valid)return this._valid;const v=o.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=o.y>0==u.y>0;return Ao(o)&&Ao(u)&&T}}const Ka={panStep:100,bearingStep:15,pitchStep:10};class Hs{constructor(){const o=Ka;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,v=0,b=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:D=>{const I=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:uh,zoom:u?Math.round(I)+u*(o.shiftKey?2:1):I,bearing:D.getBearing()+g*this._bearingStep,pitch:D.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:D.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uh(f){return f*(2-f)}const Ot=4.000244140625;class Rp{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=h.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%Ot==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Ve(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const I="wheel"===this._type&&Math.abs(this._delta)>Ot?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&0!==O&&(O=1/O);const R=u(),B=Math.pow(2,R),$="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom($*O))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let T,D=!1;if("wheel"===this._type&&v&&b){const I=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),O=b(I);T=h.number(v,g,O),I<1?this._frameId||(this._frameId=!0):D=!0}else T=g,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:T-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=h.ease;if(this._prevEase){const g=this._prevEase,v=(h.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),T=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-T*T);u=h.bezier(T,D,.25,1)}return this._prevEase={start:h.exported.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!h.window.document.fullscreenElement||!!h.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class wd{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lc{constructor(){this._tap=new Jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,u,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,u,g))}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,u,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lt{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class er{constructor(o,u,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qs{constructor(o,u,g,v){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zo=f=>f.zoom||f.drag||f.pitch||f.rotate;class di extends h.Event{}class Cd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const g=h.sub([],u,o);this.radius=h.length(g[2]<0?h.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){h.div(o,o,this.constants),h.normalize(o,o),h.mul$1(o,o,this.constants);const u=h.scale$2([],o,this.radius);if(u[2]>0){const g=h.scale$2([],[0,0,1],h.dot(u,[0,0,1])),v=h.scale$2([],h.normalize([],[u[0],u[1],0]),this.radius),b=h.add([],u,h.scale$2([],h.sub([],h.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Zs(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Po{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new am(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),h.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[v,b,T]of this._listeners)v.addEventListener(b,v===h.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,u,g]of this._listeners)o.removeEventListener(u,o===h.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new Gl(u,o));const v=u.boxZoom=new Kr(u,o);this._add("boxZoom",v);const b=new Pp,T=new Rc;u.doubleClickZoom=new wd(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const D=new Lc;this._add("tapDragZoom",D);const I=u.touchPitch=new Mn(u);this._add("touchPitch",I);const O=new bd(o),R=new Oc(o);u.dragRotate=new er(o,O,R),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const B=new Io(o),$=new Ya(u,o);u.dragPan=new lt(g,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const Z=new Op,X=new kp;u.touchZoomRotate=new qs(g,X,Z,D),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ip(u));const G=u.scrollZoom=new Rp(u,this);this._add("scrollZoom",G,["mousePan"]);const ie=u.keyboard=new Hs;this._add("keyboard",ie);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[W]&&u[W].enable(o[W])}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zo(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,g){for(const v in o)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}handleEvent(o,u){this._updatingCamera=!0;const g="renderFrame"===o.type,v=g?void 0:o,b={needsRenderFrame:!1},T={},D={},I=o.touches?this._getMapTouches(o.touches):void 0,O=I?Oe(this._el,I):g?void 0:Ve(this._el,o);for(const{handlerName:$,handler:Z,allowed:X}of this._handlers){if(!Z.isEnabled())continue;let G;this._blockedByActive(D,X,$)?Z.reset():Z[u||o.type]&&(G=Z[u||o.type](o,O,I),this.mergeHandlerResult(b,T,G,$,v),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||Z.isActive())&&(D[$]=Z)}const R={};for(const $ in this._previousActiveHandlers)D[$]||(R[$]=v);this._previousActiveHandlers=D,(Object.keys(R).length||Zs(b))&&(this._changes.push([b,T,R]),this._triggerRenderFrame()),(Object.keys(D).length||Zs(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,u,g,v,b){if(!g)return;h.extend(o,g);const T={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=T),void 0!==g.panDelta&&(u.drag=T),void 0!==g.pitchDelta&&(u.pitch=T),void 0!==g.bearingDelta&&(u.rotate=T)}_applyChanges(){const o={},u={},g={};for(const[v,b,T]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new h.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(o.around=v.around),void 0!==v.aroundCoord&&(o.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),h.extend(u,b),h.extend(g,T);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const v=this._map,b=v.transform,T=J=>[J.x,J.y,J.z];if((J=>{const q=this._eventsInProgress.drag;return q&&!this._handlersById[q.handlerName].isActive()})()&&!Zs(o)){const J=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",J!==b.zoom&&this._map._update(!0)}if(!Zs(o))return void this._fireEvents(u,g,!0);let{panDelta:D,zoomDelta:I,bearingDelta:O,pitchDelta:R,around:B,aroundCoord:$,pinchAround:Z}=o;void 0!==Z&&(B=Z),(J=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=T(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,O&&(b.bearing+=O),R&&(b.pitch+=R),b._updateCameraState();const X=[0,0,0];if(D){const J=b.pointCoordinate(B);if("globe"===b.projection.name){const q=h.latFromMercatorY(J.y),ue=b.center.lat,te=Math.min(h.mercatorZfromAltitude(1,q)/h.mercatorZfromAltitude(1,ue),2);D=D.rotate(-b.angle),X[0]=-D.x/b.worldSize*te,X[1]=-D.y/b.worldSize*te}else{const q=b.pointCoordinate(B.sub(D));J&&q&&(X[0]=q.x-J.x,X[1]=q.y-J.y)}}const G=b.zoom,ie=[0,0,0];if(I){const J=T($||b.pointCoordinate3D(B)),q={dir:h.normalize([],h.sub([],J,b._camera.position))};if(q.dir[2]<0){const ue=b.zoomDeltaToMovement(J,I);h.scale$2(ie,q.dir,ue)}}const W=h.add(X,X,ie);b._translateCameraConstrained(W),I&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_fireEvents(o,u,g){const v=Zo(this._eventsInProgress),b=Zo(o),T={};for(const R in o){const{originalEvent:B}=o[R];this._eventsInProgress[R]||(T[`${R}start`]=B),this._eventsInProgress[R]=o[R]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const R in T)this._fireEvent(R,T[R]);b&&this._fireEvent("move",b.originalEvent);for(const R in o){const{originalEvent:B}=o[R];this._fireEvent(R,B)}const D={};let I;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],I=u[B]||$,D[`${R}end`]=I)}for(const R in D)this._fireEvent(R,D[R]);const O=Zo(this._eventsInProgress);if(g&&(v||b)&&!O){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;R?(B(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:I})):(this._map.fire(new h.Event("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new h.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new di("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Hl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ql extends h.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,g){return o=h.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,h.extend({offset:o},u),g)}panTo(o,u,g){return this.easeTo(h.extend({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(h.extend({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(h.extend({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,h.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){"globe"===this.transform.projection.name&&h.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),o=h.LngLatBounds.convert(o);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,u)}_extendCameraOptions(o){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=h.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=h.extend(u,o.padding),o}_cameraForBoxAndBearing(o,u,g,v){const b=this._extendCameraOptions(v),T=this.transform,D=T.padding,I=T.project(h.LngLat.convert(o)),O=T.project(h.LngLat.convert(u)),R=new h.pointGeometry(I.x,O.y),B=new h.pointGeometry(O.x,I.y),$=-h.degToRad(g),Z=I.rotate($),X=O.rotate($),G=R.rotate($),ie=B.rotate($),W=new h.pointGeometry(Math.max(Z.x,X.x,G.x,ie.x),Math.max(Z.y,X.y,G.y,ie.y)),J=new h.pointGeometry(Math.min(Z.x,X.x,G.x,ie.x),Math.min(Z.y,X.y,G.y,ie.y)),q=W.sub(J),ue=(T.width-((D.left||0)+(D.right||0)+b.padding.left+b.padding.right))/q.x,te=(T.height-((D.top||0)+(D.bottom||0)+b.padding.top+b.padding.bottom))/q.y;if(te<0||ue<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(T.scaleZoom(T.scale*Math.min(ue,te)),b.maxZoom),pe="number"==typeof b.offset.x&&"number"==typeof b.offset.y?new h.pointGeometry(b.offset.x,b.offset.y):h.pointGeometry.convert(b.offset),Pe=new h.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),Be=pe.add(Pe).mult(T.scale/T.zoomScale(oe));return{center:T.unproject(I.add(O).div(2).sub(Be)),zoom:oe,bearing:g}}_cameraForBox(o,u,g,v,b){const T=this._extendCameraOptions(b);g=g||0,v=v||0,o=h.LngLat.convert(o),u=h.LngLat.convert(u);const D=this.transform.clone();D.padding=T.padding;const I=this.getFreeCameraOptions(),O=new h.LngLat(.5*(o.lng+u.lng),.5*(o.lat+u.lat)),R=.5*(g+v);if(D._camera.position[2]<h.mercatorZfromAltitude(R,O.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");I.lookAtPoint(O),D.setFreeCameraOptions(I);const B=h.MercatorCoordinate.fromLngLat(o),$=h.MercatorCoordinate.fromLngLat(u),Z=D.pointRayIntersection(D.centerPoint,R),X=[(G=D.rayIntersectionCoordinate(Z)).x,G.y,G.z];var G;const ie=D.screenPointToMercatorRay(D.centerPoint),W="globe"!==D.projection.name;let J,q=0;do{const ue=Math.floor(D.zoom),te=1<<ue,oe=Math.min(te*B.x,te*$.x),pe=Math.min(te*B.y,te*$.y),Pe=Math.max(te*B.x,te*$.x),Be=Math.max(te*B.y,te*$.y),ke=new h.Aabb([oe,pe,g],[Pe,Be,v]),at=h.Frustum.fromInvProjectionMatrix(D.invProjMatrix,D.worldSize,ue,W);if(2!==ke.intersects(at)){J&&(D._camera.position=h.scaleAndAdd([],D._camera.position,ie.dir,-J),D._updateStateFromCamera());break}const ae=h.sub([],D._camera.position,X);J=.5*h.length(ae),D._camera.position=h.scaleAndAdd([],D._camera.position,ie.dir,J);try{D._updateStateFromCamera()}catch{return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++q<10);return{center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch}}fitBounds(o,u,g){return"globe"===this.transform.projection.name&&h.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(o,u),u,g)}_raycastElevationBox(o,u){const g=this.transform.elevation;if(!g)return;const v=new h.pointGeometry(o.x,u.y),b=new h.pointGeometry(u.x,o.y),T=g.pointCoordinate(o);if(!T)return;const D=g.pointCoordinate(u);if(!D)return;const I=g.pointCoordinate(v);if(!I)return;const O=g.pointCoordinate(b);if(!O)return;const R=new h.MercatorCoordinate(T[0],T[1]).toLngLat(),B=new h.MercatorCoordinate(D[0],D[1]).toLngLat(),$=new h.MercatorCoordinate(I[0],I[1]).toLngLat(),Z=new h.MercatorCoordinate(O[0],O[1]).toLngLat(),X=Math.min(R.lng,Math.min(B.lng,Math.min($.lng,Z.lng))),G=Math.min(R.lat,Math.min(B.lat,Math.min($.lat,Z.lat))),ie=Math.max(R.lng,Math.max(B.lng,Math.max($.lng,Z.lng))),W=Math.max(R.lat,Math.max(B.lat,Math.max($.lat,Z.lat))),J=Math.min(T[3],Math.min(D[3],Math.min(I[3],O[3]))),q=Math.max(T[3],Math.max(D[3],Math.max(I[3],O[3])));return{minLngLat:new h.LngLat(X,G),maxLngLat:new h.LngLat(ie,W),minAltitude:J,maxAltitude:q}}fitScreenCoordinates(o,u,g,v,b){let T,D,I,O;"globe"===this.transform.projection.name&&h.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const R=h.pointGeometry.convert(o),B=h.pointGeometry.convert(u),$=this._raycastElevationBox(R,B);if($)T=$.minLngLat,D=$.maxLngLat,I=$.minAltitude,O=$.maxAltitude;else{if(this.transform.anyCornerOffEdge(R,B))return this;T=this.transform.pointLocation(R),D=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(o)),this.transform.pointLocation(h.pointGeometry.convert(u)),g,v):this._cameraForBox(T,D,I,O,v),v,b)}_fitInternal(o,u,g){return o?(delete(u=h.extend(o,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(o,u){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,T=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=h.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(T=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new h.Event("movestart",u)).fire(new h.Event("move",u)),v&&this.fire(new h.Event("zoomstart",u)).fire(new h.Event("zoom",u)).fire(new h.Event("zoomend",u)),b&&this.fire(new h.Event("rotatestart",u)).fire(new h.Event("rotate",u)).fire(new h.Event("rotateend",u)),T&&this.fire(new h.Event("pitchstart",u)).fire(new h.Event("pitch",u)).fire(new h.Event("pitchend",u)),this.fire(new h.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(Hl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return h.warnOnce(Hl),this;this.stop();const v=g.zoom,b=g.pitch,T=g.bearing;g.setFreeCameraOptions(o);const D=v!==g.zoom,I=b!==g.pitch,O=T!==g.bearing;return this.fire(new h.Event("movestart",u)).fire(new h.Event("move",u)),D&&this.fire(new h.Event("zoomstart",u)).fire(new h.Event("zoom",u)).fire(new h.Event("zoomend",u)),O&&this.fire(new h.Event("rotatestart",u)).fire(new h.Event("rotate",u)).fire(new h.Event("rotateend",u)),I&&this.fire(new h.Event("pitchstart",u)).fire(new h.Event("pitch",u)).fire(new h.Event("pitchend",u)),this.fire(new h.Event("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=h.extend({offset:[0,0],duration:500,easing:h.ease},o)).animate||!o.essential&&h.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),I="zoom"in o?+o.zoom:v,O="bearing"in o?this._normalizeBearing(o.bearing,b):b,R="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:g.padding,$=h.pointGeometry.convert(o.offset);let Z,X,G;if("globe"===g.projection.name){const Be=h.MercatorCoordinate.fromLngLat(g.center),ke=$.rotate(-g.angle);Be.x+=ke.x/g.worldSize,Be.y+=ke.y/g.worldSize;const at=Be.toLngLat(),ae=h.LngLat.convert(o.center||at);this._normalizeCenter(ae),Z=g.centerPoint.add(ke),X=new h.pointGeometry(Be.x,Be.y).mult(g.worldSize),G=new h.pointGeometry(h.mercatorXfromLng(ae.lng),h.mercatorYfromLat(ae.lat)).mult(g.worldSize).sub(X)}else{Z=g.centerPoint.add($);const Be=g.pointLocation(Z),ke=h.LngLat.convert(o.center||Be);this._normalizeCenter(ke),X=g.project(Be),G=g.project(ke).sub(X)}const ie=g.zoomScale(I-v);let W,J;o.around&&(W=h.LngLat.convert(o.around),J=g.locationPoint(W));const q=this._zooming||I!==v,ue=this._rotating||b!==O,te=this._pitching||R!==T,oe=!g.isPaddingEqual(B),pe=Be=>ke=>{if(q&&(Be.zoom=h.number(v,I,ke)),ue&&(Be.bearing=h.number(b,O,ke)),te&&(Be.pitch=h.number(T,R,ke)),oe&&(Be.interpolatePadding(D,B,ke),Z=Be.centerPoint.add($)),W)Be.setLocationAtPoint(W,J);else{const at=Be.zoomScale(Be.zoom-v),ae=I>v?Math.min(2,ie):Math.max(.5,ie),Ie=Math.pow(ae,1-ke),Ze=Be.unproject(X.add(G.mult(ke*Ie)).mult(at));Be.setLocationAtPoint(Be.renderWorldCopies?Ze.wrap():Ze,Z)}return o.preloadOnly||this._fireMoveEvents(u),Be};if(o.preloadOnly){const Be=this._emulate(pe,o.duration,g);return this._preloadTiles(Be),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=q,this._rotating=ue,this._pitching=te,this._padding=oe,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Pe),this._ease(pe(g),Be=>{g.recenterOnTerrain(),this._afterEase(u,Be)},o),this}_prepareEase(o,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new h.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new h.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new h.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new h.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new h.Event("move",o)),this._zooming&&this.fire(new h.Event("zoom",o)),this._rotating&&this.fire(new h.Event("rotate",o)),this._pitching&&this.fire(new h.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new h.Event("zoomend",o)),v&&this.fire(new h.Event("rotateend",o)),b&&this.fire(new h.Event("pitchend",o)),this.fire(new h.Event("moveend",o))}flyTo(o,u){if(!o.essential&&h.exported.prefersReducedMotion){const vt=h.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(vt,u)}this.stop(),o=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},o);const g=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),I="zoom"in o?h.clamp(+o.zoom,g.minZoom,g.maxZoom):v,O="bearing"in o?this._normalizeBearing(o.bearing,b):b,R="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:g.padding,$=g.zoomScale(I-v),Z=h.pointGeometry.convert(o.offset);let X=g.centerPoint.add(Z);const G=g.pointLocation(X),ie=h.LngLat.convert(o.center||G);this._normalizeCenter(ie);const W=g.project(G),J=g.project(ie).sub(W);let q=o.curve;const ue=Math.max(g.width,g.height),te=ue/$,oe=J.mag();if("minZoom"in o){const vt=h.clamp(Math.min(o.minZoom,v,I),g.minZoom,g.maxZoom),_t=ue/g.zoomScale(vt-v);q=Math.sqrt(_t/oe*2)}const pe=q*q;function Pe(vt){const _t=(te*te-ue*ue+(vt?-1:1)*pe*pe*oe*oe)/(2*(vt?te:ue)*pe*oe);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Be(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function ke(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const at=Pe(0);let ae=function(vt){return ke(at)/ke(at+q*vt)},Ie=function(vt){return ue*((ke(at)*(Be(_t=at+q*vt)/ke(_t))-Be(at))/pe)/oe;var _t},Ze=(Pe(1)-at)/q;if(Math.abs(oe)<1e-6||!isFinite(Ze)){if(Math.abs(ue-te)<1e-6)return this.easeTo(o,u);const vt=te<ue?-1:1;Ze=Math.abs(Math.log(te/ue))/q,Ie=function(){return 0},ae=function(_t){return Math.exp(vt*q*_t)}}o.duration="duration"in o?+o.duration:1e3*Ze/("screenSpeed"in o?+o.screenSpeed/q:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const bt=b!==O,qe=R!==T,Rt=!g.isPaddingEqual(B),mt=vt=>_t=>{const gt=_t*Ze,It=1/ae(gt);vt.zoom=1===_t?I:v+vt.scaleZoom(It),bt&&(vt.bearing=h.number(b,O,_t)),qe&&(vt.pitch=h.number(T,R,_t)),Rt&&(vt.interpolatePadding(D,B,_t),X=vt.centerPoint.add(Z));const Jt=1===_t?ie:vt.unproject(W.add(J.mult(Ie(gt))).mult(It));return vt.setLocationAtPoint(vt.renderWorldCopies?Jt.wrap():Jt,X),vt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(u),vt};if(o.preloadOnly){const vt=this._emulate(mt,o.duration,g);return this._preloadTiles(vt),this}return this._zooming=!0,this._rotating=bt,this._pitching=qe,this._padding=Rt,this._prepareEase(u,!1),this._ease(mt(g),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,u,g){!1===g.animate||0===g.duration?(o(1),u()):(this._easeStart=h.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=h.wrap(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=o.lng-u.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,u,g){const v=Math.ceil(15*u/1e3),b=[],T=o(g.clone());for(let D=0;D<=v;D++){const I=T(D/v);b.push(I.clone())}return b}}class Lp{constructor(o={}){this.options=o,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact;return this._map=o,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Te("button","mapboxgl-ctrl-attrib-button",this._container),Te("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Te("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const g=this._map._getUIString(`AttributionControl.${u}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(o){const g=u.reduce((v,b,T)=>(b.value&&(v+=`${b.key}=${b.value}${T<u.length-1?"&":""}`),v),"?");o.href=`${h.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const T=b.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((v,b)=>v.length-b.length),o=o.filter((v,b)=>{for(let T=b+1;T<o.length;T++)if(o[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ed{constructor(){h.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Te("div","mapboxgl-ctrl");const u=Te("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const u in o){const g=o[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Fp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zl(f,o,u){if(f=new h.LngLat(f.lng,f.lat),o){const g=new h.LngLat(f.lng-360,f.lat),v=new h.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),T=u.locationPoint(f).distSqr(o),D=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint(g).distSqr(o)<T&&(D||Math.abs(g.lng-u.center.lng)<b)?f=g:u.locationPoint(v).distSqr(o)<T&&(D||Math.abs(v.lng-u.center.lng)<b)&&(f=v)}for(;Math.abs(f.lng-u.center.lng)>180;){const g=u.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Wo extends h.Evented{constructor(o,u){if(super(),(o instanceof h.window.HTMLElement||u)&&(o=h.extend({element:o},u)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=h.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Te("div");const v=41,b=27,T=rt("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),D=rt("radialGradient",{id:"shadowGradient"},rt("defs",{},T));rt("stop",{offset:"10%","stop-opacity":.4},D),rt("stop",{offset:"100%","stop-opacity":.05},D),rt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),rt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),rt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),rt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=h.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Pi)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=h.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,g=o.charCode||o.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map;if(!o)return!1;const u=o.unproject(this._pos),g=o.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(u)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const u=this._pos;if(!u||u.x<0||u.x>o.transform.width||u.y<0||u.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(u);let v;o._usingGlobe()&&h.isLngLatBehindGlobe(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=.2)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const u=this._calculateXYTransform()+this._calculateZTransform(),g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${o.x}px,${o.y}px) ${Pi[this._anchor]}\n            ${u}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const o=this._pos,u=this._map;if("map"!==this.getPitchAlignment()||!u||!o)return"";if(!u._usingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const g=h.radToDeg(h.globeTiltAtLngLat(u.transform,this._lngLat)),v=o.sub(h.globeCenterToScreenPoint(u.transform)),b=g/(Math.abs(v.x)+Math.abs(v.y)),T=v.x*b,D=-v.y*b;return D||T?`rotateX(${D}deg) rotateY(${T}deg)`:""}_calculateZTransform(){const o=this._calculateRotation();return o?`rotateZ(${o}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const o=this._map;if(this._pos&&o&&o._usingGlobe()){const u=o.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),g=o.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);return this._rotation+h.radToDeg(Math.atan2(g.y,g.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(o){h.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Zl(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===o?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._usingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=h.pointGeometry.convert(o),this._update(),this}_onMove(o){const u=this._map;if(u){if(!this._isDragging){const g=this._clickTolerance||u._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(o){const u=this._map;u&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const u=this._map;return u&&(o?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Md{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=h.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,g){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+g}}const ga={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function hh(f){f.parentNode&&f.parentNode.removeChild(f)}const Td={showCompass:!0,showZoom:!0,visualizePitch:!1};class zp{constructor(o,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new bd({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Oc({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),ft()}move(o,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(o,u),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,u),D=T&&T.pitchDelta;D&&g.setPitch(g.getPitch()+D)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dt(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(h.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ve(this.element,o)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ve(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Oe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Oe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Dd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},dh={maxWidth:100,unit:"metric"};function Ws(f,o,u,g,v,b){const T=function(I){const O=Math.pow(10,`${Math.floor(I)}`.length-1);let R=I/O;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(B){const $=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*$)/$}(R),O*R}(u),D=T/u;b._requestDomTask(()=>{f.style.width=o*D+"px",f.innerHTML="nautical-mile"!==v?new Intl.NumberFormat(g,{style:"unit",unitDisplay:"narrow",unit:v}).format(T):`${T}&nbsp;nm`})}const Sd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ph(f=new h.pointGeometry(0,0),o="bottom"){if("number"==typeof f){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new h.pointGeometry(0,f);case"top-left":return new h.pointGeometry(u,u);case"top-right":return new h.pointGeometry(-u,u);case"bottom":return new h.pointGeometry(0,-f);case"bottom-left":return new h.pointGeometry(u,-u);case"bottom-right":return new h.pointGeometry(-u,-u);case"left":return new h.pointGeometry(f,0);case"right":return new h.pointGeometry(-f,0)}return new h.pointGeometry(0,0)}return f instanceof h.pointGeometry||Array.isArray(f)?h.pointGeometry.convert(f):h.pointGeometry.convert(f[o]||[0,0])}const Ja={version:h.version,supported:Me,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends ql{constructor(f){if(null!=(f=h.extend({},Es,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&h.isSafariWithAntialiasingBug(h.window)&&(f.antialias=!1,h.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sh(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language="auto"===f.language?h.window.navigator.language:f.language,this._worldview=f.worldview,this._renderTaskQueue=new Fp,this._domRenderTaskQueue=new Fp,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},ga,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Md(0),this._explicitProjection=null,this._requestManager=new h.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=h.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof h.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Po(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new ah("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,h.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Lp({customAttribution:f.customAttribution})),this._logoControl=new Ed,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new h.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new h.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(f,o){if(void 0===o&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new h.Event("movestart",f)).fire(new h.Event("move",f)),this.fire(new h.Event("resize",f)),o&&this.fire(new h.Event("moveend",f)),this}getBounds(){return"globe"===this.transform.projection.name&&h.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(h.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getLanguage(){return this._language}setLanguage(f){if(this._language="auto"===f?h.window.navigator.language:f,this.style)for(const o in this.style._sourceCaches){const u=this.style._sourceCaches[o]._source;u._setLanguage&&u._setLanguage(this._language)}for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){if(this._worldview=f,this.style)for(const o in this.style._sourceCaches){const u=this.style._sourceCaches[o]._source;u._setWorldview&&u._setWorldview(f)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._updateProjection(f)}_updateProjection(f){const o=this.getProjection();null===f&&(this._explicitProjection=null);const u=f||this.getProjection();let g;if(u&&"globe"===u.name&&this.transform.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?(g=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(g=this.transform.setProjection(u),this.transform.mercatorFromTransition=!1),f&&(this._explicitProjection="globe"===f.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),g){if("globe"===o.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const v in this.style._sourceCaches)this.style._sourceCaches[v].clearTiles()}this._update(!0)}return this}project(f){return this.transform.locationPoint3D(h.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(h.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(f,o,u){if("mouseenter"===f||"mouseover"===f){let g=!1;const v=T=>{const D=o.filter(O=>this.getLayer(O)),I=D.length?this.queryRenderedFeatures(T.point,{layers:D}):[];I.length?g||(g=!0,u.call(this,new oo(f,this,T.originalEvent,{features:I}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const v=T=>{const D=o.filter(I=>this.getLayer(I));(D.length?this.queryRenderedFeatures(T.point,{layers:D}):[]).length?g=!0:g&&(g=!1,u.call(this,new oo(f,this,T.originalEvent)))},b=T=>{g&&(g=!1,u.call(this,new oo(f,this,T.originalEvent)))};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=o.filter(D=>this.getLayer(D)),T=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];T.length&&(v.features=T,u.call(this,v),delete v.features)};return{layers:new Set(o),listener:u,delegates:{[f]:g}}}}on(f,o,u){if(void 0===u)return super.on(f,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(f,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,o,u){if(void 0===u)return super.once(f,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(f,o,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,o,u){if(void 0===u)return super.off(f,o);o=new Set(Array.isArray(o)?o:[o]);const g=(b,T)=>{if(b.size!==T.size)return!1;for(const D of b)if(!T.has(D))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(b=>{for(let T=0;T<b.length;T++){const D=b[T];if(D.listener===u&&g(D.layers,o)){for(const I in D.delegates)this.off(I,D.delegates[I]);return b.splice(T,1),this}}})(v),this}queryRenderedFeatures(f,o){return this.style?(void 0!==o||void 0===f||f instanceof h.pointGeometry||Array.isArray(f)||(o=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(f,o){return this.style.querySourceFeatures(f,o)}queryTerrainElevation(f,o){const u=this.transform.elevation;return u?(o=h.extend({},{exaggerated:!0},o),u.getAtPoint(h.MercatorCoordinate.fromLngLat(f),null,o.exaggerated)):null}setStyle(f,o){return!1!==(o=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){const o=this._locale[f];if(null==o)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new ui(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ui(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,o){if("string"==typeof f){const u=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(u,h.ResourceType.Style);h.getJSON(g,(v,b)=>{v?this.fire(new h.ErrorEvent(v)):b&&this._updateDiff(b,o)})}else"object"==typeof f&&this._updateDiff(f,o)}_updateDiff(f,o){try{this.style.setState(f)&&this._update(!0)}catch(u){h.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.warnOnce("There is no style added to the map."),!1)}addSource(f,o){return this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const o in f){const u=f[o]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,o,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,o,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap){const{width:D,height:I,data:O}=h.exported.getImageData(o);this.style.addImage(f,{data:new h.RGBAImage({width:D,height:I},O),pixelRatio:u,stretchX:v,stretchY:b,content:T,sdf:g,version:0})}else if(void 0===o.width||void 0===o.height)this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:I}=o,O=o;this.style.addImage(f,{data:new h.RGBAImage({width:D,height:I},new Uint8Array(O.data)),pixelRatio:u,stretchX:v,stretchY:b,content:T,sdf:g,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f)}}updateImage(f,o){const u=this.style.getImage(f);if(!u)return void this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap?h.exported.getImageData(o):o,{width:v,height:b}=g;void 0!==v&&void 0!==b?v===u.data.width&&b===u.data.height?(u.data.replace(g.data,!(o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new h.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){h.getImage(this._requestManager.transformRequest(f,h.ResourceType.Image),(u,g)=>{o(u,g instanceof h.window.HTMLImageElement?h.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,o){return this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)}moveLayer(f,o){return this.style.moveLayer(f,o),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,o,u){return this.style.setLayerZoomRange(f,o,u),this._update(!0)}setFilter(f,o,u={}){return this.style.setFilter(f,o,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,o,u,g={}){return this.style.setPaintProperty(f,o,u,g),this._update(!0)}getPaintProperty(f,o){return this.style.getPaintProperty(f,o)}setLayoutProperty(f,o,u,g={}){return this.style.setLayoutProperty(f,o,u,g),this._update(!0)}getLayoutProperty(f,o){return this.style.getLayoutProperty(f,o)}setLight(f,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(f),this.transform):0}setFeatureState(f,o){return this.style.setFeatureState(f,o),this._update()}removeFeatureState(f,o){return this.style.removeFeatureState(f,o),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,g,v,b=this._container;for(;b&&(!g||!v);){const T=h.window.getComputedStyle(b).transform;T&&"none"!==T&&(u=T.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(g=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(v=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Te("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Te("div","mapboxgl-canvas-container",f);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Te("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Te("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Te("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){const u=h.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const o=this._markers.indexOf(f);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const f=h.extend({},Me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);o?(h.storeAuthState(o,!0),this.painter=new yd(o,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(o)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;const u=this.painter.context.extTimerQuery,g=h.exported.now();if(this.listens("gpu-timing-frame")&&(o=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let v=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,O=this.transform.pitch,R=h.exported.now();this.style.zoomHistory.update(I,R);const B=new h.EvaluationParameters(I,{now:R,fadeDuration:b,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=B.crossFadingFactor();1===$&&$===this._crossFadingFactor||(v=!0,this._crossFadingFactor=$),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const I=h.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,o),setTimeout(()=>{const O=u.getQueryObjectEXT(o,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(o),this.fire(new h.Event("gpu-timing-frame",{cpuTime:I,gpuTime:O})),h.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:O}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(I);this.fire(new h.Event("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(I);this.fire(new h.Event("gpu-timing-deferred-render",{gpuTime:O}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,o=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const T=Math.abs(g-v);if(T>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===h.AUTH_ERR_MSG||401===f.status)){const o=this.painter.context.gl;h.storeAuthState(o,!1),this._logoControl instanceof Ed&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const T=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,T),T}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(f,o,u){let g=u[1]-u[0];const v=f.length/4;for(let b=0;b<o.length;b++){const T=o[b];let D=0;for(let I=0;I<T.length;I+=4)T[I]===f[I]&&T[I+1]===f[I+1]&&T[I+2]===f[I+2]&&T[I+3]===f[I+3]&&(D+=1);g+=(u[b+2]-u[b+1])*(1-D/v)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),hh(this._canvasContainer),hh(this._controlContainer),hh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=h.exported.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(f){const o=this.style?Object.values(this.style._sourceCaches):[];return h.asyncAll(o,(u,g)=>u._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,o){h.setCacheLimits(f,o)}get version(){return h.version}},NavigationControl:class{constructor(f){this.options=h.extend({},Td,f),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:o}):u.resetNorth({},{originalEvent:o}))}),this._compassIcon=Te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const o=f.getZoom(),u=o===f.getMaxZoom(),g=o===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zp(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){const u=Te("button",f,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(f,o){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends h.Evented{constructor(f){super(),this.options=h.extend({geolocation:h.window.navigator.geolocation},Dd,f),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$l(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(o=>{this._supportsGeolocation="denied"!==o.state,f(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.geolocation,f(this._supportsGeolocation))}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),u=f.coords;return!!o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",f)),this._finish()}}_updateCamera(f){const o=new h.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,g=this._map.getBearing(),v=h.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),v,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new h.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,o=h.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Te("button","mapboxgl-ctrl-geolocate",this._container),Te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Te("div","mapboxgl-user-location"),this._dotElement.appendChild(Te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientation),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lp,ScaleControl:class{constructor(f){this.options=h.extend({},dh,f),h.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(f,o,u,g){const v=g&&g.maxWidth||100,b=f._containerHeight/2,T=f._containerWidth/2-v/2,D=f.unproject([T,b]),I=f.unproject([T+v,b]),O=D.distanceTo(I);if(g&&"imperial"===g.unit){const R=3.2808*O;R>5280?Ws(o,v,R/5280,u,"mile",f):Ws(o,v,R,u,"foot",f)}else g&&"nautical"===g.unit?Ws(o,v,O/1852,u,"nautical-mile",f):O>=1e3?Ws(o,v,O/1e3,u,"kilometer",f):Ws(o,v,O,u,"meter",f)}(this._map,this._container,this._language,this.options)}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof h.window.HTMLElement?this._container=f.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Te("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(f){super(),this.options=h.extend(Object.create(Sd),f),h.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=h.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(h.window.document.createTextNode(f))}setHTML(f){const o=h.window.document.createDocumentFragment(),u=h.window.document.createElement("body");let g;for(u.innerHTML=f;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Te("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){const u=this._closeButton=Te("button","mapboxgl-popup-close-button",o);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const o=this._map,u=this._container,g=this._pos;if(!o||!u||!g)return"bottom";const v=u.offsetWidth,b=u.offsetHeight,T=g.x<v/2,D=g.x>o.transform.width-v/2;if(g.y+f<b)return T?"top-left":D?"top-right":"top";if(g.y>o.transform.height-b){if(T)return"bottom-left";if(D)return"bottom-right"}return T?"left":D?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){const o=this._map,u=this._content;if(!o||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Te("div","mapboxgl-popup",o.getContainer()),this._tip=Te("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zl(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f?f:o.project(this._lngLat),b=ph(this.options.offset),T=this._anchor=this._getAnchor(b.y),D=ph(this.options.offset,T),I=v.add(D).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Pi[T]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&o._usingGlobe()){const v=h.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Fc);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Wo,Style:ui,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:ih,Evented:h.Evented,config:h.config,prewarm:function(){Kn().acquire(Kt)},clearPrewarmedResources:function(){const f=bn;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Kt),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(f){h.config.ACCESS_TOKEN=f},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(f){h.config.API_URL=f},get workerCount(){return rn.workerCount},set workerCount(f){rn.workerCount=f},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){h.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){h.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return Ja}),Ue}()},775:function(At){var Ue;Ue=function(){var Fe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function Ue(Me){return Me.match(Fe)||[]}function xe(Me){return{language:(Me=Ue(Me))[1]||"",extlang:Me[2]||"",script:Me[3]||"",region:Me[4]||""}}function h(Me,Ce,ce){Object.defineProperty(Me,Ce,{value:ce,enumerable:!0})}function H(Me,Ce,ce){function Te(rt){return Ue(rt)[Me]||""}h(Te,"pattern",Ce),h(xe,ce,Te)}return H(1,/^[a-zA-Z]{2,3}$/,"language"),H(2,/^[a-zA-Z]{3}$/,"extlang"),H(3,/^[a-zA-Z]{4}$/,"script"),H(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),h(xe,"split",function Ne(Me){return Ue(Me).filter(function(Ce,ce){return Ce&&ce})}),xe},At.exports?At.exports=Ue():this.subtag=Ue()},562:(At,Et,Fe)=>{"use strict";var Ue=Fe(576);At.exports=Ue,typeof window<"u"&&(window.Suggestions=Ue)},554:At=>{"use strict";var Et=function(Fe){return this.component=Fe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,Fe.el.parentNode.insertBefore(this.wrapper,Fe.el.nextSibling),this};Et.prototype.show=function(){this.element.style.display="block"},Et.prototype.hide=function(){this.element.style.display="none"},Et.prototype.add=function(Fe){this.items.push(Fe)},Et.prototype.clear=function(){this.items=[],this.active=0},Et.prototype.isEmpty=function(){return!this.items.length},Et.prototype.isVisible=function(){return"block"===this.element.style.display},Et.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Fe=0;Fe<this.items.length;Fe++)this.drawItem(this.items[Fe],this.active===Fe);this.show()}else this.hide()},Et.prototype.drawItem=function(Fe,Ue){var Ne=document.createElement("li"),xe=document.createElement("a");Ue&&(Ne.className+=" active"),xe.innerHTML=Fe.string,Ne.appendChild(xe),this.element.appendChild(Ne),Ne.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Ne.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Fe)}.bind(this))},Et.prototype.handleMouseUp=function(Fe){this.selectingListItem=!1,this.component.value(Fe.original),this.clear(),this.draw()},Et.prototype.move=function(Fe){this.active=Fe,this.draw()},Et.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Et.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Et.prototype.drawError=function(Fe){var Ue=document.createElement("li");Ue.innerHTML=Fe,this.element.appendChild(Ue),this.show()},At.exports=Et},576:(At,Et,Fe)=>{"use strict";var Ue=Fe(703),Ne=Fe(780),xe=Fe(554),h=function(H,Me,Ce){return this.options=Ue({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Ce=Ce||{}),this.el=H,this.data=Me||[],this.list=new xe(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ce){this.handleKeyUp(ce.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ce){this.handleKeyDown(ce)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ce){this.handlePaste(ce)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};h.prototype.handleKeyUp=function(H){40===H||38===H||27===H||13===H||9===H||this.handleInputChange(this.el.value)},h.prototype.handleKeyDown=function(H){switch(H.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&H.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},h.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},h.prototype.handlePaste=function(H){if(H.clipboardData)this.handleInputChange(H.clipboardData.getData("Text"));else{var Me=this;setTimeout(function(){Me.handleInputChange(H.target.value)},100)}},h.prototype.handleInputChange=function(H){this.query=this.normalize(H),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Me){for(var Ce=0;Ce<Me.length&&(this.list.add(Me[Ce]),Ce!==this.options.limit-1);Ce++);this.list.draw()}.bind(this))},h.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},h.prototype.update=function(H){this.data=H,this.handleKeyUp()},h.prototype.clear=function(){this.data=[],this.list.clear()},h.prototype.normalize=function(H){return H.toLowerCase()},h.prototype.match=function(H,Me){return H.indexOf(Me)>-1},h.prototype.value=function(H){if(this.selected=H,this.el.value=this.getItemValue(H),document.createEvent){var Me=document.createEvent("HTMLEvents");Me.initEvent("change",!0,!1),this.el.dispatchEvent(Me)}else this.el.fireEvent("onchange")},h.prototype.getCandidates=function(H){var Me={pre:"<strong>",post:"</strong>",extract:function(ce){return this.getItemValue(ce)}.bind(this)};H(this.options.filter?Ne.filter(this.query,this.data,Me).map(function(ce){return{original:ce.original,string:this.render(ce.original,ce.string)}}.bind(this)):this.data.map(function(ce){return{original:ce,string:this.render(ce)}}.bind(this)))},h.prototype.getItemValue=function(H){return H},h.prototype.render=function(H,Me){if(Me)return Me;for(var Ce=this.getItemValue(H.original?H.original:H),ce=this.normalize(Ce),Te=ce.lastIndexOf(this.query);Te>-1;){var rt=Te+this.query.length;Ce=Ce.slice(0,Te)+"<strong>"+Ce.slice(Te,rt)+"</strong>"+Ce.slice(rt),Te=ce.slice(0,Te).lastIndexOf(this.query)}return Ce},h.prototype.renderError=function(H){this.list.drawError(H)},At.exports=h},703:At=>{At.exports=function Fe(){for(var Ue={},Ne=0;Ne<arguments.length;Ne++){var xe=arguments[Ne];for(var h in xe)Et.call(xe,h)&&(Ue[h]=xe[h])}return Ue};var Et=Object.prototype.hasOwnProperty},652:(At,Et,Fe)=>{"use strict";Fe.d(Et,{x0:()=>h});let h=(H=21)=>crypto.getRandomValues(new Uint8Array(H)).reduce((Me,Ce)=>Me+((Ce&=63)<36?Ce.toString(36):Ce<62?(Ce-26).toString(36).toUpperCase():Ce>62?"-":"_"),"")}},At=>{At(At.s=729)}]);